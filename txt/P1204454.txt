8
1
0
2
 
n
u
J
 
1
1
 
 
]

V
C
.
s
c
[
 
 
3
v
3
9
3
3
0
.
4
0
8
1
:
v
i
X
r
a

Roto-Translation Covariant Convolutional
Networks for Medical Image Analysis

Erik J Bekkers∗,1, Maxime W Lafarge∗,2, Mitko Veta2, Koen AJ Eppenhof2,
Josien PW Pluim2 and Remco Duits1

Eindhoven University of Technology, 1Department of Mathematics and Computer
Science and 2Department of Biomedical Engineering, Eindhoven, The Netherlands
∗Joint main authors - e.j.bekkers@tue.nl, m.w.lafarge@tue.nl

Abstract. We propose a framework for rotation and translation covari-
ant deep learning using SE(2) group convolutions. The group product
of the special Euclidean motion group SE(2) describes how a concatena-
tion of two roto-translations results in a net roto-translation. We encode
this geometric structure into convolutional neural networks (CNNs) via
SE(2) group convolutional layers, which ﬁt into the standard 2D CNN
framework, and which allow to generically deal with rotated input sam-
ples without the need for data augmentation.
We introduce three layers: a lifting layer which lifts a 2D (vector valued)
image to an SE(2)-image, i.e., 3D (vector valued) data whose domain is
SE(2); a group convolution layer from and to an SE(2)-image; and a pro-
jection layer from an SE(2)-image to a 2D image. The lifting and group
convolution layers are SE(2) covariant (the output roto-translates with
the input). The ﬁnal projection layer, a maximum intensity projection
over rotations, makes the full CNN rotation invariant.
We show with three diﬀerent problems in histopathology, retinal imaging,
and electron microscopy that with the proposed group CNNs, state-of-
the-art performance can be achieved, without the need for data augmen-
tation by rotation and with increased performance compared to standard
CNNs that do rely on augmentation.

Keywords: Group convolutional network, roto-translation group, mi-
tosis detection, vessel segmentation, cell boundary segmentation

1

Introduction

In this work we generalize R2 convolutional neural networks (CNNs) to SE(2)
group CNNs (G-CNNs) in which the data lives on position orientation space,
and in which the convolution layers are deﬁned in terms of representations of the
special Euclidean motion group SE(2). In essence this means that we replace
the convolutions (with translations of a kernel) by SE(2) group convolutions
(with roto-translations of a kernel). The advantage of the proposed approach
compared to standard R2 CNNs is that rotation covariance is encoded in the
network design and does not have to be learned by the convolution kernels. E.g.,
a feature that may appear in the data under several orientations does not have

to be learned for each orientation, but only once. As a result, there is no need
for data augmentation by rotation and the kernel weights (that no longer need
to learn rotation covariance) become available to increase the CNNs expressive
capacity. Moreover, the proposed group convolution layers are compatible with
standard CNN modules, allowing for easy integration in popular CNN designs.
A main objective of medical image analysis is to develop models that are
invariant to the shape and appearance variability of the structures of interest,
including their arbitrary orientations. Rotation-invariance is a desired property,
which our G-CNN framework generically deals with. We show state-of-the-art
results with improvement over standard 2D CNNs on three diﬀerent medical
imaging tasks: mitosis detection in histopathology images, vessel segmentation
in retinal images and cell boundary segmentation in electron microscopy (EM).

1.1 Related work

In relation to other approaches that incorporate rotation invariance/covariance
in the network design, such as harmonic networks [1], local transformation in-
variance learning [2], deep symmetry nets [3], scattering CNNs [4, 5], and warped
convolutions [6], the group convolution approaches [7, 8, 9, 4, 5, 10] most natu-
rally extend the standard CNNs by simply replacing the convolution operators.
In the work by Cohen & Welling [7] a comprehensive theoretical framework
for G-CNNs is developed for discrete groups whose transformations stay on the
pixel grid. In particular their focus was on the wall-paper groups p4 (group of
translations + 90◦ rotations), for which a G-CNN approach was also developed
by Dieleman et al. [8], and p4m (p4 + reﬂections). In their work it was con-
vincingly demonstrated that including such symmetries, by replacing standard
convolutions by group convolutions, substantially increases the network’s per-
formance without increasing the number of network variables. Although their
theoretical G-CNN framework [7] holds for more general groups, their actual
application scope was limited to discrete groups that stay on the pixel grid. In
this paper, we are not restricted to such groups, but include eﬃcient bi-linear
interpolation that allows us to employ the full structure of the continuous roto-
translation group SE(2), which we can discretize to the sub-group SE(2, N ),
with N rotations. Special cases of our framework are standard 2D CNNs when
N = 1 and the p4 G-CNNs as proposed in [7, 8] when N = 4.

In very recent work, Weiler et al. [9] describe a diﬀerent approach to SE(2) G-
CNNs. Instead of relying on interpolation they used 2D complex-valued steerable
kernels, which has the advantage that kernel rotations are exact. A disadvantage
is, however, that these kernels are constrained to a speciﬁc combination of com-
plex valued basis functions. With our interpolation approach, kernel rotation
simply appears in the CNN architecture as a (sparse) matrix-vector multiplica-
tion, that maps a set of base weights to a full set of rotated kernels.

In work by Mallat, Oyallon, and Sifre [5, 4] roto-translation invariant deep
networks are formulated in the context of scattering theory. Their design involves
a concatenation of separable group convolutions with hand-crafted (but well un-
derpinned) ﬁlters, followed by the modulus as activation function. Learning takes

2

place via support vector machines on the generated SE(2) invariant descriptors.
In our approach, the ﬁlters are learned without restrictions, the convolutions do
not have to be separable, and we here use the common ReLU activation function.
In work by Bekkers et al. [10], an eﬀective template matching method was
proposed using group correlations in orientation scores, which are SE(2) images
obtained from a 2D image via lifting convolutions with a speciﬁc choice of kernel
[11]. The SE(2) templates were put in a B-spline basis (allowing for exact kernel
rotations) and optimized via logistic regression. Their architecture ﬁts within
our framework as a single channel G-CNN of depth 2 with a ﬁxed lifting kernel.

2 SE(2) convolutional neural networks

2.1 Group theoretical preliminaries

The Lie group SE(2): The group SE(2) = R2 (cid:111) SO(2) is the semi-direct
product of the group of planar translations R2 and rotations SO(2), and its
group product is given by

g · g(cid:48) = (x, Rθ) · (x(cid:48), Rθ(cid:48)) = (Rθx(cid:48) + x, Rθ+θ(cid:48)),

(1)

with group elements g = (x, θ), g(cid:48) = (x(cid:48), θ(cid:48)) ∈ SE(2), with translations x, x(cid:48) and
planar rotations by θ, θ(cid:48). The group acts on the space of positions and orienta-
tions R2 × S1 via g · (x(cid:48), θ(cid:48)) = (Rθx(cid:48) + x, θ + θ(cid:48)). Since (x, Rθ) · (0, 0) = (x, θ),
we can identify the group SE(2) with the space of positions and orientations
R2 × S1. As such we will often write g = (x, θ), instead of (x, Rθ). Note that
g−1 = (−R−1
Group representations: The structure of the group can be mapped to other
mathematical objects (such as 2D images) via representations. The left-regular
SE(2) representation on 2D images f ∈ L2(R2) is given by

θ x, −θ) since g · g−1 = g−1 · g = (0, 0).

(Ugf )(x(cid:48)) = f (R−1

θ (x(cid:48) − x)),

with g = (x, θ) ∈ SE(2), x(cid:48) ∈ R2. It corresponds to a roto-translation of the
image. The left-regular representation on functions F ∈ L2(SE(2)) on SE(2),
which we refer to as SE(2)-images, is given by

(LgF )(g(cid:48)) = F (g−1 · g(cid:48)) = F (R−1

θ (x(cid:48) − x), θ(cid:48) − θ),

with g = (x, θ), g(cid:48) = (x(cid:48), θ(cid:48)) ∈ SE(2). It is a shift-twist (rotation + θ-shift) of F ,
see e.g. Fig. 1. Next we deﬁne the G-CNN layers in terms of these representations.

(2)

(3)

2.2 The SE(2) group convolution layers

In CNNs one can take a convolution or a cross-correlation viewpoint and since
these operators simply relate via a kernel reﬂection, the terminology is often used
interchangeably. We take the second viewpoint, our G-CNNs are implemented

3

using cross-correlations. On R2 we deﬁne cross-correlation via inner products of
translated kernels:

(k (cid:63)R2 f )(x) := (Txk, f )L2(R2) :=

k(x(cid:48) − x)f (x(cid:48))dx(cid:48),

(4)

(cid:90)

R2

with Tx the translation operator, the left-regular representation of the translation
group (R2, +). In the SE(2) lifting layer we now simply replace translations of
k by roto-translations via the SE(2) representation Ug deﬁned in Eq. (2).
The SE(2) lifting layer: Let f , k : R2 → RNc be a vector valued 2D image
and kernel (with Nc channels), with f = (f1, . . . , fNc) and k = (k1, . . . , kNc ),
then the group lifting correlations for vector valued images are deﬁned by

(k ˜(cid:63)f )(g) :=

(Ugkc, fc)L2(R2) =

kc(R−1

θ (y − x))fc(y)dy.

(5)

Nc(cid:88)

c=1

Nc(cid:88)

(cid:90)

R2

c=1

These correlations lift 2D image data to data that lives on the 3D position
orientation space R2 × S1 ≡ SE(2). The lifting layer that maps from a vector
image f (l−1) : R2 → RNl−1, with Nl−1 channels at layer l − 1, to an SE(2) vector
image F (l) : SE(2) → RNl using a set of Nl kernels k(l) := (k(l)
), each
with Nl−1 channels, is then deﬁned by

1 , . . . , k(l)
Nl

F (l) = k(l)˜(cid:63)f (l−1) :=

(cid:16)

k(l)
1 ˜(cid:63)f (l−1) ,

. . . , k(l)
Nl

˜(cid:63)f (l−1) (cid:17)

.

(6)

The SE(2) group convolution layer: Let F , K : SE(2) → RNc be a vector
valued SE(2) image and kernel, with F = (F1, . . . , FNc) and K = (K1, . . . , KNc ),
then the group correlations are deﬁned as

(K (cid:63) F )(g) :=

(LgKc, Fc)L2(SE(2)) =

Kc(g−1 · h)Fc(h)dh,

(7)

Nc(cid:88)

c=1

Nc(cid:88)

(cid:90)

c=1

SE(2)

with (K, F )L2(SE(2)) := (cid:82)
set of SE(2) kernels K(l) := (K (l)
1 , . . . , K (l)
Nl
mapping from F (l−1) with N(l−1) channels to F (l) with N(l) channels, via

SE(2) K(h)F (h)dh, the inner product on L2(SE(2)). A
) deﬁnes a group convolution layer,

F (l) = K(l)(cid:63)F (l−1) :=

(cid:16)

K (l)

1 (cid:63)F (l−1) ,

. . .

, K (l)
Nl

(cid:63)F (l−1) (cid:17)

.

(8)

The projection layer: Projects a multi-channel SE(2) image back to R2 via

f (l)(x) = max
θ∈[0,2π]

F (l)(x, θ).

(9)

4

Fig. 1: Rotation co- and invariance. Top row: the activations after the lifting
convolutions with a single kernel k(2)
1 , stacked together it yields an SE(2) image
F (2)
(cf. Eq. (6)). The projection layer at the end of the pipeline gives a rotation
1
invariant feature vector. Bottom row: the same ﬁgures with a rotated input.

2.3 Discretization and network architecture

Discretization, kernel sizes and rotation: Discretized 2D images are sup-
ported on a bounded subset of Z2 ⊂ R2 and the kernels live on a spatially
rectangular grid of size n × n in Z2, with n the kernel size. We discretize the
Lie group SE(2, N ) := Z2 (cid:111) SO(2, N ), with the space of 2D rotations in SO(2)
sampled with N rotation angles θi = 2π
N i, with i = 0, . . . , N − 1. The discrete
lifting kernels k(l) at layer l, mapping from a 2D image with Nl−1 input channels
to an SE(2, N ) image with Nl channels, thus have a shape of n × n × Nl−1 × Nl.
The SE(2, N ) kernels K(l) have a shape of n × n × N × Nl−1 × Nl. A complete
set of rotations of kernels k(l) or K(l) can be constructed with a single matrix
multiplication from a vector that contains the shared kernel weights. This matrix
is sparse and encodes bi-linear interpolation and kernel rotation.

3 Experiments and Results

We consider three diﬀerent tasks in three diﬀerent modalities. In each we consider
the SE(2, N ) samplings with N ∈ {1, 2, 4, 8, 16} to study the eﬀect of the choice
of N in the SE(2, N ) discretization. See Table. 1 for the network settings. In each
experiment the data is augmented at train and test time with transposed versions
of the 2D input. For reference we also include transpose plus 90◦ rotation aug-
mentation for the N = 1 experiment (as in [12, 13]) in order to be able to show
that these are not necessary in our SE(2, N ) networks for N ≥ 4. Each experi-
ment is repeated 3 times with random initialization and sampling to get a rough

5

Table 1: SE(2, N ) chain settings for diﬀerent orientation samplings N .

N (Group) 1 (Z2)
Layer 1 - lifting with Eq. (6), n = 5
13 (845)

N1 (#w) 16 (1040)

2 (Z2 × p2)

Layer 2,3,4 - group conv. with Eq. (8), n = 5

4 (Z2 × p4)

8 (SE(2, 8))

16 (SE(2, 16))

10 (650)

8 (520)

6 (390)

N2 (#w) 16 (5408)
N3 (#w) 16 (5408)
N4 (#w) 64 (21632)

13 (7124)
13 (7124)
32 (17536)
Layer 5 - group conv. with Eq. (8) + projection with Eq. (9), n = 1

10 (8420)
10 (8420)
16 (13472)

8 (10768)
8 (10768)
8 (10768)

6 (12108)
6 (12108)
4 (8072)

N5 (#w) 16 (1056)

16 (1056)

16 (1056)

16 (1056)

16 (1056)

Layer 6 - standard conv. (output) layer, n = 1

N6 (#w) 1 (17)
Total #w 34561

1 (17)

33702

1 (17)

32035

1 (17)

33897

1 (17)

33751

estimate of the mean and variance on the performance. For a fair comparison for
diﬀerent N the overall number of weights is matched. For a fair comparison with
the R2 approach, the number of ”2D” activations (NlN ) in the last three layers
is also matched. Each network optimizes a logistic loss using stochastic gradient
descent with momentum using the same settings as in [12]. Our G-CNN imple-
mentations are available at https://github.com/tueimage/se2cnn. The results
are given in Fig. 2, the tasks and metrics are summarized as follows.

Fig. 2: Top row: Crop outs of images of the three tasks with the class probabilities
generated by our method. Bottom row: Mean results (±1 std. dev.).

Histopathology - Mitosis detection: The task aims at detecting mitotic
ﬁgures in hematoxylin-eosin stained slides. We used the public dataset AMIDA13
[14] that consists of high power ﬁeld images from 23 breast cancer cases. Eight
cases (458 mitoses) were used to train the networks with random batches of

6

68 × 68 image patches, balanced between mitotic and hard negative ﬁgures. This
receptive ﬁeld was obtained by means of max-pooling operations in the ﬁrst three
layers. Sets of candidate detections were generated as in [13] after selection of an
operating point on four validation cases (92 mitoses). We assessed an F1-score
for each model based on the 11 test cases (533 mitoses) in the conditions of [14].
Retina - Vessel segmentation: In this task the blood vessels in the retina are
segmented. For validation we use the public DRIVE database [15], which consists
of 40 retinal images with manual segmentations. The set is split in a training
set (of which we use 16 for training, and 4 for validation) and a test set of also
20 images. The G-CNNs produce a probability for the vessel and background
class. Training is done with 10000 patches (17 × 17) per class per image. The
output probabilities can be thresholded to create a binary segmentation, which
can be used to quantify performance in terms of sensitivity and speciﬁcity. The
area under the receiver operator characteristic (ROC) curve, in short AUC,
summarizes these performances into a single value.
Electron microscopy - Cell boundary segmentation: This task consists of
segmenting the boundaries of cells that are imaged with EM. We use the data and
evaluation system of the ISBI EM segmentation challenge [16]. The data consists
of 2 volumes (1 train, 1 test), each containing 30 consecutive images from a serial
section transmission EM. Both the segmentation and the evaluation is done by
treating the volumes as sequences of 2D slices. To increase receptive ﬁeld size
we include max pooling in the ﬁrst 2 layers. Training is done with 10000 patches
(48 × 48) per class per image. The main evaluation criterion for the challenge
is the Rand score, which measures the similarity between clusterings/connected
components [17]. The reported Rand score is the maximum score (for several
thresholds) computed for the connected components obtained after thinning of
the binary cell boundary segmentation, see [16] for more details.
Results: In each experiment we see that the performance of the baseline with
extra rotation augmentations is reached by the non-augmented G-CNNs for N ≥
4, and even is surpassed for N ≥ 8. In the ﬁrst two experiments we also observe
that the variance on the output is reduced with increasing N . Our results on the
public datasets match or improve upon the state of the art with the following
scores: F1-score=0.628 ± 0.006 for mitosis detection, AUC = 0.9784 ± 0.0001 for
vessel segmentation, Rand = 0.962 ± 0.008 for cell boundary segmentation.

4 Discussion and Conclusions

We showed a consistent improvement of performances across three medical im-
age analysis tasks when using G-CNNs compared to their corresponding CNN
baselines. The reported results are in line with the benchmark of each dataset
and the best performances were obtained for an orientation capacity N ≥ 4,
indicating the advantage of learning such rotation-invariant representations. We
observed improved stability over the repeated experiments in mitosis detection
and vessel segmentation for N = 8 and N = 16, suggesting a regularization
eﬀect due to the increased weight sharing with increasing N .

7

We conclude that it is beneﬁciary to include SE(2) group convolution lay-
ers in CNN network design, as this avoids the need for rotation augmentation
and it improves overall performance. In all three medical imaging problems we
achieved state-of-the-art results with the same (basic) network design for each
task. Based on these results we expect that our SE(2) layers may lead to a
further performance increase when embedded in more complex network designs,
such as the popular UNets and ResNets.
Acknowledgements: The research leading to these results has received funding
from the ERC council under the EC’s 7th Framework Programme (FP7/2007–
2013) / ERC grant agr. No. 335555.

References

[1] Worrall, D.E., Garbin, S.J., Turmukhambetov, D., Brostow, G.J.: Harmonic net-
works: Deep translation and rotation equivariance. In: CVPR. (2017) 5028–5037
[2] Sohn, K., Lee, H.: Learning invariant representations with local transformations.

In: CVPR, Omnipress (2012) 1339–1346

[3] Gens, R., Domingos, P.M.: Deep symmetry networks.
information processing systems. (2014) 2537–2545

In: Advances in neural

[4] Sifre, L., Mallat, S.: Rotation, scaling and deformation invariant scattering for

texture discrimination. In: CVPR, IEEE (2013) 1233–1240

[5] Oyallon, E., Mallat, S., Sifre, L.: Generic deep networks with wavelet scattering.

arXiv preprint arXiv:1312.5940 (2013)

[6] Henriques, J.F., Vedaldi, A.: Warped convolutions: Eﬃcient invariance to spatial

transformations. In: Int. Conf. on Machine Learning. (2017) 1461–1469

[7] Cohen, T., Welling, M.: Group equivariant convolutional networks. In: Int. Conf.

on Machine Learning. (2016) 2990–2999

[8] Dieleman, S., De Fauw, J., Kavukcuoglu, K.: Exploiting cyclic symmetry in con-

volutional neural networks. arXiv preprint arXiv:1602.02660 (2016)

[9] Weiler, M., Hamprecht, F.A., Storath, M.: Learning steerable ﬁlters for rotation

equivariant cnns. arXiv preprint arXiv:1711.07289 (2017)

[10] Bekkers, E.J., Loog, M., ter Haar Romeny, B.M., Duits, R.: Template matching

via densities on the roto-translation group. IEEE tPAMI 40(2) (2018) 452–466

[11] Duits, R., Felsberg, M., Granlund, G.H., ter Haar Romeny, B.M.: Image anal-
ysis and reconstruction using a wavelet transform constructed from a reducible
representation of the Euclidean motion group. IJCV 72(1) (2007) 79–102

[12] Lafarge, M.W., Pluim, J.P., Eppenhof, K.A., Moeskops, P., Veta, M.: Domain-
adversarial neural networks to address the appearance variability of histopathol-
ogy images. In: MICCAI-DLMIA 2017. Springer (2017) 83–91

[13] Cire¸san, D.C., Giusti, A., et al.: Mitosis detection in breast cancer histology

images with deep neural networks. In: MICCAI, Springer (2013) 411–418

[14] Veta, M., van Diest, P., Willems, S., et al.: Assessment of algorithms for mitosis
detection in breast cancer histopathology images. MEDIA 20(1) (2015) 237–248
[15] Staal, J., Abr`amoﬀ, M.D., Niemeijer, M., et al.: Ridge-based vessel segmentation

in color images of the retina. IEEE TMI 23(4) (2004) 501–509

[16] Arganda-Carreras, I., Turaga, S.C., et al.: Crowdsourcing the creation of image
segmentation algorithms for connectomics. Front. in neuroanatomy 9 (2015) 142
[17] Rand, W.M.: Objective criteria for the evaluation of clustering methods. Journal

of the American Statistical association 66(336) (1971) 846–850

8

8
1
0
2
 
n
u
J
 
1
1
 
 
]

V
C
.
s
c
[
 
 
3
v
3
9
3
3
0
.
4
0
8
1
:
v
i
X
r
a

Roto-Translation Covariant Convolutional
Networks for Medical Image Analysis

Erik J Bekkers∗,1, Maxime W Lafarge∗,2, Mitko Veta2, Koen AJ Eppenhof2,
Josien PW Pluim2 and Remco Duits1

Eindhoven University of Technology, 1Department of Mathematics and Computer
Science and 2Department of Biomedical Engineering, Eindhoven, The Netherlands
∗Joint main authors - e.j.bekkers@tue.nl, m.w.lafarge@tue.nl

Abstract. We propose a framework for rotation and translation covari-
ant deep learning using SE(2) group convolutions. The group product
of the special Euclidean motion group SE(2) describes how a concatena-
tion of two roto-translations results in a net roto-translation. We encode
this geometric structure into convolutional neural networks (CNNs) via
SE(2) group convolutional layers, which ﬁt into the standard 2D CNN
framework, and which allow to generically deal with rotated input sam-
ples without the need for data augmentation.
We introduce three layers: a lifting layer which lifts a 2D (vector valued)
image to an SE(2)-image, i.e., 3D (vector valued) data whose domain is
SE(2); a group convolution layer from and to an SE(2)-image; and a pro-
jection layer from an SE(2)-image to a 2D image. The lifting and group
convolution layers are SE(2) covariant (the output roto-translates with
the input). The ﬁnal projection layer, a maximum intensity projection
over rotations, makes the full CNN rotation invariant.
We show with three diﬀerent problems in histopathology, retinal imaging,
and electron microscopy that with the proposed group CNNs, state-of-
the-art performance can be achieved, without the need for data augmen-
tation by rotation and with increased performance compared to standard
CNNs that do rely on augmentation.

Keywords: Group convolutional network, roto-translation group, mi-
tosis detection, vessel segmentation, cell boundary segmentation

1

Introduction

In this work we generalize R2 convolutional neural networks (CNNs) to SE(2)
group CNNs (G-CNNs) in which the data lives on position orientation space,
and in which the convolution layers are deﬁned in terms of representations of the
special Euclidean motion group SE(2). In essence this means that we replace
the convolutions (with translations of a kernel) by SE(2) group convolutions
(with roto-translations of a kernel). The advantage of the proposed approach
compared to standard R2 CNNs is that rotation covariance is encoded in the
network design and does not have to be learned by the convolution kernels. E.g.,
a feature that may appear in the data under several orientations does not have

to be learned for each orientation, but only once. As a result, there is no need
for data augmentation by rotation and the kernel weights (that no longer need
to learn rotation covariance) become available to increase the CNNs expressive
capacity. Moreover, the proposed group convolution layers are compatible with
standard CNN modules, allowing for easy integration in popular CNN designs.
A main objective of medical image analysis is to develop models that are
invariant to the shape and appearance variability of the structures of interest,
including their arbitrary orientations. Rotation-invariance is a desired property,
which our G-CNN framework generically deals with. We show state-of-the-art
results with improvement over standard 2D CNNs on three diﬀerent medical
imaging tasks: mitosis detection in histopathology images, vessel segmentation
in retinal images and cell boundary segmentation in electron microscopy (EM).

1.1 Related work

In relation to other approaches that incorporate rotation invariance/covariance
in the network design, such as harmonic networks [1], local transformation in-
variance learning [2], deep symmetry nets [3], scattering CNNs [4, 5], and warped
convolutions [6], the group convolution approaches [7, 8, 9, 4, 5, 10] most natu-
rally extend the standard CNNs by simply replacing the convolution operators.
In the work by Cohen & Welling [7] a comprehensive theoretical framework
for G-CNNs is developed for discrete groups whose transformations stay on the
pixel grid. In particular their focus was on the wall-paper groups p4 (group of
translations + 90◦ rotations), for which a G-CNN approach was also developed
by Dieleman et al. [8], and p4m (p4 + reﬂections). In their work it was con-
vincingly demonstrated that including such symmetries, by replacing standard
convolutions by group convolutions, substantially increases the network’s per-
formance without increasing the number of network variables. Although their
theoretical G-CNN framework [7] holds for more general groups, their actual
application scope was limited to discrete groups that stay on the pixel grid. In
this paper, we are not restricted to such groups, but include eﬃcient bi-linear
interpolation that allows us to employ the full structure of the continuous roto-
translation group SE(2), which we can discretize to the sub-group SE(2, N ),
with N rotations. Special cases of our framework are standard 2D CNNs when
N = 1 and the p4 G-CNNs as proposed in [7, 8] when N = 4.

In very recent work, Weiler et al. [9] describe a diﬀerent approach to SE(2) G-
CNNs. Instead of relying on interpolation they used 2D complex-valued steerable
kernels, which has the advantage that kernel rotations are exact. A disadvantage
is, however, that these kernels are constrained to a speciﬁc combination of com-
plex valued basis functions. With our interpolation approach, kernel rotation
simply appears in the CNN architecture as a (sparse) matrix-vector multiplica-
tion, that maps a set of base weights to a full set of rotated kernels.

In work by Mallat, Oyallon, and Sifre [5, 4] roto-translation invariant deep
networks are formulated in the context of scattering theory. Their design involves
a concatenation of separable group convolutions with hand-crafted (but well un-
derpinned) ﬁlters, followed by the modulus as activation function. Learning takes

2

place via support vector machines on the generated SE(2) invariant descriptors.
In our approach, the ﬁlters are learned without restrictions, the convolutions do
not have to be separable, and we here use the common ReLU activation function.
In work by Bekkers et al. [10], an eﬀective template matching method was
proposed using group correlations in orientation scores, which are SE(2) images
obtained from a 2D image via lifting convolutions with a speciﬁc choice of kernel
[11]. The SE(2) templates were put in a B-spline basis (allowing for exact kernel
rotations) and optimized via logistic regression. Their architecture ﬁts within
our framework as a single channel G-CNN of depth 2 with a ﬁxed lifting kernel.

2 SE(2) convolutional neural networks

2.1 Group theoretical preliminaries

The Lie group SE(2): The group SE(2) = R2 (cid:111) SO(2) is the semi-direct
product of the group of planar translations R2 and rotations SO(2), and its
group product is given by

g · g(cid:48) = (x, Rθ) · (x(cid:48), Rθ(cid:48)) = (Rθx(cid:48) + x, Rθ+θ(cid:48)),

(1)

with group elements g = (x, θ), g(cid:48) = (x(cid:48), θ(cid:48)) ∈ SE(2), with translations x, x(cid:48) and
planar rotations by θ, θ(cid:48). The group acts on the space of positions and orienta-
tions R2 × S1 via g · (x(cid:48), θ(cid:48)) = (Rθx(cid:48) + x, θ + θ(cid:48)). Since (x, Rθ) · (0, 0) = (x, θ),
we can identify the group SE(2) with the space of positions and orientations
R2 × S1. As such we will often write g = (x, θ), instead of (x, Rθ). Note that
g−1 = (−R−1
Group representations: The structure of the group can be mapped to other
mathematical objects (such as 2D images) via representations. The left-regular
SE(2) representation on 2D images f ∈ L2(R2) is given by

θ x, −θ) since g · g−1 = g−1 · g = (0, 0).

(Ugf )(x(cid:48)) = f (R−1

θ (x(cid:48) − x)),

with g = (x, θ) ∈ SE(2), x(cid:48) ∈ R2. It corresponds to a roto-translation of the
image. The left-regular representation on functions F ∈ L2(SE(2)) on SE(2),
which we refer to as SE(2)-images, is given by

(LgF )(g(cid:48)) = F (g−1 · g(cid:48)) = F (R−1

θ (x(cid:48) − x), θ(cid:48) − θ),

with g = (x, θ), g(cid:48) = (x(cid:48), θ(cid:48)) ∈ SE(2). It is a shift-twist (rotation + θ-shift) of F ,
see e.g. Fig. 1. Next we deﬁne the G-CNN layers in terms of these representations.

(2)

(3)

2.2 The SE(2) group convolution layers

In CNNs one can take a convolution or a cross-correlation viewpoint and since
these operators simply relate via a kernel reﬂection, the terminology is often used
interchangeably. We take the second viewpoint, our G-CNNs are implemented

3

using cross-correlations. On R2 we deﬁne cross-correlation via inner products of
translated kernels:

(k (cid:63)R2 f )(x) := (Txk, f )L2(R2) :=

k(x(cid:48) − x)f (x(cid:48))dx(cid:48),

(4)

(cid:90)

R2

with Tx the translation operator, the left-regular representation of the translation
group (R2, +). In the SE(2) lifting layer we now simply replace translations of
k by roto-translations via the SE(2) representation Ug deﬁned in Eq. (2).
The SE(2) lifting layer: Let f , k : R2 → RNc be a vector valued 2D image
and kernel (with Nc channels), with f = (f1, . . . , fNc) and k = (k1, . . . , kNc ),
then the group lifting correlations for vector valued images are deﬁned by

(k ˜(cid:63)f )(g) :=

(Ugkc, fc)L2(R2) =

kc(R−1

θ (y − x))fc(y)dy.

(5)

Nc(cid:88)

c=1

Nc(cid:88)

(cid:90)

R2

c=1

These correlations lift 2D image data to data that lives on the 3D position
orientation space R2 × S1 ≡ SE(2). The lifting layer that maps from a vector
image f (l−1) : R2 → RNl−1, with Nl−1 channels at layer l − 1, to an SE(2) vector
image F (l) : SE(2) → RNl using a set of Nl kernels k(l) := (k(l)
), each
with Nl−1 channels, is then deﬁned by

1 , . . . , k(l)
Nl

F (l) = k(l)˜(cid:63)f (l−1) :=

(cid:16)

k(l)
1 ˜(cid:63)f (l−1) ,

. . . , k(l)
Nl

˜(cid:63)f (l−1) (cid:17)

.

(6)

The SE(2) group convolution layer: Let F , K : SE(2) → RNc be a vector
valued SE(2) image and kernel, with F = (F1, . . . , FNc) and K = (K1, . . . , KNc ),
then the group correlations are deﬁned as

(K (cid:63) F )(g) :=

(LgKc, Fc)L2(SE(2)) =

Kc(g−1 · h)Fc(h)dh,

(7)

Nc(cid:88)

c=1

Nc(cid:88)

(cid:90)

c=1

SE(2)

with (K, F )L2(SE(2)) := (cid:82)
set of SE(2) kernels K(l) := (K (l)
1 , . . . , K (l)
Nl
mapping from F (l−1) with N(l−1) channels to F (l) with N(l) channels, via

SE(2) K(h)F (h)dh, the inner product on L2(SE(2)). A
) deﬁnes a group convolution layer,

F (l) = K(l)(cid:63)F (l−1) :=

(cid:16)

K (l)

1 (cid:63)F (l−1) ,

. . .

, K (l)
Nl

(cid:63)F (l−1) (cid:17)

.

(8)

The projection layer: Projects a multi-channel SE(2) image back to R2 via

f (l)(x) = max
θ∈[0,2π]

F (l)(x, θ).

(9)

4

Fig. 1: Rotation co- and invariance. Top row: the activations after the lifting
convolutions with a single kernel k(2)
1 , stacked together it yields an SE(2) image
F (2)
(cf. Eq. (6)). The projection layer at the end of the pipeline gives a rotation
1
invariant feature vector. Bottom row: the same ﬁgures with a rotated input.

2.3 Discretization and network architecture

Discretization, kernel sizes and rotation: Discretized 2D images are sup-
ported on a bounded subset of Z2 ⊂ R2 and the kernels live on a spatially
rectangular grid of size n × n in Z2, with n the kernel size. We discretize the
Lie group SE(2, N ) := Z2 (cid:111) SO(2, N ), with the space of 2D rotations in SO(2)
sampled with N rotation angles θi = 2π
N i, with i = 0, . . . , N − 1. The discrete
lifting kernels k(l) at layer l, mapping from a 2D image with Nl−1 input channels
to an SE(2, N ) image with Nl channels, thus have a shape of n × n × Nl−1 × Nl.
The SE(2, N ) kernels K(l) have a shape of n × n × N × Nl−1 × Nl. A complete
set of rotations of kernels k(l) or K(l) can be constructed with a single matrix
multiplication from a vector that contains the shared kernel weights. This matrix
is sparse and encodes bi-linear interpolation and kernel rotation.

3 Experiments and Results

We consider three diﬀerent tasks in three diﬀerent modalities. In each we consider
the SE(2, N ) samplings with N ∈ {1, 2, 4, 8, 16} to study the eﬀect of the choice
of N in the SE(2, N ) discretization. See Table. 1 for the network settings. In each
experiment the data is augmented at train and test time with transposed versions
of the 2D input. For reference we also include transpose plus 90◦ rotation aug-
mentation for the N = 1 experiment (as in [12, 13]) in order to be able to show
that these are not necessary in our SE(2, N ) networks for N ≥ 4. Each experi-
ment is repeated 3 times with random initialization and sampling to get a rough

5

Table 1: SE(2, N ) chain settings for diﬀerent orientation samplings N .

N (Group) 1 (Z2)
Layer 1 - lifting with Eq. (6), n = 5
13 (845)

N1 (#w) 16 (1040)

2 (Z2 × p2)

Layer 2,3,4 - group conv. with Eq. (8), n = 5

4 (Z2 × p4)

8 (SE(2, 8))

16 (SE(2, 16))

10 (650)

8 (520)

6 (390)

N2 (#w) 16 (5408)
N3 (#w) 16 (5408)
N4 (#w) 64 (21632)

13 (7124)
13 (7124)
32 (17536)
Layer 5 - group conv. with Eq. (8) + projection with Eq. (9), n = 1

10 (8420)
10 (8420)
16 (13472)

8 (10768)
8 (10768)
8 (10768)

6 (12108)
6 (12108)
4 (8072)

N5 (#w) 16 (1056)

16 (1056)

16 (1056)

16 (1056)

16 (1056)

Layer 6 - standard conv. (output) layer, n = 1

N6 (#w) 1 (17)
Total #w 34561

1 (17)

33702

1 (17)

32035

1 (17)

33897

1 (17)

33751

estimate of the mean and variance on the performance. For a fair comparison for
diﬀerent N the overall number of weights is matched. For a fair comparison with
the R2 approach, the number of ”2D” activations (NlN ) in the last three layers
is also matched. Each network optimizes a logistic loss using stochastic gradient
descent with momentum using the same settings as in [12]. Our G-CNN imple-
mentations are available at https://github.com/tueimage/se2cnn. The results
are given in Fig. 2, the tasks and metrics are summarized as follows.

Fig. 2: Top row: Crop outs of images of the three tasks with the class probabilities
generated by our method. Bottom row: Mean results (±1 std. dev.).

Histopathology - Mitosis detection: The task aims at detecting mitotic
ﬁgures in hematoxylin-eosin stained slides. We used the public dataset AMIDA13
[14] that consists of high power ﬁeld images from 23 breast cancer cases. Eight
cases (458 mitoses) were used to train the networks with random batches of

6

68 × 68 image patches, balanced between mitotic and hard negative ﬁgures. This
receptive ﬁeld was obtained by means of max-pooling operations in the ﬁrst three
layers. Sets of candidate detections were generated as in [13] after selection of an
operating point on four validation cases (92 mitoses). We assessed an F1-score
for each model based on the 11 test cases (533 mitoses) in the conditions of [14].
Retina - Vessel segmentation: In this task the blood vessels in the retina are
segmented. For validation we use the public DRIVE database [15], which consists
of 40 retinal images with manual segmentations. The set is split in a training
set (of which we use 16 for training, and 4 for validation) and a test set of also
20 images. The G-CNNs produce a probability for the vessel and background
class. Training is done with 10000 patches (17 × 17) per class per image. The
output probabilities can be thresholded to create a binary segmentation, which
can be used to quantify performance in terms of sensitivity and speciﬁcity. The
area under the receiver operator characteristic (ROC) curve, in short AUC,
summarizes these performances into a single value.
Electron microscopy - Cell boundary segmentation: This task consists of
segmenting the boundaries of cells that are imaged with EM. We use the data and
evaluation system of the ISBI EM segmentation challenge [16]. The data consists
of 2 volumes (1 train, 1 test), each containing 30 consecutive images from a serial
section transmission EM. Both the segmentation and the evaluation is done by
treating the volumes as sequences of 2D slices. To increase receptive ﬁeld size
we include max pooling in the ﬁrst 2 layers. Training is done with 10000 patches
(48 × 48) per class per image. The main evaluation criterion for the challenge
is the Rand score, which measures the similarity between clusterings/connected
components [17]. The reported Rand score is the maximum score (for several
thresholds) computed for the connected components obtained after thinning of
the binary cell boundary segmentation, see [16] for more details.
Results: In each experiment we see that the performance of the baseline with
extra rotation augmentations is reached by the non-augmented G-CNNs for N ≥
4, and even is surpassed for N ≥ 8. In the ﬁrst two experiments we also observe
that the variance on the output is reduced with increasing N . Our results on the
public datasets match or improve upon the state of the art with the following
scores: F1-score=0.628 ± 0.006 for mitosis detection, AUC = 0.9784 ± 0.0001 for
vessel segmentation, Rand = 0.962 ± 0.008 for cell boundary segmentation.

4 Discussion and Conclusions

We showed a consistent improvement of performances across three medical im-
age analysis tasks when using G-CNNs compared to their corresponding CNN
baselines. The reported results are in line with the benchmark of each dataset
and the best performances were obtained for an orientation capacity N ≥ 4,
indicating the advantage of learning such rotation-invariant representations. We
observed improved stability over the repeated experiments in mitosis detection
and vessel segmentation for N = 8 and N = 16, suggesting a regularization
eﬀect due to the increased weight sharing with increasing N .

7

We conclude that it is beneﬁciary to include SE(2) group convolution lay-
ers in CNN network design, as this avoids the need for rotation augmentation
and it improves overall performance. In all three medical imaging problems we
achieved state-of-the-art results with the same (basic) network design for each
task. Based on these results we expect that our SE(2) layers may lead to a
further performance increase when embedded in more complex network designs,
such as the popular UNets and ResNets.
Acknowledgements: The research leading to these results has received funding
from the ERC council under the EC’s 7th Framework Programme (FP7/2007–
2013) / ERC grant agr. No. 335555.

References

[1] Worrall, D.E., Garbin, S.J., Turmukhambetov, D., Brostow, G.J.: Harmonic net-
works: Deep translation and rotation equivariance. In: CVPR. (2017) 5028–5037
[2] Sohn, K., Lee, H.: Learning invariant representations with local transformations.

In: CVPR, Omnipress (2012) 1339–1346

[3] Gens, R., Domingos, P.M.: Deep symmetry networks.
information processing systems. (2014) 2537–2545

In: Advances in neural

[4] Sifre, L., Mallat, S.: Rotation, scaling and deformation invariant scattering for

texture discrimination. In: CVPR, IEEE (2013) 1233–1240

[5] Oyallon, E., Mallat, S., Sifre, L.: Generic deep networks with wavelet scattering.

arXiv preprint arXiv:1312.5940 (2013)

[6] Henriques, J.F., Vedaldi, A.: Warped convolutions: Eﬃcient invariance to spatial

transformations. In: Int. Conf. on Machine Learning. (2017) 1461–1469

[7] Cohen, T., Welling, M.: Group equivariant convolutional networks. In: Int. Conf.

on Machine Learning. (2016) 2990–2999

[8] Dieleman, S., De Fauw, J., Kavukcuoglu, K.: Exploiting cyclic symmetry in con-

volutional neural networks. arXiv preprint arXiv:1602.02660 (2016)

[9] Weiler, M., Hamprecht, F.A., Storath, M.: Learning steerable ﬁlters for rotation

equivariant cnns. arXiv preprint arXiv:1711.07289 (2017)

[10] Bekkers, E.J., Loog, M., ter Haar Romeny, B.M., Duits, R.: Template matching

via densities on the roto-translation group. IEEE tPAMI 40(2) (2018) 452–466

[11] Duits, R., Felsberg, M., Granlund, G.H., ter Haar Romeny, B.M.: Image anal-
ysis and reconstruction using a wavelet transform constructed from a reducible
representation of the Euclidean motion group. IJCV 72(1) (2007) 79–102

[12] Lafarge, M.W., Pluim, J.P., Eppenhof, K.A., Moeskops, P., Veta, M.: Domain-
adversarial neural networks to address the appearance variability of histopathol-
ogy images. In: MICCAI-DLMIA 2017. Springer (2017) 83–91

[13] Cire¸san, D.C., Giusti, A., et al.: Mitosis detection in breast cancer histology

images with deep neural networks. In: MICCAI, Springer (2013) 411–418

[14] Veta, M., van Diest, P., Willems, S., et al.: Assessment of algorithms for mitosis
detection in breast cancer histopathology images. MEDIA 20(1) (2015) 237–248
[15] Staal, J., Abr`amoﬀ, M.D., Niemeijer, M., et al.: Ridge-based vessel segmentation

in color images of the retina. IEEE TMI 23(4) (2004) 501–509

[16] Arganda-Carreras, I., Turaga, S.C., et al.: Crowdsourcing the creation of image
segmentation algorithms for connectomics. Front. in neuroanatomy 9 (2015) 142
[17] Rand, W.M.: Objective criteria for the evaluation of clustering methods. Journal

of the American Statistical association 66(336) (1971) 846–850

8

