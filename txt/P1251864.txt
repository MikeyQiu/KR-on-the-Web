Joint 3D Face Reconstruction and Dense
Alignment with Position Map Regression
Network

Yao Feng†, Fan Wu‡, Xiaohu Shao§, Yanfeng Wang†, Xi Zhou‡†

†Shanghai Jiao Tong University, ‡CloudWalk Technology
§Research Center for Intelligent Security Technology, CIGIT
fengyao@sjtu.edu.cn, wufan@cloudwalk.cn, shaoxiaohu@cigit.ac.cn
wangyanfeng@sjtu.edu.cn, zhouxi@cloudwalk.cn

Abstract. We propose a straightforward method that simultaneously
reconstructs the 3D facial structure and provides dense alignment. To
achieve this, we design a 2D representation called UV position map which
records the 3D shape of a complete face in UV space, then train a sim-
ple Convolutional Neural Network to regress it from a single 2D image.
We also integrate a weight mask into the loss function during training
to improve the performance of the network. Our method does not rely
on any prior face model, and can reconstruct full facial geometry along
with semantic meaning. Meanwhile, our network is very light-weighted
and spends only 9.8ms to process an image, which is extremely faster
than previous works. Experiments on multiple challenging datasets show
that our method surpasses other state-of-the-art methods on both re-
construction and alignment tasks by a large margin. Code is available at
https://github.com/YadiraF/PRNet.

Keywords: 3D Face Reconstruction, Face Alignment, Dense Correspon-
dence

8
1
0
2
 
r
a

M
 
1
2
 
 
]

V
C
.
s
c
[
 
 
1
v
5
3
8
7
0
.
3
0
8
1
:
v
i
X
r
a

1 Introduction

3D face reconstruction and face alignment are two fundamental and highly re-
lated topics in computer vision. In the last decades, researches in these two ﬁelds
beneﬁt each other. In the beginning, face alignment that aims at detecting a spe-
cial 2D ﬁducial points [1,2,3,4] is commonly used as a prerequisite for other facial
tasks such as face recognition [5] and assists 3D face reconstruction [6,7] to a
great extent. However, researchers ﬁnd that 2D alignment has diﬃculties [8,9]
in dealing with problems of large poses or occlusions. With the development of
deep learning, many computer vision problems have been well solved by utilizing
Convolution Neural Networks (CNNs). Thus, some works start to use CNNs to
estimate the 3D Morphable Model (3DMM) coeﬃcients [10,11,12,13,14,15] or
3D model warping functions [16,17] to restore the corresponding 3D information
from a single 2D facial image, which provides both dense face alignment and
3D face reconstruction results. However, the performance of these methods is
restricted due to the limitation of the 3D space deﬁned by face model basis or

2

Y. Feng et al.

Fig. 1: The qualitative results of our method. Odd row: alignment results (only
68 key points are plotted for display). Even row: 3D reconstruction results (re-
constructed shapes are rendered with head light for better view).

templates. The required operations including perspective projection or 3D Thin
Plate Spline (TPS) transformation also add complexity to the overall process.

Recently, two end-to-end works [18] [19], which bypass the limitation of model
space, achieve the state-of-the-art performances on their respective tasks. [19]
trains a complex network to regress 68 facial landmarks with 2D coordinates
from a single image, but needs an extra network to estimate the depth value.
Besides, dense alignment is not provided by this method. [18] develops a vol-
umetric representation of 3D face and uses a network to regress it from a 2D
image. However, this representation discards the semantic meaning of points,
thus the network needs to regress the whole volume in order to restore the fa-
cial shape, which is only part of the volume. So this representation limits the
resolution of the recovered shape, and need a complex network to regress it.
We ﬁnd that these limitations do not exist in previous model-based methods,
it motivates us to ﬁnd a new approach to obtaining the 3D reconstruction and
dense alignment simultaneously in a model-free manner.

In this paper, we propose an end-to-end method called Position map Regres-
sion Network (PRN) to jointly predict dense alignment and reconstruct 3D face
shape. Our method surpasses all other previous works on both 3D face alignment
and reconstruction on multiple datasets. Meanwhile, our method is straightfor-
ward with a very light-weighted model which provides the result in one pass with
9.8ms. All of these are achieved by the elaborate design of the 2D representation
of 3D facial structure and the corresponding loss function. Speciﬁcally, we design
a UV position map, which is a 2D image recording the 3D coordinates of a com-
plete facial point cloud, and at the same time keeping the semantic meaning at
each UV place. We then train a simple encoder-decoder network with a weighted
loss that focuses more on discriminative region to regress the UV position map

Joint 3D Face Reconstruction and Dense Alignment

3

from a single 2D facial image. Figure1 shows our method is robust to poses,
illuminations and occlusions.

In summary, our main contributions are:

– For the ﬁrst time, we solve the problems of face alignment and 3D face
reconstruction together in an end-to-end fashion without the restriction of
low-dimensional solution space.

– To directly regress the 3D facial structure and dense alignment, we develop
a novel representation called UV position map, which records the position
information of 3D face and provides dense correspondence to the semantic
meaning of each point on UV space.

– For training, we proposed a weight mask which assigns diﬀerent weight to
each point on position map and compute a weighted loss. We show that this
design helps improving the performance of our network.

– We ﬁnally provide a light-weighted framework that runs at over 100FPS to
directly obtain 3D face reconstruction and alignment result from a single 2D
facial image.

– Comparison on the AFLW2000-3D and Florence datasets shows that our
method achieves more than 25% relative improvements over other state-
of-the-art methods on both tasks of 3D face reconstruction and dense face
alignment.

2 Related Works

As described above, the main problems our method can solve are 3D face recon-
struction and face alignment. We will talk about closely related works on these
tasks in the following subsections.

2.1

3D Face Reconstruction

This part we only talk about 3D face reconstruction from a single image un-
der unconstrained situations. Since Blanz and Vetter proposed 3D Morphable
Model(3DMM) in 1999[20], methods based on 3DMM are the most popular in
completing the task of monocular 3D facial shape reconstruction. Most of earlier
methods are to establish the correspondences of the special points between input
images and the 3D mean geometry including landmarks[21,6,22,7,23,24,25] and
local features[26,27,25], then solve the non-linear optimization function to regress
the 3DMM coeﬃcients. However, these methods heavily rely on the high accu-
racy of landmarks or other feature points detector. Thus, some methods[28,29]
ﬁrstly use CNNs to learn the dense correspondence between input image and
3D template, then calculate the 3DMM parameters with predicted dense con-
strains. Recent works also explore the usage of CNN to predict 3DMM param-
eters directly. [10,11,12,13,14] use cascaded CNN structure to regress the accu-
rate 3DMM coeﬃcients, which take a lot of time due to iterations. [30,31,32,33]
propose end-to-end CNN architectures to directly estimate the 3DMM shape pa-
rameters. Unsupervised methods have been also researched recently, [34,35] can

4

Y. Feng et al.

regress the 3DMM coeﬃcients without the help of training data by using facial
texture information, which performs badly in faces with large-poses and unbal-
anced illuminations. However, the main defect of those methods are model-based,
resulting in a limited geometry which is constrained in model shape space and
post-processing to generate 3D mesh from estimated parameters. Some other
methods can reconstruct 3D faces without 3D shape basis, while still rely on
a 3D facial template. [36,37,38,17,39] can produce a 3D structure by warping
the shape of a reference 3D model. [16] also reconstruct the 3D shape of faces
by learning a 3D Thin Plate Spline(TPS) warping function via a deep network
which warps a generic 3D model to a subject speciﬁc 3D shape. Obviously, the
reconstructed face geometry from these methods are also restricted by the ref-
erence model, which means the structure diﬀers when the template changes.
Recently, [18] propose to straightforwardly map the image pixels to full 3D fa-
cial structure via volumetric CNN regression. This method is not restricted in
the model space any more, While needs a complex network structure and a lot
of time to predict the voxel data. Diﬀerent from above methods, Our framework
is model-free and light-weighted, can run at real time and directly obtain the
full 3D facial geometry along with its correspondence information.

2.2 Face Alignment

In the ﬁeld of computer vision, face alignment is a long-standing problem which
attracts a lot of attention. In the beginning, there are a number of 2D fa-
cial alignment approaches which aim at locating a set of ﬁducial 2D facial
landmarks, such as classic Active Appearance Model(AMM)[40,41,42] and Con-
strained Local Models(CLM)[43,44]. Then cascaded regression[45,46] and CNN-
based methods[3,4,19] are largely used to achieve state-of-the-art performance
in 2D landmarks location. However, 2D landmarks location only regresses vis-
ible points on faces, which leads to diﬃculties and is limited to describe face
shape when the pose of faces is large. Recent works then research the 3D fa-
cial alignment, which begins with ﬁtting a 3DMM[47,11,48] or registering a
3D facial template[39,49] with a 2D facial image. Obviously, 3D reconstruc-
tion methods based on model can easily complete the task of 3D face alignment
by selecting x,y coordinates of landmarks vertices in reconstructed geometry.
Actually, [11,29,32] are specially designated methods to achieve 3D face align-
ment by means of 3DMM ﬁtting. Recently [50,19] use a deep network to di-
rectly predict the heat map to obtain the 3D facial landmarks and achieves
state-of-the-art performance. Thus, as sparse face alignment tasks are highly
completed by aforementioned methods, the task of dense face alignment begins
to develop. Notice that, the dense face alignment means the methods should
oﬀer the correspondence between two face images as well as between a 2D facial
image and a 3D facial reference geometry. [15] use multi-constraints to train a
CNN which estimates the 3DMM parameters and then provides a very dense 3D
alignment. [28,29] directly learn the correspondence between a 2D input image
and a 3D template via a deep network, while those predicted correspondence is
not complete, only visible face-region is considered. Compared to prior works,

Joint 3D Face Reconstruction and Dense Alignment

5

our method can directly establish the dense correspondence between all region
in faces and 3D template once the position map is regressed. No intermediate
parameters such as 3DMM coeﬃcients and TPS warping parameters are needed
in our method, which means our network can run very fast bypassing complex
operations including perspective projection and TPS transformation.

3 Proposed Method

This section describes the framework and the details of our proposed method.
Firstly, we introduce the characteristics of the position map for our 3D face
representation. Then we elaborate the CNN architecture and the loss function
designed specially for learning the mapping from unconstrained RGB image to
its 3D structure. The implementation details of our method are shown in the
last subsection.

3.1

3D Face Representation

Our goal is to regress the 3D facial geometry and its dense correspondence in-
formation from a single 2D image. Thus we need a proper representation which
can be directly predicted via a deep network. One simple and commonly used
idea is to concatenate the coordinates of all points in 3D face as a vector and use
a network to predict it. However, this transformation increases the diﬃculties in
training since projection from 3D space into 1D vector discards the spatial adja-
cency information among points. While it’s natural to think that spatially adja-
cent points could share weights in predicting their positions, which can be easily
achieved by using convolutional layers. The coordinates as a 1D vector needs a
fully connected layer to predict each point with much more parameters, which
increases the network size and is hard to train. [51] proposed a point set genera-
tion network to directly predict the point cloud of 3D object as a vector from a
single image. However, the max number of points is only 1024, far from enough
to represent an accurate 3D face. So model-based methods[11,30,15] regress a
few model parameters rather than the coordinates of points, which usually needs
special care in training such as using Mahalanobis distance and inevitably limits
the estimated face geometry to the their model space. [18] proposed 3D binary
volume as the representation of 3D structure and uses Volumetric Regression
Network(VRN) to output a 192 × 192 × 200 volume as the discretized version
of point cloud. By using this representation, VRN can be built with full convo-
lutional layers. However, discretization limits the resolution of point cloud, and
most part of the network output correspond to non-surface points which are of
less usage.

To address the problems in previous works, we propose UV position map as
the presentation of full 3D facial structure. UV position map or position map
for short, is a 2D image recording 3D positions of all points in UV space. In
the past years, UV space or UV coordinates, which is a 2D image plane param-
eterized from the 3D space, has been utilized as a way to express information

6

Y. Feng et al.

including the texture of faces(texture map) [35,52,53,54], 2.5D geometry(height
map)[55,56] and the correspondences between 3D facial meshes[57]. Diﬀerent
from previous works, we use UV space to store the 3D coordinates of points
from 3D face model. As shown in Figure 2, we deﬁne the 3D face point cloud in
Left-handed Cartesian Coordinate system. The origin of the 3D space overlaps
with the upper-left of the input image, with the positive x-axis pointing to the
right of the image. The ground truth 3D face point cloud exactly matches the
face in the 2D image when projected to the x-y plane. Thus our position map
can be easily comprehended as replacing the r, g, b value in texture map by x,
y, z coordinates.

Fig. 2: The illustration of UV position map. Left: 3D plot of input image and
its ground truth 3D point cloud. Right: The ﬁrst row is the input 2D image,
extracted UV texture map and corresponding UV position map. The second
row is the x, y, z channel of the UV position map.

In order to keep the semantic meaning of points within position map, we cre-
ate our UV coordinates based on 3DMM. Since we want to regress the 3D full
structure directly, the unconstrained 2D facial images and their corresponding
3D shapes are needed for end-to-end training. 300W-LP[11] is a large dataset
that contains more than 60K unconstrained images with ﬁtted 3DMM parame-
ters, which is suitable to form our training pairs. Besides, the 3DMM parameters
of this dataset are based on the Basel Face Model(BFM)[20]. Thus, in order to
make full use of this dataset, we conduct the UV coordinates corresponding
to BFM. To be speciﬁc, we use the parameterized UV coordinates from [35]
which computes a Tutte embedding[58] with conformal Laplacian weight and
then maps the mesh boundary to a square. Since the number of vertices in BFM
is more than 50K, we choose 256 as the position map size, which get a high
precision point cloud with negligible re-sample error.

Thus our position map records a dense set of points from 3D face with its
semantic meaning, we are able to simultaneously obtain the 3D facial structure
and dense alignment result by using a CNN to regress the position map directly
from unconstrained 2D images. The network architecture in our method could
be greatly simpliﬁed due to this convenience. Notice that the position map con-
tains the information of the whole face, which makes it diﬀerent from other 2D

Joint 3D Face Reconstruction and Dense Alignment

7

representations such as Projected Normalized Coordinate Code (PNCC)[11,14],
an ordinary depth image[17] or quantized UV coordinates[28], which only re-
serve the information of visible face region in the input image. Our proposed
position map also infers the invisible parts of face, thus our method can predict
a complete 3D face.

3.2 Network Architecture and Loss Function

Fig. 3: The architecture of PRN. The Green rectangles represent the residual
blocks, and the blue ones represent the transposed convolutional layers.

Since our network transfers the input RGB image into position map image, we
employ an encoder-decoder structure to learn the transfer function. The encoder
part of our network begins with one convolution layer followed by 10 residual
blocks[59] which reduce the 256 × 256 × 3 input image into 8 × 8 × 512 feature
maps, the decoder part contains 17 transposed convolution layers to generate the
predicted 256 × 256 × 3 position map. We use kernel size of 4 for all convolution
or transposed convolution layers, and use ReLU layer for activation. Given that
the position map contains both the full 3D information and dense alignment
result, we don’t need extra network module for multi-task during training or
inferring. The architecture of our network is shown in Figure 3.

In order to learn the parameters of the network, we build a novel loss function
to measure the diﬀerence between ground truth position map and the network
output. Mean square error (MSE) is a commonly used loss for such learning task,
such as in [29,60]. However, MSE treats all points equally, so it is not entirely
appropriate for learning the position map. Since central region of face has more
discriminative features than other regions, we employ a weight mask to form our
loss function.

As shown in Figure 4, the weight mask is a gray image recording the weight
of each point on position map. It has the same size and pixel-to-pixel correspon-
dence to position map. According to our objective, we separate points into four
categories, each has its own weights in the loss function. The position of 68 facial
keypoints has the highest weight, so that to ensure the network to learn accurate
locations of these points. The neck region usually attracts less attention, and is
often occluded by hairs or clothes in unconstrained images. Since learning the
3D shape of neck or clothes is beyond our interests, we assign 0 weight to points
in neck region to reduce disturbance to the training process.

Thus, we denote the predicted position map as P (x, y) for x, y representing
each pixel coordinate. Given the ground truth position map ˜P (x, y) and weight

8

Y. Feng et al.

Fig. 4: The illustration of weight mask. From left to right: UV texture map, UV
position map, colored texture map with segmentation information (blue for eye
region, red for nose region, green for mouth region and purple for neck region),
the ﬁnal weight mask.

mask W (x, y), our loss function is deﬁned as:

Loss =

(cid:88)

(cid:107)P (x, y) − ˜P (x, y)(cid:107) · W (x, y)

(1)

Speciﬁcally, We use following weight ratio in our experiments, subregion1 (68
facial landmarks): subregion2 (eye, nose, mouth): subregion3 (other face area):
subregion4 (neck) = 16:4:3:0. The ﬁnal weight mask is shown in Figure4

3.3 Training Details

Because our training process needs datasets containing both 2D face images and
its corresponding 3D point clouds with semantic meaning, we choose e.g., 300W-
LP[11] to form our training sets, since it contains face images across diﬀerent
angles with the annotation of estimated 3DMM coeﬃcients, from which the 3D
point cloud could be easily recovered. Speciﬁcally, we crop the images according
the ground truth bounding box and rescale them to size 256 × 256. Then utilize
their annotated 3DMM parameters to generate the corresponding 3D position,
and render them into UV space to obtain the ground truth position map, the
map size in our training is also 256 × 256, which means a precision of more than
45K point cloud to regress. Notice that, although our training data is generated
from 3DMM, our network’s output, the position map is not restricted to any
face template or linear space of 3DMM.

We perturb the training set by randomly rotating and translating the target
face in 2D image plane. To be speciﬁc, the rotation is from -45 to 45 degree angles,
translation changes is random from 10 percent of input size, and scale is from
0.9 to 1.2. Like [18], we also augment our training data by scaling color channels
with scale range from 0.6 to 1.4. In order to handle images with occlusions, we
synthesize occlusions by adding noise texture into raw images, which is similar
to the work of [61,29]. With all above augmentation operations, our training
data covers all the diﬃcult cases.

We use the network described 3 to train our transfer model. For optimization,
we use Adam optimizer with a learning rate begins at 0.0001 and decays half
after each 5 epochs. The batch size is set as 16. All of our training codes are
implemented with TensorFlow[62].

Joint 3D Face Reconstruction and Dense Alignment

9

4 Experimental Results

In this part, we evaluate the performance of our proposed method on the tasks
of 3D face alignment and 3D face reconstruction. We ﬁrst introduce the test
datasets used in our experiments in section 4.1. Then in section 4.2 and 4.3 we
compare our results with other methods in both quantitative and qualitative
way. We then compare our method’s runtime with other methods in section 4.4.
In the end, the ablation study is conducted in section 4.5 to evaluate the eﬀect
of weight mask in our method.

4.1 Test Dataset

To evaluate our performance on the task of dense alignment and 3D face recon-
struction, multiple test datasets listed below are used in our experiments:

AFLW2000-3D is constructed by [11] to evaluate 3D face alignment on
challenging unconstrained images. This database contains the ﬁrst 2000 images
from AFLW[63] and expands its annotations with ﬁtted 3DMM parameters and
68 3D landmarks. We use this database to evaluate the performance of our
method on both face reconstruction and face alignment tasks.

AFLW-LFPA is another extension of AFLW dataset constructed by [10].
By picking images from AFLW according to the poses, the authors construct
this dataset which contains 1299 test images with a balanced distribution of
yaw angle. Besides, each image is annotated with 13 additional landmarks as a
expansion to only 21 visible landmarks in AFLW. This database is evaluated on
the task of 3D face alignment. We use 34 visible landmarks as the ground truth
to measure the accuracy of our results.

Florence is a 3D face dataset that contains 53 subjects with its ground truth
3D mesh acquired from a structured-light scanning system[64]. On experiments,
each subject generates renderings with diﬀerent poses as the same with [18]: a
pitch of -15,20 and 25 degrees and spaced rotations between -80 and 80. We
compare the performance of our method on face reconstruction against other
very recent state-of-the-art methods VRN-Guided[18] and 3DDFA[11] on this
dataset.

4.2

3D Face Alignment

To evaluate the face alignment performance. We employ the Normalized Mean
Error(NME) to be the evaluation metric, bounding box size is used as the nor-
malization factor. Firstly, we evaluate our method on a sparse set of 68 facial
landmarks, and compare our result with 3DDFA[11], DeFA[15] and 3D-FAN[19]
on dataset AFLW2000-3D. As shown in ﬁgure 5, our result slightly outper-
forms the state-of-the-art method 3D-FAN when calculating per distance with
2D coordinates. When considering the depth value, the performance discrepancy
between our method and 3D-FAN increases. Notice that, the 3D-FAN needs an-
other network to predict the z coordinate of landmarks, while the depth value
can be obtained directly in our method.

10

Y. Feng et al.

Fig. 5: Cumulative Errors Distribution (CED) curves on AFLW2000-3D. Eval-
uation is performed on 68 landmarks with both the 2D(left) and 3D(right) co-
ordinates. Overall 2000 images from AFLW2000-3D dataset are used here. The
mean NME% of each method is also showed in the legend.

To further investigate the performance of our method across poses and datasets,

we also report the NME of faces with small, medium and large yaw angles on
AFLW2000-3D dataset and the mean NME on both AFLW2000-3D and AFLW-
LPFA datasets. Table 1 shows the comparison with other methods, note that the
numerical values are recorded from their published papers except the ones of 3D-
FAN. Follow the work [11], we also randomly select 696 faces from AFLW2000
to balance the distribution. The result shows that our method is robust to the
change of pose and datasets.

Although all the state-of-the-art methods of face alignment conduct evalua-

tion on AFLW2000-3D dataset, the ground truth of this dataset is still controversial[29,19]
due to its annotation pipeline which is based on Landmarks Marching method
in [6]. Thus, we visualize some results in Figure 6 that have NME larger than
6.5% and we ﬁnd our results are more accurate than the ground truth in some
cases.

Table 1: Performance comparison on two large-pose face alignment datasets
AFLW2000-3D(68 landmarks) and AFLW-LFPA(34 visible landmarks). The
NME (%) for faces with diﬀerent yaw angles are reported. The ﬁrst best re-
sult in each category is highlighted in bold, the lower is the better.

Method
SDM[46]
3DDFA [11]

3.67
3.78
3DDFA + SDM [11] 3.43

PAWF[10]
Yu et al. [29]
3DSTN[16]
DeFA[15]
PRN (ours)

AFLW2000-3D
0 to 30 30 to 60 60 to 90 Mean
6.12
5.42
4.94
-
-
4.49
4.50
3.62

9.67
7.93
7.17
-
9.56
5.98
-
4.61

4.94
4.54
4.24
-
6.06
4.33
-
3.51

-
3.62
3.15
-
2.75

AFLW-LFPA
Mean
-
-
-
4.72
-
-
3.86
2.93

Joint 3D Face Reconstruction and Dense Alignment

11

Fig. 6: Examples from AFLW2000-3D dataset show that our predictions are more
accurate than ground truth in some cases. Green: predicted landmarks by our
method. Red: ground truth from [11].

We also compare our dense alignment result against other state-of-the-art
methods including 3DDFA[11] and DeFA[15] on the only test dataset AFLW2000-
3D. In order to compare diﬀerent methods with the same set of points, we select
the points from the largest common face region provided by all methods, and
ﬁnally around 45K points were used for the evaluation. As shown in ﬁgure 7, our
method outperforms the best methods with a large margin of more than 27%
on both 2D and 3D coordinates.

Fig. 7: CED curves on AFLW2000-3D. Evaluation is performed on all points
with both the 2D (left) and 3D (right) coordinates. Overall 2000 images from
AFLW2000-3D dataset are used here. The mean NME% of each method is also
showed in the legend.

4.3 3D Face Reconstruction

In this part, we evaluate our method on 3D face reconstruction task and com-
pare with 3DDFA[11], DeFA[15] and VRN-Guided[18] on AFLW2000-3D and
Florence datasets. We use the same set of points as in evaluating dense alignment
and changes the metric so as to keep consistency with other 3D face reconstruc-
tion evaluation methods. We ﬁrst use Iterative Closest Points(ICP) algorithm to

12

Y. Feng et al.

ﬁnd the corresponding nearest points between the network output and ground
truth point cloud, then calculate Mean Squared Error(MSE) normalized by outer
interocular distance of 3D coordinates.

The result is shown in ﬁgure 8. our method greatly exceeds the performance
of other two state-of-the-art methods. Since AFLW2000-3D dataset is labeled

Fig. 8: 3D reconstruction performance(CED curves) on in-the-wild AFLW2000-
3D dataset and Florence dataset. The mean NME% of each method is showed
in the legend. On AFLW2000-3D, more than 45K points are used for evaluation.
On Florence, about 19K points are used.

with results from 3DMM ﬁtting, we further evaluate the performance of our
method on Florence dataset, where ground truth 3D point cloud is obtained
from structured-light 3D scanning system. Here we compare our method with
3DDFA and VRN-Guided[18], using experimental settings in [18]. The evalua-
tion images are the renderings with diﬀerent poses from Florence database, we
calculate the bounding box from the ground truth point cloud and using the
cropped image as network input. Although our method output more complete
face point clouds than VRN, we only choose the common face region to compare
the performance, 19K points are used for the evaluation. Figure 8 shows that our
method achieves 28.7% relative higher performance compared to VRN-Guided
on Florence dataset, which is a signiﬁcant improvement.

To better evaluate the reconstruction performance of our method across dif-
ferent poses, we calculated the NME for diﬀerent yaw angle range. As shown
in ﬁgure 9, all the methods perform well in near frontal view, however, 3DDFA
and VRN-Guided fail to keep low error as pose becomes large, while our method
keeps relatively stable performance in all pose ranges. We also illustrate the
qualitative comparison in ﬁgure 9, our restored point cloud covers a larger re-
gion than in VRN-Guided, which ignores the lateral facial parts. Besides, due to
the limitation on resolution of VRN, our method provides ﬁner details of face,
especially on the nose and mouth region.

We also provide additional qualitative results on 300VW[65] and Multi-

PIE[66] datasets, please refer to supplementary material for full details.

Joint 3D Face Reconstruction and Dense Alignment

13

Fig. 9: Left: CED curves on Florence dataset with diﬀerent yaw angles. Right: the
qualitative comparison with VRN-Guided. The ﬁrst column is the input images
from Florence dataset and the Internet, the second column is the reconstructed
face from our method, the third column is the results from VRN-Guided.

4.4 Runtime

Surpassing the performance of all other state-of-the-art methods on 3D face
alignment and reconstruction, our method is surprisingly more light-weighted
and faster. Since our network uses basic encoder-decoder structure, our model
size is only 160MB compared to 1.5GB in VRN[18]. We also compare the run-
time between our method and other state-of-the-art methods. Table 2 shows the
result. The results of 3DDFA and 3DSTN are directly recorded from their pub-
lished papers and others are recorded by running their publicly available source
codes. Notice that, We measure the run time of the process which is deﬁned from
inputing the cropped face image until recovering the 3D geometry(point cloud,
mesh or voxel data) for 3D reconstruction methods or obtaining the 3D land-
marks for alignment methods. The harware used for evaluation is an NVIDIA
GeForce GTX 1080 GPU and an Intel(R) Xeon(R) CPU E5-2640 v4 @ 2.40GHz.

Table 2: Run time in Milliseconds per Image
3DDFA[11] DeFA[15] 3D-FAN[19] 3DSTN[16] VRN-Guided[18] PRN (ours)

75.7

35.4

54.7

19.0

69.0

9.8

Speciﬁcally, DeFA needs 11.8ms(GPU) to predict 3DMM parameters and an-
other 23.6ms(CPU) to generate mesh data from predicted parameters, 3DFAN
needs 29.1ms(GPU) to estimate 2D coordinates ﬁrst and 25.6ms(GPU) to ob-
tain depth value, VRN-Guided detects 68 2D landmarks with 28.4ms(GPU),
then regress the voxel data with 40.6ms(GPU), our method provides both 3D
reconstruction and dense alignment result from cropped image in one pass in
9.8ms(GPU).

14

Y. Feng et al.

4.5 Ablation Study

In this section, we conduct several experiments to evaluate the inﬂuence of our
weight mask on training and provide both sparse and dense alignment CED on
AFLW2000 to evaluate diﬀerent settings. Table 3 shows three options for our
weight mask, we could see that weight ratio 1 corresponds to the situation when
no weight mask is used, weight ratio 2 and 3 are slightly diﬀerent on the emphasis
in loss function. The results are shown in Figure 10. Network trained without

Table 3: The weight ratio of diﬀerent settings

sub1:sub2:sub3:sub4

weight ratio 1 weight ratio 2 weight ratio 3
1:1:1:0

16:4:3:0

1:1:1:1

using weight mask has worst performance compared with other two settings. By
adding weights to speciﬁc regions such as 68 facial landmarks or central face
region, weight ratio 3 shows considerable improvement on 68 points datasets
over weight ratio 2.

Fig. 10: The eﬀect of weight mask evaluated on AFLW2000-3D dataset with 68
landmarks(left) and all points(right).

5 Conclusion

In this paper, we propose an end-to-end method, which well solves the problems
of 3D face alignment and 3D face reconstruction simultaneously. By learning the
position map, we directly regress the complete 3D structure along with semantic
meaning from a single image. Quantitative and qualitative results demonstrate
our method is robust to poses, illuminations and occlusions. Experiments on
three test datasets show that our method achieves signiﬁcant improvements over
others. We further show that our method runs faster than other methods and is
suitable for real time usage.

Joint 3D Face Reconstruction and Dense Alignment

15

6 Acknowledgements

We would like to thank Aaron Jackson for kindly providing the Florence test
data. We also thank Iacopo Masi for his patience in helping me acquire Florence
3D Face dataset. This work was supported by CloudWalk Technology.

References

1. Zhou, E., Fan, H., Cao, Z., Jiang, Y., Yin, Q.: Extensive facial landmark local-
In: Computer Vision
ization with coarse-to-ﬁne convolutional network cascade.
Workshops (ICCVW), 2013 IEEE International Conference on, IEEE (2013) 386–
391

2. Zhang, Z., Luo, P., Loy, C.C., Tang, X.: Facial landmark detection by deep multi-
task learning. In: European Conference on Computer Vision, Springer (2014) 94–
108

3. Liang, Z., Ding, S., Lin, L.: Unconstrained facial landmark localization with
backbone-branches fully-convolutional networks. arXiv preprint arXiv:1507.03409
(2015)

4. Peng, X., Feris, R.S., Wang, X., Metaxas, D.N.: A recurrent encoder-decoder
In: European Conference on Computer

network for sequential face alignment.
Vision, Springer (2016) 38–56

5. Wagner, A., Wright, J., Ganesh, A., Zhou, Z., Mobahi, H., Ma, Y.: Toward a
practical face recognition system: Robust alignment and illumination by sparse
representation. IEEE Transactions on Pattern Analysis and Machine Intelligence
34(2) (2012) 372–386

6. Zhu, X., Lei, Z., Yan, J., Yi, D., Li, S.Z.: High-ﬁdelity pose and expression nor-

malization for face recognition in the wild. (2015) 787–796

7. Huber, P., Hu, G., Tena, R., Mortazavian, P., Koppen, W.P., Christmas, W.J.,
Ratsch, M., Kittler, J.: A multiresolution 3d morphable face model and ﬁtting
framework. (2016) 79–86

8. Zhao, R., Wang, Y., Benitez-Quiroz, C.F., Liu, Y., Martinez, A.M.: Fast and
precise face alignment and 3d shape reconstruction from a single 2d image. In:
European Conference on Computer Vision, Springer (2016) 590–603

9. Jeni, L.A., Tulyakov, S., Yin, L., Sebe, N., Cohn, J.F.: The ﬁrst 3d face alignment
In: European Conference on Computer Vision,

in the wild (3dfaw) challenge.
Springer (2016) 511–520

10. Jourabloo, A., Liu, X.: Large-pose face alignment via cnn-based dense 3d model

ﬁtting. In: Computer Vision and Pattern Recognition. (2016)

11. Zhu, X., Lei, Z., Liu, X., Shi, H., Li, S.Z.: Face alignment across large poses: A 3d

solution. computer vision and pattern recognition (2016) 146–155

12. Richardson, E., Sela, M., Kimmel, R.: 3d face reconstruction by learning from
synthetic data. In: Fourth International Conference on 3d Vision. (2016) 460–469
13. Liu, F., Zeng, D., Zhao, Q., Liu, X.: Joint face alignment and 3d face reconstruction.

In: European Conference on Computer Vision, Springer (2016) 545–560

14. Richardson, E., Sela, M., Or-El, R., Kimmel, R.: Learning detailed face recon-

15. Liu, Y., Jourabloo, A., Ren, W., Liu, X.: Dense face alignment. arXiv preprint

struction from a single image. (2016)

arXiv:1709.01442 (2017)

16

Y. Feng et al.

16. Bhagavatula, C., Zhu, C., Luu, K., Savvides, M.: Faster than real-time facial
alignment: A 3d spatial transformer network approach in unconstrained poses. In:
The IEEE International Conference on Computer Vision (ICCV). Volume 2. (2017)
7

17. Sela, M., Richardson, E., Kimmel, R.: Unrestricted facial geometry reconstruction

using image-to-image translation. (2017)

18. Jackson, A.S., Bulat, A., Argyriou, V., Tzimiropoulos, G., Jackson, A.S., Bulat,
A., Argyriou, V., Tzimiropoulos, G.: Large pose 3d face reconstruction from a
single image via direct volumetric cnn regression. In: International Conference on
Computer Vision. (2017)

19. Bulat, A., Tzimiropoulos, G.: How far are we from solving the 2d and 3d face

alignment problem? (and a dataset of 230,000 3d facial landmarks). (2017)

20. Blanz, V., Vetter, T.: A morphable model for the synthesis of 3d faces. international
conference on computer graphics and interactive techniques (1999) 187–194
21. Lee, Y.J., Lee, S.J., Kang, R.P., Jo, J., Kim, J.: Single view-based 3d face recon-
struction robust to self-occlusion. Eurasip Journal on Advances in Signal Process-
ing 2012(1) (2012) 1–20

22. Thies, J., Zollhfer, M., Stamminger, M., Theobalt, C., Niener, M.: Face2face: Real-
time face capture and reenactment of rgb videos. In: Computer Vision and Pattern
Recognition. (2016) 5

23. Cao, C., Hou, Q., Zhou, K.: Displaced dynamic expression regression for real-time

facial tracking and animation. ACM (2014)

24. Jeni, L.A., Cohn, J.F., Kanade, T.: Dense 3d face alignment from 2d videos in
In: Automatic Face and Gesture Recognition (FG), 2015 11th IEEE

real-time.
International Conference and Workshops on. Volume 1., IEEE (2015) 1–8

25. Grewe, C.M., Zachow, S.: Fully automated and highly accurate dense correspon-
dence for facial surfaces. In: European Conference on Computer Vision, Springer
(2016) 552–568

26. Huber, P., Feng, Z.H., Christmas, W., Kittler, J., Ratsch, M.: Fitting 3d morphable
In: IEEE International Conference on Image

face models using local features.
Processing. (2015) 1195–1199

27. Romdhani, S., Vetter, T.: Estimating 3d shape and texture using pixel intensity,
edges, specular highlights, texture constraints and a prior.
In: IEEE Computer
Society Conference on Computer Vision and Pattern Recognition. (2005) 986–993
28. G¨uler, R.A., Trigeorgis, G., Antonakos, E., Snape, P., Zafeiriou, S., Kokkinos, I.:
Densereg: Fully convolutional dense shape regression in-the-wild. In: Proc. CVPR.
Volume 2. (2017)

29. Yu, R., Saito, S., Li, H., Ceylan, D., Li, H.: Learning dense facial correspondences

30. Dou, P., Shah, S.K., Kakadiaris, I.A.: End-to-end 3d face reconstruction with deep

in unconstrained images. (2017)

neural networks. (2017)

31. Tran, A.T., Hassner, T., Masi, I., Medioni, G.: Regressing robust and discrimina-

tive 3d morphable models with a very deep neural network. (2016)

32. Jourabloo, A., Liu, X.: Pose-invariant 3d face alignment. In: Proceedings of the

IEEE International Conference on Computer Vision. (2015) 3694–3702

33. Laine, S., Karras, T., Aila, T., Herva, A., Lehtinen, J.: Facial performance capture

with deep neural networks. arXiv preprint arXiv:1609.06536 (2016)

34. Tewari, A., Zollhfer, M., Kim, H., Garrido, P., Bernard, F., Prez, P., Theobalt, C.:
Mofa: Model-based deep convolutional face autoencoder for unsupervised monoc-
ular reconstruction. (2017)

Joint 3D Face Reconstruction and Dense Alignment

17

35. Bas, A., Huber, P., Smith, W.A.P., Awais, M., Kittler, J.: 3d morphable models as
spatial transformer networks. In: ICCV 2017 Workshop on Geometry Meets Deep
Learning. (2017)

36. Hassner, T.: Viewing real-world faces in 3d. In: IEEE International Conference on

Computer Vision. (2013) 3607–3614

37. Kemelmacher-Shlizerman, I., Basri, R.: 3d face reconstruction from a single image
using a single reference face shape. IEEE Transactions on Pattern Analysis and
Machine Intelligence 33(2) (2011) 394

38. Gu, L., Kanade, T.: 3d alignment of face in a single image. In: Computer Vision
and Pattern Recognition, 2006 IEEE Computer Society Conference on. Volume 1.,
IEEE (2006) 1305–1312

39. S´anta, Z., Kato, Z.: 3d face alignment without correspondences.

In: European

Conference on Computer Vision, Springer (2016) 521–535

40. Matthews, I., Baker, S.: Active appearance models revisited. International journal

of computer vision 60(2) (2004) 135–164

41. Saragih, J., Goecke, R.: A nonlinear discriminative approach to aam ﬁtting. In:
Computer Vision, 2007. ICCV 2007. IEEE 11th International Conference on, IEEE
(2007) 1–8

42. Tzimiropoulos, G., Pantic, M.: Optimization problems for fast aam ﬁtting in-the-
wild. In: Computer Vision (ICCV), 2013 IEEE International Conference on, IEEE
(2013) 593–600

43. Kim, J., Liu, C., Sha, F., Grauman, K.: Deformable spatial pyramid matching for
fast dense correspondences. In: Computer Vision and Pattern Recognition. (2013)
2307–2314

44. Asthana, A., Zafeiriou, S., Cheng, S., Pantic, M.: Robust discriminative response
map ﬁtting with constrained local models. In: Computer Vision and Pattern Recog-
nition (CVPR), 2013 IEEE Conference on, IEEE (2013) 3444–3451

45. Doll´ar, P., Welinder, P., Perona, P.: Cascaded pose regression.

In: Computer
Vision and Pattern Recognition (CVPR), 2010 IEEE Conference on, IEEE (2010)
1078–1085

46. Xiong, X., Torre, F.D.L.: Global supervised descent method. In: IEEE Conference

on Computer Vision and Pattern Recognition. (2015) 2664–2673

47. McDonagh, J., Tzimiropoulos, G.: Joint face detection and alignment with a de-
formable hough transform model. In: European Conference on Computer Vision,
Springer (2016) 569–580

48. Gou, C., Wu, Y., Wang, F.Y., Ji, Q.: Shape augmented regression for 3d face
alignment. In: European Conference on Computer Vision, Springer (2016) 604–
615

49. de Bittencourt Zavan, F.H., Nascimento, A.C., e Silva, L.P., Bellon, O.R., Silva, L.:
3d face alignment in the wild: A landmark-free, nose-based approach. In: European
Conference on Computer Vision, Springer (2016) 581–589

50. Bulat, A., Tzimiropoulos, G.: Two-stage convolutional part heatmap regression for
the 1st 3d face alignment in the wild (3dfaw) challenge. In: European Conference
on Computer Vision, Springer (2016) 616–624

51. Fan, H., Su, H., Guibas, L.: A point set generation network for 3d object recon-

struction from a single image. (2016) 2463–2471

52. Deng, J., Cheng, S., Xue, N., Zhou, Y., Zafeiriou, S.: Uv-gan: Adversarial
arXiv preprint

facial uv map completion for pose-invariant face recognition.
arXiv:1712.04695 (2017)

18

Y. Feng et al.

53. Moschoglou, S., Ververas, E., Panagakis, Y., Nicolaou, M., Zafeiriou, S.: Multi-
arXiv preprint

attribute robust component analysis for facial uv maps.
arXiv:1712.05799 (2017)

54. Xue, N., Deng, J., Cheng, S., Panagakis, Y., Zafeiriou, S.: Side information for

face completion: a robust pca approach. arXiv preprint arXiv:1801.07580 (2018)

55. Maninchedda, F., H¨ane, C., Oswald, M.R., Pollefeys, M.: Face reconstruction on
mobile devices using a height map shape model and fast regularization. In: 3D
Vision (3DV), 2016 Fourth International Conference on, IEEE (2016) 489–498
56. Maninchedda, F., Oswald, M.R., Pollefeys, M.: Fast 3d reconstruction of faces with
glasses. In: 2017 IEEE Conference on Computer Vision and Pattern Recognition
(CVPR), IEEE (2017) 4608–4617

57. Booth, J., Zafeiriou, S.: Optimal uv spaces for facial morphable model construction.
In: Image Processing (ICIP), 2014 IEEE International Conference on, IEEE (2014)
4672–4676

58. Floater, M.S.: Parametrization and smooth approximation of surface triangula-

tions. Computer Aided Geometric Design 14(3) (1997) 231–250

59. He, K., Zhang, X., Ren, S., Sun, J.: Deep residual learning for image recognition.

In: Computer Vision and Pattern Recognition. (2016) 770–778

60. Crispell, D., Bazik, M.: Pix2face: Direct 3d face model estimation. (2017)
61. Saito, S., Li, T., Li, H.: Real-time facial segmentation and performance capture
from rgb input. In: European Conference on Computer Vision, Springer (2016)
244–261

62. Abadi, M., Barham, P., Chen, J., Chen, Z., Davis, A., Dean, J., Devin, M., Ghe-
mawat, S., Irving, G., Isard, M., et al.: Tensorﬂow: A system for large-scale machine
learning. In: OSDI. Volume 16. (2016) 265–283

63. Koestinger, M., Wohlhart, P., Roth, P.M., Bischof, H.: Annotated facial landmarks
in the wild: A large-scale, real-world database for facial landmark localization. In:
Computer Vision Workshops (ICCV Workshops), 2011 IEEE International Con-
ference on, IEEE (2011) 2144–2151

64. Bagdanov, A.D., Del Bimbo, A., Masi, I.: The ﬂorence 2d/3d hybrid face dataset.
In: Proceedings of the 2011 joint ACM workshop on Human gesture and behavior
understanding, ACM (2011) 79–80

65. Chrysos, G.G., Antonakos, E., Zafeiriou, S., Snape, P.: Oﬄine deformable face
tracking in arbitrary videos. In: Proceedings of the IEEE International Conference
on Computer Vision Workshops. (2015) 1–9

66. Hartley, R., Zisserman, A.: Multiple view geometry in computer vision. Kybernetes

30(9/10) (2003) 1865 – 1872

Joint 3D Face Reconstruction and Dense
Alignment with Position Map Regression
Network

Yao Feng†, Fan Wu‡, Xiaohu Shao§, Yanfeng Wang†, Xi Zhou‡†

†Shanghai Jiao Tong University, ‡CloudWalk Technology
§Research Center for Intelligent Security Technology, CIGIT
fengyao@sjtu.edu.cn, wufan@cloudwalk.cn, shaoxiaohu@cigit.ac.cn
wangyanfeng@sjtu.edu.cn, zhouxi@cloudwalk.cn

Abstract. We propose a straightforward method that simultaneously
reconstructs the 3D facial structure and provides dense alignment. To
achieve this, we design a 2D representation called UV position map which
records the 3D shape of a complete face in UV space, then train a sim-
ple Convolutional Neural Network to regress it from a single 2D image.
We also integrate a weight mask into the loss function during training
to improve the performance of the network. Our method does not rely
on any prior face model, and can reconstruct full facial geometry along
with semantic meaning. Meanwhile, our network is very light-weighted
and spends only 9.8ms to process an image, which is extremely faster
than previous works. Experiments on multiple challenging datasets show
that our method surpasses other state-of-the-art methods on both re-
construction and alignment tasks by a large margin. Code is available at
https://github.com/YadiraF/PRNet.

Keywords: 3D Face Reconstruction, Face Alignment, Dense Correspon-
dence

8
1
0
2
 
r
a

M
 
1
2
 
 
]

V
C
.
s
c
[
 
 
1
v
5
3
8
7
0
.
3
0
8
1
:
v
i
X
r
a

1 Introduction

3D face reconstruction and face alignment are two fundamental and highly re-
lated topics in computer vision. In the last decades, researches in these two ﬁelds
beneﬁt each other. In the beginning, face alignment that aims at detecting a spe-
cial 2D ﬁducial points [1,2,3,4] is commonly used as a prerequisite for other facial
tasks such as face recognition [5] and assists 3D face reconstruction [6,7] to a
great extent. However, researchers ﬁnd that 2D alignment has diﬃculties [8,9]
in dealing with problems of large poses or occlusions. With the development of
deep learning, many computer vision problems have been well solved by utilizing
Convolution Neural Networks (CNNs). Thus, some works start to use CNNs to
estimate the 3D Morphable Model (3DMM) coeﬃcients [10,11,12,13,14,15] or
3D model warping functions [16,17] to restore the corresponding 3D information
from a single 2D facial image, which provides both dense face alignment and
3D face reconstruction results. However, the performance of these methods is
restricted due to the limitation of the 3D space deﬁned by face model basis or

2

Y. Feng et al.

Fig. 1: The qualitative results of our method. Odd row: alignment results (only
68 key points are plotted for display). Even row: 3D reconstruction results (re-
constructed shapes are rendered with head light for better view).

templates. The required operations including perspective projection or 3D Thin
Plate Spline (TPS) transformation also add complexity to the overall process.

Recently, two end-to-end works [18] [19], which bypass the limitation of model
space, achieve the state-of-the-art performances on their respective tasks. [19]
trains a complex network to regress 68 facial landmarks with 2D coordinates
from a single image, but needs an extra network to estimate the depth value.
Besides, dense alignment is not provided by this method. [18] develops a vol-
umetric representation of 3D face and uses a network to regress it from a 2D
image. However, this representation discards the semantic meaning of points,
thus the network needs to regress the whole volume in order to restore the fa-
cial shape, which is only part of the volume. So this representation limits the
resolution of the recovered shape, and need a complex network to regress it.
We ﬁnd that these limitations do not exist in previous model-based methods,
it motivates us to ﬁnd a new approach to obtaining the 3D reconstruction and
dense alignment simultaneously in a model-free manner.

In this paper, we propose an end-to-end method called Position map Regres-
sion Network (PRN) to jointly predict dense alignment and reconstruct 3D face
shape. Our method surpasses all other previous works on both 3D face alignment
and reconstruction on multiple datasets. Meanwhile, our method is straightfor-
ward with a very light-weighted model which provides the result in one pass with
9.8ms. All of these are achieved by the elaborate design of the 2D representation
of 3D facial structure and the corresponding loss function. Speciﬁcally, we design
a UV position map, which is a 2D image recording the 3D coordinates of a com-
plete facial point cloud, and at the same time keeping the semantic meaning at
each UV place. We then train a simple encoder-decoder network with a weighted
loss that focuses more on discriminative region to regress the UV position map

Joint 3D Face Reconstruction and Dense Alignment

3

from a single 2D facial image. Figure1 shows our method is robust to poses,
illuminations and occlusions.

In summary, our main contributions are:

– For the ﬁrst time, we solve the problems of face alignment and 3D face
reconstruction together in an end-to-end fashion without the restriction of
low-dimensional solution space.

– To directly regress the 3D facial structure and dense alignment, we develop
a novel representation called UV position map, which records the position
information of 3D face and provides dense correspondence to the semantic
meaning of each point on UV space.

– For training, we proposed a weight mask which assigns diﬀerent weight to
each point on position map and compute a weighted loss. We show that this
design helps improving the performance of our network.

– We ﬁnally provide a light-weighted framework that runs at over 100FPS to
directly obtain 3D face reconstruction and alignment result from a single 2D
facial image.

– Comparison on the AFLW2000-3D and Florence datasets shows that our
method achieves more than 25% relative improvements over other state-
of-the-art methods on both tasks of 3D face reconstruction and dense face
alignment.

2 Related Works

As described above, the main problems our method can solve are 3D face recon-
struction and face alignment. We will talk about closely related works on these
tasks in the following subsections.

2.1

3D Face Reconstruction

This part we only talk about 3D face reconstruction from a single image un-
der unconstrained situations. Since Blanz and Vetter proposed 3D Morphable
Model(3DMM) in 1999[20], methods based on 3DMM are the most popular in
completing the task of monocular 3D facial shape reconstruction. Most of earlier
methods are to establish the correspondences of the special points between input
images and the 3D mean geometry including landmarks[21,6,22,7,23,24,25] and
local features[26,27,25], then solve the non-linear optimization function to regress
the 3DMM coeﬃcients. However, these methods heavily rely on the high accu-
racy of landmarks or other feature points detector. Thus, some methods[28,29]
ﬁrstly use CNNs to learn the dense correspondence between input image and
3D template, then calculate the 3DMM parameters with predicted dense con-
strains. Recent works also explore the usage of CNN to predict 3DMM param-
eters directly. [10,11,12,13,14] use cascaded CNN structure to regress the accu-
rate 3DMM coeﬃcients, which take a lot of time due to iterations. [30,31,32,33]
propose end-to-end CNN architectures to directly estimate the 3DMM shape pa-
rameters. Unsupervised methods have been also researched recently, [34,35] can

4

Y. Feng et al.

regress the 3DMM coeﬃcients without the help of training data by using facial
texture information, which performs badly in faces with large-poses and unbal-
anced illuminations. However, the main defect of those methods are model-based,
resulting in a limited geometry which is constrained in model shape space and
post-processing to generate 3D mesh from estimated parameters. Some other
methods can reconstruct 3D faces without 3D shape basis, while still rely on
a 3D facial template. [36,37,38,17,39] can produce a 3D structure by warping
the shape of a reference 3D model. [16] also reconstruct the 3D shape of faces
by learning a 3D Thin Plate Spline(TPS) warping function via a deep network
which warps a generic 3D model to a subject speciﬁc 3D shape. Obviously, the
reconstructed face geometry from these methods are also restricted by the ref-
erence model, which means the structure diﬀers when the template changes.
Recently, [18] propose to straightforwardly map the image pixels to full 3D fa-
cial structure via volumetric CNN regression. This method is not restricted in
the model space any more, While needs a complex network structure and a lot
of time to predict the voxel data. Diﬀerent from above methods, Our framework
is model-free and light-weighted, can run at real time and directly obtain the
full 3D facial geometry along with its correspondence information.

2.2 Face Alignment

In the ﬁeld of computer vision, face alignment is a long-standing problem which
attracts a lot of attention. In the beginning, there are a number of 2D fa-
cial alignment approaches which aim at locating a set of ﬁducial 2D facial
landmarks, such as classic Active Appearance Model(AMM)[40,41,42] and Con-
strained Local Models(CLM)[43,44]. Then cascaded regression[45,46] and CNN-
based methods[3,4,19] are largely used to achieve state-of-the-art performance
in 2D landmarks location. However, 2D landmarks location only regresses vis-
ible points on faces, which leads to diﬃculties and is limited to describe face
shape when the pose of faces is large. Recent works then research the 3D fa-
cial alignment, which begins with ﬁtting a 3DMM[47,11,48] or registering a
3D facial template[39,49] with a 2D facial image. Obviously, 3D reconstruc-
tion methods based on model can easily complete the task of 3D face alignment
by selecting x,y coordinates of landmarks vertices in reconstructed geometry.
Actually, [11,29,32] are specially designated methods to achieve 3D face align-
ment by means of 3DMM ﬁtting. Recently [50,19] use a deep network to di-
rectly predict the heat map to obtain the 3D facial landmarks and achieves
state-of-the-art performance. Thus, as sparse face alignment tasks are highly
completed by aforementioned methods, the task of dense face alignment begins
to develop. Notice that, the dense face alignment means the methods should
oﬀer the correspondence between two face images as well as between a 2D facial
image and a 3D facial reference geometry. [15] use multi-constraints to train a
CNN which estimates the 3DMM parameters and then provides a very dense 3D
alignment. [28,29] directly learn the correspondence between a 2D input image
and a 3D template via a deep network, while those predicted correspondence is
not complete, only visible face-region is considered. Compared to prior works,

Joint 3D Face Reconstruction and Dense Alignment

5

our method can directly establish the dense correspondence between all region
in faces and 3D template once the position map is regressed. No intermediate
parameters such as 3DMM coeﬃcients and TPS warping parameters are needed
in our method, which means our network can run very fast bypassing complex
operations including perspective projection and TPS transformation.

3 Proposed Method

This section describes the framework and the details of our proposed method.
Firstly, we introduce the characteristics of the position map for our 3D face
representation. Then we elaborate the CNN architecture and the loss function
designed specially for learning the mapping from unconstrained RGB image to
its 3D structure. The implementation details of our method are shown in the
last subsection.

3.1

3D Face Representation

Our goal is to regress the 3D facial geometry and its dense correspondence in-
formation from a single 2D image. Thus we need a proper representation which
can be directly predicted via a deep network. One simple and commonly used
idea is to concatenate the coordinates of all points in 3D face as a vector and use
a network to predict it. However, this transformation increases the diﬃculties in
training since projection from 3D space into 1D vector discards the spatial adja-
cency information among points. While it’s natural to think that spatially adja-
cent points could share weights in predicting their positions, which can be easily
achieved by using convolutional layers. The coordinates as a 1D vector needs a
fully connected layer to predict each point with much more parameters, which
increases the network size and is hard to train. [51] proposed a point set genera-
tion network to directly predict the point cloud of 3D object as a vector from a
single image. However, the max number of points is only 1024, far from enough
to represent an accurate 3D face. So model-based methods[11,30,15] regress a
few model parameters rather than the coordinates of points, which usually needs
special care in training such as using Mahalanobis distance and inevitably limits
the estimated face geometry to the their model space. [18] proposed 3D binary
volume as the representation of 3D structure and uses Volumetric Regression
Network(VRN) to output a 192 × 192 × 200 volume as the discretized version
of point cloud. By using this representation, VRN can be built with full convo-
lutional layers. However, discretization limits the resolution of point cloud, and
most part of the network output correspond to non-surface points which are of
less usage.

To address the problems in previous works, we propose UV position map as
the presentation of full 3D facial structure. UV position map or position map
for short, is a 2D image recording 3D positions of all points in UV space. In
the past years, UV space or UV coordinates, which is a 2D image plane param-
eterized from the 3D space, has been utilized as a way to express information

6

Y. Feng et al.

including the texture of faces(texture map) [35,52,53,54], 2.5D geometry(height
map)[55,56] and the correspondences between 3D facial meshes[57]. Diﬀerent
from previous works, we use UV space to store the 3D coordinates of points
from 3D face model. As shown in Figure 2, we deﬁne the 3D face point cloud in
Left-handed Cartesian Coordinate system. The origin of the 3D space overlaps
with the upper-left of the input image, with the positive x-axis pointing to the
right of the image. The ground truth 3D face point cloud exactly matches the
face in the 2D image when projected to the x-y plane. Thus our position map
can be easily comprehended as replacing the r, g, b value in texture map by x,
y, z coordinates.

Fig. 2: The illustration of UV position map. Left: 3D plot of input image and
its ground truth 3D point cloud. Right: The ﬁrst row is the input 2D image,
extracted UV texture map and corresponding UV position map. The second
row is the x, y, z channel of the UV position map.

In order to keep the semantic meaning of points within position map, we cre-
ate our UV coordinates based on 3DMM. Since we want to regress the 3D full
structure directly, the unconstrained 2D facial images and their corresponding
3D shapes are needed for end-to-end training. 300W-LP[11] is a large dataset
that contains more than 60K unconstrained images with ﬁtted 3DMM parame-
ters, which is suitable to form our training pairs. Besides, the 3DMM parameters
of this dataset are based on the Basel Face Model(BFM)[20]. Thus, in order to
make full use of this dataset, we conduct the UV coordinates corresponding
to BFM. To be speciﬁc, we use the parameterized UV coordinates from [35]
which computes a Tutte embedding[58] with conformal Laplacian weight and
then maps the mesh boundary to a square. Since the number of vertices in BFM
is more than 50K, we choose 256 as the position map size, which get a high
precision point cloud with negligible re-sample error.

Thus our position map records a dense set of points from 3D face with its
semantic meaning, we are able to simultaneously obtain the 3D facial structure
and dense alignment result by using a CNN to regress the position map directly
from unconstrained 2D images. The network architecture in our method could
be greatly simpliﬁed due to this convenience. Notice that the position map con-
tains the information of the whole face, which makes it diﬀerent from other 2D

Joint 3D Face Reconstruction and Dense Alignment

7

representations such as Projected Normalized Coordinate Code (PNCC)[11,14],
an ordinary depth image[17] or quantized UV coordinates[28], which only re-
serve the information of visible face region in the input image. Our proposed
position map also infers the invisible parts of face, thus our method can predict
a complete 3D face.

3.2 Network Architecture and Loss Function

Fig. 3: The architecture of PRN. The Green rectangles represent the residual
blocks, and the blue ones represent the transposed convolutional layers.

Since our network transfers the input RGB image into position map image, we
employ an encoder-decoder structure to learn the transfer function. The encoder
part of our network begins with one convolution layer followed by 10 residual
blocks[59] which reduce the 256 × 256 × 3 input image into 8 × 8 × 512 feature
maps, the decoder part contains 17 transposed convolution layers to generate the
predicted 256 × 256 × 3 position map. We use kernel size of 4 for all convolution
or transposed convolution layers, and use ReLU layer for activation. Given that
the position map contains both the full 3D information and dense alignment
result, we don’t need extra network module for multi-task during training or
inferring. The architecture of our network is shown in Figure 3.

In order to learn the parameters of the network, we build a novel loss function
to measure the diﬀerence between ground truth position map and the network
output. Mean square error (MSE) is a commonly used loss for such learning task,
such as in [29,60]. However, MSE treats all points equally, so it is not entirely
appropriate for learning the position map. Since central region of face has more
discriminative features than other regions, we employ a weight mask to form our
loss function.

As shown in Figure 4, the weight mask is a gray image recording the weight
of each point on position map. It has the same size and pixel-to-pixel correspon-
dence to position map. According to our objective, we separate points into four
categories, each has its own weights in the loss function. The position of 68 facial
keypoints has the highest weight, so that to ensure the network to learn accurate
locations of these points. The neck region usually attracts less attention, and is
often occluded by hairs or clothes in unconstrained images. Since learning the
3D shape of neck or clothes is beyond our interests, we assign 0 weight to points
in neck region to reduce disturbance to the training process.

Thus, we denote the predicted position map as P (x, y) for x, y representing
each pixel coordinate. Given the ground truth position map ˜P (x, y) and weight

8

Y. Feng et al.

Fig. 4: The illustration of weight mask. From left to right: UV texture map, UV
position map, colored texture map with segmentation information (blue for eye
region, red for nose region, green for mouth region and purple for neck region),
the ﬁnal weight mask.

mask W (x, y), our loss function is deﬁned as:

Loss =

(cid:88)

(cid:107)P (x, y) − ˜P (x, y)(cid:107) · W (x, y)

(1)

Speciﬁcally, We use following weight ratio in our experiments, subregion1 (68
facial landmarks): subregion2 (eye, nose, mouth): subregion3 (other face area):
subregion4 (neck) = 16:4:3:0. The ﬁnal weight mask is shown in Figure4

3.3 Training Details

Because our training process needs datasets containing both 2D face images and
its corresponding 3D point clouds with semantic meaning, we choose e.g., 300W-
LP[11] to form our training sets, since it contains face images across diﬀerent
angles with the annotation of estimated 3DMM coeﬃcients, from which the 3D
point cloud could be easily recovered. Speciﬁcally, we crop the images according
the ground truth bounding box and rescale them to size 256 × 256. Then utilize
their annotated 3DMM parameters to generate the corresponding 3D position,
and render them into UV space to obtain the ground truth position map, the
map size in our training is also 256 × 256, which means a precision of more than
45K point cloud to regress. Notice that, although our training data is generated
from 3DMM, our network’s output, the position map is not restricted to any
face template or linear space of 3DMM.

We perturb the training set by randomly rotating and translating the target
face in 2D image plane. To be speciﬁc, the rotation is from -45 to 45 degree angles,
translation changes is random from 10 percent of input size, and scale is from
0.9 to 1.2. Like [18], we also augment our training data by scaling color channels
with scale range from 0.6 to 1.4. In order to handle images with occlusions, we
synthesize occlusions by adding noise texture into raw images, which is similar
to the work of [61,29]. With all above augmentation operations, our training
data covers all the diﬃcult cases.

We use the network described 3 to train our transfer model. For optimization,
we use Adam optimizer with a learning rate begins at 0.0001 and decays half
after each 5 epochs. The batch size is set as 16. All of our training codes are
implemented with TensorFlow[62].

Joint 3D Face Reconstruction and Dense Alignment

9

4 Experimental Results

In this part, we evaluate the performance of our proposed method on the tasks
of 3D face alignment and 3D face reconstruction. We ﬁrst introduce the test
datasets used in our experiments in section 4.1. Then in section 4.2 and 4.3 we
compare our results with other methods in both quantitative and qualitative
way. We then compare our method’s runtime with other methods in section 4.4.
In the end, the ablation study is conducted in section 4.5 to evaluate the eﬀect
of weight mask in our method.

4.1 Test Dataset

To evaluate our performance on the task of dense alignment and 3D face recon-
struction, multiple test datasets listed below are used in our experiments:

AFLW2000-3D is constructed by [11] to evaluate 3D face alignment on
challenging unconstrained images. This database contains the ﬁrst 2000 images
from AFLW[63] and expands its annotations with ﬁtted 3DMM parameters and
68 3D landmarks. We use this database to evaluate the performance of our
method on both face reconstruction and face alignment tasks.

AFLW-LFPA is another extension of AFLW dataset constructed by [10].
By picking images from AFLW according to the poses, the authors construct
this dataset which contains 1299 test images with a balanced distribution of
yaw angle. Besides, each image is annotated with 13 additional landmarks as a
expansion to only 21 visible landmarks in AFLW. This database is evaluated on
the task of 3D face alignment. We use 34 visible landmarks as the ground truth
to measure the accuracy of our results.

Florence is a 3D face dataset that contains 53 subjects with its ground truth
3D mesh acquired from a structured-light scanning system[64]. On experiments,
each subject generates renderings with diﬀerent poses as the same with [18]: a
pitch of -15,20 and 25 degrees and spaced rotations between -80 and 80. We
compare the performance of our method on face reconstruction against other
very recent state-of-the-art methods VRN-Guided[18] and 3DDFA[11] on this
dataset.

4.2

3D Face Alignment

To evaluate the face alignment performance. We employ the Normalized Mean
Error(NME) to be the evaluation metric, bounding box size is used as the nor-
malization factor. Firstly, we evaluate our method on a sparse set of 68 facial
landmarks, and compare our result with 3DDFA[11], DeFA[15] and 3D-FAN[19]
on dataset AFLW2000-3D. As shown in ﬁgure 5, our result slightly outper-
forms the state-of-the-art method 3D-FAN when calculating per distance with
2D coordinates. When considering the depth value, the performance discrepancy
between our method and 3D-FAN increases. Notice that, the 3D-FAN needs an-
other network to predict the z coordinate of landmarks, while the depth value
can be obtained directly in our method.

10

Y. Feng et al.

Fig. 5: Cumulative Errors Distribution (CED) curves on AFLW2000-3D. Eval-
uation is performed on 68 landmarks with both the 2D(left) and 3D(right) co-
ordinates. Overall 2000 images from AFLW2000-3D dataset are used here. The
mean NME% of each method is also showed in the legend.

To further investigate the performance of our method across poses and datasets,

we also report the NME of faces with small, medium and large yaw angles on
AFLW2000-3D dataset and the mean NME on both AFLW2000-3D and AFLW-
LPFA datasets. Table 1 shows the comparison with other methods, note that the
numerical values are recorded from their published papers except the ones of 3D-
FAN. Follow the work [11], we also randomly select 696 faces from AFLW2000
to balance the distribution. The result shows that our method is robust to the
change of pose and datasets.

Although all the state-of-the-art methods of face alignment conduct evalua-

tion on AFLW2000-3D dataset, the ground truth of this dataset is still controversial[29,19]
due to its annotation pipeline which is based on Landmarks Marching method
in [6]. Thus, we visualize some results in Figure 6 that have NME larger than
6.5% and we ﬁnd our results are more accurate than the ground truth in some
cases.

Table 1: Performance comparison on two large-pose face alignment datasets
AFLW2000-3D(68 landmarks) and AFLW-LFPA(34 visible landmarks). The
NME (%) for faces with diﬀerent yaw angles are reported. The ﬁrst best re-
sult in each category is highlighted in bold, the lower is the better.

Method
SDM[46]
3DDFA [11]

3.67
3.78
3DDFA + SDM [11] 3.43

PAWF[10]
Yu et al. [29]
3DSTN[16]
DeFA[15]
PRN (ours)

AFLW2000-3D
0 to 30 30 to 60 60 to 90 Mean
6.12
5.42
4.94
-
-
4.49
4.50
3.62

9.67
7.93
7.17
-
9.56
5.98
-
4.61

4.94
4.54
4.24
-
6.06
4.33
-
3.51

-
3.62
3.15
-
2.75

AFLW-LFPA
Mean
-
-
-
4.72
-
-
3.86
2.93

Joint 3D Face Reconstruction and Dense Alignment

11

Fig. 6: Examples from AFLW2000-3D dataset show that our predictions are more
accurate than ground truth in some cases. Green: predicted landmarks by our
method. Red: ground truth from [11].

We also compare our dense alignment result against other state-of-the-art
methods including 3DDFA[11] and DeFA[15] on the only test dataset AFLW2000-
3D. In order to compare diﬀerent methods with the same set of points, we select
the points from the largest common face region provided by all methods, and
ﬁnally around 45K points were used for the evaluation. As shown in ﬁgure 7, our
method outperforms the best methods with a large margin of more than 27%
on both 2D and 3D coordinates.

Fig. 7: CED curves on AFLW2000-3D. Evaluation is performed on all points
with both the 2D (left) and 3D (right) coordinates. Overall 2000 images from
AFLW2000-3D dataset are used here. The mean NME% of each method is also
showed in the legend.

4.3 3D Face Reconstruction

In this part, we evaluate our method on 3D face reconstruction task and com-
pare with 3DDFA[11], DeFA[15] and VRN-Guided[18] on AFLW2000-3D and
Florence datasets. We use the same set of points as in evaluating dense alignment
and changes the metric so as to keep consistency with other 3D face reconstruc-
tion evaluation methods. We ﬁrst use Iterative Closest Points(ICP) algorithm to

12

Y. Feng et al.

ﬁnd the corresponding nearest points between the network output and ground
truth point cloud, then calculate Mean Squared Error(MSE) normalized by outer
interocular distance of 3D coordinates.

The result is shown in ﬁgure 8. our method greatly exceeds the performance
of other two state-of-the-art methods. Since AFLW2000-3D dataset is labeled

Fig. 8: 3D reconstruction performance(CED curves) on in-the-wild AFLW2000-
3D dataset and Florence dataset. The mean NME% of each method is showed
in the legend. On AFLW2000-3D, more than 45K points are used for evaluation.
On Florence, about 19K points are used.

with results from 3DMM ﬁtting, we further evaluate the performance of our
method on Florence dataset, where ground truth 3D point cloud is obtained
from structured-light 3D scanning system. Here we compare our method with
3DDFA and VRN-Guided[18], using experimental settings in [18]. The evalua-
tion images are the renderings with diﬀerent poses from Florence database, we
calculate the bounding box from the ground truth point cloud and using the
cropped image as network input. Although our method output more complete
face point clouds than VRN, we only choose the common face region to compare
the performance, 19K points are used for the evaluation. Figure 8 shows that our
method achieves 28.7% relative higher performance compared to VRN-Guided
on Florence dataset, which is a signiﬁcant improvement.

To better evaluate the reconstruction performance of our method across dif-
ferent poses, we calculated the NME for diﬀerent yaw angle range. As shown
in ﬁgure 9, all the methods perform well in near frontal view, however, 3DDFA
and VRN-Guided fail to keep low error as pose becomes large, while our method
keeps relatively stable performance in all pose ranges. We also illustrate the
qualitative comparison in ﬁgure 9, our restored point cloud covers a larger re-
gion than in VRN-Guided, which ignores the lateral facial parts. Besides, due to
the limitation on resolution of VRN, our method provides ﬁner details of face,
especially on the nose and mouth region.

We also provide additional qualitative results on 300VW[65] and Multi-

PIE[66] datasets, please refer to supplementary material for full details.

Joint 3D Face Reconstruction and Dense Alignment

13

Fig. 9: Left: CED curves on Florence dataset with diﬀerent yaw angles. Right: the
qualitative comparison with VRN-Guided. The ﬁrst column is the input images
from Florence dataset and the Internet, the second column is the reconstructed
face from our method, the third column is the results from VRN-Guided.

4.4 Runtime

Surpassing the performance of all other state-of-the-art methods on 3D face
alignment and reconstruction, our method is surprisingly more light-weighted
and faster. Since our network uses basic encoder-decoder structure, our model
size is only 160MB compared to 1.5GB in VRN[18]. We also compare the run-
time between our method and other state-of-the-art methods. Table 2 shows the
result. The results of 3DDFA and 3DSTN are directly recorded from their pub-
lished papers and others are recorded by running their publicly available source
codes. Notice that, We measure the run time of the process which is deﬁned from
inputing the cropped face image until recovering the 3D geometry(point cloud,
mesh or voxel data) for 3D reconstruction methods or obtaining the 3D land-
marks for alignment methods. The harware used for evaluation is an NVIDIA
GeForce GTX 1080 GPU and an Intel(R) Xeon(R) CPU E5-2640 v4 @ 2.40GHz.

Table 2: Run time in Milliseconds per Image
3DDFA[11] DeFA[15] 3D-FAN[19] 3DSTN[16] VRN-Guided[18] PRN (ours)

75.7

35.4

54.7

19.0

69.0

9.8

Speciﬁcally, DeFA needs 11.8ms(GPU) to predict 3DMM parameters and an-
other 23.6ms(CPU) to generate mesh data from predicted parameters, 3DFAN
needs 29.1ms(GPU) to estimate 2D coordinates ﬁrst and 25.6ms(GPU) to ob-
tain depth value, VRN-Guided detects 68 2D landmarks with 28.4ms(GPU),
then regress the voxel data with 40.6ms(GPU), our method provides both 3D
reconstruction and dense alignment result from cropped image in one pass in
9.8ms(GPU).

14

Y. Feng et al.

4.5 Ablation Study

In this section, we conduct several experiments to evaluate the inﬂuence of our
weight mask on training and provide both sparse and dense alignment CED on
AFLW2000 to evaluate diﬀerent settings. Table 3 shows three options for our
weight mask, we could see that weight ratio 1 corresponds to the situation when
no weight mask is used, weight ratio 2 and 3 are slightly diﬀerent on the emphasis
in loss function. The results are shown in Figure 10. Network trained without

Table 3: The weight ratio of diﬀerent settings

sub1:sub2:sub3:sub4

weight ratio 1 weight ratio 2 weight ratio 3
1:1:1:0

16:4:3:0

1:1:1:1

using weight mask has worst performance compared with other two settings. By
adding weights to speciﬁc regions such as 68 facial landmarks or central face
region, weight ratio 3 shows considerable improvement on 68 points datasets
over weight ratio 2.

Fig. 10: The eﬀect of weight mask evaluated on AFLW2000-3D dataset with 68
landmarks(left) and all points(right).

5 Conclusion

In this paper, we propose an end-to-end method, which well solves the problems
of 3D face alignment and 3D face reconstruction simultaneously. By learning the
position map, we directly regress the complete 3D structure along with semantic
meaning from a single image. Quantitative and qualitative results demonstrate
our method is robust to poses, illuminations and occlusions. Experiments on
three test datasets show that our method achieves signiﬁcant improvements over
others. We further show that our method runs faster than other methods and is
suitable for real time usage.

Joint 3D Face Reconstruction and Dense Alignment

15

6 Acknowledgements

We would like to thank Aaron Jackson for kindly providing the Florence test
data. We also thank Iacopo Masi for his patience in helping me acquire Florence
3D Face dataset. This work was supported by CloudWalk Technology.

References

1. Zhou, E., Fan, H., Cao, Z., Jiang, Y., Yin, Q.: Extensive facial landmark local-
In: Computer Vision
ization with coarse-to-ﬁne convolutional network cascade.
Workshops (ICCVW), 2013 IEEE International Conference on, IEEE (2013) 386–
391

2. Zhang, Z., Luo, P., Loy, C.C., Tang, X.: Facial landmark detection by deep multi-
task learning. In: European Conference on Computer Vision, Springer (2014) 94–
108

3. Liang, Z., Ding, S., Lin, L.: Unconstrained facial landmark localization with
backbone-branches fully-convolutional networks. arXiv preprint arXiv:1507.03409
(2015)

4. Peng, X., Feris, R.S., Wang, X., Metaxas, D.N.: A recurrent encoder-decoder
In: European Conference on Computer

network for sequential face alignment.
Vision, Springer (2016) 38–56

5. Wagner, A., Wright, J., Ganesh, A., Zhou, Z., Mobahi, H., Ma, Y.: Toward a
practical face recognition system: Robust alignment and illumination by sparse
representation. IEEE Transactions on Pattern Analysis and Machine Intelligence
34(2) (2012) 372–386

6. Zhu, X., Lei, Z., Yan, J., Yi, D., Li, S.Z.: High-ﬁdelity pose and expression nor-

malization for face recognition in the wild. (2015) 787–796

7. Huber, P., Hu, G., Tena, R., Mortazavian, P., Koppen, W.P., Christmas, W.J.,
Ratsch, M., Kittler, J.: A multiresolution 3d morphable face model and ﬁtting
framework. (2016) 79–86

8. Zhao, R., Wang, Y., Benitez-Quiroz, C.F., Liu, Y., Martinez, A.M.: Fast and
precise face alignment and 3d shape reconstruction from a single 2d image. In:
European Conference on Computer Vision, Springer (2016) 590–603

9. Jeni, L.A., Tulyakov, S., Yin, L., Sebe, N., Cohn, J.F.: The ﬁrst 3d face alignment
In: European Conference on Computer Vision,

in the wild (3dfaw) challenge.
Springer (2016) 511–520

10. Jourabloo, A., Liu, X.: Large-pose face alignment via cnn-based dense 3d model

ﬁtting. In: Computer Vision and Pattern Recognition. (2016)

11. Zhu, X., Lei, Z., Liu, X., Shi, H., Li, S.Z.: Face alignment across large poses: A 3d

solution. computer vision and pattern recognition (2016) 146–155

12. Richardson, E., Sela, M., Kimmel, R.: 3d face reconstruction by learning from
synthetic data. In: Fourth International Conference on 3d Vision. (2016) 460–469
13. Liu, F., Zeng, D., Zhao, Q., Liu, X.: Joint face alignment and 3d face reconstruction.

In: European Conference on Computer Vision, Springer (2016) 545–560

14. Richardson, E., Sela, M., Or-El, R., Kimmel, R.: Learning detailed face recon-

15. Liu, Y., Jourabloo, A., Ren, W., Liu, X.: Dense face alignment. arXiv preprint

struction from a single image. (2016)

arXiv:1709.01442 (2017)

16

Y. Feng et al.

16. Bhagavatula, C., Zhu, C., Luu, K., Savvides, M.: Faster than real-time facial
alignment: A 3d spatial transformer network approach in unconstrained poses. In:
The IEEE International Conference on Computer Vision (ICCV). Volume 2. (2017)
7

17. Sela, M., Richardson, E., Kimmel, R.: Unrestricted facial geometry reconstruction

using image-to-image translation. (2017)

18. Jackson, A.S., Bulat, A., Argyriou, V., Tzimiropoulos, G., Jackson, A.S., Bulat,
A., Argyriou, V., Tzimiropoulos, G.: Large pose 3d face reconstruction from a
single image via direct volumetric cnn regression. In: International Conference on
Computer Vision. (2017)

19. Bulat, A., Tzimiropoulos, G.: How far are we from solving the 2d and 3d face

alignment problem? (and a dataset of 230,000 3d facial landmarks). (2017)

20. Blanz, V., Vetter, T.: A morphable model for the synthesis of 3d faces. international
conference on computer graphics and interactive techniques (1999) 187–194
21. Lee, Y.J., Lee, S.J., Kang, R.P., Jo, J., Kim, J.: Single view-based 3d face recon-
struction robust to self-occlusion. Eurasip Journal on Advances in Signal Process-
ing 2012(1) (2012) 1–20

22. Thies, J., Zollhfer, M., Stamminger, M., Theobalt, C., Niener, M.: Face2face: Real-
time face capture and reenactment of rgb videos. In: Computer Vision and Pattern
Recognition. (2016) 5

23. Cao, C., Hou, Q., Zhou, K.: Displaced dynamic expression regression for real-time

facial tracking and animation. ACM (2014)

24. Jeni, L.A., Cohn, J.F., Kanade, T.: Dense 3d face alignment from 2d videos in
In: Automatic Face and Gesture Recognition (FG), 2015 11th IEEE

real-time.
International Conference and Workshops on. Volume 1., IEEE (2015) 1–8

25. Grewe, C.M., Zachow, S.: Fully automated and highly accurate dense correspon-
dence for facial surfaces. In: European Conference on Computer Vision, Springer
(2016) 552–568

26. Huber, P., Feng, Z.H., Christmas, W., Kittler, J., Ratsch, M.: Fitting 3d morphable
In: IEEE International Conference on Image

face models using local features.
Processing. (2015) 1195–1199

27. Romdhani, S., Vetter, T.: Estimating 3d shape and texture using pixel intensity,
edges, specular highlights, texture constraints and a prior.
In: IEEE Computer
Society Conference on Computer Vision and Pattern Recognition. (2005) 986–993
28. G¨uler, R.A., Trigeorgis, G., Antonakos, E., Snape, P., Zafeiriou, S., Kokkinos, I.:
Densereg: Fully convolutional dense shape regression in-the-wild. In: Proc. CVPR.
Volume 2. (2017)

29. Yu, R., Saito, S., Li, H., Ceylan, D., Li, H.: Learning dense facial correspondences

30. Dou, P., Shah, S.K., Kakadiaris, I.A.: End-to-end 3d face reconstruction with deep

in unconstrained images. (2017)

neural networks. (2017)

31. Tran, A.T., Hassner, T., Masi, I., Medioni, G.: Regressing robust and discrimina-

tive 3d morphable models with a very deep neural network. (2016)

32. Jourabloo, A., Liu, X.: Pose-invariant 3d face alignment. In: Proceedings of the

IEEE International Conference on Computer Vision. (2015) 3694–3702

33. Laine, S., Karras, T., Aila, T., Herva, A., Lehtinen, J.: Facial performance capture

with deep neural networks. arXiv preprint arXiv:1609.06536 (2016)

34. Tewari, A., Zollhfer, M., Kim, H., Garrido, P., Bernard, F., Prez, P., Theobalt, C.:
Mofa: Model-based deep convolutional face autoencoder for unsupervised monoc-
ular reconstruction. (2017)

Joint 3D Face Reconstruction and Dense Alignment

17

35. Bas, A., Huber, P., Smith, W.A.P., Awais, M., Kittler, J.: 3d morphable models as
spatial transformer networks. In: ICCV 2017 Workshop on Geometry Meets Deep
Learning. (2017)

36. Hassner, T.: Viewing real-world faces in 3d. In: IEEE International Conference on

Computer Vision. (2013) 3607–3614

37. Kemelmacher-Shlizerman, I., Basri, R.: 3d face reconstruction from a single image
using a single reference face shape. IEEE Transactions on Pattern Analysis and
Machine Intelligence 33(2) (2011) 394

38. Gu, L., Kanade, T.: 3d alignment of face in a single image. In: Computer Vision
and Pattern Recognition, 2006 IEEE Computer Society Conference on. Volume 1.,
IEEE (2006) 1305–1312

39. S´anta, Z., Kato, Z.: 3d face alignment without correspondences.

In: European

Conference on Computer Vision, Springer (2016) 521–535

40. Matthews, I., Baker, S.: Active appearance models revisited. International journal

of computer vision 60(2) (2004) 135–164

41. Saragih, J., Goecke, R.: A nonlinear discriminative approach to aam ﬁtting. In:
Computer Vision, 2007. ICCV 2007. IEEE 11th International Conference on, IEEE
(2007) 1–8

42. Tzimiropoulos, G., Pantic, M.: Optimization problems for fast aam ﬁtting in-the-
wild. In: Computer Vision (ICCV), 2013 IEEE International Conference on, IEEE
(2013) 593–600

43. Kim, J., Liu, C., Sha, F., Grauman, K.: Deformable spatial pyramid matching for
fast dense correspondences. In: Computer Vision and Pattern Recognition. (2013)
2307–2314

44. Asthana, A., Zafeiriou, S., Cheng, S., Pantic, M.: Robust discriminative response
map ﬁtting with constrained local models. In: Computer Vision and Pattern Recog-
nition (CVPR), 2013 IEEE Conference on, IEEE (2013) 3444–3451

45. Doll´ar, P., Welinder, P., Perona, P.: Cascaded pose regression.

In: Computer
Vision and Pattern Recognition (CVPR), 2010 IEEE Conference on, IEEE (2010)
1078–1085

46. Xiong, X., Torre, F.D.L.: Global supervised descent method. In: IEEE Conference

on Computer Vision and Pattern Recognition. (2015) 2664–2673

47. McDonagh, J., Tzimiropoulos, G.: Joint face detection and alignment with a de-
formable hough transform model. In: European Conference on Computer Vision,
Springer (2016) 569–580

48. Gou, C., Wu, Y., Wang, F.Y., Ji, Q.: Shape augmented regression for 3d face
alignment. In: European Conference on Computer Vision, Springer (2016) 604–
615

49. de Bittencourt Zavan, F.H., Nascimento, A.C., e Silva, L.P., Bellon, O.R., Silva, L.:
3d face alignment in the wild: A landmark-free, nose-based approach. In: European
Conference on Computer Vision, Springer (2016) 581–589

50. Bulat, A., Tzimiropoulos, G.: Two-stage convolutional part heatmap regression for
the 1st 3d face alignment in the wild (3dfaw) challenge. In: European Conference
on Computer Vision, Springer (2016) 616–624

51. Fan, H., Su, H., Guibas, L.: A point set generation network for 3d object recon-

struction from a single image. (2016) 2463–2471

52. Deng, J., Cheng, S., Xue, N., Zhou, Y., Zafeiriou, S.: Uv-gan: Adversarial
arXiv preprint

facial uv map completion for pose-invariant face recognition.
arXiv:1712.04695 (2017)

18

Y. Feng et al.

53. Moschoglou, S., Ververas, E., Panagakis, Y., Nicolaou, M., Zafeiriou, S.: Multi-
arXiv preprint

attribute robust component analysis for facial uv maps.
arXiv:1712.05799 (2017)

54. Xue, N., Deng, J., Cheng, S., Panagakis, Y., Zafeiriou, S.: Side information for

face completion: a robust pca approach. arXiv preprint arXiv:1801.07580 (2018)

55. Maninchedda, F., H¨ane, C., Oswald, M.R., Pollefeys, M.: Face reconstruction on
mobile devices using a height map shape model and fast regularization. In: 3D
Vision (3DV), 2016 Fourth International Conference on, IEEE (2016) 489–498
56. Maninchedda, F., Oswald, M.R., Pollefeys, M.: Fast 3d reconstruction of faces with
glasses. In: 2017 IEEE Conference on Computer Vision and Pattern Recognition
(CVPR), IEEE (2017) 4608–4617

57. Booth, J., Zafeiriou, S.: Optimal uv spaces for facial morphable model construction.
In: Image Processing (ICIP), 2014 IEEE International Conference on, IEEE (2014)
4672–4676

58. Floater, M.S.: Parametrization and smooth approximation of surface triangula-

tions. Computer Aided Geometric Design 14(3) (1997) 231–250

59. He, K., Zhang, X., Ren, S., Sun, J.: Deep residual learning for image recognition.

In: Computer Vision and Pattern Recognition. (2016) 770–778

60. Crispell, D., Bazik, M.: Pix2face: Direct 3d face model estimation. (2017)
61. Saito, S., Li, T., Li, H.: Real-time facial segmentation and performance capture
from rgb input. In: European Conference on Computer Vision, Springer (2016)
244–261

62. Abadi, M., Barham, P., Chen, J., Chen, Z., Davis, A., Dean, J., Devin, M., Ghe-
mawat, S., Irving, G., Isard, M., et al.: Tensorﬂow: A system for large-scale machine
learning. In: OSDI. Volume 16. (2016) 265–283

63. Koestinger, M., Wohlhart, P., Roth, P.M., Bischof, H.: Annotated facial landmarks
in the wild: A large-scale, real-world database for facial landmark localization. In:
Computer Vision Workshops (ICCV Workshops), 2011 IEEE International Con-
ference on, IEEE (2011) 2144–2151

64. Bagdanov, A.D., Del Bimbo, A., Masi, I.: The ﬂorence 2d/3d hybrid face dataset.
In: Proceedings of the 2011 joint ACM workshop on Human gesture and behavior
understanding, ACM (2011) 79–80

65. Chrysos, G.G., Antonakos, E., Zafeiriou, S., Snape, P.: Oﬄine deformable face
tracking in arbitrary videos. In: Proceedings of the IEEE International Conference
on Computer Vision Workshops. (2015) 1–9

66. Hartley, R., Zisserman, A.: Multiple view geometry in computer vision. Kybernetes

30(9/10) (2003) 1865 – 1872

Joint 3D Face Reconstruction and Dense
Alignment with Position Map Regression
Network

Yao Feng†, Fan Wu‡, Xiaohu Shao§, Yanfeng Wang†, Xi Zhou‡†

†Shanghai Jiao Tong University, ‡CloudWalk Technology
§Research Center for Intelligent Security Technology, CIGIT
fengyao@sjtu.edu.cn, wufan@cloudwalk.cn, shaoxiaohu@cigit.ac.cn
wangyanfeng@sjtu.edu.cn, zhouxi@cloudwalk.cn

Abstract. We propose a straightforward method that simultaneously
reconstructs the 3D facial structure and provides dense alignment. To
achieve this, we design a 2D representation called UV position map which
records the 3D shape of a complete face in UV space, then train a sim-
ple Convolutional Neural Network to regress it from a single 2D image.
We also integrate a weight mask into the loss function during training
to improve the performance of the network. Our method does not rely
on any prior face model, and can reconstruct full facial geometry along
with semantic meaning. Meanwhile, our network is very light-weighted
and spends only 9.8ms to process an image, which is extremely faster
than previous works. Experiments on multiple challenging datasets show
that our method surpasses other state-of-the-art methods on both re-
construction and alignment tasks by a large margin. Code is available at
https://github.com/YadiraF/PRNet.

Keywords: 3D Face Reconstruction, Face Alignment, Dense Correspon-
dence

8
1
0
2
 
r
a

M
 
1
2
 
 
]

V
C
.
s
c
[
 
 
1
v
5
3
8
7
0
.
3
0
8
1
:
v
i
X
r
a

1 Introduction

3D face reconstruction and face alignment are two fundamental and highly re-
lated topics in computer vision. In the last decades, researches in these two ﬁelds
beneﬁt each other. In the beginning, face alignment that aims at detecting a spe-
cial 2D ﬁducial points [1,2,3,4] is commonly used as a prerequisite for other facial
tasks such as face recognition [5] and assists 3D face reconstruction [6,7] to a
great extent. However, researchers ﬁnd that 2D alignment has diﬃculties [8,9]
in dealing with problems of large poses or occlusions. With the development of
deep learning, many computer vision problems have been well solved by utilizing
Convolution Neural Networks (CNNs). Thus, some works start to use CNNs to
estimate the 3D Morphable Model (3DMM) coeﬃcients [10,11,12,13,14,15] or
3D model warping functions [16,17] to restore the corresponding 3D information
from a single 2D facial image, which provides both dense face alignment and
3D face reconstruction results. However, the performance of these methods is
restricted due to the limitation of the 3D space deﬁned by face model basis or

2

Y. Feng et al.

Fig. 1: The qualitative results of our method. Odd row: alignment results (only
68 key points are plotted for display). Even row: 3D reconstruction results (re-
constructed shapes are rendered with head light for better view).

templates. The required operations including perspective projection or 3D Thin
Plate Spline (TPS) transformation also add complexity to the overall process.

Recently, two end-to-end works [18] [19], which bypass the limitation of model
space, achieve the state-of-the-art performances on their respective tasks. [19]
trains a complex network to regress 68 facial landmarks with 2D coordinates
from a single image, but needs an extra network to estimate the depth value.
Besides, dense alignment is not provided by this method. [18] develops a vol-
umetric representation of 3D face and uses a network to regress it from a 2D
image. However, this representation discards the semantic meaning of points,
thus the network needs to regress the whole volume in order to restore the fa-
cial shape, which is only part of the volume. So this representation limits the
resolution of the recovered shape, and need a complex network to regress it.
We ﬁnd that these limitations do not exist in previous model-based methods,
it motivates us to ﬁnd a new approach to obtaining the 3D reconstruction and
dense alignment simultaneously in a model-free manner.

In this paper, we propose an end-to-end method called Position map Regres-
sion Network (PRN) to jointly predict dense alignment and reconstruct 3D face
shape. Our method surpasses all other previous works on both 3D face alignment
and reconstruction on multiple datasets. Meanwhile, our method is straightfor-
ward with a very light-weighted model which provides the result in one pass with
9.8ms. All of these are achieved by the elaborate design of the 2D representation
of 3D facial structure and the corresponding loss function. Speciﬁcally, we design
a UV position map, which is a 2D image recording the 3D coordinates of a com-
plete facial point cloud, and at the same time keeping the semantic meaning at
each UV place. We then train a simple encoder-decoder network with a weighted
loss that focuses more on discriminative region to regress the UV position map

Joint 3D Face Reconstruction and Dense Alignment

3

from a single 2D facial image. Figure1 shows our method is robust to poses,
illuminations and occlusions.

In summary, our main contributions are:

– For the ﬁrst time, we solve the problems of face alignment and 3D face
reconstruction together in an end-to-end fashion without the restriction of
low-dimensional solution space.

– To directly regress the 3D facial structure and dense alignment, we develop
a novel representation called UV position map, which records the position
information of 3D face and provides dense correspondence to the semantic
meaning of each point on UV space.

– For training, we proposed a weight mask which assigns diﬀerent weight to
each point on position map and compute a weighted loss. We show that this
design helps improving the performance of our network.

– We ﬁnally provide a light-weighted framework that runs at over 100FPS to
directly obtain 3D face reconstruction and alignment result from a single 2D
facial image.

– Comparison on the AFLW2000-3D and Florence datasets shows that our
method achieves more than 25% relative improvements over other state-
of-the-art methods on both tasks of 3D face reconstruction and dense face
alignment.

2 Related Works

As described above, the main problems our method can solve are 3D face recon-
struction and face alignment. We will talk about closely related works on these
tasks in the following subsections.

2.1

3D Face Reconstruction

This part we only talk about 3D face reconstruction from a single image un-
der unconstrained situations. Since Blanz and Vetter proposed 3D Morphable
Model(3DMM) in 1999[20], methods based on 3DMM are the most popular in
completing the task of monocular 3D facial shape reconstruction. Most of earlier
methods are to establish the correspondences of the special points between input
images and the 3D mean geometry including landmarks[21,6,22,7,23,24,25] and
local features[26,27,25], then solve the non-linear optimization function to regress
the 3DMM coeﬃcients. However, these methods heavily rely on the high accu-
racy of landmarks or other feature points detector. Thus, some methods[28,29]
ﬁrstly use CNNs to learn the dense correspondence between input image and
3D template, then calculate the 3DMM parameters with predicted dense con-
strains. Recent works also explore the usage of CNN to predict 3DMM param-
eters directly. [10,11,12,13,14] use cascaded CNN structure to regress the accu-
rate 3DMM coeﬃcients, which take a lot of time due to iterations. [30,31,32,33]
propose end-to-end CNN architectures to directly estimate the 3DMM shape pa-
rameters. Unsupervised methods have been also researched recently, [34,35] can

4

Y. Feng et al.

regress the 3DMM coeﬃcients without the help of training data by using facial
texture information, which performs badly in faces with large-poses and unbal-
anced illuminations. However, the main defect of those methods are model-based,
resulting in a limited geometry which is constrained in model shape space and
post-processing to generate 3D mesh from estimated parameters. Some other
methods can reconstruct 3D faces without 3D shape basis, while still rely on
a 3D facial template. [36,37,38,17,39] can produce a 3D structure by warping
the shape of a reference 3D model. [16] also reconstruct the 3D shape of faces
by learning a 3D Thin Plate Spline(TPS) warping function via a deep network
which warps a generic 3D model to a subject speciﬁc 3D shape. Obviously, the
reconstructed face geometry from these methods are also restricted by the ref-
erence model, which means the structure diﬀers when the template changes.
Recently, [18] propose to straightforwardly map the image pixels to full 3D fa-
cial structure via volumetric CNN regression. This method is not restricted in
the model space any more, While needs a complex network structure and a lot
of time to predict the voxel data. Diﬀerent from above methods, Our framework
is model-free and light-weighted, can run at real time and directly obtain the
full 3D facial geometry along with its correspondence information.

2.2 Face Alignment

In the ﬁeld of computer vision, face alignment is a long-standing problem which
attracts a lot of attention. In the beginning, there are a number of 2D fa-
cial alignment approaches which aim at locating a set of ﬁducial 2D facial
landmarks, such as classic Active Appearance Model(AMM)[40,41,42] and Con-
strained Local Models(CLM)[43,44]. Then cascaded regression[45,46] and CNN-
based methods[3,4,19] are largely used to achieve state-of-the-art performance
in 2D landmarks location. However, 2D landmarks location only regresses vis-
ible points on faces, which leads to diﬃculties and is limited to describe face
shape when the pose of faces is large. Recent works then research the 3D fa-
cial alignment, which begins with ﬁtting a 3DMM[47,11,48] or registering a
3D facial template[39,49] with a 2D facial image. Obviously, 3D reconstruc-
tion methods based on model can easily complete the task of 3D face alignment
by selecting x,y coordinates of landmarks vertices in reconstructed geometry.
Actually, [11,29,32] are specially designated methods to achieve 3D face align-
ment by means of 3DMM ﬁtting. Recently [50,19] use a deep network to di-
rectly predict the heat map to obtain the 3D facial landmarks and achieves
state-of-the-art performance. Thus, as sparse face alignment tasks are highly
completed by aforementioned methods, the task of dense face alignment begins
to develop. Notice that, the dense face alignment means the methods should
oﬀer the correspondence between two face images as well as between a 2D facial
image and a 3D facial reference geometry. [15] use multi-constraints to train a
CNN which estimates the 3DMM parameters and then provides a very dense 3D
alignment. [28,29] directly learn the correspondence between a 2D input image
and a 3D template via a deep network, while those predicted correspondence is
not complete, only visible face-region is considered. Compared to prior works,

Joint 3D Face Reconstruction and Dense Alignment

5

our method can directly establish the dense correspondence between all region
in faces and 3D template once the position map is regressed. No intermediate
parameters such as 3DMM coeﬃcients and TPS warping parameters are needed
in our method, which means our network can run very fast bypassing complex
operations including perspective projection and TPS transformation.

3 Proposed Method

This section describes the framework and the details of our proposed method.
Firstly, we introduce the characteristics of the position map for our 3D face
representation. Then we elaborate the CNN architecture and the loss function
designed specially for learning the mapping from unconstrained RGB image to
its 3D structure. The implementation details of our method are shown in the
last subsection.

3.1

3D Face Representation

Our goal is to regress the 3D facial geometry and its dense correspondence in-
formation from a single 2D image. Thus we need a proper representation which
can be directly predicted via a deep network. One simple and commonly used
idea is to concatenate the coordinates of all points in 3D face as a vector and use
a network to predict it. However, this transformation increases the diﬃculties in
training since projection from 3D space into 1D vector discards the spatial adja-
cency information among points. While it’s natural to think that spatially adja-
cent points could share weights in predicting their positions, which can be easily
achieved by using convolutional layers. The coordinates as a 1D vector needs a
fully connected layer to predict each point with much more parameters, which
increases the network size and is hard to train. [51] proposed a point set genera-
tion network to directly predict the point cloud of 3D object as a vector from a
single image. However, the max number of points is only 1024, far from enough
to represent an accurate 3D face. So model-based methods[11,30,15] regress a
few model parameters rather than the coordinates of points, which usually needs
special care in training such as using Mahalanobis distance and inevitably limits
the estimated face geometry to the their model space. [18] proposed 3D binary
volume as the representation of 3D structure and uses Volumetric Regression
Network(VRN) to output a 192 × 192 × 200 volume as the discretized version
of point cloud. By using this representation, VRN can be built with full convo-
lutional layers. However, discretization limits the resolution of point cloud, and
most part of the network output correspond to non-surface points which are of
less usage.

To address the problems in previous works, we propose UV position map as
the presentation of full 3D facial structure. UV position map or position map
for short, is a 2D image recording 3D positions of all points in UV space. In
the past years, UV space or UV coordinates, which is a 2D image plane param-
eterized from the 3D space, has been utilized as a way to express information

6

Y. Feng et al.

including the texture of faces(texture map) [35,52,53,54], 2.5D geometry(height
map)[55,56] and the correspondences between 3D facial meshes[57]. Diﬀerent
from previous works, we use UV space to store the 3D coordinates of points
from 3D face model. As shown in Figure 2, we deﬁne the 3D face point cloud in
Left-handed Cartesian Coordinate system. The origin of the 3D space overlaps
with the upper-left of the input image, with the positive x-axis pointing to the
right of the image. The ground truth 3D face point cloud exactly matches the
face in the 2D image when projected to the x-y plane. Thus our position map
can be easily comprehended as replacing the r, g, b value in texture map by x,
y, z coordinates.

Fig. 2: The illustration of UV position map. Left: 3D plot of input image and
its ground truth 3D point cloud. Right: The ﬁrst row is the input 2D image,
extracted UV texture map and corresponding UV position map. The second
row is the x, y, z channel of the UV position map.

In order to keep the semantic meaning of points within position map, we cre-
ate our UV coordinates based on 3DMM. Since we want to regress the 3D full
structure directly, the unconstrained 2D facial images and their corresponding
3D shapes are needed for end-to-end training. 300W-LP[11] is a large dataset
that contains more than 60K unconstrained images with ﬁtted 3DMM parame-
ters, which is suitable to form our training pairs. Besides, the 3DMM parameters
of this dataset are based on the Basel Face Model(BFM)[20]. Thus, in order to
make full use of this dataset, we conduct the UV coordinates corresponding
to BFM. To be speciﬁc, we use the parameterized UV coordinates from [35]
which computes a Tutte embedding[58] with conformal Laplacian weight and
then maps the mesh boundary to a square. Since the number of vertices in BFM
is more than 50K, we choose 256 as the position map size, which get a high
precision point cloud with negligible re-sample error.

Thus our position map records a dense set of points from 3D face with its
semantic meaning, we are able to simultaneously obtain the 3D facial structure
and dense alignment result by using a CNN to regress the position map directly
from unconstrained 2D images. The network architecture in our method could
be greatly simpliﬁed due to this convenience. Notice that the position map con-
tains the information of the whole face, which makes it diﬀerent from other 2D

Joint 3D Face Reconstruction and Dense Alignment

7

representations such as Projected Normalized Coordinate Code (PNCC)[11,14],
an ordinary depth image[17] or quantized UV coordinates[28], which only re-
serve the information of visible face region in the input image. Our proposed
position map also infers the invisible parts of face, thus our method can predict
a complete 3D face.

3.2 Network Architecture and Loss Function

Fig. 3: The architecture of PRN. The Green rectangles represent the residual
blocks, and the blue ones represent the transposed convolutional layers.

Since our network transfers the input RGB image into position map image, we
employ an encoder-decoder structure to learn the transfer function. The encoder
part of our network begins with one convolution layer followed by 10 residual
blocks[59] which reduce the 256 × 256 × 3 input image into 8 × 8 × 512 feature
maps, the decoder part contains 17 transposed convolution layers to generate the
predicted 256 × 256 × 3 position map. We use kernel size of 4 for all convolution
or transposed convolution layers, and use ReLU layer for activation. Given that
the position map contains both the full 3D information and dense alignment
result, we don’t need extra network module for multi-task during training or
inferring. The architecture of our network is shown in Figure 3.

In order to learn the parameters of the network, we build a novel loss function
to measure the diﬀerence between ground truth position map and the network
output. Mean square error (MSE) is a commonly used loss for such learning task,
such as in [29,60]. However, MSE treats all points equally, so it is not entirely
appropriate for learning the position map. Since central region of face has more
discriminative features than other regions, we employ a weight mask to form our
loss function.

As shown in Figure 4, the weight mask is a gray image recording the weight
of each point on position map. It has the same size and pixel-to-pixel correspon-
dence to position map. According to our objective, we separate points into four
categories, each has its own weights in the loss function. The position of 68 facial
keypoints has the highest weight, so that to ensure the network to learn accurate
locations of these points. The neck region usually attracts less attention, and is
often occluded by hairs or clothes in unconstrained images. Since learning the
3D shape of neck or clothes is beyond our interests, we assign 0 weight to points
in neck region to reduce disturbance to the training process.

Thus, we denote the predicted position map as P (x, y) for x, y representing
each pixel coordinate. Given the ground truth position map ˜P (x, y) and weight

8

Y. Feng et al.

Fig. 4: The illustration of weight mask. From left to right: UV texture map, UV
position map, colored texture map with segmentation information (blue for eye
region, red for nose region, green for mouth region and purple for neck region),
the ﬁnal weight mask.

mask W (x, y), our loss function is deﬁned as:

Loss =

(cid:88)

(cid:107)P (x, y) − ˜P (x, y)(cid:107) · W (x, y)

(1)

Speciﬁcally, We use following weight ratio in our experiments, subregion1 (68
facial landmarks): subregion2 (eye, nose, mouth): subregion3 (other face area):
subregion4 (neck) = 16:4:3:0. The ﬁnal weight mask is shown in Figure4

3.3 Training Details

Because our training process needs datasets containing both 2D face images and
its corresponding 3D point clouds with semantic meaning, we choose e.g., 300W-
LP[11] to form our training sets, since it contains face images across diﬀerent
angles with the annotation of estimated 3DMM coeﬃcients, from which the 3D
point cloud could be easily recovered. Speciﬁcally, we crop the images according
the ground truth bounding box and rescale them to size 256 × 256. Then utilize
their annotated 3DMM parameters to generate the corresponding 3D position,
and render them into UV space to obtain the ground truth position map, the
map size in our training is also 256 × 256, which means a precision of more than
45K point cloud to regress. Notice that, although our training data is generated
from 3DMM, our network’s output, the position map is not restricted to any
face template or linear space of 3DMM.

We perturb the training set by randomly rotating and translating the target
face in 2D image plane. To be speciﬁc, the rotation is from -45 to 45 degree angles,
translation changes is random from 10 percent of input size, and scale is from
0.9 to 1.2. Like [18], we also augment our training data by scaling color channels
with scale range from 0.6 to 1.4. In order to handle images with occlusions, we
synthesize occlusions by adding noise texture into raw images, which is similar
to the work of [61,29]. With all above augmentation operations, our training
data covers all the diﬃcult cases.

We use the network described 3 to train our transfer model. For optimization,
we use Adam optimizer with a learning rate begins at 0.0001 and decays half
after each 5 epochs. The batch size is set as 16. All of our training codes are
implemented with TensorFlow[62].

Joint 3D Face Reconstruction and Dense Alignment

9

4 Experimental Results

In this part, we evaluate the performance of our proposed method on the tasks
of 3D face alignment and 3D face reconstruction. We ﬁrst introduce the test
datasets used in our experiments in section 4.1. Then in section 4.2 and 4.3 we
compare our results with other methods in both quantitative and qualitative
way. We then compare our method’s runtime with other methods in section 4.4.
In the end, the ablation study is conducted in section 4.5 to evaluate the eﬀect
of weight mask in our method.

4.1 Test Dataset

To evaluate our performance on the task of dense alignment and 3D face recon-
struction, multiple test datasets listed below are used in our experiments:

AFLW2000-3D is constructed by [11] to evaluate 3D face alignment on
challenging unconstrained images. This database contains the ﬁrst 2000 images
from AFLW[63] and expands its annotations with ﬁtted 3DMM parameters and
68 3D landmarks. We use this database to evaluate the performance of our
method on both face reconstruction and face alignment tasks.

AFLW-LFPA is another extension of AFLW dataset constructed by [10].
By picking images from AFLW according to the poses, the authors construct
this dataset which contains 1299 test images with a balanced distribution of
yaw angle. Besides, each image is annotated with 13 additional landmarks as a
expansion to only 21 visible landmarks in AFLW. This database is evaluated on
the task of 3D face alignment. We use 34 visible landmarks as the ground truth
to measure the accuracy of our results.

Florence is a 3D face dataset that contains 53 subjects with its ground truth
3D mesh acquired from a structured-light scanning system[64]. On experiments,
each subject generates renderings with diﬀerent poses as the same with [18]: a
pitch of -15,20 and 25 degrees and spaced rotations between -80 and 80. We
compare the performance of our method on face reconstruction against other
very recent state-of-the-art methods VRN-Guided[18] and 3DDFA[11] on this
dataset.

4.2

3D Face Alignment

To evaluate the face alignment performance. We employ the Normalized Mean
Error(NME) to be the evaluation metric, bounding box size is used as the nor-
malization factor. Firstly, we evaluate our method on a sparse set of 68 facial
landmarks, and compare our result with 3DDFA[11], DeFA[15] and 3D-FAN[19]
on dataset AFLW2000-3D. As shown in ﬁgure 5, our result slightly outper-
forms the state-of-the-art method 3D-FAN when calculating per distance with
2D coordinates. When considering the depth value, the performance discrepancy
between our method and 3D-FAN increases. Notice that, the 3D-FAN needs an-
other network to predict the z coordinate of landmarks, while the depth value
can be obtained directly in our method.

10

Y. Feng et al.

Fig. 5: Cumulative Errors Distribution (CED) curves on AFLW2000-3D. Eval-
uation is performed on 68 landmarks with both the 2D(left) and 3D(right) co-
ordinates. Overall 2000 images from AFLW2000-3D dataset are used here. The
mean NME% of each method is also showed in the legend.

To further investigate the performance of our method across poses and datasets,

we also report the NME of faces with small, medium and large yaw angles on
AFLW2000-3D dataset and the mean NME on both AFLW2000-3D and AFLW-
LPFA datasets. Table 1 shows the comparison with other methods, note that the
numerical values are recorded from their published papers except the ones of 3D-
FAN. Follow the work [11], we also randomly select 696 faces from AFLW2000
to balance the distribution. The result shows that our method is robust to the
change of pose and datasets.

Although all the state-of-the-art methods of face alignment conduct evalua-

tion on AFLW2000-3D dataset, the ground truth of this dataset is still controversial[29,19]
due to its annotation pipeline which is based on Landmarks Marching method
in [6]. Thus, we visualize some results in Figure 6 that have NME larger than
6.5% and we ﬁnd our results are more accurate than the ground truth in some
cases.

Table 1: Performance comparison on two large-pose face alignment datasets
AFLW2000-3D(68 landmarks) and AFLW-LFPA(34 visible landmarks). The
NME (%) for faces with diﬀerent yaw angles are reported. The ﬁrst best re-
sult in each category is highlighted in bold, the lower is the better.

Method
SDM[46]
3DDFA [11]

3.67
3.78
3DDFA + SDM [11] 3.43

PAWF[10]
Yu et al. [29]
3DSTN[16]
DeFA[15]
PRN (ours)

AFLW2000-3D
0 to 30 30 to 60 60 to 90 Mean
6.12
5.42
4.94
-
-
4.49
4.50
3.62

9.67
7.93
7.17
-
9.56
5.98
-
4.61

4.94
4.54
4.24
-
6.06
4.33
-
3.51

-
3.62
3.15
-
2.75

AFLW-LFPA
Mean
-
-
-
4.72
-
-
3.86
2.93

Joint 3D Face Reconstruction and Dense Alignment

11

Fig. 6: Examples from AFLW2000-3D dataset show that our predictions are more
accurate than ground truth in some cases. Green: predicted landmarks by our
method. Red: ground truth from [11].

We also compare our dense alignment result against other state-of-the-art
methods including 3DDFA[11] and DeFA[15] on the only test dataset AFLW2000-
3D. In order to compare diﬀerent methods with the same set of points, we select
the points from the largest common face region provided by all methods, and
ﬁnally around 45K points were used for the evaluation. As shown in ﬁgure 7, our
method outperforms the best methods with a large margin of more than 27%
on both 2D and 3D coordinates.

Fig. 7: CED curves on AFLW2000-3D. Evaluation is performed on all points
with both the 2D (left) and 3D (right) coordinates. Overall 2000 images from
AFLW2000-3D dataset are used here. The mean NME% of each method is also
showed in the legend.

4.3 3D Face Reconstruction

In this part, we evaluate our method on 3D face reconstruction task and com-
pare with 3DDFA[11], DeFA[15] and VRN-Guided[18] on AFLW2000-3D and
Florence datasets. We use the same set of points as in evaluating dense alignment
and changes the metric so as to keep consistency with other 3D face reconstruc-
tion evaluation methods. We ﬁrst use Iterative Closest Points(ICP) algorithm to

12

Y. Feng et al.

ﬁnd the corresponding nearest points between the network output and ground
truth point cloud, then calculate Mean Squared Error(MSE) normalized by outer
interocular distance of 3D coordinates.

The result is shown in ﬁgure 8. our method greatly exceeds the performance
of other two state-of-the-art methods. Since AFLW2000-3D dataset is labeled

Fig. 8: 3D reconstruction performance(CED curves) on in-the-wild AFLW2000-
3D dataset and Florence dataset. The mean NME% of each method is showed
in the legend. On AFLW2000-3D, more than 45K points are used for evaluation.
On Florence, about 19K points are used.

with results from 3DMM ﬁtting, we further evaluate the performance of our
method on Florence dataset, where ground truth 3D point cloud is obtained
from structured-light 3D scanning system. Here we compare our method with
3DDFA and VRN-Guided[18], using experimental settings in [18]. The evalua-
tion images are the renderings with diﬀerent poses from Florence database, we
calculate the bounding box from the ground truth point cloud and using the
cropped image as network input. Although our method output more complete
face point clouds than VRN, we only choose the common face region to compare
the performance, 19K points are used for the evaluation. Figure 8 shows that our
method achieves 28.7% relative higher performance compared to VRN-Guided
on Florence dataset, which is a signiﬁcant improvement.

To better evaluate the reconstruction performance of our method across dif-
ferent poses, we calculated the NME for diﬀerent yaw angle range. As shown
in ﬁgure 9, all the methods perform well in near frontal view, however, 3DDFA
and VRN-Guided fail to keep low error as pose becomes large, while our method
keeps relatively stable performance in all pose ranges. We also illustrate the
qualitative comparison in ﬁgure 9, our restored point cloud covers a larger re-
gion than in VRN-Guided, which ignores the lateral facial parts. Besides, due to
the limitation on resolution of VRN, our method provides ﬁner details of face,
especially on the nose and mouth region.

We also provide additional qualitative results on 300VW[65] and Multi-

PIE[66] datasets, please refer to supplementary material for full details.

Joint 3D Face Reconstruction and Dense Alignment

13

Fig. 9: Left: CED curves on Florence dataset with diﬀerent yaw angles. Right: the
qualitative comparison with VRN-Guided. The ﬁrst column is the input images
from Florence dataset and the Internet, the second column is the reconstructed
face from our method, the third column is the results from VRN-Guided.

4.4 Runtime

Surpassing the performance of all other state-of-the-art methods on 3D face
alignment and reconstruction, our method is surprisingly more light-weighted
and faster. Since our network uses basic encoder-decoder structure, our model
size is only 160MB compared to 1.5GB in VRN[18]. We also compare the run-
time between our method and other state-of-the-art methods. Table 2 shows the
result. The results of 3DDFA and 3DSTN are directly recorded from their pub-
lished papers and others are recorded by running their publicly available source
codes. Notice that, We measure the run time of the process which is deﬁned from
inputing the cropped face image until recovering the 3D geometry(point cloud,
mesh or voxel data) for 3D reconstruction methods or obtaining the 3D land-
marks for alignment methods. The harware used for evaluation is an NVIDIA
GeForce GTX 1080 GPU and an Intel(R) Xeon(R) CPU E5-2640 v4 @ 2.40GHz.

Table 2: Run time in Milliseconds per Image
3DDFA[11] DeFA[15] 3D-FAN[19] 3DSTN[16] VRN-Guided[18] PRN (ours)

75.7

35.4

54.7

19.0

69.0

9.8

Speciﬁcally, DeFA needs 11.8ms(GPU) to predict 3DMM parameters and an-
other 23.6ms(CPU) to generate mesh data from predicted parameters, 3DFAN
needs 29.1ms(GPU) to estimate 2D coordinates ﬁrst and 25.6ms(GPU) to ob-
tain depth value, VRN-Guided detects 68 2D landmarks with 28.4ms(GPU),
then regress the voxel data with 40.6ms(GPU), our method provides both 3D
reconstruction and dense alignment result from cropped image in one pass in
9.8ms(GPU).

14

Y. Feng et al.

4.5 Ablation Study

In this section, we conduct several experiments to evaluate the inﬂuence of our
weight mask on training and provide both sparse and dense alignment CED on
AFLW2000 to evaluate diﬀerent settings. Table 3 shows three options for our
weight mask, we could see that weight ratio 1 corresponds to the situation when
no weight mask is used, weight ratio 2 and 3 are slightly diﬀerent on the emphasis
in loss function. The results are shown in Figure 10. Network trained without

Table 3: The weight ratio of diﬀerent settings

sub1:sub2:sub3:sub4

weight ratio 1 weight ratio 2 weight ratio 3
1:1:1:0

16:4:3:0

1:1:1:1

using weight mask has worst performance compared with other two settings. By
adding weights to speciﬁc regions such as 68 facial landmarks or central face
region, weight ratio 3 shows considerable improvement on 68 points datasets
over weight ratio 2.

Fig. 10: The eﬀect of weight mask evaluated on AFLW2000-3D dataset with 68
landmarks(left) and all points(right).

5 Conclusion

In this paper, we propose an end-to-end method, which well solves the problems
of 3D face alignment and 3D face reconstruction simultaneously. By learning the
position map, we directly regress the complete 3D structure along with semantic
meaning from a single image. Quantitative and qualitative results demonstrate
our method is robust to poses, illuminations and occlusions. Experiments on
three test datasets show that our method achieves signiﬁcant improvements over
others. We further show that our method runs faster than other methods and is
suitable for real time usage.

Joint 3D Face Reconstruction and Dense Alignment

15

6 Acknowledgements

We would like to thank Aaron Jackson for kindly providing the Florence test
data. We also thank Iacopo Masi for his patience in helping me acquire Florence
3D Face dataset. This work was supported by CloudWalk Technology.

References

1. Zhou, E., Fan, H., Cao, Z., Jiang, Y., Yin, Q.: Extensive facial landmark local-
In: Computer Vision
ization with coarse-to-ﬁne convolutional network cascade.
Workshops (ICCVW), 2013 IEEE International Conference on, IEEE (2013) 386–
391

2. Zhang, Z., Luo, P., Loy, C.C., Tang, X.: Facial landmark detection by deep multi-
task learning. In: European Conference on Computer Vision, Springer (2014) 94–
108

3. Liang, Z., Ding, S., Lin, L.: Unconstrained facial landmark localization with
backbone-branches fully-convolutional networks. arXiv preprint arXiv:1507.03409
(2015)

4. Peng, X., Feris, R.S., Wang, X., Metaxas, D.N.: A recurrent encoder-decoder
In: European Conference on Computer

network for sequential face alignment.
Vision, Springer (2016) 38–56

5. Wagner, A., Wright, J., Ganesh, A., Zhou, Z., Mobahi, H., Ma, Y.: Toward a
practical face recognition system: Robust alignment and illumination by sparse
representation. IEEE Transactions on Pattern Analysis and Machine Intelligence
34(2) (2012) 372–386

6. Zhu, X., Lei, Z., Yan, J., Yi, D., Li, S.Z.: High-ﬁdelity pose and expression nor-

malization for face recognition in the wild. (2015) 787–796

7. Huber, P., Hu, G., Tena, R., Mortazavian, P., Koppen, W.P., Christmas, W.J.,
Ratsch, M., Kittler, J.: A multiresolution 3d morphable face model and ﬁtting
framework. (2016) 79–86

8. Zhao, R., Wang, Y., Benitez-Quiroz, C.F., Liu, Y., Martinez, A.M.: Fast and
precise face alignment and 3d shape reconstruction from a single 2d image. In:
European Conference on Computer Vision, Springer (2016) 590–603

9. Jeni, L.A., Tulyakov, S., Yin, L., Sebe, N., Cohn, J.F.: The ﬁrst 3d face alignment
In: European Conference on Computer Vision,

in the wild (3dfaw) challenge.
Springer (2016) 511–520

10. Jourabloo, A., Liu, X.: Large-pose face alignment via cnn-based dense 3d model

ﬁtting. In: Computer Vision and Pattern Recognition. (2016)

11. Zhu, X., Lei, Z., Liu, X., Shi, H., Li, S.Z.: Face alignment across large poses: A 3d

solution. computer vision and pattern recognition (2016) 146–155

12. Richardson, E., Sela, M., Kimmel, R.: 3d face reconstruction by learning from
synthetic data. In: Fourth International Conference on 3d Vision. (2016) 460–469
13. Liu, F., Zeng, D., Zhao, Q., Liu, X.: Joint face alignment and 3d face reconstruction.

In: European Conference on Computer Vision, Springer (2016) 545–560

14. Richardson, E., Sela, M., Or-El, R., Kimmel, R.: Learning detailed face recon-

15. Liu, Y., Jourabloo, A., Ren, W., Liu, X.: Dense face alignment. arXiv preprint

struction from a single image. (2016)

arXiv:1709.01442 (2017)

16

Y. Feng et al.

16. Bhagavatula, C., Zhu, C., Luu, K., Savvides, M.: Faster than real-time facial
alignment: A 3d spatial transformer network approach in unconstrained poses. In:
The IEEE International Conference on Computer Vision (ICCV). Volume 2. (2017)
7

17. Sela, M., Richardson, E., Kimmel, R.: Unrestricted facial geometry reconstruction

using image-to-image translation. (2017)

18. Jackson, A.S., Bulat, A., Argyriou, V., Tzimiropoulos, G., Jackson, A.S., Bulat,
A., Argyriou, V., Tzimiropoulos, G.: Large pose 3d face reconstruction from a
single image via direct volumetric cnn regression. In: International Conference on
Computer Vision. (2017)

19. Bulat, A., Tzimiropoulos, G.: How far are we from solving the 2d and 3d face

alignment problem? (and a dataset of 230,000 3d facial landmarks). (2017)

20. Blanz, V., Vetter, T.: A morphable model for the synthesis of 3d faces. international
conference on computer graphics and interactive techniques (1999) 187–194
21. Lee, Y.J., Lee, S.J., Kang, R.P., Jo, J., Kim, J.: Single view-based 3d face recon-
struction robust to self-occlusion. Eurasip Journal on Advances in Signal Process-
ing 2012(1) (2012) 1–20

22. Thies, J., Zollhfer, M., Stamminger, M., Theobalt, C., Niener, M.: Face2face: Real-
time face capture and reenactment of rgb videos. In: Computer Vision and Pattern
Recognition. (2016) 5

23. Cao, C., Hou, Q., Zhou, K.: Displaced dynamic expression regression for real-time

facial tracking and animation. ACM (2014)

24. Jeni, L.A., Cohn, J.F., Kanade, T.: Dense 3d face alignment from 2d videos in
In: Automatic Face and Gesture Recognition (FG), 2015 11th IEEE

real-time.
International Conference and Workshops on. Volume 1., IEEE (2015) 1–8

25. Grewe, C.M., Zachow, S.: Fully automated and highly accurate dense correspon-
dence for facial surfaces. In: European Conference on Computer Vision, Springer
(2016) 552–568

26. Huber, P., Feng, Z.H., Christmas, W., Kittler, J., Ratsch, M.: Fitting 3d morphable
In: IEEE International Conference on Image

face models using local features.
Processing. (2015) 1195–1199

27. Romdhani, S., Vetter, T.: Estimating 3d shape and texture using pixel intensity,
edges, specular highlights, texture constraints and a prior.
In: IEEE Computer
Society Conference on Computer Vision and Pattern Recognition. (2005) 986–993
28. G¨uler, R.A., Trigeorgis, G., Antonakos, E., Snape, P., Zafeiriou, S., Kokkinos, I.:
Densereg: Fully convolutional dense shape regression in-the-wild. In: Proc. CVPR.
Volume 2. (2017)

29. Yu, R., Saito, S., Li, H., Ceylan, D., Li, H.: Learning dense facial correspondences

30. Dou, P., Shah, S.K., Kakadiaris, I.A.: End-to-end 3d face reconstruction with deep

in unconstrained images. (2017)

neural networks. (2017)

31. Tran, A.T., Hassner, T., Masi, I., Medioni, G.: Regressing robust and discrimina-

tive 3d morphable models with a very deep neural network. (2016)

32. Jourabloo, A., Liu, X.: Pose-invariant 3d face alignment. In: Proceedings of the

IEEE International Conference on Computer Vision. (2015) 3694–3702

33. Laine, S., Karras, T., Aila, T., Herva, A., Lehtinen, J.: Facial performance capture

with deep neural networks. arXiv preprint arXiv:1609.06536 (2016)

34. Tewari, A., Zollhfer, M., Kim, H., Garrido, P., Bernard, F., Prez, P., Theobalt, C.:
Mofa: Model-based deep convolutional face autoencoder for unsupervised monoc-
ular reconstruction. (2017)

Joint 3D Face Reconstruction and Dense Alignment

17

35. Bas, A., Huber, P., Smith, W.A.P., Awais, M., Kittler, J.: 3d morphable models as
spatial transformer networks. In: ICCV 2017 Workshop on Geometry Meets Deep
Learning. (2017)

36. Hassner, T.: Viewing real-world faces in 3d. In: IEEE International Conference on

Computer Vision. (2013) 3607–3614

37. Kemelmacher-Shlizerman, I., Basri, R.: 3d face reconstruction from a single image
using a single reference face shape. IEEE Transactions on Pattern Analysis and
Machine Intelligence 33(2) (2011) 394

38. Gu, L., Kanade, T.: 3d alignment of face in a single image. In: Computer Vision
and Pattern Recognition, 2006 IEEE Computer Society Conference on. Volume 1.,
IEEE (2006) 1305–1312

39. S´anta, Z., Kato, Z.: 3d face alignment without correspondences.

In: European

Conference on Computer Vision, Springer (2016) 521–535

40. Matthews, I., Baker, S.: Active appearance models revisited. International journal

of computer vision 60(2) (2004) 135–164

41. Saragih, J., Goecke, R.: A nonlinear discriminative approach to aam ﬁtting. In:
Computer Vision, 2007. ICCV 2007. IEEE 11th International Conference on, IEEE
(2007) 1–8

42. Tzimiropoulos, G., Pantic, M.: Optimization problems for fast aam ﬁtting in-the-
wild. In: Computer Vision (ICCV), 2013 IEEE International Conference on, IEEE
(2013) 593–600

43. Kim, J., Liu, C., Sha, F., Grauman, K.: Deformable spatial pyramid matching for
fast dense correspondences. In: Computer Vision and Pattern Recognition. (2013)
2307–2314

44. Asthana, A., Zafeiriou, S., Cheng, S., Pantic, M.: Robust discriminative response
map ﬁtting with constrained local models. In: Computer Vision and Pattern Recog-
nition (CVPR), 2013 IEEE Conference on, IEEE (2013) 3444–3451

45. Doll´ar, P., Welinder, P., Perona, P.: Cascaded pose regression.

In: Computer
Vision and Pattern Recognition (CVPR), 2010 IEEE Conference on, IEEE (2010)
1078–1085

46. Xiong, X., Torre, F.D.L.: Global supervised descent method. In: IEEE Conference

on Computer Vision and Pattern Recognition. (2015) 2664–2673

47. McDonagh, J., Tzimiropoulos, G.: Joint face detection and alignment with a de-
formable hough transform model. In: European Conference on Computer Vision,
Springer (2016) 569–580

48. Gou, C., Wu, Y., Wang, F.Y., Ji, Q.: Shape augmented regression for 3d face
alignment. In: European Conference on Computer Vision, Springer (2016) 604–
615

49. de Bittencourt Zavan, F.H., Nascimento, A.C., e Silva, L.P., Bellon, O.R., Silva, L.:
3d face alignment in the wild: A landmark-free, nose-based approach. In: European
Conference on Computer Vision, Springer (2016) 581–589

50. Bulat, A., Tzimiropoulos, G.: Two-stage convolutional part heatmap regression for
the 1st 3d face alignment in the wild (3dfaw) challenge. In: European Conference
on Computer Vision, Springer (2016) 616–624

51. Fan, H., Su, H., Guibas, L.: A point set generation network for 3d object recon-

struction from a single image. (2016) 2463–2471

52. Deng, J., Cheng, S., Xue, N., Zhou, Y., Zafeiriou, S.: Uv-gan: Adversarial
arXiv preprint

facial uv map completion for pose-invariant face recognition.
arXiv:1712.04695 (2017)

18

Y. Feng et al.

53. Moschoglou, S., Ververas, E., Panagakis, Y., Nicolaou, M., Zafeiriou, S.: Multi-
arXiv preprint

attribute robust component analysis for facial uv maps.
arXiv:1712.05799 (2017)

54. Xue, N., Deng, J., Cheng, S., Panagakis, Y., Zafeiriou, S.: Side information for

face completion: a robust pca approach. arXiv preprint arXiv:1801.07580 (2018)

55. Maninchedda, F., H¨ane, C., Oswald, M.R., Pollefeys, M.: Face reconstruction on
mobile devices using a height map shape model and fast regularization. In: 3D
Vision (3DV), 2016 Fourth International Conference on, IEEE (2016) 489–498
56. Maninchedda, F., Oswald, M.R., Pollefeys, M.: Fast 3d reconstruction of faces with
glasses. In: 2017 IEEE Conference on Computer Vision and Pattern Recognition
(CVPR), IEEE (2017) 4608–4617

57. Booth, J., Zafeiriou, S.: Optimal uv spaces for facial morphable model construction.
In: Image Processing (ICIP), 2014 IEEE International Conference on, IEEE (2014)
4672–4676

58. Floater, M.S.: Parametrization and smooth approximation of surface triangula-

tions. Computer Aided Geometric Design 14(3) (1997) 231–250

59. He, K., Zhang, X., Ren, S., Sun, J.: Deep residual learning for image recognition.

In: Computer Vision and Pattern Recognition. (2016) 770–778

60. Crispell, D., Bazik, M.: Pix2face: Direct 3d face model estimation. (2017)
61. Saito, S., Li, T., Li, H.: Real-time facial segmentation and performance capture
from rgb input. In: European Conference on Computer Vision, Springer (2016)
244–261

62. Abadi, M., Barham, P., Chen, J., Chen, Z., Davis, A., Dean, J., Devin, M., Ghe-
mawat, S., Irving, G., Isard, M., et al.: Tensorﬂow: A system for large-scale machine
learning. In: OSDI. Volume 16. (2016) 265–283

63. Koestinger, M., Wohlhart, P., Roth, P.M., Bischof, H.: Annotated facial landmarks
in the wild: A large-scale, real-world database for facial landmark localization. In:
Computer Vision Workshops (ICCV Workshops), 2011 IEEE International Con-
ference on, IEEE (2011) 2144–2151

64. Bagdanov, A.D., Del Bimbo, A., Masi, I.: The ﬂorence 2d/3d hybrid face dataset.
In: Proceedings of the 2011 joint ACM workshop on Human gesture and behavior
understanding, ACM (2011) 79–80

65. Chrysos, G.G., Antonakos, E., Zafeiriou, S., Snape, P.: Oﬄine deformable face
tracking in arbitrary videos. In: Proceedings of the IEEE International Conference
on Computer Vision Workshops. (2015) 1–9

66. Hartley, R., Zisserman, A.: Multiple view geometry in computer vision. Kybernetes

30(9/10) (2003) 1865 – 1872

Joint 3D Face Reconstruction and Dense
Alignment with Position Map Regression
Network

Yao Feng†, Fan Wu‡, Xiaohu Shao§, Yanfeng Wang†, Xi Zhou‡†

†Shanghai Jiao Tong University, ‡CloudWalk Technology
§Research Center for Intelligent Security Technology, CIGIT
fengyao@sjtu.edu.cn, wufan@cloudwalk.cn, shaoxiaohu@cigit.ac.cn
wangyanfeng@sjtu.edu.cn, zhouxi@cloudwalk.cn

Abstract. We propose a straightforward method that simultaneously
reconstructs the 3D facial structure and provides dense alignment. To
achieve this, we design a 2D representation called UV position map which
records the 3D shape of a complete face in UV space, then train a sim-
ple Convolutional Neural Network to regress it from a single 2D image.
We also integrate a weight mask into the loss function during training
to improve the performance of the network. Our method does not rely
on any prior face model, and can reconstruct full facial geometry along
with semantic meaning. Meanwhile, our network is very light-weighted
and spends only 9.8ms to process an image, which is extremely faster
than previous works. Experiments on multiple challenging datasets show
that our method surpasses other state-of-the-art methods on both re-
construction and alignment tasks by a large margin. Code is available at
https://github.com/YadiraF/PRNet.

Keywords: 3D Face Reconstruction, Face Alignment, Dense Correspon-
dence

8
1
0
2
 
r
a

M
 
1
2
 
 
]

V
C
.
s
c
[
 
 
1
v
5
3
8
7
0
.
3
0
8
1
:
v
i
X
r
a

1 Introduction

3D face reconstruction and face alignment are two fundamental and highly re-
lated topics in computer vision. In the last decades, researches in these two ﬁelds
beneﬁt each other. In the beginning, face alignment that aims at detecting a spe-
cial 2D ﬁducial points [1,2,3,4] is commonly used as a prerequisite for other facial
tasks such as face recognition [5] and assists 3D face reconstruction [6,7] to a
great extent. However, researchers ﬁnd that 2D alignment has diﬃculties [8,9]
in dealing with problems of large poses or occlusions. With the development of
deep learning, many computer vision problems have been well solved by utilizing
Convolution Neural Networks (CNNs). Thus, some works start to use CNNs to
estimate the 3D Morphable Model (3DMM) coeﬃcients [10,11,12,13,14,15] or
3D model warping functions [16,17] to restore the corresponding 3D information
from a single 2D facial image, which provides both dense face alignment and
3D face reconstruction results. However, the performance of these methods is
restricted due to the limitation of the 3D space deﬁned by face model basis or

2

Y. Feng et al.

Fig. 1: The qualitative results of our method. Odd row: alignment results (only
68 key points are plotted for display). Even row: 3D reconstruction results (re-
constructed shapes are rendered with head light for better view).

templates. The required operations including perspective projection or 3D Thin
Plate Spline (TPS) transformation also add complexity to the overall process.

Recently, two end-to-end works [18] [19], which bypass the limitation of model
space, achieve the state-of-the-art performances on their respective tasks. [19]
trains a complex network to regress 68 facial landmarks with 2D coordinates
from a single image, but needs an extra network to estimate the depth value.
Besides, dense alignment is not provided by this method. [18] develops a vol-
umetric representation of 3D face and uses a network to regress it from a 2D
image. However, this representation discards the semantic meaning of points,
thus the network needs to regress the whole volume in order to restore the fa-
cial shape, which is only part of the volume. So this representation limits the
resolution of the recovered shape, and need a complex network to regress it.
We ﬁnd that these limitations do not exist in previous model-based methods,
it motivates us to ﬁnd a new approach to obtaining the 3D reconstruction and
dense alignment simultaneously in a model-free manner.

In this paper, we propose an end-to-end method called Position map Regres-
sion Network (PRN) to jointly predict dense alignment and reconstruct 3D face
shape. Our method surpasses all other previous works on both 3D face alignment
and reconstruction on multiple datasets. Meanwhile, our method is straightfor-
ward with a very light-weighted model which provides the result in one pass with
9.8ms. All of these are achieved by the elaborate design of the 2D representation
of 3D facial structure and the corresponding loss function. Speciﬁcally, we design
a UV position map, which is a 2D image recording the 3D coordinates of a com-
plete facial point cloud, and at the same time keeping the semantic meaning at
each UV place. We then train a simple encoder-decoder network with a weighted
loss that focuses more on discriminative region to regress the UV position map

Joint 3D Face Reconstruction and Dense Alignment

3

from a single 2D facial image. Figure1 shows our method is robust to poses,
illuminations and occlusions.

In summary, our main contributions are:

– For the ﬁrst time, we solve the problems of face alignment and 3D face
reconstruction together in an end-to-end fashion without the restriction of
low-dimensional solution space.

– To directly regress the 3D facial structure and dense alignment, we develop
a novel representation called UV position map, which records the position
information of 3D face and provides dense correspondence to the semantic
meaning of each point on UV space.

– For training, we proposed a weight mask which assigns diﬀerent weight to
each point on position map and compute a weighted loss. We show that this
design helps improving the performance of our network.

– We ﬁnally provide a light-weighted framework that runs at over 100FPS to
directly obtain 3D face reconstruction and alignment result from a single 2D
facial image.

– Comparison on the AFLW2000-3D and Florence datasets shows that our
method achieves more than 25% relative improvements over other state-
of-the-art methods on both tasks of 3D face reconstruction and dense face
alignment.

2 Related Works

As described above, the main problems our method can solve are 3D face recon-
struction and face alignment. We will talk about closely related works on these
tasks in the following subsections.

2.1

3D Face Reconstruction

This part we only talk about 3D face reconstruction from a single image un-
der unconstrained situations. Since Blanz and Vetter proposed 3D Morphable
Model(3DMM) in 1999[20], methods based on 3DMM are the most popular in
completing the task of monocular 3D facial shape reconstruction. Most of earlier
methods are to establish the correspondences of the special points between input
images and the 3D mean geometry including landmarks[21,6,22,7,23,24,25] and
local features[26,27,25], then solve the non-linear optimization function to regress
the 3DMM coeﬃcients. However, these methods heavily rely on the high accu-
racy of landmarks or other feature points detector. Thus, some methods[28,29]
ﬁrstly use CNNs to learn the dense correspondence between input image and
3D template, then calculate the 3DMM parameters with predicted dense con-
strains. Recent works also explore the usage of CNN to predict 3DMM param-
eters directly. [10,11,12,13,14] use cascaded CNN structure to regress the accu-
rate 3DMM coeﬃcients, which take a lot of time due to iterations. [30,31,32,33]
propose end-to-end CNN architectures to directly estimate the 3DMM shape pa-
rameters. Unsupervised methods have been also researched recently, [34,35] can

4

Y. Feng et al.

regress the 3DMM coeﬃcients without the help of training data by using facial
texture information, which performs badly in faces with large-poses and unbal-
anced illuminations. However, the main defect of those methods are model-based,
resulting in a limited geometry which is constrained in model shape space and
post-processing to generate 3D mesh from estimated parameters. Some other
methods can reconstruct 3D faces without 3D shape basis, while still rely on
a 3D facial template. [36,37,38,17,39] can produce a 3D structure by warping
the shape of a reference 3D model. [16] also reconstruct the 3D shape of faces
by learning a 3D Thin Plate Spline(TPS) warping function via a deep network
which warps a generic 3D model to a subject speciﬁc 3D shape. Obviously, the
reconstructed face geometry from these methods are also restricted by the ref-
erence model, which means the structure diﬀers when the template changes.
Recently, [18] propose to straightforwardly map the image pixels to full 3D fa-
cial structure via volumetric CNN regression. This method is not restricted in
the model space any more, While needs a complex network structure and a lot
of time to predict the voxel data. Diﬀerent from above methods, Our framework
is model-free and light-weighted, can run at real time and directly obtain the
full 3D facial geometry along with its correspondence information.

2.2 Face Alignment

In the ﬁeld of computer vision, face alignment is a long-standing problem which
attracts a lot of attention. In the beginning, there are a number of 2D fa-
cial alignment approaches which aim at locating a set of ﬁducial 2D facial
landmarks, such as classic Active Appearance Model(AMM)[40,41,42] and Con-
strained Local Models(CLM)[43,44]. Then cascaded regression[45,46] and CNN-
based methods[3,4,19] are largely used to achieve state-of-the-art performance
in 2D landmarks location. However, 2D landmarks location only regresses vis-
ible points on faces, which leads to diﬃculties and is limited to describe face
shape when the pose of faces is large. Recent works then research the 3D fa-
cial alignment, which begins with ﬁtting a 3DMM[47,11,48] or registering a
3D facial template[39,49] with a 2D facial image. Obviously, 3D reconstruc-
tion methods based on model can easily complete the task of 3D face alignment
by selecting x,y coordinates of landmarks vertices in reconstructed geometry.
Actually, [11,29,32] are specially designated methods to achieve 3D face align-
ment by means of 3DMM ﬁtting. Recently [50,19] use a deep network to di-
rectly predict the heat map to obtain the 3D facial landmarks and achieves
state-of-the-art performance. Thus, as sparse face alignment tasks are highly
completed by aforementioned methods, the task of dense face alignment begins
to develop. Notice that, the dense face alignment means the methods should
oﬀer the correspondence between two face images as well as between a 2D facial
image and a 3D facial reference geometry. [15] use multi-constraints to train a
CNN which estimates the 3DMM parameters and then provides a very dense 3D
alignment. [28,29] directly learn the correspondence between a 2D input image
and a 3D template via a deep network, while those predicted correspondence is
not complete, only visible face-region is considered. Compared to prior works,

Joint 3D Face Reconstruction and Dense Alignment

5

our method can directly establish the dense correspondence between all region
in faces and 3D template once the position map is regressed. No intermediate
parameters such as 3DMM coeﬃcients and TPS warping parameters are needed
in our method, which means our network can run very fast bypassing complex
operations including perspective projection and TPS transformation.

3 Proposed Method

This section describes the framework and the details of our proposed method.
Firstly, we introduce the characteristics of the position map for our 3D face
representation. Then we elaborate the CNN architecture and the loss function
designed specially for learning the mapping from unconstrained RGB image to
its 3D structure. The implementation details of our method are shown in the
last subsection.

3.1

3D Face Representation

Our goal is to regress the 3D facial geometry and its dense correspondence in-
formation from a single 2D image. Thus we need a proper representation which
can be directly predicted via a deep network. One simple and commonly used
idea is to concatenate the coordinates of all points in 3D face as a vector and use
a network to predict it. However, this transformation increases the diﬃculties in
training since projection from 3D space into 1D vector discards the spatial adja-
cency information among points. While it’s natural to think that spatially adja-
cent points could share weights in predicting their positions, which can be easily
achieved by using convolutional layers. The coordinates as a 1D vector needs a
fully connected layer to predict each point with much more parameters, which
increases the network size and is hard to train. [51] proposed a point set genera-
tion network to directly predict the point cloud of 3D object as a vector from a
single image. However, the max number of points is only 1024, far from enough
to represent an accurate 3D face. So model-based methods[11,30,15] regress a
few model parameters rather than the coordinates of points, which usually needs
special care in training such as using Mahalanobis distance and inevitably limits
the estimated face geometry to the their model space. [18] proposed 3D binary
volume as the representation of 3D structure and uses Volumetric Regression
Network(VRN) to output a 192 × 192 × 200 volume as the discretized version
of point cloud. By using this representation, VRN can be built with full convo-
lutional layers. However, discretization limits the resolution of point cloud, and
most part of the network output correspond to non-surface points which are of
less usage.

To address the problems in previous works, we propose UV position map as
the presentation of full 3D facial structure. UV position map or position map
for short, is a 2D image recording 3D positions of all points in UV space. In
the past years, UV space or UV coordinates, which is a 2D image plane param-
eterized from the 3D space, has been utilized as a way to express information

6

Y. Feng et al.

including the texture of faces(texture map) [35,52,53,54], 2.5D geometry(height
map)[55,56] and the correspondences between 3D facial meshes[57]. Diﬀerent
from previous works, we use UV space to store the 3D coordinates of points
from 3D face model. As shown in Figure 2, we deﬁne the 3D face point cloud in
Left-handed Cartesian Coordinate system. The origin of the 3D space overlaps
with the upper-left of the input image, with the positive x-axis pointing to the
right of the image. The ground truth 3D face point cloud exactly matches the
face in the 2D image when projected to the x-y plane. Thus our position map
can be easily comprehended as replacing the r, g, b value in texture map by x,
y, z coordinates.

Fig. 2: The illustration of UV position map. Left: 3D plot of input image and
its ground truth 3D point cloud. Right: The ﬁrst row is the input 2D image,
extracted UV texture map and corresponding UV position map. The second
row is the x, y, z channel of the UV position map.

In order to keep the semantic meaning of points within position map, we cre-
ate our UV coordinates based on 3DMM. Since we want to regress the 3D full
structure directly, the unconstrained 2D facial images and their corresponding
3D shapes are needed for end-to-end training. 300W-LP[11] is a large dataset
that contains more than 60K unconstrained images with ﬁtted 3DMM parame-
ters, which is suitable to form our training pairs. Besides, the 3DMM parameters
of this dataset are based on the Basel Face Model(BFM)[20]. Thus, in order to
make full use of this dataset, we conduct the UV coordinates corresponding
to BFM. To be speciﬁc, we use the parameterized UV coordinates from [35]
which computes a Tutte embedding[58] with conformal Laplacian weight and
then maps the mesh boundary to a square. Since the number of vertices in BFM
is more than 50K, we choose 256 as the position map size, which get a high
precision point cloud with negligible re-sample error.

Thus our position map records a dense set of points from 3D face with its
semantic meaning, we are able to simultaneously obtain the 3D facial structure
and dense alignment result by using a CNN to regress the position map directly
from unconstrained 2D images. The network architecture in our method could
be greatly simpliﬁed due to this convenience. Notice that the position map con-
tains the information of the whole face, which makes it diﬀerent from other 2D

Joint 3D Face Reconstruction and Dense Alignment

7

representations such as Projected Normalized Coordinate Code (PNCC)[11,14],
an ordinary depth image[17] or quantized UV coordinates[28], which only re-
serve the information of visible face region in the input image. Our proposed
position map also infers the invisible parts of face, thus our method can predict
a complete 3D face.

3.2 Network Architecture and Loss Function

Fig. 3: The architecture of PRN. The Green rectangles represent the residual
blocks, and the blue ones represent the transposed convolutional layers.

Since our network transfers the input RGB image into position map image, we
employ an encoder-decoder structure to learn the transfer function. The encoder
part of our network begins with one convolution layer followed by 10 residual
blocks[59] which reduce the 256 × 256 × 3 input image into 8 × 8 × 512 feature
maps, the decoder part contains 17 transposed convolution layers to generate the
predicted 256 × 256 × 3 position map. We use kernel size of 4 for all convolution
or transposed convolution layers, and use ReLU layer for activation. Given that
the position map contains both the full 3D information and dense alignment
result, we don’t need extra network module for multi-task during training or
inferring. The architecture of our network is shown in Figure 3.

In order to learn the parameters of the network, we build a novel loss function
to measure the diﬀerence between ground truth position map and the network
output. Mean square error (MSE) is a commonly used loss for such learning task,
such as in [29,60]. However, MSE treats all points equally, so it is not entirely
appropriate for learning the position map. Since central region of face has more
discriminative features than other regions, we employ a weight mask to form our
loss function.

As shown in Figure 4, the weight mask is a gray image recording the weight
of each point on position map. It has the same size and pixel-to-pixel correspon-
dence to position map. According to our objective, we separate points into four
categories, each has its own weights in the loss function. The position of 68 facial
keypoints has the highest weight, so that to ensure the network to learn accurate
locations of these points. The neck region usually attracts less attention, and is
often occluded by hairs or clothes in unconstrained images. Since learning the
3D shape of neck or clothes is beyond our interests, we assign 0 weight to points
in neck region to reduce disturbance to the training process.

Thus, we denote the predicted position map as P (x, y) for x, y representing
each pixel coordinate. Given the ground truth position map ˜P (x, y) and weight

8

Y. Feng et al.

Fig. 4: The illustration of weight mask. From left to right: UV texture map, UV
position map, colored texture map with segmentation information (blue for eye
region, red for nose region, green for mouth region and purple for neck region),
the ﬁnal weight mask.

mask W (x, y), our loss function is deﬁned as:

Loss =

(cid:88)

(cid:107)P (x, y) − ˜P (x, y)(cid:107) · W (x, y)

(1)

Speciﬁcally, We use following weight ratio in our experiments, subregion1 (68
facial landmarks): subregion2 (eye, nose, mouth): subregion3 (other face area):
subregion4 (neck) = 16:4:3:0. The ﬁnal weight mask is shown in Figure4

3.3 Training Details

Because our training process needs datasets containing both 2D face images and
its corresponding 3D point clouds with semantic meaning, we choose e.g., 300W-
LP[11] to form our training sets, since it contains face images across diﬀerent
angles with the annotation of estimated 3DMM coeﬃcients, from which the 3D
point cloud could be easily recovered. Speciﬁcally, we crop the images according
the ground truth bounding box and rescale them to size 256 × 256. Then utilize
their annotated 3DMM parameters to generate the corresponding 3D position,
and render them into UV space to obtain the ground truth position map, the
map size in our training is also 256 × 256, which means a precision of more than
45K point cloud to regress. Notice that, although our training data is generated
from 3DMM, our network’s output, the position map is not restricted to any
face template or linear space of 3DMM.

We perturb the training set by randomly rotating and translating the target
face in 2D image plane. To be speciﬁc, the rotation is from -45 to 45 degree angles,
translation changes is random from 10 percent of input size, and scale is from
0.9 to 1.2. Like [18], we also augment our training data by scaling color channels
with scale range from 0.6 to 1.4. In order to handle images with occlusions, we
synthesize occlusions by adding noise texture into raw images, which is similar
to the work of [61,29]. With all above augmentation operations, our training
data covers all the diﬃcult cases.

We use the network described 3 to train our transfer model. For optimization,
we use Adam optimizer with a learning rate begins at 0.0001 and decays half
after each 5 epochs. The batch size is set as 16. All of our training codes are
implemented with TensorFlow[62].

Joint 3D Face Reconstruction and Dense Alignment

9

4 Experimental Results

In this part, we evaluate the performance of our proposed method on the tasks
of 3D face alignment and 3D face reconstruction. We ﬁrst introduce the test
datasets used in our experiments in section 4.1. Then in section 4.2 and 4.3 we
compare our results with other methods in both quantitative and qualitative
way. We then compare our method’s runtime with other methods in section 4.4.
In the end, the ablation study is conducted in section 4.5 to evaluate the eﬀect
of weight mask in our method.

4.1 Test Dataset

To evaluate our performance on the task of dense alignment and 3D face recon-
struction, multiple test datasets listed below are used in our experiments:

AFLW2000-3D is constructed by [11] to evaluate 3D face alignment on
challenging unconstrained images. This database contains the ﬁrst 2000 images
from AFLW[63] and expands its annotations with ﬁtted 3DMM parameters and
68 3D landmarks. We use this database to evaluate the performance of our
method on both face reconstruction and face alignment tasks.

AFLW-LFPA is another extension of AFLW dataset constructed by [10].
By picking images from AFLW according to the poses, the authors construct
this dataset which contains 1299 test images with a balanced distribution of
yaw angle. Besides, each image is annotated with 13 additional landmarks as a
expansion to only 21 visible landmarks in AFLW. This database is evaluated on
the task of 3D face alignment. We use 34 visible landmarks as the ground truth
to measure the accuracy of our results.

Florence is a 3D face dataset that contains 53 subjects with its ground truth
3D mesh acquired from a structured-light scanning system[64]. On experiments,
each subject generates renderings with diﬀerent poses as the same with [18]: a
pitch of -15,20 and 25 degrees and spaced rotations between -80 and 80. We
compare the performance of our method on face reconstruction against other
very recent state-of-the-art methods VRN-Guided[18] and 3DDFA[11] on this
dataset.

4.2

3D Face Alignment

To evaluate the face alignment performance. We employ the Normalized Mean
Error(NME) to be the evaluation metric, bounding box size is used as the nor-
malization factor. Firstly, we evaluate our method on a sparse set of 68 facial
landmarks, and compare our result with 3DDFA[11], DeFA[15] and 3D-FAN[19]
on dataset AFLW2000-3D. As shown in ﬁgure 5, our result slightly outper-
forms the state-of-the-art method 3D-FAN when calculating per distance with
2D coordinates. When considering the depth value, the performance discrepancy
between our method and 3D-FAN increases. Notice that, the 3D-FAN needs an-
other network to predict the z coordinate of landmarks, while the depth value
can be obtained directly in our method.

10

Y. Feng et al.

Fig. 5: Cumulative Errors Distribution (CED) curves on AFLW2000-3D. Eval-
uation is performed on 68 landmarks with both the 2D(left) and 3D(right) co-
ordinates. Overall 2000 images from AFLW2000-3D dataset are used here. The
mean NME% of each method is also showed in the legend.

To further investigate the performance of our method across poses and datasets,

we also report the NME of faces with small, medium and large yaw angles on
AFLW2000-3D dataset and the mean NME on both AFLW2000-3D and AFLW-
LPFA datasets. Table 1 shows the comparison with other methods, note that the
numerical values are recorded from their published papers except the ones of 3D-
FAN. Follow the work [11], we also randomly select 696 faces from AFLW2000
to balance the distribution. The result shows that our method is robust to the
change of pose and datasets.

Although all the state-of-the-art methods of face alignment conduct evalua-

tion on AFLW2000-3D dataset, the ground truth of this dataset is still controversial[29,19]
due to its annotation pipeline which is based on Landmarks Marching method
in [6]. Thus, we visualize some results in Figure 6 that have NME larger than
6.5% and we ﬁnd our results are more accurate than the ground truth in some
cases.

Table 1: Performance comparison on two large-pose face alignment datasets
AFLW2000-3D(68 landmarks) and AFLW-LFPA(34 visible landmarks). The
NME (%) for faces with diﬀerent yaw angles are reported. The ﬁrst best re-
sult in each category is highlighted in bold, the lower is the better.

Method
SDM[46]
3DDFA [11]

3.67
3.78
3DDFA + SDM [11] 3.43

PAWF[10]
Yu et al. [29]
3DSTN[16]
DeFA[15]
PRN (ours)

AFLW2000-3D
0 to 30 30 to 60 60 to 90 Mean
6.12
5.42
4.94
-
-
4.49
4.50
3.62

9.67
7.93
7.17
-
9.56
5.98
-
4.61

4.94
4.54
4.24
-
6.06
4.33
-
3.51

-
3.62
3.15
-
2.75

AFLW-LFPA
Mean
-
-
-
4.72
-
-
3.86
2.93

Joint 3D Face Reconstruction and Dense Alignment

11

Fig. 6: Examples from AFLW2000-3D dataset show that our predictions are more
accurate than ground truth in some cases. Green: predicted landmarks by our
method. Red: ground truth from [11].

We also compare our dense alignment result against other state-of-the-art
methods including 3DDFA[11] and DeFA[15] on the only test dataset AFLW2000-
3D. In order to compare diﬀerent methods with the same set of points, we select
the points from the largest common face region provided by all methods, and
ﬁnally around 45K points were used for the evaluation. As shown in ﬁgure 7, our
method outperforms the best methods with a large margin of more than 27%
on both 2D and 3D coordinates.

Fig. 7: CED curves on AFLW2000-3D. Evaluation is performed on all points
with both the 2D (left) and 3D (right) coordinates. Overall 2000 images from
AFLW2000-3D dataset are used here. The mean NME% of each method is also
showed in the legend.

4.3 3D Face Reconstruction

In this part, we evaluate our method on 3D face reconstruction task and com-
pare with 3DDFA[11], DeFA[15] and VRN-Guided[18] on AFLW2000-3D and
Florence datasets. We use the same set of points as in evaluating dense alignment
and changes the metric so as to keep consistency with other 3D face reconstruc-
tion evaluation methods. We ﬁrst use Iterative Closest Points(ICP) algorithm to

12

Y. Feng et al.

ﬁnd the corresponding nearest points between the network output and ground
truth point cloud, then calculate Mean Squared Error(MSE) normalized by outer
interocular distance of 3D coordinates.

The result is shown in ﬁgure 8. our method greatly exceeds the performance
of other two state-of-the-art methods. Since AFLW2000-3D dataset is labeled

Fig. 8: 3D reconstruction performance(CED curves) on in-the-wild AFLW2000-
3D dataset and Florence dataset. The mean NME% of each method is showed
in the legend. On AFLW2000-3D, more than 45K points are used for evaluation.
On Florence, about 19K points are used.

with results from 3DMM ﬁtting, we further evaluate the performance of our
method on Florence dataset, where ground truth 3D point cloud is obtained
from structured-light 3D scanning system. Here we compare our method with
3DDFA and VRN-Guided[18], using experimental settings in [18]. The evalua-
tion images are the renderings with diﬀerent poses from Florence database, we
calculate the bounding box from the ground truth point cloud and using the
cropped image as network input. Although our method output more complete
face point clouds than VRN, we only choose the common face region to compare
the performance, 19K points are used for the evaluation. Figure 8 shows that our
method achieves 28.7% relative higher performance compared to VRN-Guided
on Florence dataset, which is a signiﬁcant improvement.

To better evaluate the reconstruction performance of our method across dif-
ferent poses, we calculated the NME for diﬀerent yaw angle range. As shown
in ﬁgure 9, all the methods perform well in near frontal view, however, 3DDFA
and VRN-Guided fail to keep low error as pose becomes large, while our method
keeps relatively stable performance in all pose ranges. We also illustrate the
qualitative comparison in ﬁgure 9, our restored point cloud covers a larger re-
gion than in VRN-Guided, which ignores the lateral facial parts. Besides, due to
the limitation on resolution of VRN, our method provides ﬁner details of face,
especially on the nose and mouth region.

We also provide additional qualitative results on 300VW[65] and Multi-

PIE[66] datasets, please refer to supplementary material for full details.

Joint 3D Face Reconstruction and Dense Alignment

13

Fig. 9: Left: CED curves on Florence dataset with diﬀerent yaw angles. Right: the
qualitative comparison with VRN-Guided. The ﬁrst column is the input images
from Florence dataset and the Internet, the second column is the reconstructed
face from our method, the third column is the results from VRN-Guided.

4.4 Runtime

Surpassing the performance of all other state-of-the-art methods on 3D face
alignment and reconstruction, our method is surprisingly more light-weighted
and faster. Since our network uses basic encoder-decoder structure, our model
size is only 160MB compared to 1.5GB in VRN[18]. We also compare the run-
time between our method and other state-of-the-art methods. Table 2 shows the
result. The results of 3DDFA and 3DSTN are directly recorded from their pub-
lished papers and others are recorded by running their publicly available source
codes. Notice that, We measure the run time of the process which is deﬁned from
inputing the cropped face image until recovering the 3D geometry(point cloud,
mesh or voxel data) for 3D reconstruction methods or obtaining the 3D land-
marks for alignment methods. The harware used for evaluation is an NVIDIA
GeForce GTX 1080 GPU and an Intel(R) Xeon(R) CPU E5-2640 v4 @ 2.40GHz.

Table 2: Run time in Milliseconds per Image
3DDFA[11] DeFA[15] 3D-FAN[19] 3DSTN[16] VRN-Guided[18] PRN (ours)

75.7

35.4

54.7

19.0

69.0

9.8

Speciﬁcally, DeFA needs 11.8ms(GPU) to predict 3DMM parameters and an-
other 23.6ms(CPU) to generate mesh data from predicted parameters, 3DFAN
needs 29.1ms(GPU) to estimate 2D coordinates ﬁrst and 25.6ms(GPU) to ob-
tain depth value, VRN-Guided detects 68 2D landmarks with 28.4ms(GPU),
then regress the voxel data with 40.6ms(GPU), our method provides both 3D
reconstruction and dense alignment result from cropped image in one pass in
9.8ms(GPU).

14

Y. Feng et al.

4.5 Ablation Study

In this section, we conduct several experiments to evaluate the inﬂuence of our
weight mask on training and provide both sparse and dense alignment CED on
AFLW2000 to evaluate diﬀerent settings. Table 3 shows three options for our
weight mask, we could see that weight ratio 1 corresponds to the situation when
no weight mask is used, weight ratio 2 and 3 are slightly diﬀerent on the emphasis
in loss function. The results are shown in Figure 10. Network trained without

Table 3: The weight ratio of diﬀerent settings

sub1:sub2:sub3:sub4

weight ratio 1 weight ratio 2 weight ratio 3
1:1:1:0

16:4:3:0

1:1:1:1

using weight mask has worst performance compared with other two settings. By
adding weights to speciﬁc regions such as 68 facial landmarks or central face
region, weight ratio 3 shows considerable improvement on 68 points datasets
over weight ratio 2.

Fig. 10: The eﬀect of weight mask evaluated on AFLW2000-3D dataset with 68
landmarks(left) and all points(right).

5 Conclusion

In this paper, we propose an end-to-end method, which well solves the problems
of 3D face alignment and 3D face reconstruction simultaneously. By learning the
position map, we directly regress the complete 3D structure along with semantic
meaning from a single image. Quantitative and qualitative results demonstrate
our method is robust to poses, illuminations and occlusions. Experiments on
three test datasets show that our method achieves signiﬁcant improvements over
others. We further show that our method runs faster than other methods and is
suitable for real time usage.

Joint 3D Face Reconstruction and Dense Alignment

15

6 Acknowledgements

We would like to thank Aaron Jackson for kindly providing the Florence test
data. We also thank Iacopo Masi for his patience in helping me acquire Florence
3D Face dataset. This work was supported by CloudWalk Technology.

References

1. Zhou, E., Fan, H., Cao, Z., Jiang, Y., Yin, Q.: Extensive facial landmark local-
In: Computer Vision
ization with coarse-to-ﬁne convolutional network cascade.
Workshops (ICCVW), 2013 IEEE International Conference on, IEEE (2013) 386–
391

2. Zhang, Z., Luo, P., Loy, C.C., Tang, X.: Facial landmark detection by deep multi-
task learning. In: European Conference on Computer Vision, Springer (2014) 94–
108

3. Liang, Z., Ding, S., Lin, L.: Unconstrained facial landmark localization with
backbone-branches fully-convolutional networks. arXiv preprint arXiv:1507.03409
(2015)

4. Peng, X., Feris, R.S., Wang, X., Metaxas, D.N.: A recurrent encoder-decoder
In: European Conference on Computer

network for sequential face alignment.
Vision, Springer (2016) 38–56

5. Wagner, A., Wright, J., Ganesh, A., Zhou, Z., Mobahi, H., Ma, Y.: Toward a
practical face recognition system: Robust alignment and illumination by sparse
representation. IEEE Transactions on Pattern Analysis and Machine Intelligence
34(2) (2012) 372–386

6. Zhu, X., Lei, Z., Yan, J., Yi, D., Li, S.Z.: High-ﬁdelity pose and expression nor-

malization for face recognition in the wild. (2015) 787–796

7. Huber, P., Hu, G., Tena, R., Mortazavian, P., Koppen, W.P., Christmas, W.J.,
Ratsch, M., Kittler, J.: A multiresolution 3d morphable face model and ﬁtting
framework. (2016) 79–86

8. Zhao, R., Wang, Y., Benitez-Quiroz, C.F., Liu, Y., Martinez, A.M.: Fast and
precise face alignment and 3d shape reconstruction from a single 2d image. In:
European Conference on Computer Vision, Springer (2016) 590–603

9. Jeni, L.A., Tulyakov, S., Yin, L., Sebe, N., Cohn, J.F.: The ﬁrst 3d face alignment
In: European Conference on Computer Vision,

in the wild (3dfaw) challenge.
Springer (2016) 511–520

10. Jourabloo, A., Liu, X.: Large-pose face alignment via cnn-based dense 3d model

ﬁtting. In: Computer Vision and Pattern Recognition. (2016)

11. Zhu, X., Lei, Z., Liu, X., Shi, H., Li, S.Z.: Face alignment across large poses: A 3d

solution. computer vision and pattern recognition (2016) 146–155

12. Richardson, E., Sela, M., Kimmel, R.: 3d face reconstruction by learning from
synthetic data. In: Fourth International Conference on 3d Vision. (2016) 460–469
13. Liu, F., Zeng, D., Zhao, Q., Liu, X.: Joint face alignment and 3d face reconstruction.

In: European Conference on Computer Vision, Springer (2016) 545–560

14. Richardson, E., Sela, M., Or-El, R., Kimmel, R.: Learning detailed face recon-

15. Liu, Y., Jourabloo, A., Ren, W., Liu, X.: Dense face alignment. arXiv preprint

struction from a single image. (2016)

arXiv:1709.01442 (2017)

16

Y. Feng et al.

16. Bhagavatula, C., Zhu, C., Luu, K., Savvides, M.: Faster than real-time facial
alignment: A 3d spatial transformer network approach in unconstrained poses. In:
The IEEE International Conference on Computer Vision (ICCV). Volume 2. (2017)
7

17. Sela, M., Richardson, E., Kimmel, R.: Unrestricted facial geometry reconstruction

using image-to-image translation. (2017)

18. Jackson, A.S., Bulat, A., Argyriou, V., Tzimiropoulos, G., Jackson, A.S., Bulat,
A., Argyriou, V., Tzimiropoulos, G.: Large pose 3d face reconstruction from a
single image via direct volumetric cnn regression. In: International Conference on
Computer Vision. (2017)

19. Bulat, A., Tzimiropoulos, G.: How far are we from solving the 2d and 3d face

alignment problem? (and a dataset of 230,000 3d facial landmarks). (2017)

20. Blanz, V., Vetter, T.: A morphable model for the synthesis of 3d faces. international
conference on computer graphics and interactive techniques (1999) 187–194
21. Lee, Y.J., Lee, S.J., Kang, R.P., Jo, J., Kim, J.: Single view-based 3d face recon-
struction robust to self-occlusion. Eurasip Journal on Advances in Signal Process-
ing 2012(1) (2012) 1–20

22. Thies, J., Zollhfer, M., Stamminger, M., Theobalt, C., Niener, M.: Face2face: Real-
time face capture and reenactment of rgb videos. In: Computer Vision and Pattern
Recognition. (2016) 5

23. Cao, C., Hou, Q., Zhou, K.: Displaced dynamic expression regression for real-time

facial tracking and animation. ACM (2014)

24. Jeni, L.A., Cohn, J.F., Kanade, T.: Dense 3d face alignment from 2d videos in
In: Automatic Face and Gesture Recognition (FG), 2015 11th IEEE

real-time.
International Conference and Workshops on. Volume 1., IEEE (2015) 1–8

25. Grewe, C.M., Zachow, S.: Fully automated and highly accurate dense correspon-
dence for facial surfaces. In: European Conference on Computer Vision, Springer
(2016) 552–568

26. Huber, P., Feng, Z.H., Christmas, W., Kittler, J., Ratsch, M.: Fitting 3d morphable
In: IEEE International Conference on Image

face models using local features.
Processing. (2015) 1195–1199

27. Romdhani, S., Vetter, T.: Estimating 3d shape and texture using pixel intensity,
edges, specular highlights, texture constraints and a prior.
In: IEEE Computer
Society Conference on Computer Vision and Pattern Recognition. (2005) 986–993
28. G¨uler, R.A., Trigeorgis, G., Antonakos, E., Snape, P., Zafeiriou, S., Kokkinos, I.:
Densereg: Fully convolutional dense shape regression in-the-wild. In: Proc. CVPR.
Volume 2. (2017)

29. Yu, R., Saito, S., Li, H., Ceylan, D., Li, H.: Learning dense facial correspondences

30. Dou, P., Shah, S.K., Kakadiaris, I.A.: End-to-end 3d face reconstruction with deep

in unconstrained images. (2017)

neural networks. (2017)

31. Tran, A.T., Hassner, T., Masi, I., Medioni, G.: Regressing robust and discrimina-

tive 3d morphable models with a very deep neural network. (2016)

32. Jourabloo, A., Liu, X.: Pose-invariant 3d face alignment. In: Proceedings of the

IEEE International Conference on Computer Vision. (2015) 3694–3702

33. Laine, S., Karras, T., Aila, T., Herva, A., Lehtinen, J.: Facial performance capture

with deep neural networks. arXiv preprint arXiv:1609.06536 (2016)

34. Tewari, A., Zollhfer, M., Kim, H., Garrido, P., Bernard, F., Prez, P., Theobalt, C.:
Mofa: Model-based deep convolutional face autoencoder for unsupervised monoc-
ular reconstruction. (2017)

Joint 3D Face Reconstruction and Dense Alignment

17

35. Bas, A., Huber, P., Smith, W.A.P., Awais, M., Kittler, J.: 3d morphable models as
spatial transformer networks. In: ICCV 2017 Workshop on Geometry Meets Deep
Learning. (2017)

36. Hassner, T.: Viewing real-world faces in 3d. In: IEEE International Conference on

Computer Vision. (2013) 3607–3614

37. Kemelmacher-Shlizerman, I., Basri, R.: 3d face reconstruction from a single image
using a single reference face shape. IEEE Transactions on Pattern Analysis and
Machine Intelligence 33(2) (2011) 394

38. Gu, L., Kanade, T.: 3d alignment of face in a single image. In: Computer Vision
and Pattern Recognition, 2006 IEEE Computer Society Conference on. Volume 1.,
IEEE (2006) 1305–1312

39. S´anta, Z., Kato, Z.: 3d face alignment without correspondences.

In: European

Conference on Computer Vision, Springer (2016) 521–535

40. Matthews, I., Baker, S.: Active appearance models revisited. International journal

of computer vision 60(2) (2004) 135–164

41. Saragih, J., Goecke, R.: A nonlinear discriminative approach to aam ﬁtting. In:
Computer Vision, 2007. ICCV 2007. IEEE 11th International Conference on, IEEE
(2007) 1–8

42. Tzimiropoulos, G., Pantic, M.: Optimization problems for fast aam ﬁtting in-the-
wild. In: Computer Vision (ICCV), 2013 IEEE International Conference on, IEEE
(2013) 593–600

43. Kim, J., Liu, C., Sha, F., Grauman, K.: Deformable spatial pyramid matching for
fast dense correspondences. In: Computer Vision and Pattern Recognition. (2013)
2307–2314

44. Asthana, A., Zafeiriou, S., Cheng, S., Pantic, M.: Robust discriminative response
map ﬁtting with constrained local models. In: Computer Vision and Pattern Recog-
nition (CVPR), 2013 IEEE Conference on, IEEE (2013) 3444–3451

45. Doll´ar, P., Welinder, P., Perona, P.: Cascaded pose regression.

In: Computer
Vision and Pattern Recognition (CVPR), 2010 IEEE Conference on, IEEE (2010)
1078–1085

46. Xiong, X., Torre, F.D.L.: Global supervised descent method. In: IEEE Conference

on Computer Vision and Pattern Recognition. (2015) 2664–2673

47. McDonagh, J., Tzimiropoulos, G.: Joint face detection and alignment with a de-
formable hough transform model. In: European Conference on Computer Vision,
Springer (2016) 569–580

48. Gou, C., Wu, Y., Wang, F.Y., Ji, Q.: Shape augmented regression for 3d face
alignment. In: European Conference on Computer Vision, Springer (2016) 604–
615

49. de Bittencourt Zavan, F.H., Nascimento, A.C., e Silva, L.P., Bellon, O.R., Silva, L.:
3d face alignment in the wild: A landmark-free, nose-based approach. In: European
Conference on Computer Vision, Springer (2016) 581–589

50. Bulat, A., Tzimiropoulos, G.: Two-stage convolutional part heatmap regression for
the 1st 3d face alignment in the wild (3dfaw) challenge. In: European Conference
on Computer Vision, Springer (2016) 616–624

51. Fan, H., Su, H., Guibas, L.: A point set generation network for 3d object recon-

struction from a single image. (2016) 2463–2471

52. Deng, J., Cheng, S., Xue, N., Zhou, Y., Zafeiriou, S.: Uv-gan: Adversarial
arXiv preprint

facial uv map completion for pose-invariant face recognition.
arXiv:1712.04695 (2017)

18

Y. Feng et al.

53. Moschoglou, S., Ververas, E., Panagakis, Y., Nicolaou, M., Zafeiriou, S.: Multi-
arXiv preprint

attribute robust component analysis for facial uv maps.
arXiv:1712.05799 (2017)

54. Xue, N., Deng, J., Cheng, S., Panagakis, Y., Zafeiriou, S.: Side information for

face completion: a robust pca approach. arXiv preprint arXiv:1801.07580 (2018)

55. Maninchedda, F., H¨ane, C., Oswald, M.R., Pollefeys, M.: Face reconstruction on
mobile devices using a height map shape model and fast regularization. In: 3D
Vision (3DV), 2016 Fourth International Conference on, IEEE (2016) 489–498
56. Maninchedda, F., Oswald, M.R., Pollefeys, M.: Fast 3d reconstruction of faces with
glasses. In: 2017 IEEE Conference on Computer Vision and Pattern Recognition
(CVPR), IEEE (2017) 4608–4617

57. Booth, J., Zafeiriou, S.: Optimal uv spaces for facial morphable model construction.
In: Image Processing (ICIP), 2014 IEEE International Conference on, IEEE (2014)
4672–4676

58. Floater, M.S.: Parametrization and smooth approximation of surface triangula-

tions. Computer Aided Geometric Design 14(3) (1997) 231–250

59. He, K., Zhang, X., Ren, S., Sun, J.: Deep residual learning for image recognition.

In: Computer Vision and Pattern Recognition. (2016) 770–778

60. Crispell, D., Bazik, M.: Pix2face: Direct 3d face model estimation. (2017)
61. Saito, S., Li, T., Li, H.: Real-time facial segmentation and performance capture
from rgb input. In: European Conference on Computer Vision, Springer (2016)
244–261

62. Abadi, M., Barham, P., Chen, J., Chen, Z., Davis, A., Dean, J., Devin, M., Ghe-
mawat, S., Irving, G., Isard, M., et al.: Tensorﬂow: A system for large-scale machine
learning. In: OSDI. Volume 16. (2016) 265–283

63. Koestinger, M., Wohlhart, P., Roth, P.M., Bischof, H.: Annotated facial landmarks
in the wild: A large-scale, real-world database for facial landmark localization. In:
Computer Vision Workshops (ICCV Workshops), 2011 IEEE International Con-
ference on, IEEE (2011) 2144–2151

64. Bagdanov, A.D., Del Bimbo, A., Masi, I.: The ﬂorence 2d/3d hybrid face dataset.
In: Proceedings of the 2011 joint ACM workshop on Human gesture and behavior
understanding, ACM (2011) 79–80

65. Chrysos, G.G., Antonakos, E., Zafeiriou, S., Snape, P.: Oﬄine deformable face
tracking in arbitrary videos. In: Proceedings of the IEEE International Conference
on Computer Vision Workshops. (2015) 1–9

66. Hartley, R., Zisserman, A.: Multiple view geometry in computer vision. Kybernetes

30(9/10) (2003) 1865 – 1872

