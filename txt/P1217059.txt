Fast Threshold Tests for Detecting Discrimination

8
1
0
2
 
r
a

M
 
0
1
 
 
]
L
M

.
t
a
t
s
[
 
 
3
v
6
3
5
8
0
.
2
0
7
1
:
v
i
X
r
a

Emma Pierson
Stanford University

Sam Corbett-Davies
Stanford University

Sharad Goel
Stanford University

Abstract

Threshold tests have recently been proposed
as a useful method for detecting bias in lend-
ing, hiring, and policing decisions. For ex-
ample, in the case of credit extensions, these
tests aim to estimate the bar for granting
loans to white and minority applicants, with
a higher inferred threshold for minorities in-
dicative of discrimination. This technique,
however, requires ﬁtting a complex Bayesian
latent variable model for which inference is
often computationally challenging. Here we
develop a method for ﬁtting threshold tests
that is two orders of magnitude faster than
the existing approach, reducing computation
from hours to minutes. To achieve these per-
formance gains, we introduce and analyze a
ﬂexible family of probability distributions on
the interval [0, 1]—which we call discriminant
distributions—that is computationally eﬃ-
cient to work with. We demonstrate our tech-
nique by analyzing 2.7 million police stops of
pedestrians in New York City.

1

INTRODUCTION

There is wide interest in detecting and quantifying bias
in human decisions, but well-known problems with tra-
ditional statistical tests of discrimination have ham-
pered rigorous analysis. The primary goal of such
work is to determine whether decision makers apply
diﬀerent standards to groups deﬁned by race, gen-
der, or other protected attributes—what economists
call taste-based discrimination (Becker, 1957). For ex-
ample, in the context of banking, such discrimination
might mean that minorities are granted loans only
when they are exceptionally creditworthy. The key

Proceedings of the 21st International Conference on Artiﬁ-
cial Intelligence and Statistics (AISTATS) 2018, Lanzarote,
Spain. PMLR: Volume 84.

statistical challenge is that an individual’s qualiﬁca-
tions are typically only partially observed (e.g., re-
searchers may not know an applicant’s full credit his-
tory); it is thus unclear whether observed disparities
are attributable to discrimination or omitted variables.

To address this problem, Simoiu et al. (2017) recently
proposed the threshold test, which considers both the
decisions made (e.g., whether a loan was granted) and
the outcomes of those decisions (e.g., whether a loan
was repaid). The test simultaneously estimates deci-
sion thresholds and risk proﬁles via a Bayesian latent
variable model. This approach mitigates some of the
most serious statistical shortcomings of past methods.
Fitting the model, however, is computationally chal-
lenging, often requiring several hours on moderately
sized datasets. As is common in full Bayesian infer-
ence, the threshold model is typically ﬁt with Hamilto-
nian Monte Carlo (HMC) sampling. In this case, HMC
involves repeatedly evaluating gradients of conditional
beta distributions that are expensive to compute.

Here we introduce a family of distributions on the
interval
[0, 1]—which we call discriminant distribu-
tions—that is eﬃcient for performing common sta-
tistical operations. Discriminant distributions com-
prise a natural subset of logit-normal mixture distri-
butions which is suﬃciently expressive to approximate
logit-normal and beta distributions for a wide range
of parameters. By replacing the beta distributions in
the threshold test with discriminant distributions, we
speed up inference by two orders of magnitude.

To demonstrate our method, we analyze 2.7 million
police stops of pedestrians in New York City between
2008 and 2012. We apply the threshold test to as-
sess possible bias in decisions to search individuals for
weapons. We also extend the threshold test to detect
discrimination in the decision to stop an individual.
For both problems (search decisions and stop deci-
sions), our method accelerates inference by more than
75-fold. Such performance gains are consequential in
part because each new application requires running the
threshold test dozens of times to conduct a battery of
standard robustness checks. To carry out the experi-
ments in this paper, we ran the threshold test nearly

Fast Threshold Tests for Detecting Discrimination

100 times. That translates into about two months of
continuous, serial computation under the standard ﬁt-
ting method; our approach required less than one day
of computation. These performance gains also allow
one to run the threshold test on very large datasets.
In a national analysis of traﬃc stops by Pierson et al.
(2017), running the threshold test required splitting
the data into state-level subsets; with our approach,
one can ﬁt a single national model on 22 million stops
in 30 minutes, facilitating eﬃcient pooling of informa-
tion across states. Finally, such acceleration broadens
the accessibility of the threshold test to policy analysts
with limited computing resources. Our fast implemen-
tation of the threshold test is available online.

2 BACKGROUND

Traditional tests of discrimination. To motivate
the threshold test, we review two traditional statistical
tests of discrimination: the benchmark test (or bench-
marking) and the outcome test. The benchmark test
analyzes the rate at which some action is taken (e.g.,
the rate at which stopped pedestrians are searched).
Decision rates might vary across racial groups for a va-
riety of legitimate reasons, such as race-speciﬁc diﬀer-
ences in behavior. One thus attempts to estimate deci-
sion rates after controlling for all legitimate factors. If
decision rates still diﬀer by race after such condition-
ing, the benchmark test would suggest bias. Though
popular, this test suﬀers from the well-known problem
of omitted variable bias, as it is typically impossible
for researchers to observe—and control for—all legiti-
mate factors that might aﬀect decisions. For example,
if evasiveness is a reliable indicator of possessing con-
traband, is not observed by researchers, and is diﬀer-
entially distributed across race groups, the benchmark
test might indicate discrimination where there is none.
This concern is especially problematic for face-to-face
interactions such as police stops that may rely on hard-
to-quantify behavioral observations.

Addressing this shortcoming, Becker (1957, 1993) pro-
posed the outcome test, which is based not on the rate
at which decisions are made but on the hit rate (i.e, the
success rate) of those decisions. Becker reasoned that
even if one cannot observe the rationale for a search,
absent discrimination contraband should be found on
searched minorities at the same rate as on searched
whites. If searches of minorities turn up weapons at
lower rates than searches of whites, it suggests that
oﬃcers are applying a double standard, searching mi-
norities on the basis of less evidence.

Outcome tests, however, are also imperfect measures
of discrimination (Ayres, 2002). Suppose that there
are two, easily distinguishable types of white pedestri-

ans: those who have a 1% chance of carrying weapons,
and those who have a 75% chance. Similarly assume
that black pedestrians have either a 1% or 50% chance
of carrying weapons. If oﬃcers, in a race-neutral man-
ner, search individuals who are at least 10% likely to
be carrying a weapon, then searches of whites will be
successful 75% of the time whereas searches of blacks
will be successful only 50% of the time. With such
a race-neutral threshold, no individual is treated dif-
ferently because of their race. Thus, contrary to the
ﬁndings of the outcome test (which suggests discrim-
ination against blacks due to their lower hit rate),
no discrimination is present. This illustrates a fail-
ure of outcome tests known as the problem of infra-
marginality (Simoiu et al., 2017; Ayres, 2002; Anwar
and Fang, 2006; Engel, 2008; Anwar and Fang, 2011,
2015; Arnold et al., 2017).

The threshold test. To circumvent this problem
of infra-marginality, the threshold test of Simoiu et al.
(2017) attempts to directly infer race-speciﬁc search
thresholds. Though still relatively new, the test has
already been used to analyze tens of millions of police
stops across the United States (Pierson et al., 2017).
The threshold test is based on a Bayesian latent vari-
able model that formalizes the following stylized pro-
cess of search and discovery. Upon stopping a pedes-
trian, oﬃcers observe the probability p the individual
is carrying a weapon; this probability summarizes all
the available information, such as the stopped indi-
vidual’s age and gender, criminal record, and behav-
ioral indicators like nervousness and evasiveness. Be-
cause these probabilities vary from one individual to
the next, p is modeled as being drawn from a risk dis-
tribution that depends on the stopped person’s race
(r) and the location of the stop (d), where location
might indicate the precinct in which the stop occurred.
Oﬃcers deterministically conduct a search if the prob-
ability p exceeds a race- and location-speciﬁc threshold
(trd), and if a search is conducted, a weapon is found
with probability p. By reasoning in terms of risk dis-
tributions, one avoids the omitted variables problem
by marginalizing out all unobserved variables. In this
formulation, one need not observe the factors that led
to any given decision, and can instead infer the aggre-
gate distribution of risk for each group.

Figure 1 illustrates hypothetical risk distributions and
thresholds for two groups in a single location. This
representation visually describes the mapping from
thresholds and risk distributions to search rates and
hit rates (the observed data). Suppose Prd is a ran-
dom variable (termed “risk distribution”) that gives
the probability of ﬁnding a weapon on a stopped pedes-
trian in group r in location d. The search rate srd of
group r in location d is Pr(Prd > trd), the probabil-

Emma Pierson, Sam Corbett-Davies, Sharad Goel

(2) the number of integration steps per sample; and (3)
the number of eﬀectively independent samples relative
to the total number of samples (i.e., the eﬀective sam-
ple size). The ﬁrst can be improved by simplifying the
analytical form of the log posterior and its derivatives.
The second and third factors depend on the geom-
etry of the posterior: a smooth posterior allows for
longer paths between samples that take fewer integra-
tion steps to traverse (Betancourt, 2017). On all three
measures, our new threshold model generally outper-
forms that of Simoiu et al. (2017); the improvement in
gradient computation is particularly substantial.

When full Bayesian inference is computationally diﬃ-
cult, it is common to consider alternatives such as vari-
ational inference (Wainwright et al., 2008). Though
fast, such alternatives have shortcomings. As we dis-
cuss below, variational inference produced worse ﬁts
than full Bayesian inference on our policing dataset.
Moreover, parameter estimates from variational infer-
ence varied signiﬁcantly from run to run in our tests,
as estimates were sensitive to initialization. With our
accelerated threshold test, one can have the best of
both worlds: the statistical beneﬁts of full Bayesian
inference and the speed of fast alternatives.

3 DISCRIMINANT DISTRIBUTIONS

The computational complexity of the standard thresh-
old test is in large part due to diﬃculties of work-
ing with beta distributions. When P has a beta dis-
tribution, it is expensive to compute the search rate
Pr(P > t), the hit rate E[P | P > t], and their associ-
ated derivatives (Boik and Robison-Cox, 1998). Here
we introduce an alternative family of discriminant dis-
tributions for which it is eﬃcient to compute these
quantities. We motivate and analyze this family in
the speciﬁc context of the threshold test, but the fam-
ily itself can be applied more widely.

To deﬁne discriminant distributions, assume that there
are two classes (positive and negative), and the prob-
ability of being in the positive class is φ. For exam-
ple, positive examples might correspond to individuals
who are carrying weapons, and negative examples to
those who are not. We further assume that each class
emits signals that are normally distributed according
to N(µ0, σ0) and N(µ1, σ1), respectively. Denote by X
the signal emitted by a random instance in the popu-
lation, and by Y ∈ {0, 1} its class membership. Then,
given an observed signal x, one can compute the prob-
ability g(x) = Pr(Y = 1 | X = x) that it was emitted
by a member of the positive class. Throughout the
paper, we term the domain of g the signal space and
its range the probability space. Finally, we say the
random variable g(X) has a discriminant distribution

Figure 1: An illustration of hypothetical risk distribu-
tions Prd (solid curves) and search thresholds (dashed
vertical lines). The blue group is searched at a lower
threshold than the red group, and so the blue group by
deﬁnition faces discrimination.

ity a randomly selected pedestrian in that group and
location exceeds the race- and location-speciﬁc search
threshold; graphically, this is the proportion of the risk
distribution to the right of the threshold. The hit rate
is the probability that a random searched pedestrian is
carrying a weapon: hrd = E[Prd | Prd > trd]; in other
words, the hit rate is the mean of the risk distribution
conditional on being above the threshold. The primary
goal of inference is to determine the latent thresholds
If the thresholds applied to one race group are
trd.
consistently lower than the thresholds applied to an-
other, this suggests discrimination against the group
with the lower thresholds.
In order to estimate the
decision thresholds, the risk distributions must be si-
multaneously inferred. In Simoiu et al. (2017), these
risk proﬁles take the form of beta distributions param-
eterized by means φrd = logit−1(φr + φd) and total
count parameters λrd = exp(λr + λd), where φr, φd,
λr, and λd are parameters that depend on the race of
the stopped individuals and the location of the stops.
Reparameterizing these risk distributions is the key to
accelerating inference. Given the number of searches
and hits by race and location, we can compute the
likelihood of the observed data under any set of model
parameters {φd, φr, λd, λr, trd}. One can likewise com-
pute the posterior distribution of the parameters given
the data and prior distributions.

Inference via Hamiltonian Monte Carlo.
Bayesian inference is challenging when the parame-
ter space is high dimensional, because random walk
MCMC methods fail to fully explore the complex pos-
terior in any reasonable time. This obstacle can be ad-
dressed with Hamiltonian Monte Carlo (HMC) meth-
ods (Neal et al., 2011; Betancourt and Girolami, 2015;
Chen et al., 2014), which propose new samples by
numerically integrating along the gradient of the log
posterior, allowing for more eﬃcient exploration. The
speed of convergence of HMC depends on three factors:
(1) the gradient computation time per integration step;

Fast Threshold Tests for Detecting Discrimination

with parameters φ, µ0, σ0, µ1, and σ1.
Deﬁnition 3.1 (Discriminant distribution). Consider
parameters φ ∈ (0, 1), µ0 ∈ R, σ0 ∈ R+, µ1 ∈ R, and
σ1 ∈ R+, where µ1 > µ0. The discriminant distribu-
tion disc(φ, µ0, σ0, µ1, σ1) is deﬁned as follows. Let

Y ∼ Bernoulli(φ),

X | Y = 0 ∼ N(µ0, σ0),

X | Y = 1 ∼ N(µ1, σ1).

Set g(x) = Pr(Y = 1 | X = x). Then the random
variable g(X) is distributed as disc(φ, µ0, σ0, µ1, σ1).

Our description above mirrors the motivation of lin-
ear discriminant analysis (LDA). Although it is com-
mon to consider the conditional probability of class
membership g(x), it is less common to consider the
distribution of these probabilities as an alternative to
beta or logit-normal distributions. To the best of our
knowledge, the computational properties of discrimi-
nant distributions have not been previously studied.

As in the case of LDA, the statistical properties of dis-
criminant distributions are particularly nice when the
underlying normal distributions have the same vari-
ance. Proposition 3.1 below establishes a key mono-
tonicity property that is standard in the development
of LDA; though the statement is well-known, we in-
clude it here for completeness. Proofs of this proposi-
tion and other technical statements are in the Supple-
mentary Information (SI).
Proposition 3.1 (Monotonicity). Given a discrimi-
nant distribution disc(φ, µ0, σ0, µ1, σ1), the mapping g
from signal space to probability space is monotonic if
and only if σ0 = σ1.

We conﬁne our attention to homoskedastic discrim-
inant distributions so that the mapping from signal
space to probability space will be monotonic. With-
out this property, we cannot interpret a threshold on
signal space as a threshold in probability space, which
is key to our analysis. Homoskedastic discriminant dis-
tributions (i.e., with σ0 = σ1) involve four parameters.
But in fact only two parameters are required to fully
describe this family of distributions. This simpliﬁed
parameterization is useful for computation.
Proposition 3.2 (2-parameter representation). Sup-
1, σ(cid:48)) are
pose disc(φ, µ0, σ, µ1, σ) and disc(φ(cid:48), µ(cid:48)
two homoskedastic discriminant distributions. Let

0, σ(cid:48), µ(cid:48)

δ =

µ1 − µ0
σ

and deﬁne δ(cid:48) analogously. Then the two distributions
are identical if φ = φ(cid:48) and δ = δ(cid:48). As a result, ho-
moskedastic discriminant distributions can be param-
eterized by φ and δ alone.

Given Proposition 3.2, we henceforth write disc(φ, δ)
to denote a homoskedastic discriminant distribution.
Considering disc(φ, δ) as a distribution of calibrated
predictions, the parameters have intuitive interpreta-
tions: φ is the fraction of individuals in the positive
class, while δ is monotonically related to the AUC-
ROC of the predictions1. Even though the distribution
itself depends on only φ and δ, the transformation g
from signal space to probability space depends on the
particular 4-parameter representation we use. For sim-
plicity, we consider the representation with µ0 = 0 and
σ = 1. This yields the simpliﬁed transformation func-
tion:

g(x) =

1 + 1−φ

φ exp (−δx + δ2/2)

.

1

Our primary motivation for introducing discriminant
distributions is to accelerate key computations of the
(complementary) CDF and conditional means. Let-
ting P = g(X), we are speciﬁcally interested in com-
puting Pr(P > t) and E[P | P > t]. With (ho-
moskedastic) discriminant distributions, these quan-
tities map nicely to signal space, where they can be
computed eﬃciently.
Denote by ¯Φ(x; µ, σ) the normal complementary CDF.
Then the complementary CDF of P can be computed
as follows.

Pr(P > t) = (1 − φ) ¯Φ(g−1(t); 0, 1) + φ ¯Φ(g−1(t); δ, 1).

For the conditional mean, we have

E[P | P > t] =

φ ¯Φ(g−1(t); δ, 1)
(1 − φ) ¯Φ(g−1(t); 0, 1) + φ ¯Φ(g−1(t); δ, 1)

.

Importantly, the CDF and conditional means for dis-
criminant distributions are closely related to those for
the normal distributions, and as such are computa-
tionally eﬃcient to work with. In particular, the gra-
dients of these functions are relatively straightforward
to evaluate. The corresponding quantities for logit-
normal and beta distributions involve tricky numerical
approximations (Frederic and Lad, 2008; Jones, 2009).

Finally, we show that discriminant distributions are
an expressive family of distributions (Fig. 2): they can
approximate typical instantiations of the logit-normal

1AUC-ROC is the probability that a random member
of the positive class is assigned a higher score than a ran-
dom member of the negative class. Since the positive and
negative class emit signals from independent normal distri-
butions, it’s straightforward to show that the AUC-ROC
equals Φ
(where Φ(·) is the CDF of the standard

(cid:17)

(cid:16) δ√
normal distribution).

2

Emma Pierson, Sam Corbett-Davies, Sharad Goel

Figure 2: Discriminant distributions can approxi-
mate the logit-normal(µ, σ) (left panels) and beta(φ, λ)
(right panels) distributions.
In the top row we il-
lustrate some typical distributions (solid lines) and
their discriminant distribution approximations (dashed
lines; some approximations are too accurate for lines
to be seen). In the bottom row we explore a wide range
of parameter values for distributions and report the to-
tal variation distance between the reference distribu-
tion and its discriminant distribution approximation.

and beta distributions. First, we select the parame-
ters of the reference distribution: (µ, σ) for the logit-
normal or (φ, λ) for the beta. Then we numerically
optimize the parameters of the discriminant distribu-
tion to minimize the total variation distance between
the reference distribution and the discriminant distri-
bution. The top row of Figure 2 shows some typical
densities and their approximations. The bottom row
investigates the approximation error for a wide range
of parameter values. The discriminant distribution ﬁts
the logit-normal very well (distance below 0.1 for all
distributions with σ ≤ 3), and the beta distribution
moderately well (distance below 0.2 for λ ≥ 1). Dis-
criminant distributions approximate logit-normal dis-
tributions particularly well because they form a subset
of logit-normal mixture distributions (SI).

4 STOP-AND-FRISK CASE STUDY

To demonstrate the value of discriminant distributions
for speeding up the threshold test, we analyze a pub-
lic dataset of pedestrian stops conducted by New York
City police oﬃcers under its “stop-and-frisk” practice.
Oﬃcers have legal authority to stop and brieﬂy detain
individuals when they suspect criminal activity. There
is worry, however, that such discretionary decisions
are prone to racial bias; indeed the NYPD practice
was recently ruled discriminatory in federal court and
subsequently curtailed (Floyd v. City of New York ,
2013; Goel et al., 2017). Here we revisit the statisti-
cal evidence for discrimination. Our dataset contains

Figure 3:
Inferred thresholds for frisks in the stop-
and-frisk data. Thresholds for white pedestrians are
plotted on the horizontal axis and thresholds for mi-
nority pedestrians in the same precinct are plotted on
the vertical axis. The dotted line denotes equal thresh-
olds. The size of each circle corresponds to the number
of stops of minority pedestrians. Axes are logarithmic.

information on 2.7 million police stops occurring be-
tween 2008 and 2012. Several variables are available
for each stop, including the race of the pedestrian, the
police precinct in which the stop occurred, whether the
pedestrian was “frisked” (patted-down in search of a
weapon), and whether a weapon was found. We an-
alyze stops of white, black, and Hispanic pedestrians,
as there are relatively few stops of individuals of other
races. We use the threshold test to analyze two de-
cisions: the initial stop decision, and the subsequent
decision of whether or not to conduct a frisk. Ana-
lyzing frisk decisions is a straightforward application
of the threshold test: simply replacing beta distribu-
tions in the model with discriminant distributions re-
sults in more than a 100-fold speedup. To analyze stop
decisions, we extend the threshold model to the case
where one does not observe negative examples (i.e.,
those who were not stopped) and show that discrimi-
nant distributions again produce signiﬁcant speedups.

4.1 Assessing bias in frisk decisions

We ﬁt the threshold models using Stan (Carpenter
et al., 2016), a language for full Bayesian statistical
inference via HMC. When using beta distributions in
the threshold test, it takes nearly two hours to infer the
model parameters; when we replace beta distributions
with discriminant distributions, inference completes in
under one minute. Why is it that discriminant distri-
butions result in such a dramatic increase in perfor-
mance? The compute time per eﬀective Monte Carlo
sample is the product of three terms:

seconds
neﬀ

=

samples
neﬀ

·

integration steps
sample

·

seconds
integration step

.

All three factors are signiﬁcantly reduced by using dis-
criminant distributions (Table 1), with the ﬁnal term
providing the most signiﬁcant reduction. (The reduc-
tion in the ﬁrst two terms is likely due to the geometry
of the underlying parameter space and the accuracy
with which we can numerically approximate gradients

Fast Threshold Tests for Detecting Discrimination

Table 1: Sampling times for the frisk decision model.
Each row reports the improvement for the discrimi-
nant distribution model relative to the beta distribution
model followed by the statistics for both models. The
ﬁrst row reports the seconds per eﬀective sample, which
is the product of the numbers in the second to fourth
rows. The ﬁnal row reports the time to ﬁt the models
used in our analysis using 5 chains run in parallel for
5,000 samples. Sampling was performed on a server
with two Intel Xeon E5 processors with 16 cores each.

Seconds/neff
Samples/neff
Integration steps/sample
Seconds/integration step
Seconds to fit model

Speedup
760x
5x
3x
53x
143x

Beta
26
22
152
0.008
5,977

Disc
0.03
5
49
0.0001
42

for the beta and discriminant distributions.) Using
discriminant distributions reduces the time per eﬀec-
tive sample by a factor of 760. In practice, one typi-
cally runs chains in parallel, and so total running time
is determined by the last chain to terminate. When
running ﬁve chains in parallel for 5,000 iterations each,
the accelerated model is faster by a factor of 140.

The thresholds inferred using the accelerated model
are extremely highly correlated with the thresholds in-
ferred under the original model (correlation = 0.95),
and indicate discrimination against black and Hispanic
individuals. (In general, we would not expect the orig-
inal and accelerated models to yield identical results
on all datasets, since they use diﬀerent probability dis-
tributions, so the fact that the thresholds are highly
correlated serves as a robustness check.) Figure 3
shows the inferred thresholds (under the accelerated
model). Each point corresponds to the threshold for
one precinct, with the threshold for white pedestrians
on the horizontal axis and for minority pedestrians on
the vertical axis. Within precinct, thresholds for mi-
nority pedestrians are consistently lower than thresh-
olds for white pedestrians.

Robustness checks. To evaluate the robustness of
our substantive ﬁnding of bias in frisk decisions, we
perform a series of checks for threshold tests recom-
mended by Simoiu et al. (2017); we include all ﬁgures
in the SI. We start by conducting posterior predictive
checks (Gelman et al., 1996). We compute the model-
inferred frisk and hit rates for each precinct and race
group, and compare these to the observed rates (SI
Figure 1). The model almost perfectly ﬁts the ob-
served frisk rates, and ﬁts the observed hit rates quite
well: The RMSE of frisk rates is 0.05%, and the RMSE
of hit rates is 2.5%.
(RMSEs for the original beta
model are comparable: the RMSE for frisk rates is
0.1%, and the RMSE for hit rates is 2.4%). For com-
parison, if the model of Simoiu et al. (2017) is ﬁt with

variational inference—rather than HMC, to speed up
inference—the frisk rate RMSE is 0.15% (a 3-fold in-
crease), and the hit rate RMSE is 2.6% (on par with
HMC). Variational inference ﬁts the model of Simoiu
et al. (2017) in 44 seconds, comparable to the runtime
with HMC and discriminant distributions.

The stylized behavioral model underlying the thresh-
old test posits a single frisk threshold for each race-
In reality, oﬃcers within a precinct
precinct pair.
might apply diﬀerent thresholds, and even the same
oﬃcer might vary the threshold from one stop to the
next. Moreover, oﬃcers only observe noisy approx-
imations of a stopped pedestrian’s likelihood of car-
rying a weapon; such errors can be equivalently re-
cast as variation in the frisk threshold applied to the
true probability. To investigate the robustness of our
results to such heterogeneity, we next examine the
stability of our inferences on synthetic datasets de-
rived from a generative process with varying thresh-
olds. We start with the model ﬁt to the actual data.
Then, for each observed stop, we draw a signal p from
the inferred signal distribution for the precinct d in
which the stop occurred and the race r of the pedes-
trian. Second, we set the stop-speciﬁc threshold to
T ∼ logit-normal(logit(trd), σ), where trd is the in-
ferred threshold, and σ is a parameter we set to control
the degree of heterogeneity in the thresholds. This cor-
responds to adding normally-distributed noise to the
inferred threshold on the logit scale. Third, we assume
a frisk occurs if and only if p ≥ T , and if a frisk is con-
ducted, we assume a weapon is found with probability
p. Finally, we use our modeling framework to infer
new frisk thresholds t(cid:48)

rd for the synthetic dataset.

There is a steady decrease in inferred thresholds as
the noise increases (SI Figure 2). Importantly, how-
ever, there is a persistent gap between whites and mi-
norities despite this decline, indicating that the lower
thresholds for minorities are robust to heterogeneity
in frisk thresholds. σ = 1 is a substantial amount of
noise. Decreasing the frisk threshold of blacks by 1 on
the logit scale corresponds to a 3-fold increase in the
city-wide frisk rate of blacks.

In theory, the threshold test is robust to unobserved
heterogeneity that aﬀects the signal, since we eﬀec-
tively marginalize over any omitted variables when es-
timating the signal distribution. However, we must
still worry about systematic variation in the thresh-
olds that is correlated with race. For example, if oﬃ-
cers apply a lower frisk threshold at night, and black
individuals are disproportionately likely to be stopped
at night, then blacks would, on average, experience a
lower frisk threshold than whites even in the absence
of discrimination. Fortunately, as a matter of policy
only a limited number of factors may legitimately af-

Emma Pierson, Sam Corbett-Davies, Sharad Goel

fect the frisk thresholds, and many—but not all—of
these are recorded in the data. There are a multitude
of hard-to-quantify factors (such as behavioral cues)
that may aﬀect the signal—but these should not af-
fect the threshold.

We examine the robustness of our results to variation
in thresholds across year, time-of-day, and age and
gender of the stopped pedestrian.2 To do so, we disag-
gregate our primary dataset by year (and, separately,
by time-of-day, by age, and by gender), and then inde-
pendently run the threshold test on each component
(SI Figure 3). The inferred thresholds do indeed vary
across the diﬀerent subsets of the data. However, in
every case, the thresholds for frisking blacks and His-
panics are lower than the thresholds for frisking whites,
corroborating our main results.

Finally, we conduct two placebo tests, where we re-
run the threshold test with race replaced by day-of-
week, and separately, with race replaced by month.
The hope is that the threshold test accurately cap-
tures a lack of “discrimination” based on these fac-
tors. The model indeed ﬁnds that the threshold for
frisking individuals is relatively stable by day-of-week,
with largely overlapping credible intervals (SI Figure
4). We similarly ﬁnd only small diﬀerences in the in-
ferred monthly thresholds. Some variation is expected,
as oﬃcers might legitimately apply slightly diﬀerent
frisk standards throughout the week or year.

4.2 Assessing bias in stop decisions

We now extend the threshold model to test for dis-
crimination in an oﬃcer’s decision to stop a pedes-
trian. In contrast to frisk decisions, we do not observe
instances in which an oﬃcer decided not to carry out
a stop. Inferring thresholds with such censored data is
analogous to learning classiﬁers from only positive and
unlabeled examples (Elkan and Noto, 2008; Mordelet
and Vert, 2014; du Plessis et al., 2014). We assume
oﬃcers are equally likely to encounter anyone in a
precinct. Coupled with demographic data compiled by
the U.S. Census Bureau, this assumption lets us esti-
mate the racial distribution of individuals encountered
by oﬃcers. Such estimates are imperfect, in part be-
cause residential populations diﬀer from daytime pop-
ulations (Bhaduri, 2008); however, our inferences are
robust to violations of this assumption.

Model description. When analyzing frisk deci-
sions, the decision itself and the success of a frisk were
modeled as random outcomes. For stops, we model as

2Variation across location is explicitly captured by the
model. Gender, like race, is generally not considered a
valid criterion for altering the frisk threshold, though for
completeness we still examine its eﬀects on our conclusions.

random the race of stopped individuals and whether
a stop was successful (i.e., turned up a weapon). The
likelihood of the observed outcomes can then be com-
puted under any set of model parameters, which allows
us to compute posterior parameter estimates. Let Srd
denote the number of stops of individuals of race r
in precinct d, and let Hrd denote the number of such
stops that yield a weapon. We denote by crd the frac-
tion of people in a precinct of a given race. Letting Rd
denote the race of an individual randomly encountered
by the police in precinct d, we have

Pr(Rd = r | stopped) ∝ Pr(stopped | Rd = r) Pr(Rd = r).

Assuming oﬃcers are equally likely to encounter ev-
eryone in a precinct, Pr(Rd = r) = crd. We fur-
ther assume that individuals of race r are stopped
when their probability of carrying a weapon exceeds a
race- and precinct-speciﬁc threshold trd; this assump-
tion mirrors the one made for the frisk model. Setting
θrd = Pr(Rd = r | stopped), we have

θrd ∝ crd · Pr(stopped | Rd = r)

Pr(stopped | Rd = r) = (1 − φrd) ¯Φ(trd; 0, 1)
+ φrd ¯Φ(trd; δrd, 1).

For each precinct d, the racial composition of stops is
thus distributed as a multinomial:

(cid:126)Sd ∼ multinomial

(cid:16)(cid:126)θd, Nd

(cid:17)

where Nd denotes the total number of stops conducted
in that precinct, (cid:126)θd is a vector of race-speciﬁc stop
probabilities θrd, and (cid:126)Sd is the number of stops of each
race group in that precinct. We model hits as in the
frisk model. We put normal or half-normal priors on
all the parameters: {φd, φr, λd, λr, trd}.3

Results. We apply the above model to the subset of
approximately 723,000 stops predicated on suspected
criminal possession of a weapon, as indicated by oﬃ-
cers. In these cases, the stated objective of the stop
is discovery of a weapon, and so we consider a stop
successful if a weapon was discovered (Goel et al.,
2016). We estimate the racial composition of precincts
using data from the 2010 U.S. Census.
In Table 2
we compare the time to ﬁt our stop model with dis-
criminant distributions rather than beta distributions.
The speedup from using discriminant distributions is

3 Following Simoiu et al. (2017) and Pierson et al.
(2017), we put weakly informative priors on φr, λr, and
trd; we put tighter priors on the location parameters φd
and λd to restrict geographical heterogeneity and to accel-
erate convergence.

Fast Threshold Tests for Detecting Discrimination

Table 2: Breakdown of sampling times for the stop
model. Each row reports the improvement for the dis-
criminant distribution model relative to the beta distri-
bution model followed by the statistics for both models.

Seconds/neff
Samples/neff
Integration steps/sample
Seconds/integration step
Seconds to fit model

Speedup
84x
1x
2x
37x
77x

Beta
55
18
503
0.006
15,943

Disc
0.7
17
237
0.0002
208

dramatic: with beta distributions, the model requires
more than 4 hours to ﬁt; with discriminant distri-
butions it takes under 4 minutes. The primary rea-
son for the speedup is the reduced time per gradient
evaluation, although the number of gradient evalua-
tions is also reduced. As with frisk decisions, we ﬁnd
stop thresholds for blacks and Hispanics are consis-
tently lower than for whites, suggestive of discrimina-
tion (Figure 4). Our results are in line with those from
past statistical studies of New York City’s stop-and-
frisk practices based on benchmark (Gelman et al.,
2007) and outcome (Goel et al., 2016) analysis.

Figure 4: Inferred stop thresholds in the stop-and-frisk
data. The size of each circle corresponds to the minor-
ity population in each precinct. Axes are logarithmic.

Robustness checks. A key assumption of our stop
model is that the racial composition of the residen-
tial population (as estimated by the U.S. Census) is
similar to the racial composition of pedestrians oﬃ-
cers encounter on the street. We test how sensitive
our inferred thresholds are to this assumption by reﬁt-
ting the stop model with various estimates of the frac-
tion of white individuals encountered in each precinct.
Letting cwhite,d denote the original Census estimate,
we varied this number from cwhite,d/2 to 2cwhite,d.
The inferred thresholds remain stable, with thresh-
olds for blacks and Hispanics consistently lower than
for whites: thresholds for whites varied from 5.7% to
6.1%, thresholds for blacks from 0.8% to 1.2%, and
thresholds for Hispanics from 1.8% to 2.1%. This sta-
bility is in part due to the fact that altering assump-
tions about the base population does not change the
observed hit rates, which are substantially higher for
whites. We also ran the robustness checks outlined in
Simoiu et al. (2017): posterior predictive checks, tests
for threshold heterogeneity, and tests for omitted vari-
able bias (SI Figures 5–7). In all cases, the results con-

ﬁrm our main ﬁndings. Standard placebo tests cannot
be run in this setting because natural placebos (such
as month) eliminate all heterogeneity across groups,
breaking model identiﬁability.

As with the frisk model, HMC inference with discrim-
inant distributions yields better model ﬁt than varia-
tional inference with beta distributions. Though vari-
ational inference ﬁts more quickly (30 seconds vs. 208
seconds), with variational inference the RMSE of stop
rates is four times larger (0.9% vs. 0.2%), and the
RMSE of hit rates is twice as large (1.3% vs. 0.8%).
(For comparison, the RMSE of the original beta model
for stop rates is 0.2% and the RMSE of the hit rates
is 0.7%). These performance gaps illustrate the value
of full Bayesian inference over approximate methods.

5 CONCLUSION

We introduced and analyzed discriminant distribu-
tions to accelerate threshold tests for discrimination.
The CDF and conditional means of discriminant distri-
butions reduce to simple expressions that are no more
diﬃcult to evaluate than the equivalent statistics for
normal distributions. Consequently, using discrimi-
nant distributions speeds up inference in the thresh-
old test by more than 75-fold. It is now practical to
use the threshold test to investigate bias in a wide
variety of settings. Practitioners can quickly carry
out analysis—including computationally expensive ro-
bustness checks—on low-cost hardware within min-
utes. Our test also scales to previously intractable
datasets, such as the national traﬃc stop database of
Pierson et al. (2017). We also extended the threshold
test to domains in which actions are only partially ob-
served, allowing us to assess possible discrimination in
an oﬃcer’s decision to stop a pedestrian.

Tools for black box Bayesian inference are allowing
inference for increasingly complicated models. As re-
searchers embrace this complexity, there is opportu-
nity to consider new distributions. Historical default
distributions—often selected for convenient properties
like conjugacy—may not be the best choices when us-
ing automatic inference. An early example of this
was the Kumaraswamy distribution (Jones, 2009; Ku-
maraswamy, 1980), developed as an alternative to the
beta distribution for its simpler CDF. Discriminant
distributions may also oﬀer computational speedups
beyond the threshold test as automatic inference en-
joys increasingly widespread use.

Code and acknowledgments: Code is available
at https://github.com/5harad/fasttt. We thank Peng
Ding, Avi Feller, Pang Wei Koh, and the reviewers
for helpful comments, and the John S. and James L.
Knight, Hertz, and NDSEG Foundations.

Emma Pierson, Sam Corbett-Davies, Sharad Goel

References

G. S. Becker, The economics of discrimination. Uni-

versity of Chicago Press, 1957.

C. Simoiu, S. Corbett-Davies, and S. Goel, “The prob-
lem of infra-marginality in outcome tests for dis-
crimination,” Annals of Applied Statistics, 2017,
forthcoming.

C. Elkan and K. Noto, “Learning classiﬁers from only
positive and unlabeled data,” in Proceedings of the
14th ACM SIGKDD. ACM, 2008, pp. 213–220.

F. Mordelet and J.-P. Vert, “A bagging SVM to
learn from positive and unlabeled examples,” Pat-
tern Recognition Letters, vol. 37, pp. 201–209, 2014.

M. C. du Plessis, G. Niu, and M. Sugiyama, “Anal-
ysis of learning from positive and unlabeled data,”
in Advances in Neural Information Processing Sys-
tems, 2014, pp. 703–711.

E. Pierson, C. Simoiu, J. Overgoor, S. Corbett-Davies,
V. Ramachandran, C. Phillips, and S. Goel, “A
large-scale analysis of racial disparities in police
stops across the united states,” Working paper,
2017.

G. S. Becker, “Nobel lecture: The economic way of
looking at behavior,” Journal of Political Economy,
pp. 385–409, 1993.

I. Ayres, “Outcome tests of racial disparities in police
practices,” Justice Research and Policy, vol. 4, no.
1-2, pp. 131–142, 2002.

S. Anwar and H. Fang, “An alternative test of racial
prejudice in motor vehicle searches: Theory and ev-
idence,” The American Economic Review, vol. 96,
no. 1, pp. 127–151, 2006.

R. S. Engel, “A critique of the outcome test in racial
proﬁling research,” Justice Quarterly, vol. 25, no. 1,
pp. 1–36, 2008.

S. Anwar and H. Fang, “Testing for the role of
prejudice in emergency departments using bounce-
back rates,” National Bureau of Economic Research,
Tech. Rep., 2011.

——, “Testing for racial prejudice in the parole board
release process: Theory and evidence,” The Journal
of Legal Studies, vol. 44, no. 1, pp. 1–37, 2015.

D. Arnold, W. Dobbie, and C. S. Yang, “Racial bias
in bail decisions,” 2017, NBER working paper, avail-
able at http://www.nber.org/papers/w23421.

R. M. Neal et al., “MCMC using Hamiltonian dy-
namics,” Handbook of Markov Chain Monte Carlo,
vol. 2, pp. 113–162, 2011.

M. Betancourt and M. Girolami, “Hamiltonian Monte
Carlo for hierarchical models,” Current trends in
Bayesian methodology with applications, vol. 79,
p. 30, 2015.

T. Chen, E. B. Fox, and C. Guestrin, “Stochastic Gra-
dient Hamiltonian Monte Carlo.” in ICML, 2014,
pp. 1683–1691.

M. Betancourt,

“A conceptual
Hamiltonian Monte Carlo,”
arXiv:1701.02434, 2017.

introduction to
preprint
arXiv

M. J. Wainwright, M. I. Jordan et al., “Graphical
models, exponential families, and variational infer-
ence,” Foundations and Trends in Machine Learn-
ing, vol. 1, no. 1–2, pp. 1–305, 2008.

R. J. Boik and J. F. Robison-Cox, “Derivatives of
the incomplete beta function,” Journal of Statistical
Software, vol. 3, no. 1, pp. 1–20, 1998.

P. Frederic and F. Lad, “Two moments of the logit-
normal distribution,” Communications in Statistics
– Simulation and Computation, vol. 37, no. 7, pp.
1263–1269, 2008.

M. Jones, “Kumaraswamy’s distribution: A beta-type
distribution with some tractability advantages,”
Statistical Methodology, vol. 6, no. 1, pp. 70–81,
2009.

Floyd v. City of New York, “959 F. Supp. 2d 540 -

Dist. Court, SD New York,” 2013.

S. Goel, M. Perelman, R. Shroﬀ, and D. A. Sklansky,
“Combatting police discrimination in the age of big
data,” New Criminal Law Review, vol. 20, no. 2, pp.
181–232, 2017.

B. Carpenter, A. Gelman, M. Hoﬀman, D. Lee,
B. Goodrich, M. Betancourt, M. A. Brubaker,
J. Guo, P. Li, and A. Riddell, “Stan: A probabilistic
programming language,” Journal of Statistical Soft-
ware, vol. 20, 2016.

A. Gelman, X.-L. Meng, and H. Stern, “Posterior pre-
dictive assessment of model ﬁtness via realized dis-
crepancies,” Statistica sinica, pp. 733–760, 1996.

B. Bhaduri, “Population distribution during the day,”
Springer, 2008, pp. 880–

in Encyclopedia of GIS.
885.

S. Goel, J. M. Rao, and R. Shroﬀ, “Precinct or preju-
dice? Understanding racial disparities in New York
City’s stop-and-frisk policy,” The Annals of Applied
Statistics, vol. 10, no. 1, pp. 365–394, 2016.

A. Gelman, J. Fagan, and A. Kiss, “An analysis of
the New York City police department’s stop-and-
frisk policy in the context of claims of racial bias,”
Journal of the American Statistical Association, vol.
102, no. 479, pp. 813–823, 2007.

Fast Threshold Tests for Detecting Discrimination

A. Kucukelbir, D. Tran, R. Ranganath, A. Gelman,
and D. M. Blei, “Automatic diﬀerentiation varia-
tional inference,” arXiv preprint arXiv:1603.00788,
2016.

P. Kumaraswamy, “A generalized probability density
function for double-bounded random processes,”
Journal of Hydrology, vol. 46, no. 1-2, pp. 79–88,
1980.

Fast Threshold Tests for Detecting Discrimination

8
1
0
2
 
r
a

M
 
0
1
 
 
]
L
M

.
t
a
t
s
[
 
 
3
v
6
3
5
8
0
.
2
0
7
1
:
v
i
X
r
a

Emma Pierson
Stanford University

Sam Corbett-Davies
Stanford University

Sharad Goel
Stanford University

Abstract

Threshold tests have recently been proposed
as a useful method for detecting bias in lend-
ing, hiring, and policing decisions. For ex-
ample, in the case of credit extensions, these
tests aim to estimate the bar for granting
loans to white and minority applicants, with
a higher inferred threshold for minorities in-
dicative of discrimination. This technique,
however, requires ﬁtting a complex Bayesian
latent variable model for which inference is
often computationally challenging. Here we
develop a method for ﬁtting threshold tests
that is two orders of magnitude faster than
the existing approach, reducing computation
from hours to minutes. To achieve these per-
formance gains, we introduce and analyze a
ﬂexible family of probability distributions on
the interval [0, 1]—which we call discriminant
distributions—that is computationally eﬃ-
cient to work with. We demonstrate our tech-
nique by analyzing 2.7 million police stops of
pedestrians in New York City.

1

INTRODUCTION

There is wide interest in detecting and quantifying bias
in human decisions, but well-known problems with tra-
ditional statistical tests of discrimination have ham-
pered rigorous analysis. The primary goal of such
work is to determine whether decision makers apply
diﬀerent standards to groups deﬁned by race, gen-
der, or other protected attributes—what economists
call taste-based discrimination (Becker, 1957). For ex-
ample, in the context of banking, such discrimination
might mean that minorities are granted loans only
when they are exceptionally creditworthy. The key

Proceedings of the 21st International Conference on Artiﬁ-
cial Intelligence and Statistics (AISTATS) 2018, Lanzarote,
Spain. PMLR: Volume 84.

statistical challenge is that an individual’s qualiﬁca-
tions are typically only partially observed (e.g., re-
searchers may not know an applicant’s full credit his-
tory); it is thus unclear whether observed disparities
are attributable to discrimination or omitted variables.

To address this problem, Simoiu et al. (2017) recently
proposed the threshold test, which considers both the
decisions made (e.g., whether a loan was granted) and
the outcomes of those decisions (e.g., whether a loan
was repaid). The test simultaneously estimates deci-
sion thresholds and risk proﬁles via a Bayesian latent
variable model. This approach mitigates some of the
most serious statistical shortcomings of past methods.
Fitting the model, however, is computationally chal-
lenging, often requiring several hours on moderately
sized datasets. As is common in full Bayesian infer-
ence, the threshold model is typically ﬁt with Hamilto-
nian Monte Carlo (HMC) sampling. In this case, HMC
involves repeatedly evaluating gradients of conditional
beta distributions that are expensive to compute.

Here we introduce a family of distributions on the
interval
[0, 1]—which we call discriminant distribu-
tions—that is eﬃcient for performing common sta-
tistical operations. Discriminant distributions com-
prise a natural subset of logit-normal mixture distri-
butions which is suﬃciently expressive to approximate
logit-normal and beta distributions for a wide range
of parameters. By replacing the beta distributions in
the threshold test with discriminant distributions, we
speed up inference by two orders of magnitude.

To demonstrate our method, we analyze 2.7 million
police stops of pedestrians in New York City between
2008 and 2012. We apply the threshold test to as-
sess possible bias in decisions to search individuals for
weapons. We also extend the threshold test to detect
discrimination in the decision to stop an individual.
For both problems (search decisions and stop deci-
sions), our method accelerates inference by more than
75-fold. Such performance gains are consequential in
part because each new application requires running the
threshold test dozens of times to conduct a battery of
standard robustness checks. To carry out the experi-
ments in this paper, we ran the threshold test nearly

Fast Threshold Tests for Detecting Discrimination

100 times. That translates into about two months of
continuous, serial computation under the standard ﬁt-
ting method; our approach required less than one day
of computation. These performance gains also allow
one to run the threshold test on very large datasets.
In a national analysis of traﬃc stops by Pierson et al.
(2017), running the threshold test required splitting
the data into state-level subsets; with our approach,
one can ﬁt a single national model on 22 million stops
in 30 minutes, facilitating eﬃcient pooling of informa-
tion across states. Finally, such acceleration broadens
the accessibility of the threshold test to policy analysts
with limited computing resources. Our fast implemen-
tation of the threshold test is available online.

2 BACKGROUND

Traditional tests of discrimination. To motivate
the threshold test, we review two traditional statistical
tests of discrimination: the benchmark test (or bench-
marking) and the outcome test. The benchmark test
analyzes the rate at which some action is taken (e.g.,
the rate at which stopped pedestrians are searched).
Decision rates might vary across racial groups for a va-
riety of legitimate reasons, such as race-speciﬁc diﬀer-
ences in behavior. One thus attempts to estimate deci-
sion rates after controlling for all legitimate factors. If
decision rates still diﬀer by race after such condition-
ing, the benchmark test would suggest bias. Though
popular, this test suﬀers from the well-known problem
of omitted variable bias, as it is typically impossible
for researchers to observe—and control for—all legiti-
mate factors that might aﬀect decisions. For example,
if evasiveness is a reliable indicator of possessing con-
traband, is not observed by researchers, and is diﬀer-
entially distributed across race groups, the benchmark
test might indicate discrimination where there is none.
This concern is especially problematic for face-to-face
interactions such as police stops that may rely on hard-
to-quantify behavioral observations.

Addressing this shortcoming, Becker (1957, 1993) pro-
posed the outcome test, which is based not on the rate
at which decisions are made but on the hit rate (i.e, the
success rate) of those decisions. Becker reasoned that
even if one cannot observe the rationale for a search,
absent discrimination contraband should be found on
searched minorities at the same rate as on searched
whites. If searches of minorities turn up weapons at
lower rates than searches of whites, it suggests that
oﬃcers are applying a double standard, searching mi-
norities on the basis of less evidence.

Outcome tests, however, are also imperfect measures
of discrimination (Ayres, 2002). Suppose that there
are two, easily distinguishable types of white pedestri-

ans: those who have a 1% chance of carrying weapons,
and those who have a 75% chance. Similarly assume
that black pedestrians have either a 1% or 50% chance
of carrying weapons. If oﬃcers, in a race-neutral man-
ner, search individuals who are at least 10% likely to
be carrying a weapon, then searches of whites will be
successful 75% of the time whereas searches of blacks
will be successful only 50% of the time. With such
a race-neutral threshold, no individual is treated dif-
ferently because of their race. Thus, contrary to the
ﬁndings of the outcome test (which suggests discrim-
ination against blacks due to their lower hit rate),
no discrimination is present. This illustrates a fail-
ure of outcome tests known as the problem of infra-
marginality (Simoiu et al., 2017; Ayres, 2002; Anwar
and Fang, 2006; Engel, 2008; Anwar and Fang, 2011,
2015; Arnold et al., 2017).

The threshold test. To circumvent this problem
of infra-marginality, the threshold test of Simoiu et al.
(2017) attempts to directly infer race-speciﬁc search
thresholds. Though still relatively new, the test has
already been used to analyze tens of millions of police
stops across the United States (Pierson et al., 2017).
The threshold test is based on a Bayesian latent vari-
able model that formalizes the following stylized pro-
cess of search and discovery. Upon stopping a pedes-
trian, oﬃcers observe the probability p the individual
is carrying a weapon; this probability summarizes all
the available information, such as the stopped indi-
vidual’s age and gender, criminal record, and behav-
ioral indicators like nervousness and evasiveness. Be-
cause these probabilities vary from one individual to
the next, p is modeled as being drawn from a risk dis-
tribution that depends on the stopped person’s race
(r) and the location of the stop (d), where location
might indicate the precinct in which the stop occurred.
Oﬃcers deterministically conduct a search if the prob-
ability p exceeds a race- and location-speciﬁc threshold
(trd), and if a search is conducted, a weapon is found
with probability p. By reasoning in terms of risk dis-
tributions, one avoids the omitted variables problem
by marginalizing out all unobserved variables. In this
formulation, one need not observe the factors that led
to any given decision, and can instead infer the aggre-
gate distribution of risk for each group.

Figure 1 illustrates hypothetical risk distributions and
thresholds for two groups in a single location. This
representation visually describes the mapping from
thresholds and risk distributions to search rates and
hit rates (the observed data). Suppose Prd is a ran-
dom variable (termed “risk distribution”) that gives
the probability of ﬁnding a weapon on a stopped pedes-
trian in group r in location d. The search rate srd of
group r in location d is Pr(Prd > trd), the probabil-

Emma Pierson, Sam Corbett-Davies, Sharad Goel

(2) the number of integration steps per sample; and (3)
the number of eﬀectively independent samples relative
to the total number of samples (i.e., the eﬀective sam-
ple size). The ﬁrst can be improved by simplifying the
analytical form of the log posterior and its derivatives.
The second and third factors depend on the geom-
etry of the posterior: a smooth posterior allows for
longer paths between samples that take fewer integra-
tion steps to traverse (Betancourt, 2017). On all three
measures, our new threshold model generally outper-
forms that of Simoiu et al. (2017); the improvement in
gradient computation is particularly substantial.

When full Bayesian inference is computationally diﬃ-
cult, it is common to consider alternatives such as vari-
ational inference (Wainwright et al., 2008). Though
fast, such alternatives have shortcomings. As we dis-
cuss below, variational inference produced worse ﬁts
than full Bayesian inference on our policing dataset.
Moreover, parameter estimates from variational infer-
ence varied signiﬁcantly from run to run in our tests,
as estimates were sensitive to initialization. With our
accelerated threshold test, one can have the best of
both worlds: the statistical beneﬁts of full Bayesian
inference and the speed of fast alternatives.

3 DISCRIMINANT DISTRIBUTIONS

The computational complexity of the standard thresh-
old test is in large part due to diﬃculties of work-
ing with beta distributions. When P has a beta dis-
tribution, it is expensive to compute the search rate
Pr(P > t), the hit rate E[P | P > t], and their associ-
ated derivatives (Boik and Robison-Cox, 1998). Here
we introduce an alternative family of discriminant dis-
tributions for which it is eﬃcient to compute these
quantities. We motivate and analyze this family in
the speciﬁc context of the threshold test, but the fam-
ily itself can be applied more widely.

To deﬁne discriminant distributions, assume that there
are two classes (positive and negative), and the prob-
ability of being in the positive class is φ. For exam-
ple, positive examples might correspond to individuals
who are carrying weapons, and negative examples to
those who are not. We further assume that each class
emits signals that are normally distributed according
to N(µ0, σ0) and N(µ1, σ1), respectively. Denote by X
the signal emitted by a random instance in the popu-
lation, and by Y ∈ {0, 1} its class membership. Then,
given an observed signal x, one can compute the prob-
ability g(x) = Pr(Y = 1 | X = x) that it was emitted
by a member of the positive class. Throughout the
paper, we term the domain of g the signal space and
its range the probability space. Finally, we say the
random variable g(X) has a discriminant distribution

Figure 1: An illustration of hypothetical risk distribu-
tions Prd (solid curves) and search thresholds (dashed
vertical lines). The blue group is searched at a lower
threshold than the red group, and so the blue group by
deﬁnition faces discrimination.

ity a randomly selected pedestrian in that group and
location exceeds the race- and location-speciﬁc search
threshold; graphically, this is the proportion of the risk
distribution to the right of the threshold. The hit rate
is the probability that a random searched pedestrian is
carrying a weapon: hrd = E[Prd | Prd > trd]; in other
words, the hit rate is the mean of the risk distribution
conditional on being above the threshold. The primary
goal of inference is to determine the latent thresholds
If the thresholds applied to one race group are
trd.
consistently lower than the thresholds applied to an-
other, this suggests discrimination against the group
with the lower thresholds.
In order to estimate the
decision thresholds, the risk distributions must be si-
multaneously inferred. In Simoiu et al. (2017), these
risk proﬁles take the form of beta distributions param-
eterized by means φrd = logit−1(φr + φd) and total
count parameters λrd = exp(λr + λd), where φr, φd,
λr, and λd are parameters that depend on the race of
the stopped individuals and the location of the stops.
Reparameterizing these risk distributions is the key to
accelerating inference. Given the number of searches
and hits by race and location, we can compute the
likelihood of the observed data under any set of model
parameters {φd, φr, λd, λr, trd}. One can likewise com-
pute the posterior distribution of the parameters given
the data and prior distributions.

Inference via Hamiltonian Monte Carlo.
Bayesian inference is challenging when the parame-
ter space is high dimensional, because random walk
MCMC methods fail to fully explore the complex pos-
terior in any reasonable time. This obstacle can be ad-
dressed with Hamiltonian Monte Carlo (HMC) meth-
ods (Neal et al., 2011; Betancourt and Girolami, 2015;
Chen et al., 2014), which propose new samples by
numerically integrating along the gradient of the log
posterior, allowing for more eﬃcient exploration. The
speed of convergence of HMC depends on three factors:
(1) the gradient computation time per integration step;

Fast Threshold Tests for Detecting Discrimination

with parameters φ, µ0, σ0, µ1, and σ1.
Deﬁnition 3.1 (Discriminant distribution). Consider
parameters φ ∈ (0, 1), µ0 ∈ R, σ0 ∈ R+, µ1 ∈ R, and
σ1 ∈ R+, where µ1 > µ0. The discriminant distribu-
tion disc(φ, µ0, σ0, µ1, σ1) is deﬁned as follows. Let

Y ∼ Bernoulli(φ),

X | Y = 0 ∼ N(µ0, σ0),

X | Y = 1 ∼ N(µ1, σ1).

Set g(x) = Pr(Y = 1 | X = x). Then the random
variable g(X) is distributed as disc(φ, µ0, σ0, µ1, σ1).

Our description above mirrors the motivation of lin-
ear discriminant analysis (LDA). Although it is com-
mon to consider the conditional probability of class
membership g(x), it is less common to consider the
distribution of these probabilities as an alternative to
beta or logit-normal distributions. To the best of our
knowledge, the computational properties of discrimi-
nant distributions have not been previously studied.

As in the case of LDA, the statistical properties of dis-
criminant distributions are particularly nice when the
underlying normal distributions have the same vari-
ance. Proposition 3.1 below establishes a key mono-
tonicity property that is standard in the development
of LDA; though the statement is well-known, we in-
clude it here for completeness. Proofs of this proposi-
tion and other technical statements are in the Supple-
mentary Information (SI).
Proposition 3.1 (Monotonicity). Given a discrimi-
nant distribution disc(φ, µ0, σ0, µ1, σ1), the mapping g
from signal space to probability space is monotonic if
and only if σ0 = σ1.

We conﬁne our attention to homoskedastic discrim-
inant distributions so that the mapping from signal
space to probability space will be monotonic. With-
out this property, we cannot interpret a threshold on
signal space as a threshold in probability space, which
is key to our analysis. Homoskedastic discriminant dis-
tributions (i.e., with σ0 = σ1) involve four parameters.
But in fact only two parameters are required to fully
describe this family of distributions. This simpliﬁed
parameterization is useful for computation.
Proposition 3.2 (2-parameter representation). Sup-
1, σ(cid:48)) are
pose disc(φ, µ0, σ, µ1, σ) and disc(φ(cid:48), µ(cid:48)
two homoskedastic discriminant distributions. Let

0, σ(cid:48), µ(cid:48)

δ =

µ1 − µ0
σ

and deﬁne δ(cid:48) analogously. Then the two distributions
are identical if φ = φ(cid:48) and δ = δ(cid:48). As a result, ho-
moskedastic discriminant distributions can be param-
eterized by φ and δ alone.

Given Proposition 3.2, we henceforth write disc(φ, δ)
to denote a homoskedastic discriminant distribution.
Considering disc(φ, δ) as a distribution of calibrated
predictions, the parameters have intuitive interpreta-
tions: φ is the fraction of individuals in the positive
class, while δ is monotonically related to the AUC-
ROC of the predictions1. Even though the distribution
itself depends on only φ and δ, the transformation g
from signal space to probability space depends on the
particular 4-parameter representation we use. For sim-
plicity, we consider the representation with µ0 = 0 and
σ = 1. This yields the simpliﬁed transformation func-
tion:

g(x) =

1 + 1−φ

φ exp (−δx + δ2/2)

.

1

Our primary motivation for introducing discriminant
distributions is to accelerate key computations of the
(complementary) CDF and conditional means. Let-
ting P = g(X), we are speciﬁcally interested in com-
puting Pr(P > t) and E[P | P > t]. With (ho-
moskedastic) discriminant distributions, these quan-
tities map nicely to signal space, where they can be
computed eﬃciently.
Denote by ¯Φ(x; µ, σ) the normal complementary CDF.
Then the complementary CDF of P can be computed
as follows.

Pr(P > t) = (1 − φ) ¯Φ(g−1(t); 0, 1) + φ ¯Φ(g−1(t); δ, 1).

For the conditional mean, we have

E[P | P > t] =

φ ¯Φ(g−1(t); δ, 1)
(1 − φ) ¯Φ(g−1(t); 0, 1) + φ ¯Φ(g−1(t); δ, 1)

.

Importantly, the CDF and conditional means for dis-
criminant distributions are closely related to those for
the normal distributions, and as such are computa-
tionally eﬃcient to work with. In particular, the gra-
dients of these functions are relatively straightforward
to evaluate. The corresponding quantities for logit-
normal and beta distributions involve tricky numerical
approximations (Frederic and Lad, 2008; Jones, 2009).

Finally, we show that discriminant distributions are
an expressive family of distributions (Fig. 2): they can
approximate typical instantiations of the logit-normal

1AUC-ROC is the probability that a random member
of the positive class is assigned a higher score than a ran-
dom member of the negative class. Since the positive and
negative class emit signals from independent normal distri-
butions, it’s straightforward to show that the AUC-ROC
equals Φ
(where Φ(·) is the CDF of the standard

(cid:17)

(cid:16) δ√
normal distribution).

2

Emma Pierson, Sam Corbett-Davies, Sharad Goel

Figure 2: Discriminant distributions can approxi-
mate the logit-normal(µ, σ) (left panels) and beta(φ, λ)
(right panels) distributions.
In the top row we il-
lustrate some typical distributions (solid lines) and
their discriminant distribution approximations (dashed
lines; some approximations are too accurate for lines
to be seen). In the bottom row we explore a wide range
of parameter values for distributions and report the to-
tal variation distance between the reference distribu-
tion and its discriminant distribution approximation.

and beta distributions. First, we select the parame-
ters of the reference distribution: (µ, σ) for the logit-
normal or (φ, λ) for the beta. Then we numerically
optimize the parameters of the discriminant distribu-
tion to minimize the total variation distance between
the reference distribution and the discriminant distri-
bution. The top row of Figure 2 shows some typical
densities and their approximations. The bottom row
investigates the approximation error for a wide range
of parameter values. The discriminant distribution ﬁts
the logit-normal very well (distance below 0.1 for all
distributions with σ ≤ 3), and the beta distribution
moderately well (distance below 0.2 for λ ≥ 1). Dis-
criminant distributions approximate logit-normal dis-
tributions particularly well because they form a subset
of logit-normal mixture distributions (SI).

4 STOP-AND-FRISK CASE STUDY

To demonstrate the value of discriminant distributions
for speeding up the threshold test, we analyze a pub-
lic dataset of pedestrian stops conducted by New York
City police oﬃcers under its “stop-and-frisk” practice.
Oﬃcers have legal authority to stop and brieﬂy detain
individuals when they suspect criminal activity. There
is worry, however, that such discretionary decisions
are prone to racial bias; indeed the NYPD practice
was recently ruled discriminatory in federal court and
subsequently curtailed (Floyd v. City of New York ,
2013; Goel et al., 2017). Here we revisit the statisti-
cal evidence for discrimination. Our dataset contains

Figure 3:
Inferred thresholds for frisks in the stop-
and-frisk data. Thresholds for white pedestrians are
plotted on the horizontal axis and thresholds for mi-
nority pedestrians in the same precinct are plotted on
the vertical axis. The dotted line denotes equal thresh-
olds. The size of each circle corresponds to the number
of stops of minority pedestrians. Axes are logarithmic.

information on 2.7 million police stops occurring be-
tween 2008 and 2012. Several variables are available
for each stop, including the race of the pedestrian, the
police precinct in which the stop occurred, whether the
pedestrian was “frisked” (patted-down in search of a
weapon), and whether a weapon was found. We an-
alyze stops of white, black, and Hispanic pedestrians,
as there are relatively few stops of individuals of other
races. We use the threshold test to analyze two de-
cisions: the initial stop decision, and the subsequent
decision of whether or not to conduct a frisk. Ana-
lyzing frisk decisions is a straightforward application
of the threshold test: simply replacing beta distribu-
tions in the model with discriminant distributions re-
sults in more than a 100-fold speedup. To analyze stop
decisions, we extend the threshold model to the case
where one does not observe negative examples (i.e.,
those who were not stopped) and show that discrimi-
nant distributions again produce signiﬁcant speedups.

4.1 Assessing bias in frisk decisions

We ﬁt the threshold models using Stan (Carpenter
et al., 2016), a language for full Bayesian statistical
inference via HMC. When using beta distributions in
the threshold test, it takes nearly two hours to infer the
model parameters; when we replace beta distributions
with discriminant distributions, inference completes in
under one minute. Why is it that discriminant distri-
butions result in such a dramatic increase in perfor-
mance? The compute time per eﬀective Monte Carlo
sample is the product of three terms:

seconds
neﬀ

=

samples
neﬀ

·

integration steps
sample

·

seconds
integration step

.

All three factors are signiﬁcantly reduced by using dis-
criminant distributions (Table 1), with the ﬁnal term
providing the most signiﬁcant reduction. (The reduc-
tion in the ﬁrst two terms is likely due to the geometry
of the underlying parameter space and the accuracy
with which we can numerically approximate gradients

Fast Threshold Tests for Detecting Discrimination

Table 1: Sampling times for the frisk decision model.
Each row reports the improvement for the discrimi-
nant distribution model relative to the beta distribution
model followed by the statistics for both models. The
ﬁrst row reports the seconds per eﬀective sample, which
is the product of the numbers in the second to fourth
rows. The ﬁnal row reports the time to ﬁt the models
used in our analysis using 5 chains run in parallel for
5,000 samples. Sampling was performed on a server
with two Intel Xeon E5 processors with 16 cores each.

Seconds/neff
Samples/neff
Integration steps/sample
Seconds/integration step
Seconds to fit model

Speedup
760x
5x
3x
53x
143x

Beta
26
22
152
0.008
5,977

Disc
0.03
5
49
0.0001
42

for the beta and discriminant distributions.) Using
discriminant distributions reduces the time per eﬀec-
tive sample by a factor of 760. In practice, one typi-
cally runs chains in parallel, and so total running time
is determined by the last chain to terminate. When
running ﬁve chains in parallel for 5,000 iterations each,
the accelerated model is faster by a factor of 140.

The thresholds inferred using the accelerated model
are extremely highly correlated with the thresholds in-
ferred under the original model (correlation = 0.95),
and indicate discrimination against black and Hispanic
individuals. (In general, we would not expect the orig-
inal and accelerated models to yield identical results
on all datasets, since they use diﬀerent probability dis-
tributions, so the fact that the thresholds are highly
correlated serves as a robustness check.) Figure 3
shows the inferred thresholds (under the accelerated
model). Each point corresponds to the threshold for
one precinct, with the threshold for white pedestrians
on the horizontal axis and for minority pedestrians on
the vertical axis. Within precinct, thresholds for mi-
nority pedestrians are consistently lower than thresh-
olds for white pedestrians.

Robustness checks. To evaluate the robustness of
our substantive ﬁnding of bias in frisk decisions, we
perform a series of checks for threshold tests recom-
mended by Simoiu et al. (2017); we include all ﬁgures
in the SI. We start by conducting posterior predictive
checks (Gelman et al., 1996). We compute the model-
inferred frisk and hit rates for each precinct and race
group, and compare these to the observed rates (SI
Figure 1). The model almost perfectly ﬁts the ob-
served frisk rates, and ﬁts the observed hit rates quite
well: The RMSE of frisk rates is 0.05%, and the RMSE
of hit rates is 2.5%.
(RMSEs for the original beta
model are comparable: the RMSE for frisk rates is
0.1%, and the RMSE for hit rates is 2.4%). For com-
parison, if the model of Simoiu et al. (2017) is ﬁt with

variational inference—rather than HMC, to speed up
inference—the frisk rate RMSE is 0.15% (a 3-fold in-
crease), and the hit rate RMSE is 2.6% (on par with
HMC). Variational inference ﬁts the model of Simoiu
et al. (2017) in 44 seconds, comparable to the runtime
with HMC and discriminant distributions.

The stylized behavioral model underlying the thresh-
old test posits a single frisk threshold for each race-
In reality, oﬃcers within a precinct
precinct pair.
might apply diﬀerent thresholds, and even the same
oﬃcer might vary the threshold from one stop to the
next. Moreover, oﬃcers only observe noisy approx-
imations of a stopped pedestrian’s likelihood of car-
rying a weapon; such errors can be equivalently re-
cast as variation in the frisk threshold applied to the
true probability. To investigate the robustness of our
results to such heterogeneity, we next examine the
stability of our inferences on synthetic datasets de-
rived from a generative process with varying thresh-
olds. We start with the model ﬁt to the actual data.
Then, for each observed stop, we draw a signal p from
the inferred signal distribution for the precinct d in
which the stop occurred and the race r of the pedes-
trian. Second, we set the stop-speciﬁc threshold to
T ∼ logit-normal(logit(trd), σ), where trd is the in-
ferred threshold, and σ is a parameter we set to control
the degree of heterogeneity in the thresholds. This cor-
responds to adding normally-distributed noise to the
inferred threshold on the logit scale. Third, we assume
a frisk occurs if and only if p ≥ T , and if a frisk is con-
ducted, we assume a weapon is found with probability
p. Finally, we use our modeling framework to infer
new frisk thresholds t(cid:48)

rd for the synthetic dataset.

There is a steady decrease in inferred thresholds as
the noise increases (SI Figure 2). Importantly, how-
ever, there is a persistent gap between whites and mi-
norities despite this decline, indicating that the lower
thresholds for minorities are robust to heterogeneity
in frisk thresholds. σ = 1 is a substantial amount of
noise. Decreasing the frisk threshold of blacks by 1 on
the logit scale corresponds to a 3-fold increase in the
city-wide frisk rate of blacks.

In theory, the threshold test is robust to unobserved
heterogeneity that aﬀects the signal, since we eﬀec-
tively marginalize over any omitted variables when es-
timating the signal distribution. However, we must
still worry about systematic variation in the thresh-
olds that is correlated with race. For example, if oﬃ-
cers apply a lower frisk threshold at night, and black
individuals are disproportionately likely to be stopped
at night, then blacks would, on average, experience a
lower frisk threshold than whites even in the absence
of discrimination. Fortunately, as a matter of policy
only a limited number of factors may legitimately af-

Emma Pierson, Sam Corbett-Davies, Sharad Goel

fect the frisk thresholds, and many—but not all—of
these are recorded in the data. There are a multitude
of hard-to-quantify factors (such as behavioral cues)
that may aﬀect the signal—but these should not af-
fect the threshold.

We examine the robustness of our results to variation
in thresholds across year, time-of-day, and age and
gender of the stopped pedestrian.2 To do so, we disag-
gregate our primary dataset by year (and, separately,
by time-of-day, by age, and by gender), and then inde-
pendently run the threshold test on each component
(SI Figure 3). The inferred thresholds do indeed vary
across the diﬀerent subsets of the data. However, in
every case, the thresholds for frisking blacks and His-
panics are lower than the thresholds for frisking whites,
corroborating our main results.

Finally, we conduct two placebo tests, where we re-
run the threshold test with race replaced by day-of-
week, and separately, with race replaced by month.
The hope is that the threshold test accurately cap-
tures a lack of “discrimination” based on these fac-
tors. The model indeed ﬁnds that the threshold for
frisking individuals is relatively stable by day-of-week,
with largely overlapping credible intervals (SI Figure
4). We similarly ﬁnd only small diﬀerences in the in-
ferred monthly thresholds. Some variation is expected,
as oﬃcers might legitimately apply slightly diﬀerent
frisk standards throughout the week or year.

4.2 Assessing bias in stop decisions

We now extend the threshold model to test for dis-
crimination in an oﬃcer’s decision to stop a pedes-
trian. In contrast to frisk decisions, we do not observe
instances in which an oﬃcer decided not to carry out
a stop. Inferring thresholds with such censored data is
analogous to learning classiﬁers from only positive and
unlabeled examples (Elkan and Noto, 2008; Mordelet
and Vert, 2014; du Plessis et al., 2014). We assume
oﬃcers are equally likely to encounter anyone in a
precinct. Coupled with demographic data compiled by
the U.S. Census Bureau, this assumption lets us esti-
mate the racial distribution of individuals encountered
by oﬃcers. Such estimates are imperfect, in part be-
cause residential populations diﬀer from daytime pop-
ulations (Bhaduri, 2008); however, our inferences are
robust to violations of this assumption.

Model description. When analyzing frisk deci-
sions, the decision itself and the success of a frisk were
modeled as random outcomes. For stops, we model as

2Variation across location is explicitly captured by the
model. Gender, like race, is generally not considered a
valid criterion for altering the frisk threshold, though for
completeness we still examine its eﬀects on our conclusions.

random the race of stopped individuals and whether
a stop was successful (i.e., turned up a weapon). The
likelihood of the observed outcomes can then be com-
puted under any set of model parameters, which allows
us to compute posterior parameter estimates. Let Srd
denote the number of stops of individuals of race r
in precinct d, and let Hrd denote the number of such
stops that yield a weapon. We denote by crd the frac-
tion of people in a precinct of a given race. Letting Rd
denote the race of an individual randomly encountered
by the police in precinct d, we have

Pr(Rd = r | stopped) ∝ Pr(stopped | Rd = r) Pr(Rd = r).

Assuming oﬃcers are equally likely to encounter ev-
eryone in a precinct, Pr(Rd = r) = crd. We fur-
ther assume that individuals of race r are stopped
when their probability of carrying a weapon exceeds a
race- and precinct-speciﬁc threshold trd; this assump-
tion mirrors the one made for the frisk model. Setting
θrd = Pr(Rd = r | stopped), we have

θrd ∝ crd · Pr(stopped | Rd = r)

Pr(stopped | Rd = r) = (1 − φrd) ¯Φ(trd; 0, 1)
+ φrd ¯Φ(trd; δrd, 1).

For each precinct d, the racial composition of stops is
thus distributed as a multinomial:

(cid:126)Sd ∼ multinomial

(cid:16)(cid:126)θd, Nd

(cid:17)

where Nd denotes the total number of stops conducted
in that precinct, (cid:126)θd is a vector of race-speciﬁc stop
probabilities θrd, and (cid:126)Sd is the number of stops of each
race group in that precinct. We model hits as in the
frisk model. We put normal or half-normal priors on
all the parameters: {φd, φr, λd, λr, trd}.3

Results. We apply the above model to the subset of
approximately 723,000 stops predicated on suspected
criminal possession of a weapon, as indicated by oﬃ-
cers. In these cases, the stated objective of the stop
is discovery of a weapon, and so we consider a stop
successful if a weapon was discovered (Goel et al.,
2016). We estimate the racial composition of precincts
using data from the 2010 U.S. Census.
In Table 2
we compare the time to ﬁt our stop model with dis-
criminant distributions rather than beta distributions.
The speedup from using discriminant distributions is

3 Following Simoiu et al. (2017) and Pierson et al.
(2017), we put weakly informative priors on φr, λr, and
trd; we put tighter priors on the location parameters φd
and λd to restrict geographical heterogeneity and to accel-
erate convergence.

Fast Threshold Tests for Detecting Discrimination

Table 2: Breakdown of sampling times for the stop
model. Each row reports the improvement for the dis-
criminant distribution model relative to the beta distri-
bution model followed by the statistics for both models.

Seconds/neff
Samples/neff
Integration steps/sample
Seconds/integration step
Seconds to fit model

Speedup
84x
1x
2x
37x
77x

Beta
55
18
503
0.006
15,943

Disc
0.7
17
237
0.0002
208

dramatic: with beta distributions, the model requires
more than 4 hours to ﬁt; with discriminant distri-
butions it takes under 4 minutes. The primary rea-
son for the speedup is the reduced time per gradient
evaluation, although the number of gradient evalua-
tions is also reduced. As with frisk decisions, we ﬁnd
stop thresholds for blacks and Hispanics are consis-
tently lower than for whites, suggestive of discrimina-
tion (Figure 4). Our results are in line with those from
past statistical studies of New York City’s stop-and-
frisk practices based on benchmark (Gelman et al.,
2007) and outcome (Goel et al., 2016) analysis.

Figure 4: Inferred stop thresholds in the stop-and-frisk
data. The size of each circle corresponds to the minor-
ity population in each precinct. Axes are logarithmic.

Robustness checks. A key assumption of our stop
model is that the racial composition of the residen-
tial population (as estimated by the U.S. Census) is
similar to the racial composition of pedestrians oﬃ-
cers encounter on the street. We test how sensitive
our inferred thresholds are to this assumption by reﬁt-
ting the stop model with various estimates of the frac-
tion of white individuals encountered in each precinct.
Letting cwhite,d denote the original Census estimate,
we varied this number from cwhite,d/2 to 2cwhite,d.
The inferred thresholds remain stable, with thresh-
olds for blacks and Hispanics consistently lower than
for whites: thresholds for whites varied from 5.7% to
6.1%, thresholds for blacks from 0.8% to 1.2%, and
thresholds for Hispanics from 1.8% to 2.1%. This sta-
bility is in part due to the fact that altering assump-
tions about the base population does not change the
observed hit rates, which are substantially higher for
whites. We also ran the robustness checks outlined in
Simoiu et al. (2017): posterior predictive checks, tests
for threshold heterogeneity, and tests for omitted vari-
able bias (SI Figures 5–7). In all cases, the results con-

ﬁrm our main ﬁndings. Standard placebo tests cannot
be run in this setting because natural placebos (such
as month) eliminate all heterogeneity across groups,
breaking model identiﬁability.

As with the frisk model, HMC inference with discrim-
inant distributions yields better model ﬁt than varia-
tional inference with beta distributions. Though vari-
ational inference ﬁts more quickly (30 seconds vs. 208
seconds), with variational inference the RMSE of stop
rates is four times larger (0.9% vs. 0.2%), and the
RMSE of hit rates is twice as large (1.3% vs. 0.8%).
(For comparison, the RMSE of the original beta model
for stop rates is 0.2% and the RMSE of the hit rates
is 0.7%). These performance gaps illustrate the value
of full Bayesian inference over approximate methods.

5 CONCLUSION

We introduced and analyzed discriminant distribu-
tions to accelerate threshold tests for discrimination.
The CDF and conditional means of discriminant distri-
butions reduce to simple expressions that are no more
diﬃcult to evaluate than the equivalent statistics for
normal distributions. Consequently, using discrimi-
nant distributions speeds up inference in the thresh-
old test by more than 75-fold. It is now practical to
use the threshold test to investigate bias in a wide
variety of settings. Practitioners can quickly carry
out analysis—including computationally expensive ro-
bustness checks—on low-cost hardware within min-
utes. Our test also scales to previously intractable
datasets, such as the national traﬃc stop database of
Pierson et al. (2017). We also extended the threshold
test to domains in which actions are only partially ob-
served, allowing us to assess possible discrimination in
an oﬃcer’s decision to stop a pedestrian.

Tools for black box Bayesian inference are allowing
inference for increasingly complicated models. As re-
searchers embrace this complexity, there is opportu-
nity to consider new distributions. Historical default
distributions—often selected for convenient properties
like conjugacy—may not be the best choices when us-
ing automatic inference. An early example of this
was the Kumaraswamy distribution (Jones, 2009; Ku-
maraswamy, 1980), developed as an alternative to the
beta distribution for its simpler CDF. Discriminant
distributions may also oﬀer computational speedups
beyond the threshold test as automatic inference en-
joys increasingly widespread use.

Code and acknowledgments: Code is available
at https://github.com/5harad/fasttt. We thank Peng
Ding, Avi Feller, Pang Wei Koh, and the reviewers
for helpful comments, and the John S. and James L.
Knight, Hertz, and NDSEG Foundations.

Emma Pierson, Sam Corbett-Davies, Sharad Goel

References

G. S. Becker, The economics of discrimination. Uni-

versity of Chicago Press, 1957.

C. Simoiu, S. Corbett-Davies, and S. Goel, “The prob-
lem of infra-marginality in outcome tests for dis-
crimination,” Annals of Applied Statistics, 2017,
forthcoming.

C. Elkan and K. Noto, “Learning classiﬁers from only
positive and unlabeled data,” in Proceedings of the
14th ACM SIGKDD. ACM, 2008, pp. 213–220.

F. Mordelet and J.-P. Vert, “A bagging SVM to
learn from positive and unlabeled examples,” Pat-
tern Recognition Letters, vol. 37, pp. 201–209, 2014.

M. C. du Plessis, G. Niu, and M. Sugiyama, “Anal-
ysis of learning from positive and unlabeled data,”
in Advances in Neural Information Processing Sys-
tems, 2014, pp. 703–711.

E. Pierson, C. Simoiu, J. Overgoor, S. Corbett-Davies,
V. Ramachandran, C. Phillips, and S. Goel, “A
large-scale analysis of racial disparities in police
stops across the united states,” Working paper,
2017.

G. S. Becker, “Nobel lecture: The economic way of
looking at behavior,” Journal of Political Economy,
pp. 385–409, 1993.

I. Ayres, “Outcome tests of racial disparities in police
practices,” Justice Research and Policy, vol. 4, no.
1-2, pp. 131–142, 2002.

S. Anwar and H. Fang, “An alternative test of racial
prejudice in motor vehicle searches: Theory and ev-
idence,” The American Economic Review, vol. 96,
no. 1, pp. 127–151, 2006.

R. S. Engel, “A critique of the outcome test in racial
proﬁling research,” Justice Quarterly, vol. 25, no. 1,
pp. 1–36, 2008.

S. Anwar and H. Fang, “Testing for the role of
prejudice in emergency departments using bounce-
back rates,” National Bureau of Economic Research,
Tech. Rep., 2011.

——, “Testing for racial prejudice in the parole board
release process: Theory and evidence,” The Journal
of Legal Studies, vol. 44, no. 1, pp. 1–37, 2015.

D. Arnold, W. Dobbie, and C. S. Yang, “Racial bias
in bail decisions,” 2017, NBER working paper, avail-
able at http://www.nber.org/papers/w23421.

R. M. Neal et al., “MCMC using Hamiltonian dy-
namics,” Handbook of Markov Chain Monte Carlo,
vol. 2, pp. 113–162, 2011.

M. Betancourt and M. Girolami, “Hamiltonian Monte
Carlo for hierarchical models,” Current trends in
Bayesian methodology with applications, vol. 79,
p. 30, 2015.

T. Chen, E. B. Fox, and C. Guestrin, “Stochastic Gra-
dient Hamiltonian Monte Carlo.” in ICML, 2014,
pp. 1683–1691.

M. Betancourt,

“A conceptual
Hamiltonian Monte Carlo,”
arXiv:1701.02434, 2017.

introduction to
preprint
arXiv

M. J. Wainwright, M. I. Jordan et al., “Graphical
models, exponential families, and variational infer-
ence,” Foundations and Trends in Machine Learn-
ing, vol. 1, no. 1–2, pp. 1–305, 2008.

R. J. Boik and J. F. Robison-Cox, “Derivatives of
the incomplete beta function,” Journal of Statistical
Software, vol. 3, no. 1, pp. 1–20, 1998.

P. Frederic and F. Lad, “Two moments of the logit-
normal distribution,” Communications in Statistics
– Simulation and Computation, vol. 37, no. 7, pp.
1263–1269, 2008.

M. Jones, “Kumaraswamy’s distribution: A beta-type
distribution with some tractability advantages,”
Statistical Methodology, vol. 6, no. 1, pp. 70–81,
2009.

Floyd v. City of New York, “959 F. Supp. 2d 540 -

Dist. Court, SD New York,” 2013.

S. Goel, M. Perelman, R. Shroﬀ, and D. A. Sklansky,
“Combatting police discrimination in the age of big
data,” New Criminal Law Review, vol. 20, no. 2, pp.
181–232, 2017.

B. Carpenter, A. Gelman, M. Hoﬀman, D. Lee,
B. Goodrich, M. Betancourt, M. A. Brubaker,
J. Guo, P. Li, and A. Riddell, “Stan: A probabilistic
programming language,” Journal of Statistical Soft-
ware, vol. 20, 2016.

A. Gelman, X.-L. Meng, and H. Stern, “Posterior pre-
dictive assessment of model ﬁtness via realized dis-
crepancies,” Statistica sinica, pp. 733–760, 1996.

B. Bhaduri, “Population distribution during the day,”
Springer, 2008, pp. 880–

in Encyclopedia of GIS.
885.

S. Goel, J. M. Rao, and R. Shroﬀ, “Precinct or preju-
dice? Understanding racial disparities in New York
City’s stop-and-frisk policy,” The Annals of Applied
Statistics, vol. 10, no. 1, pp. 365–394, 2016.

A. Gelman, J. Fagan, and A. Kiss, “An analysis of
the New York City police department’s stop-and-
frisk policy in the context of claims of racial bias,”
Journal of the American Statistical Association, vol.
102, no. 479, pp. 813–823, 2007.

Fast Threshold Tests for Detecting Discrimination

A. Kucukelbir, D. Tran, R. Ranganath, A. Gelman,
and D. M. Blei, “Automatic diﬀerentiation varia-
tional inference,” arXiv preprint arXiv:1603.00788,
2016.

P. Kumaraswamy, “A generalized probability density
function for double-bounded random processes,”
Journal of Hydrology, vol. 46, no. 1-2, pp. 79–88,
1980.

