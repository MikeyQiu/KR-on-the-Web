Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed
Bandit Problem with Multiple Plays

9
1
0
2
 
r
a

M
 
0
2
 
 
]
L
M

.
t
a
t
s
[
 
 
3
v
9
7
7
0
0
.
6
0
5
1
:
v
i
X
r
a

Junpei Komiyama
Junya Honda
Hiroshi Nakagawa
The University of Tokyo, Japan

JUNPEI@KOMIYAMA.INFO
HONDA@STAT.T.U-TOKYO.AC.JP
NAKAGAWA@DL.ITC.U-TOKYO.AC.JP

Abstract

We discuss a multiple-play multi-armed ban-
dit (MAB) problem in which several arms are
selected at each round. Recently, Thompson
sampling (TS), a randomized algorithm with a
Bayesian spirit, has attracted much attention for
its empirically excellent performance, and it is
revealed to have an optimal regret bound in the
standard single-play MAB problem. In this pa-
per, we propose the multiple-play Thompson
sampling (MP-TS) algorithm, an extension of TS
to the multiple-play MAB problem, and discuss
its regret analysis. We prove that MP-TS for bi-
nary rewards has the optimal regret upper bound
that matches the regret lower bound provided
by Anantharam et al. (1987). Therefore, MP-
TS is the ﬁrst computationally efﬁcient algorithm
with optimal regret. A set of computer simula-
tions was also conducted, which compared MP-
TS with state-of-the-art algorithms. We also pro-
pose a modiﬁcation of MP-TS, which is shown
to have better empirical performance.

1. Introduction

The multi-armed bandit (MAB) problem is one of the most
well-known instances of sequential decision-making prob-
lems in uncertain environments, which can model many
real-world scenarios. The problem involves conceptual en-
tities called arms. At each round, the forecaster draws one
of K arms and receives a corresponding reward. The aim
of the forecaster is to maximize the cumulative reward over
rounds, and the forecaster’s performance is usually mea-
sured by a regret, which is the gap between his or her
cumulative reward and that of an optimal drawing policy.

Throughout the rounds, the forecaster faces an “exploration
vs. exploitation” dilemma. On one hand, the forecaster
wants to exploit the information that he or she has gath-
ered up to the previous round by selecting seemingly good
arms. On the other hand, there is always a possibility that
the other arms have been underestimated, which motivates
him or her to explore seemingly bad arms in order to gather
their information. To resolve this dilemma, the forecaster
uses an algorithm to control the number of draws for each
arm.

In the stochastic MAB problem, which is the most widely
studied version of the MAB problem, it is assumed that
each arm is associated with a distinct probability distribu-
tion. While there have been many theoretical studies on the
inﬁnite setting in which future rewards are geometrically
discounted (e.g., the Gittins index (Gittins & Jones, 1974)),
recent availability of massive data has led to a ﬁnite horizon
setting in which every reward has the same importance. In
this work, we focus on the latter setting.

There has been signiﬁcant progress in this setting of the
MAB problem. In particular, the upper conﬁdence bound
(UCB) algorithm (Auer et al., 2002) has been widely used
and studied for its computational simplicity and customiz-
ability. Whereas the coefﬁcient of the leading logarithmic
term in UCB is larger than the theoretical lower bound
given by Lai & Robbins (1985), algorithms have been pro-
posed that achieve this bound, such as DMED (Honda &
Takemura, 2010), Kinf, and KL-UCB (Capp´e et al., 2013).

Moreover, Thompson sampling (TS) (Thompson, 1933)
has recently attracted attention for its excellent perfor-
mance (Scott, 2010; Chapelle & Li, 2011) and it has been
revealed to be applicable to even a wider class of problems
(Agrawal & Goyal, 2013a; Russo & Roy, 2013; Osband
et al., 2013; Koc´ak et al., 2014; Guha & Munagala, 2014).
Thompson sampling is an old heuristic that has a spirit of
Bayesian inference and selects an arm based on posterior
samples of the expectation of each arm. It has been shown
that TS has an optimal regret bound (Agrawal & Goyal,

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

2012; Kaufmann et al., 2012; Agrawal & Goyal, 2013b).

1.1. Multiple-play MAB problem

The literature mentioned above has speciﬁcally dealt with
the MAB problem in which a single arm is selected and
drawn at each round. Let us call this problem single-play
MAB (SP-MAB). While the SP-MAB problem is indis-
putably important as a canonical problem, in many prac-
tical situations multiple entities corresponding to arms are
selected at each round. We call the MAB problem in
which several arms can be selected multiple-play MAB
(MP-MAB). Examples of the situations that can be mod-
eled as an MP-MAB problem include the followings.

• Example 1 (placement of online advertisements): a
web site has several slots where advertisements can
be placed. Based on each user’s query, there is a set
of candidates of relevant advertisements from which
web sites can select to display. The effectiveness of
advertisements varies: some advertisements are more
appealing to the user than others. With the standard
model in online advertising, it is assumed that each
advertisement is associated with a click-through-rate
(CTR), which is the number of clicks per view. Since
web sites receive revenue from clicks on advertise-
ments, it is natural to maximize it, which can be con-
sidered as an instance of an MP-MAB problem in
which advertisements and clicks correspond to arms
and rewards, respectively.

• Example 2 (channel selection in cognitive radio
networks (Huang et al., 2008)): a cognitive radio
is an adaptive scheme for allocating channels, such
as wireless network spectrums. There are two kinds
of users: primary and secondary. Unlike primary
users, secondary users do not have primary access to
a channel but can take advantage of the vacancies in
primary access and opportunistically exploit instanta-
neous spectrum availability when primary users are
idle. However, the availabilities of channels are not
easily known. Usually, secondary users have access
to multiple channels. They can enhance their commu-
nication efﬁciency by adaptively estimating the avail-
ability statistics of the channels, which can be con-
sidered as an MP-MAB problem in which channels
and the permission of communication are arms and
rewards, respectively.

There have been several studies on the MP-MAB prob-
lem. Anantharam et al. (1987) derived an asymptotic lower
bound on the regret for this problem and proposed an al-
gorithm to achieve this bound. Because their algorithm
requires certain statistics that are difﬁcult to compute, ef-
ﬁciently computable MP-MAB algorithms have also been
extensively studied. Chen et al. (2013) extended a UCB-

based algorithm to a multiple-play case with combinatorial
rewards and Gopalan et al. (2014) extended TS to a wide
class of problems. Although both papers provide a loga-
rithmic regret bound, the constant factors of these regret
bounds do not match the lower bound. Therefore, it is un-
known whether the optimal regret bound for the MP-MAB
problem is achievable by using a computationally efﬁcient
algorithm.

The main difﬁculty in analyzing the MP-MAB problem
lies in the fact that the regret depends on the combinato-
rial structure of arm draws. More speciﬁcally, an algorithm
with the optimal bound on the number of draws of subopti-
mal arms does not always ensure the optimal regret bound
unlike the SP-MAB problem.

Contribution: Our contributions are as follows.

• TS-based algorithm for the MP-MAB problem and
its optimal regret bound: the ﬁrst and main contri-
bution of this paper is an extension of TS to the mul-
tiple play case, which we call MP-TS. We prove that
MP-TS for binary rewards achieves an optimal regret
bound. To the best of our knowledge, this paper is
the ﬁrst to provide a computationally efﬁcient algo-
rithm in the MP-MAB problem with the optimal regret
bound by Anantharam et al. (1987).

• Novel analysis technique: to solve the difﬁculty in
the combinatorial structure of the MP-MAB problem,
we show that the independence of posterior samples
among arms in TS is a key property for suppressing
the number of simultaneous draws of several subopti-
mal arms, and the use of this property eventually leads
to the optimal regret bound.

• Experimental comparison among MP-MAB algo-
rithms: we compare MP-TS with other algorithms,
and conﬁrm its efﬁciency. We also propose an em-
pirical improvement of MP-TS (IMP-TS) motivated
by analyses on the regret structure of the MP-MAB
problem. We conﬁrm that IMP-TS improves the per-
formance of MP-TS without increasing computational
complexity.

2. Problem Setup

there be K arms.

Each arm i ∈ [K] =
Let
{1, 2, . . . , K} is associated with a probability distribution
νi = Bernoulli(µi), µi ∈ (0, 1). At each round t =
1, 2, . . . , T , the forecaster selects a set of L < K arms
I(t), then receives the rewards of the selected arms. The
reward Xi(t) of each selected arm i is i.i.d. samples from
νi. Let Ni(t) be the number of draws of arm i before round
t (i.e., Ni(t) = (cid:80)t−1
t(cid:48)=1 1{i ∈ I(t(cid:48))}, where 1{A} = 1 if
event A holds and = 0 otherwise.), and ˆµi(t) be the em-
pirical mean of the rewards of arm i at the beginning of
round t. The forecaster is interested in maximizing the sum

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

of rewards over drawn arms. For simplicity, we assume
that all arms have distinct expected rewards (i.e., µi (cid:54)= µj
for any i (cid:54)= j). We discuss the case in which µi = µj
for some i and j in Appendix A.1, which is in Supple-
mentary Material. Without loss of generality, we assume
µ1 > µ2 > µ3 > · · · > µK. Of course, algorithms do
not exploit this ordering. We deﬁne optimal arms as top-
L arms (i.e., arms [L]), and suboptimal arms as the others
(i.e., arms [K] \ [L]). The regret, which is the expected loss
of the forecaster, is deﬁned as

Reg(T ) =

T
(cid:88)







(cid:88)

µi −

(cid:88)

µi

 .

t=1

i∈[L]

i∈I(t)

The expectation of regret E[Reg(T )] is used to measure the
performance of an algorithm.

3. Regret Bounds

In this section we introduce the known lower bounds of
the regret for the SP-MAB and MP-MAB problems and
discuss the relation between them.

3.1. Regret bound for SP-MAB problem

The SP-MAB problem, which has been thoroughly studied
in the ﬁelds of statistics and machine learning, is a special
case of the MP-MAB problem with L = 1. The optimal
regret bound in the SP-MAB problem was given by Lai &
Robbins (1985). They proved that, for any strongly consis-
tent algorithm (i.e., algorithms with subpolynomial regret
for any set of arms), there exists a lower bound

E[Ni(T + 1)] ≥

log T,

(1)

(cid:19)

(cid:18) 1 − o(1)
d(µi, µ1)

where d(p, q) = p log (p/q)+(1−p) log ((1 − p)/(1 − q))
is the KL divergence between two Bernoulli distributions
with expectation p and q. Note that when arm i is drawn,
the regret increases by ∆i,1 and the regret is written as

E[Reg(T )] =

Ni(T + 1)∆i,1,

(2)

(cid:88)

i(cid:54)=1

where ∆i,j = µj − µi. Therefore, inequality (1) directly
leads to the regret lower bound

E[Reg(T )] ≥

(cid:18) (1 − o(1))∆i,1
d(µi, µ1)

(cid:19)

(cid:88)

i(cid:54)=1

log T.

(3)

One may think that applying the techniques of the SP-MAB
problem would directly yield an optimal bound for a more
general MP-MAB problem. However, this is not the case.
In short, the difﬁculty in analyzing the regret on the MP-
MAB problem arises from the fact that the optimal bound

Figure 1. Two bandit games with the same set of arms. r(t) is
deﬁned as the increase in the regret at round t. In both games
1 and 2, we have the same number of suboptimal arm draws
(N3(2) = N4(2) = 1). However, the regret in games 1 and 2
are different.

on the number of suboptimal arm draws does not directly
lead to the optimal regret. From this point forward, we
focus on the MP-MAB problem in which L is not restricted
to one.

3.2. Extension to MP-MAB problem

The regret lower bound in the MP-MAB problem, which is
the generalization of inequality (3), was provided by Anan-
tharam et al. (1987). They ﬁrst proved that, for any strongly
consistent algorithm and suboptimal arm i, the number of
arm i draws is lower-bounded as

E[Ni(T + 1)] ≥

log T.

(4)

(cid:19)

(cid:18) 1 − o(1)
d(µi, µL)

Unlike in the SP-MAB problem, the regret in the MP-MAB
problem is not uniquely determined by the number of sub-
optimal arm draws. As illustrated in Figure 1, the regret is
dependent on the combinatorial structure of arm draws.

Recall that a regret increase at each round is the gap of ex-
pected rewards between the optimal arms and that of the
selected arms. When a suboptimal arm is selected, one op-
timal arm is excluded from I(t) instead of the suboptimal
arm. Let the selected suboptimal arm and excluded opti-
mal arm be i and j, respectively. Then, we lose expected
reward µj − µi. Namely, the loss in the expected reward at
each round is given by

(cid:88)

µj −

(cid:88)

µi =

(cid:88)

µj −

(cid:88)

µi

j∈[L]

i∈I(t)

i∈I(t)\[L]

≥

(µL − µi),

(5)

j∈[L]\I(t)
(cid:88)

i∈I(t)\[L]

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Algorithm 1 Multiple-play Thompson sampling (MP-TS)
for binary rewards

Input: # of arms K, # of selection L
for i = 1, 2, . . . , K do

Ai, Bi = 1, 1

end for
t ← 1.
for t = 1, 2, . . . , T do

for i = 1, 2, . . . , K do

θi(t) ∼ Beta(Ai, Bi)

end for
I(t) = top-L arms ranked by θi(t).
for i ∈ I(t) do

if Xi(t) = 1 then
Ai ← Ai + 1

else

Bi ← Bi + 1

end if
end for

end for

where we used the fact µj ≥ µL for any optimal arm j.
From this relation, the regret is expressed as

Reg(T ) ≥

(µL − µi)

T
(cid:88)

(cid:88)

t=1

i∈I(t)\[L]

(cid:88)

=

i∈[K]\[L]

(µL − µi)Ni(T + 1)

(6)

which, combined with (4), leads to the regret lower bound
by Anantharam et al. (1987) that any strongly consistent
algorithm satisﬁes

E[Reg(T )] ≥

(cid:88)

i∈[K]\[L]

(1 − o(1))∆i,L
d(µi, µL)

log T.

(7)

3.3. Necessary condition for an optimal algorithm

In Sections 3.1 and 3.2, we saw that the derivations of
the regret bounds are analogous between the SP-MAB and
MP-MAB problems. However, there is a difference in the
relation between the regret and Ni(T ), the number of draws
of suboptimal arms, is given as equation (2) in the SP-MAB
problem, whereas it is given as inequality (6) in the MP-
MAB problem. This means that, an algorithm achieving
the asymptotic lower bound (4) on Ni(T ) does not always
achieve the asymptotic regret bound (7).

When suboptimal arm i is selected, one of the optimal arms
is pushed out instead of arm i, and the regret increases by
the difference between the expected rewards of these two
arms. The best scenario is that, arm L, which is the optimal
arm with the smallest expected reward, is almost always

the arm pushed out instead of a suboptimal arm. For this
scenario to occur, it is necessary to ensure that at most one
suboptimal arm is drawn for almost all rounds because, if
two suboptimal arms are selected, at least one arm in [L−1]
is pushed out.

In the next section, we propose an extension of TS to the
MP-MAB problem, and explain that it has a crucial prop-
erty for suppressing this simultaneous draw of two subop-
timal arms.

Remark: Corollary 1 of Gopalan et al. (2014) shows the
achievability of the bound in the RHS of (4) on the num-
ber of draws of suboptimal arms. Whereas this does not
lead to the optimal regret bound as discussed above, they
originally derived in Theorem 1 an O(log T ) bound on the
number of each suboptimal action (that is, each combina-
tion of arms including suboptimal ones) for a more general
setting of MP-MAB. Thus, we can directly use this bound
to derive a better regret bound. However, to show the op-
timality in the sense of regret it is necessary to prove that
there are at most o(log T ) rounds such that an arm in [L−1]
is pushed out. Therefore, it still requires further discussion
to derive the optimal regret bound of TS. Note also that the
regret bound by Gopalan et al. (2014) is restricted to the
case that the prior has a ﬁnite support and the true param-
eter is in the support, and thus their analysis requires some
approximation scheme for dealing Bernoulli rewards.

4. Multiple-play Thompson Sampling

Algorithm

Algorithm 1 is our MP-TS algorithm. While TS for single-
play selects the top-1 arm based on a posterior sample θi(t),
MP-TS selects the top-L arms ranked by the posterior sam-
ple θi(t). Like Kaufmann et al. (2012) and Agrawal &
Goyal (2013b), we set the uniform prior on each arm.

In Section 3.3, we discussed that the necessary condition
to achieve the optimal regret bound is to suppress the si-
multaneous draws of two or more suboptimal arms, which
characterizes the difﬁculty of the MP-MAB problem.

Note that it is easy to extend other asymptotically opti-
mal SP-MAB algorithms, such as KL-UCB, to the MP-
MAB problem. Nevertheless, we were not able to prove
the optimality of these algorithms for the MP-MAB prob-
lem though the achievability of the bound (4) on Ni(T ) is
easily proved, and the simulation results in Section 7 also
imply their achievability of the regret bound. This is be-
cause TS has quite a plausible property to suppress simul-
taneous draws as we discuss below.

Before the exact statement in the next section, we give an
intuition for the natural extension of TS (or other asymp-
totically optimal SP-MAB algorithms) can have the opti-

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

mal regret in the MP-MAB problem. Roughly speaking, a
bandit algorithm with a logarithmic regret draws a subop-
timal arm with probability O(1/t) at the t-th round, which
amounts to O((cid:80)T
t=1 1/t) = O(log T ) regret. Thus, two
suboptimal arms are drawn at the same round with proba-
bility O(1/t2), which amounts to O((cid:80)T
t=1 1/t2) = O(1)
total simultaneous draws, provided that each suboptimal
arm is selected independently.

In TS, the score θi(t) for the choice of arms is generated
randomly at each round from the posterior independently
between each arm, which enables us to bound simultane-
ous draws as the above intuition. On the other hand, in
KL-UCB (or in other index policies), the UCB score for
the choice of arms is deterministic given the past results of
rewards, which means that the scores of suboptimal arms
may behave quite similarly in the worst case on the past
rewards.

5. Optimal Regret Bound

In this section, we state the main theoretical result (Theo-
rem 1). The analysis that leads to this theorem is discussed
in Section 6.
Theorem 1. (Regret upper bound of MP-TS) For any sufﬁ-
ciently small (cid:15)1 > 0, (cid:15)2 > 0, the regret of MP-TS is upper-
bounded as

E[Reg(T )] ≤

(cid:88)

i∈[K]\[L]

(cid:18) (1 + (cid:15)1)∆i,L log T
d(µi, µL)

(cid:19)

+ Ca((cid:15)1, µ1, µ2, . . . , µK) + Cb(T, (cid:15)2, µ1, µ2, . . . , µK),

where, Ca = Ca((cid:15)1, µ1, µ2, . . . , µK) is a constant inde-
pendent on T and is O((cid:15)−2
i=1 as
constants. The value Cb = Cb(T, (cid:15)2, µ1, µ2, . . . , µK) is
a function of T , which, by choosing proper (cid:15)2, grows at a
rate of O(log log T ) = o(log T ).

1 ) when we regard {µi}K

By letting (cid:15)1 = O((log T )−1/3) we obtain

E[Reg(T )] ≤

(cid:88)

∆i,L log T
d(µi, µL)

i∈[K]\[L]

+ O((log T )2/3) (8)

and we see that MP-TS achieves the asymptotic bound in
(7).

Expected regret and high-probability regret: Anan-
tharam et al. (1987) originally derived a regret lower bound
in a stronger form than (7) such that for any (cid:15) > 0, the
regret of a strongly consistent algorithm is lower-bounded
as





Reg(T )
log T

≥

lim
T →∞

Pr

(cid:88)

(1 − (cid:15))∆i,L
d(µi, µL)

i∈[K]\[L]



 = 1.

Combining this with (8) we can easily see that MP-TS sat-
isﬁes





Reg(T )
log T

≤

lim
T →∞

Pr

(cid:88)

(1 + (cid:15))∆i,L
d(µi, µL)

i∈[K]\[L]



 = 1,

(9)

that is, MP-TS is also asymptotically optimal in the sense
of high probability. Since an algorithm satisfying (9) is not
always optimal in the sense of expectation, our result, the
expected optimal regret bound, is also stronger in this sense
than the high-probability bound by Gopalan et al. (2014).

6. Regret Analysis
We ﬁrst deﬁne some additional notation that are useful for
our analysis in Section 6.1 then analyze the regret bound
in Section 6.2. The proofs of all the lemmas, except for
Lemma 2, are given in the Appendix.

i

i

log T

(T ) =

i
. Intuitively, N suf

L = µL − δ and µ(+)

L ∈ (µL+1, µL) and µ(+)
d(µ(+)
i

6.1. Additional notation
Let µ(−)
i = µi + δ for δ > 0 and
i ∈ [K] \ [L]. We assume δ to be sufﬁciently small such
that µ(−)
∈ (µi, µL). We also
deﬁne N suf
(T ) is the
,µ(−)
L )
sufﬁcient number of explorations to make sure that arm i is
not as good as arm L.
Events: Now, let max(m)
i∈S ai denote the m-th largest el-
ement of {ai}i∈S ∈ R|S|,
(m)ai =
We deﬁne θ∗(t) =
maxS(cid:48)⊂S:|S(cid:48)|=m mini∈S(cid:48) ai.
max(L)
i∈[K] θi(t) as the L-th largest posterior sample at round
t (i.e., the minimum posterior sample among the selected
arms), and θ∗∗
k∈[K]\{i,j} θk(t) as the (L − 1)-
th largest posterior sample at round t except for arms i and
j. Moreover, let ν = µL−1+µL
. Let us deﬁne the following
events.

\i,j(t) = max(L−1)

is, maxi∈S

that

2

Ai(t) = {i ∈ I(t)},
B(t) = {θ∗(t) ≥ µ(−)

L },

Ci(t) =

(cid:92)

{θ∗∗

\i,j(t) ≥ ν},

j∈[K]\([L−1]∪{i})

Di(t) = {Ni(t) < N suf

(T )}.

i

Event Ai(t) states that arm i is sampled at round t, and
Di(t) states that arm i has not been sampled sufﬁciently
yet. The complements of B(t) and Ci(t) are related to the
underestimation of optimal arms. Since the optimal arms
are sampled sufﬁciently, Bc(t) or Cc
i (t) should not occur
very frequently.

6.2. Proof of Theorem 1

We ﬁrst decompose the regret to the contribution of each
arm. Recall that, the regret increase by drawing suboptimal

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

arm i is determined by the optimal arm excluded in the
selection set I(t). Formally, for suboptimal arm i, let

• Term (D) corresponds to the case in which, arm i is

selected after it is sufﬁciently explored.

(cid:40)

∆i(t) =

(maxj∈[L]\I(t) µj) − µi
0

if I(t) (cid:54)= [L],
otherwise,

Proof of Lemma 2. The contribution of suboptimal arm i
to the regret is decomposed as follows. By using the fact
∆i(t) ≤ 1 and the following decomposition of an event

and

Regi(T ) =

1{i ∈ I(t)}∆i(t).

T
(cid:88)

t=1

(10)

Ai(t) ⊂ Bc(t) ∪ {Ai(t), Cc
⊂ Bc(t) ∪ {Ai(t), Cc
i (t)}
∪ {Ai(t), B(t), Dc

i (t)} ∪ {Ai(t), B(t), Ci(t)}

i (t)} ∪ {Ai(t), Ci(t), Di(t)},

From inequality (5) the following inequality is easily de-
rived

we have

Reg(T ) ≤

(cid:88)

Regi(T ).

i∈[K]\[L]

We next decompose Regi(T ) into several terms by using
events A–D. After giving bounds for these terms, we ﬁ-
nally give the total regret bound, which proves Theorem
1. Note that, in bounding the deviation of Bernoulli means
and Beta posteriors in the Appendix, our analysis borrowed
some techniques developed in the context of the SP-MAB
problem, mostly from Agrawal & Goyal (2013b), and some
from Honda & Takemura (2014).
Lemma 2. The regret by drawing suboptimal arm i > L is
decomposed as:

Regi(T ) ≤

1{Bc(t)}

+

1{Ai(t), Cc

i (t)}

Regi(T ) =

1{Ai(t)}∆i(t)

≤

1{Bc(t)} +

1{Ai(t), Cc

i (t)}

T
(cid:88)

t=1

T
(cid:88)

t=1

1{Ai(t), B(t), Dc

i (t)}

T
(cid:88)

t=1

+

+

T
(cid:88)

t=1

T
(cid:88)

t=1

1{Ai(t), Ci(t), Di(t)}∆i(t).

(11)

Recall that ∆i(t) is deﬁned as (10). At each round, when L
and all suboptimal arms, except for i, are not selected, then
I(t) = {1, 2, . . . , L − 1, i}; ∆i(t) = ∆i,L. Therefore,

T
(cid:88)

t=1
(cid:124)

(cid:123)(cid:122)
(C)

T
(cid:88)

t=1
(cid:124)

T
(cid:88)

t=1
(cid:124)

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

+

(cid:123)(cid:122)
(A)

(cid:125)

(cid:123)(cid:122)
(B)

(cid:125)

1{Ai(t), Ci(t), Di(t)}∆i(t)

+

(cid:88)

j∈[K]\([L−1]∪{i})
(cid:124)

T
(cid:88)

t=1

1{Ai(t), Ci(t), Di(t), Aj(t)}

(cid:125)

≤

1{Ai(t), Ci(t), Di(t)}∆i,L

+

1{Ai(t), B(t), Dc

i (t)}

+N suf
i

(T )∆i,L,

+

1{Ai(t), Ci(t), Di(t),

(cid:91)

Aj(t)}

j∈[K]\([L−1]∪{i})

(cid:123)(cid:122)
(D)

(cid:125)

≤

1{Ai(t), Di(t)}∆i,L

where, for example, {A, B} abbreviates {A ∩ B}.

Roughly speaking,

• Term (A) corresponds to the case in which, some of

the optimal arms are under-estimated.

• Term (B) corresponds to the case in which, arm i is
selected and some of the arms in [L − 1] are under-
estimated.

• Term (C) corresponds to the case in which, arm i ∈
[K] \ [L] and j ∈ [K] \ ([L − 1] ∪ {i}) are simulta-
neously drawn.
In particular, term (C) is unique in
the MP-MAB problem that causes additional regret
increase, and in analyzing this term we fully use the
fact that the samples of the posterior distributions on
the arms are independent of each other.

(cid:88)

T
(cid:88)

1{Ai(t), Ci(t), Di(t), Aj(t)}

j∈[K]\([L−1]∪{i})

t=1

≤ N suf
i

(T )∆i,L

(cid:88)

T
(cid:88)

j∈[K]\([L−1]∪{i})

t=1

+

1{Ai(t), Ci(t), Di(t), Aj(t)}.

(12)

Summarizing (11) and (12) completes the proof.

The following lemma bounds terms (A)–(D).
Lemma 3. (Bounds on individual terms) Let (cid:15)2 > 0 be
arbitrary. For sufﬁciently small δ and (cid:15)2, the four terms

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

are bounded in expectation as:
(cid:32)

(cid:33)

E[(A)] = O

1
(µL − µ(−)

L )2

= O

(cid:19)

,

(cid:18) 1
δ2

E[(B)] = O(log log T ),
(cid:18)

E[(C)] ≤

(cid:88)

(cid:15)2 + 4T −

(cid:15)2∆2
8

L,L−1

(cid:19)

log T

j∈[K]\([L−1]∪{i})

d(µi, µL)

and

E[(D)] ≤ 2+

1
d(µ(+)
i

, µi)

= O

(cid:19)

.

(cid:18) 1
δ2

(13)

(14)

(15)

(16)

+ O(1),

The proof of Lemma 3 is in Appendix A.4. Lemma 3 states
that terms (A), (B), and (D) are O(1/δ2). Moreover, the
following lemma bounds term (C).
Lemma 4. (Asymptotic convergence of (cid:15)2-dependent fac-
tor) By choosing an O((log log T )/ log T ) value of (cid:15)2, we
obtain E[(C)] = O(log log T ).

The proof of Lemma 4 is in Appendix A.5. Now it suf-
ﬁces to evaluate N suf
to complete the
proof. From the convexity of KL divergence there exists a
constant ci = ci(µi, µL) > 0 such that

(T ) =

d(µ(+)
i

,µ(−)
L )

log T

i

d(µ(+)
i

, µ(−)

L ) = d(µi + δ, µL − δ) ≥ (1 − ciδ)d(µi, µL)

and therefore

E[Reg(T )]≤

(cid:88)

E[Regi(T )] ≤

(cid:34) T

(cid:88)

(cid:88)

E

(cid:35)

1{Ai(t)}∆i(t)

i∈[K]\[L]

i∈[K]\[L]

t=1

(cid:88)

≤

(cid:8)E [(A) + (B) + (C) + (D)] + N suf

(T )∆i,L

i

(cid:9)

i∈[K]\[L]

(cid:88)

≤
i∈[K]\[L]

(cid:124)

∆i,L log T
(1 − ciδ)d(µi, µL)

(cid:123)(cid:122)
main term

(cid:18) 1
δ2
(cid:123)(cid:122)
Ca

(cid:19)

(cid:125)

+ O

(cid:124)

(cid:125)

+ O(log log T )
(cid:123)(cid:122)
(cid:125)
Cb

(cid:124)

.

Since (1 − ciδ)−1 ≤ 1 + 2ciδ for ciδ ≤ 1/2, we com-
plete the proof of Theorem 1 by letting (cid:15)1 < 1/2 and
δ = (cid:15)1/ maxi∈[K]\[L] ci = Θ((cid:15)1).

7. Experiment
We ran a series of computer simulations1 to clarify the em-
pirical properties MP-TS. The simulations involved the fol-
lowing three scenarios. In Scenarios 1 and 2, we used ﬁxed
arms similar to that of Garivier & Capp´e (2011), and Sce-
nario 3 is based on a click log dataset of advertisements on
a commercial search engine.
Algorithms:
the simulations involved MP-TS, Exp3.M
(Uchiya et al., 2010), CUCB (Chen et al., 2013), and

1The source code of

the simulations

is available at

https://github.com/jkomiyama/multiplaybanditlib.

arms with {µ1, . . . , µ5}

the MP-MAB problem2.

the simulations
=

MP-KL-UCB. Exp3.M is a state-of-the-art adversarial
The
bandit algorithm for
learning rate γ of Exp3.M is set
in accordance with
Corollary 1 of Uchiya et al. (2010). Note that
the
CUCB algorithm in the MP-MAB problem at each
round draws the top-L arms of the UCB indices ˆµi +
(cid:112)(3 log t)/(2Ni(t)). MP-KL-UCB is the algorithm that
selects the top-L arms in accordance with the KL-UCB in-
dex supq∈[ˆµi(t),1] {q|Ni(t)d(ˆµi(t), q) ≤ log t}.
Scenario 1 (5-armed bandits):
include 5 Bernoulli
{0.7, 0.6, 0.5, 0.4, 0.3}, and L = 2.
Scenario 2 (20-armed bandits):
the simulations in-
clude 20 Bernoulli arms with µ1 = 0.15, µ2 = 0.12,
µ3 = 0.10, µi = 0.05 for i ∈ {4, 5, . . . , 12}, µi = 0.03 for
i ∈ {13, 14, . . . , 20}, and L = 3.
Scenario 3 (many-armed bandits, online advertisement
based CTRs): we conducted another set of experiments
with arms whose expectations were based on the dataset
provided for KDD Cup3 2012 track 2. The dataset involves
a click log on soso.com (a large-scale search engine ser-
viced by Tencent), which is composed of 149 million im-
pressions (view of advertisements). We processed the data
as follows. First, we excluded users of abnormally high
click probability (i.e., users who had more than 1, 000 im-
pressions and more than 0.1 click probability) from the log.
We also excluded minor advertisements (ads) that had less
than 5, 000 impressions. There are a wide variety of ads
on a search engine (e.g., ”rental cars”, ”music”, etc.) and
randomly picking ads from a search engine should yield a
set of irrelevant ads. To address this issue, we selected pop-
ular queries that had more than 104 impressions and more
than 50 ads that appeared on the query. As a result, 80
queries were obtained. The number of ads associated with
each query ranged from 50 to 105, and the average click-
through-rate (CTR, the probability that the ad is clicked) of
an ad on each query ranged from 1.15% to 6.86%. After
that, each ad was converted into a Bernoulli arm with its
expectations corresponding to the CTR of the ad. At the
beginning of each run, one of the queries was randomly se-
lected, and the bandit simulation with the arms correspond-
ing to the query and L = 3 is then conducted. This scenario
was more difﬁcult than the ﬁrst two scenarios in the sense
that 1) a larger number of arms were involved and 2) the
reward gap among arms was very small.

The simulation results are shown in Figure 2. In all sce-
narios, the tendency is the same: our proposed MP-TS per-
forms signiﬁcantly better than the other algorithms. MP-
KL-UCB is not as good as MP-TS, but clearly better than
CUCB and Exp3.M. While it is unclear whether the slope

2Note that, Exp3.M is designed for the adversarial setting in

which the rewards of arms are not necessarily stationary.

3https://www.kddcup2012.org/

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

(a) Scenario 1

(b) Scenario 2

(c) Scenario 3

Figure 2. Regret-round plots of algorithms. The regret in Scenarios 1 and 2 are averaged over 10, 000 runs, and the regret in Scenario 3
is averaged over 1, 000 runs. “Lower Bound” is the leading Ω(log T ) term of the RHS of inequality (7). We do not show Lower Bound
in Scenario 3 because the coefﬁcient of the bound can sometimes be quite large (i.e., in some runs, 1/d(µL+1, µL) is large).

of the regret of MP-KL-UCB converges to the asymptotic
bound or not, the slope of the regret of TS quickly ap-
proaches the asymptotic lower bound.

7.1. Improvement of MP-TS based on the empirical

means

even though L − 1 arms are selected based on empirical
means as in IMP-TS. Similarly, we deﬁne an improved ver-
sion of MP-KL-UCB (IMP-KL-UCB) for selecting the ﬁrst
L − 1 arms on the basis of empirical averages. The be-
fore/after analysis of this improvement is shown in Figure
3. One sees that, (i) MP-TS still performs better than IMP-
KL-UCB, and (ii) IMP-TS reduces the regret throughout
the rounds. In particular, when the number of the rounds is
small (T ∼ 103–104), the advantage of IMP-TS is large.

8. Discussion
We extended TS to the multiple-play setting and proved its
optimality in terms of the regret. We considered the case in
which the total reward is linear to the individual rewards of
selected arms. The analysis in this paper fully uses the in-
dependent property of posterior samples and paves the way
to obtain a tight analysis on the multiple-play regret that de-
pends on the combinatorial structure of arm selection. We
now point out two promising directions for future work.

• Position-dependent factors for online advertising:
it is well-known that the CTR of an ad is dependent
on its position. Taking the position-dependent fac-
tor into consideration changes the MP-MAB problem
from the L-set selection problem to the L-sequence
selection problem in which the position of L arms
matters. For the starting point, we consider an ex-
tension of MP-TS for the cascade model (Kempe &
Mahdian, 2008; Aggarwal et al., 2008) that corrects
position-dependent bias in Appendix A.2.

• Non-Bernoulli distributions for general problems:
for the ease of argument, we exclusively consider the
binary rewards. The analysis by Korda et al. (2013)
is useful in extending our result to the case of the 1-d
exponential families of rewards. Moreover, extend-
ing our result to multi-parameter reward distributions
(Burnetas & Katehakis, 1996; Honda & Takemura,
2014) is interesting.

Figure 3. Before/after comparison of MP-TS. All settings (except
for algorithms) are the same as that of Scenario 3.

We now introduce an improved version of MP-TS (IMP-
TS). In the theoretical analysis of the MP-MAB problem,
we observed that an extra loss arises when multiple subop-
timal arms are drawn at the same round. Based on this ob-
servation, the new algorithm selects L−1 arms on the basis
of empirical averages and selects the last arm on the basis
of TS to avoid simultaneous draws of suboptimal arms. In
other words, this algorithm is further aimed to minimize
the regret by purely exploiting the knowledge in the top-
(L − 1) arms; thus, limiting the exploration to only one
arm. One might fear that this increase in exploitation could
devastate the balance between exploration and exploitation.
Although we provide no regret bound for the improved ver-
sion of the algorithm, we expect that this algorithm will
also achieve the asymptotic bound for the following reason.
When we restrict the exploration to one arm, the number of
opportunities for an arm to be explored may decrease, say,
from T to T /L. Still, T /L opportunities are sufﬁcient since
O(log(T /L)) = O(log T ). In fact, the algorithm proposed
by Anantharam et al. (1987) achieves the asymptotic bound

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Acknowledgements

We gratefully acknowledge the insightful advice from Issei
Sato and Tao Qin. We thank Yingce Xia for discussion on
the evaluation of (14). We thank Bertrand Chapleau for dis-
cussion on Bias-corrected MP-TS. We thank Zhibing Zhao
for pointing out our notation error in the arXiv version. We
thank the anonymous reviewers in ICML2015 for their use-
ful comments. This work was supported in part by JSPS
KAKENHI Grant Number 26106506.

References

Aggarwal, Gagan, Feldman, Jon, Muthukrishnan, S., and
P´al, Martin. Sponsored search auctions with markovian
users. In WINE, pp. 621–628, 2008.

Agrawal, Shipra and Goyal, Navin. Analysis of thompson
sampling for the multi-armed bandit problem. In COLT,
pp. 39.1–39.26, 2012.

Agrawal, Shipra and Goyal, Navin. Thompson sampling
for contextual bandits with linear payoffs. In ICML, pp.
127–135, 2013a.

Agrawal, Shipra and Goyal, Navin. Further optimal regret
bounds for thompson sampling. In AISTATS, pp. 99–107,
2013b.

Anantharam, V., Varaiya, P., and Walrand, J. Asymptoti-
cally efﬁcient allocation rules for the multiarmed bandit
problem with multiple plays-part i: I.i.d. rewards. Auto-
matic Control, IEEE Transactions on, 32(11):968–976,
1987.

Auer, Peter, Cesa-bianchi, Nicol´o, and Fischer, Paul.
Finite-time Analysis of the Multiarmed Bandit Problem.
Machine Learning, 47:235–256, 2002.

Burnetas, A.N. and Katehakis, M.N. Optimal adaptive poli-
cies for sequential allocation problems. Advances in Ap-
plied Mathematics, 17(2):122–142, 1996.

Capp´e, Olivier, Garivier, Aur´elien, Maillard, Odalric-
Ambrym, Munos, R´emi, and Stoltz, Gilles. Kullback-
leibler upper conﬁdence bounds for optimal sequential
allocation. Ann. Statist., 41(3):1516–1541, 06 2013.

Chapelle, Olivier and Li, Lihong. An empirical evaluation
of thompson sampling. In NIPS, pp. 2249–2257, 2011.

Garivier, Aur´elien and Capp´e, Olivier. The KL-UCB al-
gorithm for bounded stochastic bandits and beyond. In
COLT, pp. 359–376, 2011.

Gatti, Nicola, Lazaric, Alessandro, and Trov`o, Francesco.
A truthful learning mechanism for multi-slot sponsored
search auctions with externalities. In AAMAS, pp. 1325–
1326, 2012.

Gittins, J.C. and Jones, D.M. A dynamic allocation in-
dex for the sequential design of experiments. In Gani,
J. (ed.), Progress in Statistics, pp. 241–266. North-
Holland, Amsterdam, NL, 1974.

Gopalan, Aditya, Mannor, Shie, and Mansour, Yishay.
Thompson sampling for complex bandit problems.
In
ICML, 2014.

Guha, Sudipto and Munagala, Kamesh. Stochastic regret
In COLT, pp.

minimization via thompson sampling.
317–338, 2014.

Honda, Junya and Takemura, Akimichi. An Asymptot-
ically Optimal Bandit Algorithm for Bounded Support
Models. In COLT, pp. 67–79, 2010.

Honda, Junya and Takemura, Akimichi. Optimality of
thompson sampling for gaussian bandits depends on pri-
ors. In AISTATS, pp. 375–383, 2014.

Huang, Senhua, Liu, Xin, and Ding, Zhi. Opportunistic
spectrum access in cognitive radio networks. In INFO-
COM, pp. 1427–1435, 2008.

Kaufmann, Emilie, Korda, Nathaniel, and Munos, R´emi.
Thompson sampling: An asymptotically optimal ﬁnite-
time analysis. In ALT, pp. 199–213, 2012.

Kempe, David and Mahdian, Mohammad. A cascade
In WINE,

model for externalities in sponsored search.
pp. 585–596, 2008.

Koc´ak, Tom´as, Valko, Michal, Munos, R´emi, and Agrawal,
Shipra. Spectral thompson sampling. In AAAI, pp. 1911–
1917, 2014.

Korda, Nathaniel, Kaufmann, Emilie, and Munos, R´emi.
Thompson sampling for 1-dimensional exponential fam-
ily bandits. In NIPS, pp. 1448–1456, 2013.

Chen, Wei, Wang, Yajun, and Yuan, Yang. Combinato-
rial multi-armed bandit: General framework and appli-
cations. In ICML, pp. 151–159, 2013.

Lai, T. L. and Robbins, Herbert. Asymptotically efﬁcient
adaptive allocation rules. Advances in Applied Mathe-
matics, 6(1):4–22, 1985.

Craswell, Nick, Zoeter, Onno, Taylor, Michael J., and
Ramsey, Bill. An experimental comparison of click
position-bias models. In WSDM, pp. 87–94, 2008.

Osband, Ian, Russo, Daniel, and Roy, Benjamin Van.
learning via posterior

(more) efﬁcient reinforcement
sampling. In NIPS, pp. 3003–3011, 2013.

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Russo, Daniel and Roy, Benjamin Van. Eluder dimension
and the sample complexity of optimistic exploration. In
NIPS, pp. 2256–2264, 2013.

Scott, Steven L. A modern bayesian look at the multi-
armed bandit. Appl. Stoch. Model. Bus. Ind., 26(6):639–
658, November 2010. ISSN 1524-1904.

Thompson, William R. On The Likelihood That One Un-
known Probability Exceeds Another In View Of The Ev-
idence Of Two Samples. Biometrika, 25:285–294, 1933.

Uchiya, Taishi, Nakamura, Atsuyoshi, and Kudo, Mine-
ichi. Algorithms for adversarial bandit problems with
multiple plays. In ALT, pp. 375–389, 2010.

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

A. Appendix

A.1. Cases of several arms having the same expectation

Up to now, we have assumed that all arms have distinct ex-
pectations. Here, we consider cases in which some arms
have the same expectations. Without loss of generality,
we assume µ1 ≥ µ2 ≥, . . . , ≥ µK. Let us call arms
with a larger expectation than µL “strictly optimal” arms,
arms with the same expectation as µL “marginal” arms, and
arms with a smaller expectation than µL “strictly subopti-
mal” arms. Each arm is either strictly optimal, marginal, or
strictly suboptimal.

Case 1: Assume that all strictly optimal arms are distinct,
that there is only one marginal arm, and that there are sev-
eral strictly suboptimal arms with the same expectation. In
this case, the regret bound of Theorem 1 holds because our
analysis deals with each suboptimal arm separately.

Case 2: Assume that there is only one marginal arm, that
all strictly suboptimal arms are distinct, and that there are
several strictly optimal arms with the same expectation.
The regret bound also holds in this case since there is a
gap between each strictly suboptimal arm and each strictly
optimal arm.

Case 3: Assume that all strictly optimal arms and strictly
suboptimal arms are distinct and that there are several
marginal arms with the same expectation. Unfortunately,
we were unable to perform a meaningful analysis in
this case.
Intuitively, as stated by Agrawal and Goyal
(Agrawal & Goyal, 2012) for SP-MAB, adding an addi-
tional marginal arm appears to require some extra explo-
ration, which slightly increases the regret. However, the re-
gret structure is more complex than the SP-MAB because
several marginal arms can be drawn simultaneously.

In summary, our Theorem 1 holds when the marginal arm
is distinct. That is, µ1 ≥ µ2 ≥ · · · ≥ µL−1 > µL >
µL+1 ≥ · · · ≥ µK.

A.2. Cascade model and position-dependent MP-MAB

problem

In the main paper, we assumed that the rewards of arms are
independently and identically drawn from individual dis-
tributions.
In this section, we relax this assumption and
consider a wider class of the MP-MAB problem. Remem-
ber that, one of our primary applications is multiple adver-
tisement placement in the online advertising problem (c.f.,
Example 1).
In this section, we interchangeably use the
terms an advertisement (ad) and an arm. It is known that
the CTR of an ad depends on the environment where the
ad is placed, especially on the position of the ad. Among
several models that explain this dependency on the posi-
tion, the model that explains human behavior and agrees

Algorithm 2 Bias-Corrected Multiple-play Thompson
sampling (BC-MP-TS) for binary rewards

Input: # of arms K, # of positions L, discount fac-
tors {γl(i)}
for i = 1, 2, . . . , K do

Ai, Ni = 1, 2

end for
t ← 1.
for t = 1, 2 . . . , T do

for i = 1, 2, . . . , K do

Bi ← max (Ni − Ai, 1)
θi(t) ∼ Beta(Ai, Bi)

end for
Select Il(t) (l = 1, . . . , L) in accordance with Section
A.2.2.
for l ∈ 1, 2, . . . , L do
if Xi(t) = 1 then
Ai ← Ai + 1

end if
Ni ← Ni + (cid:81)l

l(cid:48)=2 γl(cid:48)(Il(cid:48)−1(t))

end for

end for

well with real data (Craswell et al., 2008) is the cascade
model (Kempe & Mahdian, 2008; Aggarwal et al., 2008),
with which it is assumed that the user scans the ads from
top to bottom. Following Gatti et al. (2012), we deﬁne
the discount factor γl(i) for l ≥ 2 as the probability that
a user observing ad i in position l − 1 will observe the
ad in the next position. Namely, the MP-MAB problem
with a discount factor is deﬁned as a MP-MAB problem
in which the arm at position l yields reward 1 with proba-
µIl(t), where Il(t) be the arm
bility
placed at the l-th position at round t. Note that, when we
set γl(i) = 1 for any position l ∈ [L] and ad i, this model is
reduced to the model we considered in the main paper. In
the MP-MAB problem in the main paper, the order of the L
arms does not matter. Whereas, under a position-dependent
discount factor smaller than 1, the order of L arms matters:
the problem is not the selection of an L-set of arms, but an
L-sequence of arms.

l(cid:48)=2 γl(cid:48)(Il(cid:48)−1(t))

(cid:16)(cid:81)l

(cid:17)

A.2.1. THOMPSON SAMPLING FOR CASCADE MODEL

In the cascade model, there is some probability that the arm
at position l > 1 is not drawn. The probability that the
arm at position l is drawn, (cid:81)l
l(cid:48)=2 γl(cid:48)(Il(cid:48)−1(t)), can be con-
sidered as the effective number of the draws at position i.
MP-TS (Algorithm 1) keeps Ai and Bi, which respectively
correspond to the number of rewards 1 and 0. The number
of draws on the arm i is Ni = Ai + Bi. When we consider
the cascade model, we need to take the effective number of
draw into consideration. We introduce Bias-corrected MP-

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

TS (BC-MP-TS, Algorithm 2). The crux of BC-MP-TS is
that, for each arm that is selected, Ni should be increased
not by 1, but by the effective number of draw for each posi-
tion. Note that, when γl(i) = 1, BC-MP-TS is essentially
the same as MP-TS.

A.2.2. OPTIMAL ARM SELECTION AND THE REGRET

In general discount factor γl(i), even if we have perfect
information over the expectation of all arms {µi}K
i=1, the
computation of the optimal sequence of L-arms at each
round t (optimal arm selection) appears to be computation-
ally intractable when K is large because we need to search
all the possible allocation of K ads over L positions. In the
case where γl(i) = γ(i), Kempe & Mahdian (2008) pro-
posed a polynomial-time approximation of the optimal arm
selection. We can obtain the arm selection strategy for BC-
MP-TS by using this approximation algorithm as an oracle
and plugging {θi(t)}L

i=1 as estimated expected rewards.

Ad-independent discount factor: when the discount fac-
tor is independent of the ad at that position (i.e., γl(i) =
γl), the optimal arm selection is easy: just select µl (i.e.,
l-th best arm) on the l-th position. We deﬁne the arm selec-
tion strategy of BC-MP-TS as placing the arm of the l-th
largest θi (i.e., Il(t) = max(l)

i∈[K] θi) on the l-th position.

Regret: naturally, the regret per round is deﬁned as the
difference between the expected reward of the optimal arm
selection and that of an algorithm. Namely,

T
(cid:88)

L
(cid:88)

(cid:32) l

(cid:89)

t=1

l=1

l(cid:48)=2

l
(cid:89)

l(cid:48)=2
(cid:124)

−

γl(cid:48)(Il(cid:48)−1(t))

×µIl(t)

(cid:123)(cid:122)
effective number of draw at position l

(cid:125)

where (Iopt(1), . . . , Iopt(L)) is the optimal arm selection.
In the case of the ad-independent discount factor, we con-
jecture that the regret lower bound should be identical to
the case of no-discount factor that we analysed in the main
paper (i.e., inequality (7)). Although we do not prove any
regret bound for this cascade model, the conjecture is sup-
ported by the fact that (i) by identifying the top-L arm
we immediately obtain the optimal arm selection, (ii) algo-
rithms should require log T /d(µi, µL) number of effective
draws to convince that suboptimal arm i > L is not as good
as arm L, and (iii) the best situation is that the simultane-
ous draw of several optimal arms rarely occurs: arm L is
pushed out instead of arm i, and the regret increase per an
effective draw is µL−µi. In the case of the general discount
factor, the problem is subtler because a slight difference in
{µi} can change the optimal arm selection.

Figure 4. Simulation with a discount factor. Lower Bound is the
leading Ω(log T ) term of the RHS of inequality (7), which we
have conjectured to be the lower bound for the cascade model
with the ad-independent discount factor in Section A.2.2. The
regret is averaged over 10, 000 runs.

A.2.3. EXPERIMENT OF CASCADE MODEL

This simulation adapts the cascade model and involves a
constant discount factor γl(i) = 0.7 for any position and
arm. There are 9 Bernoulli arms with µ1 = 0.24, µ2 =
0.21, . . . , µ9 = 0.00 and L = 3. In this case the optimal
arm selection strategy is to choose {I1(t), I2(t), I3(t)} =
{µ1, µ2, µ3} (c.f., Section A.2.2). The regret of the al-
gorithms is shown in 4. On one hand, MP-TS failed to
have a small regret due to its ignorance to the discount fac-
tors. On the other hand, the slope of BC-MP-TS quickly
approaches the conjectured Lower Bound, which is em-
pirical evidence of the ability of BC-MP-TS to correct the
position-dependent bias.

(cid:33)
,

Fact 5. (Chernoff bound for binary random variables)
Let X1, . . . , Xn be i.i.d. binary random variables. Let ˆX =
i=1 Xi and µ = E[Xi]. Then, for any (cid:15) ∈ (0, 1 − µ),
1
n

(cid:80)n

Pr( ˆX ≥ µ + (cid:15)) ≤ exp (−d(µ + (cid:15), µ)n).

and, for any (cid:15) ∈ (0, µ),

Pr( ˆX ≤ µ − (cid:15)) ≤ exp (−d(µ − (cid:15), µ)n).

Fact 6. (Beta-Binomial equality) Let F beta
α,β (y) be the cdf
of the beta distribution with integer parameters α and β.
Let F B
n,p(·) be the cdf of the binomial distribution with pa-
rameters n, p. Then,

α,β (y) = 1 − F B
F beta

α+β−1,y(α − 1),

Fact 7. (Pinsker’s inequality for binary random variables)
For p, q ∈ (0, 1), the KL divergence between two Bernoulli
distributions is bounded as:

d(p, q) ≥ 2(p − q)2.

Reg(T ) =

γl(cid:48)(Iopt(l(cid:48) − 1))µIopt(l)

A.3. Key fact and lemmas

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Lemma 8. (Lemma 2 in Agrawal & Goyal (2013b)) Let
k ∈ [K], n ≥ 0 and x < µk. Let ˆµk,n be the em-
pirical average of n samples from Bernoulli(µk). Let
pk,n(x) = 1 − F beta
ˆµk,nn+1,(1−ˆµk,n)n+1(y) be the probability
that the posterior sample from the Beta distribution with its
parameter ˆµk,nn + 1, (1 − ˆµk,n)n + 1 exceeds x. Then, its
average over runs is bounded as:

(cid:20)

E

(cid:21)

≤

1
pk,n(x)

1 + 3
∆k(x)
(cid:32)






(cid:33)

+

1
e∆k (x)2n/4−1

1 + Θ

e−∆k(x)2n/2 +

1

(n+1)∆k(x)2 e−Dk(x)n

Here note that the event

(n < 8/∆k(x))

(n ≥ 8/∆k(x)),

m ≤

1{θk(t) < z, S(t), U(t), Nk(t) = n}

1{θk(t) < z, S(t), U(t), Nk(t) < Nc}

1{θk(t) < z, S(t), U(t), Nk(t) = n}

1

m ≤

1{θk(t) < z, S(t), U(t), Nk(t) = n}

.

(cid:35)

(18)

Proof. First we have

T
(cid:88)

t=1

≤

≤

Nc(cid:88)

T
(cid:88)

n=0

t=1

Nc(cid:88)

T
(cid:88)

(cid:34)

n=0

m=1

T
(cid:88)

t=1

T
(cid:88)

t=1

implies that the event

{S(t), U(t), Nk(t) = n}

(19)

occurred for at least m rounds and {θk(t) < z} or T c(t)
occurred for the ﬁrst m rounds such that (19) occurred.
Thus, by using the mutual independence of {θk(t) < z},
S(t), and T (t), we have

(cid:34)

Pr

m ≤

T
(cid:88)

t=1

(cid:12)
(cid:12)
(cid:12)
1{θk(t) < z, S(t), U(t), Nk(t) = n}
(cid:12)
(cid:12)

(cid:35)

ˆµk,n

≤ (1 − pk,n(z)q)m (20)

where ∆k(x) = µk − x, Dk(x) = d(x, µk).

In the proof of Lemma 3 we use the following Lemmas
9, 10, and 11 several times. Lemma 9 is essentially the
combination of the existing techniques of Agrawal & Goyal
(2013b) and Honda & Takemura (2014). Lemmas 10 and
11 are also existing techniques that appear in several previ-
ous analyses in Bayesian bandits with Bernoulli arms.
Lemma 9. Let k ∈ [K], z < µk be arbitrary, S(t), T (t),
and U(t) be events such that

(i) if {θk(t) ≥ z}, S(t), and T (t) occurred then the arm

k is drawn at round t,

and therefore

(ii) θk(t), S(t) and T (t) are mutually independent given

{ˆµi(t)}K

i=1 and {Ni(t)}K

i=1.

(iii) The event U(t) is deterministic given {ˆµi(t)}K

i=1 and

{Ni(t)}K

i=1.

(iv) Given {ˆµi(t)}K

i=1 and {Ni(t)}K
holds, T (t) occurs with probability at least q > 0.

i=1 such that U(t)

t=1

Nc(cid:88)

T
(cid:88)

n=0

m=1

≤

≤

(cid:34) T

(cid:88)

E

(cid:12)
(cid:12)
(cid:12)
1{θk(t) < z, S(t), U(t), Nk(t) < Nc}
(cid:12)
(cid:12)

(cid:35)

ˆµk,n

(1 − pk,n(z)q)m (by (18) and (20))

Nc(cid:88)

n=0

1 − pk,n(z)q
pk,n(z)q

=

1
q

T −1
(cid:88)

(cid:18) 1

pk,n(z)

n=0

(cid:19)

− 1

+ Nc

1 − q
q

.

Then

(cid:34) T

(cid:88)

E

t=1

1{θk(t) < z, S(t), U(t), Nk(t) < Nc}

(cid:35)

(cid:18)

= O

(cid:19)

1
q(µk − z)2

+ Nc

1 − q
q

.

In particular, by setting T (t) and U(t) the trivial events
that always hold (q = 1), we obtain the following inequal-
ity:

(cid:34) T

(cid:88)

E

t=1

1{θk(t) < z, S(t)}

= O

(cid:35)

(cid:19)

(cid:18)

1
(µk − z)2

.

(17)

By using Lemma 8, we obtain

(cid:34)T −1
(cid:88)

(cid:18) 1

E

(cid:19)(cid:35)

− 1

pk,n(z)

≤

n=0

24
∆k(z)2
T −1
(cid:88)

(cid:32)

O
+
n=(cid:100)8/∆k(z)(cid:101)

e−∆k(z)2n/2 +

e−Dk(z)n
(n + 1)∆k(z)2 +

1
e∆k(z)2n/4 − 1

(cid:33)
.

(21)

By using the fact that Dk(z) = d(z, µk) = Ω(1/(µk −z)2)
(from the Pinsker’s inequality), it is easy to verify that the

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

RHS of (21) is O(1/(µk − z)2). By using these facts, we
ﬁnally obtain

Proof. Here, we prove inequality (13). Recall that

(cid:35)

(A) =

1{Bc(t)} =

1{θ∗(t) < µ(−)

L }.

T
(cid:88)

t=1

T
(cid:88)

t=1

(cid:34) T

(cid:88)

E

t=1

E

1
q

(cid:18)

≤

= O

1{θk(t) < z, S(t), U(t), Nk(t) < Nc}

(cid:34)T −1
(cid:88)

(cid:18) 1

pk,n(z)

n=0

(cid:19)(cid:35)

− 1

+ Nc

1 − q
q

(cid:19)

1
q(µk − z)2

+ Nc

1 − q
q

,

Since θ∗(t) is the L-th largest posterior sample among arms
at round t, θ∗(t) < µ(−)
L implies that, there exists at least
one arm in [L] with its posterior sample smaller than µ(−)
L .
Namely,

{θ∗(t) < µ(−)

L } ⊂

{θk(t) < µ(−)

L },

(cid:91)

k∈[L]

which concludes the proof of the lemma.

Lemma 10. (Deviation of empirical averages, Agrawal &
Goyal (2013b, Appendix B.1)) Let k ∈ [K] and z > µk be
arbitrary. Then,

and therefore

{θ∗(t) < µ(−)
L }
(cid:91)

(cid:34) ∞
(cid:88)

E

t=0

1{Ak(t), ˆµk(t) > z}

< 1 +

(cid:35)

1
d(z, µk)

.

Lemma 11. (Deviation of Beta posteriors) Let k ∈ [K],
x1, x2 ∈ [0, 1] be arbitrary values such that x1 > x2, and
n ≥ 1. Then,

Pr(θk(t) ≥ x1|ˆµk(t) ≤ x2, Nk(t) = n)

≤ exp (−d(x2, x1)n).

Proof. Note that, this lemma is essentially the same as
the ﬁrst display in Agrawal & Goyal (2013b, Appendix
B.2). While Agrawal & Goyal (2013b) provide a bound
for Nk(t) > n, the bound in our lemma is for Nk(t) = n.
For the sake of rigor, we write the proof here.

Pr(θj(t) ≥ x1|ˆµj(t) ≤ x2, Nj(t) = n)

(cid:18)

= Pr

θ ∼ Beta(ˆµj(t)n + 1, (1 − ˆµj(t))n + 1),

(cid:19)

θ ≥ x1

(cid:12)
(cid:12)
(cid:12)
(cid:12)
x2n+1,(1−x2)n+1(x1)

ˆµj(t) ≤ x2

= 1 − F beta
= F B

n+1,x1

(x2n)

=

=

⊂

k∈[L]
(cid:91)

k∈[L]
(cid:91)

k∈[L]

{θk(t) < µ(−)

L , θ∗(t) < µ(−)
L }

{θk(t) < µ(−)

L , max
j∈[L]

(L)θj(t) < µ(−)
L }

{θk(t) < µ(−)

L , max

(L)θj(t) < µ(−)

L }.

j∈[L]\{k}

By using the union bound, we obtain

1{θ∗(t) < µ(−)
L }
1{θk(t) < µ(−)

(cid:88)

≤

k∈[L]

L , max

j∈[L]\{k}

(L)θj(t) < µ(−)

L }.

Note that the event max(L)
L satisﬁes the
condition for the event S(t) in (17) in Lemma 9 with z :=
µ(−)
L . Therefore we obtain from Lemma 9 that

j∈[L]\{k} θj(t) < µ(−)

(cid:34) T

(cid:88)

E

t=1

(cid:35)

1{θ∗(t) < µ(−)
L }

(cid:32)

= O

1
(µk − µ(−)

L )2

(cid:33)

(cid:32)

= O

1
(µL − µ(−)

L )2

(cid:33)

,

which concludes the proof of inequality (13).

≤ F B

n,x1

(x2n) ≤ exp (−d(x2, x1)n)

(by the Beta-Binomial equality)

Evaluation of term (B):

(by the Chernoff bound).

Proof. Here, we prove inequality (14). We have,

A.4. Proof of Lemma 3

Evaluation of term (A):

(B) =

1{Ai(t), Cc

i (t)}

T
(cid:88)

t=1



1



=

T
(cid:88)

t=1

(cid:91)

{Ai(t), θ∗∗

\i,j(t) < ν}

j∈[K]\([L−1]∪{i})






Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

(cid:110)

1

Ai(t), θ∗∗

\i,j(t) < ν

(cid:111)

T
(cid:88)

=

T
(cid:88)

=

(cid:88)

(cid:88)

t=1

j∈[K]\([L−1]∪{i})

θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

(cid:111)
.

Moreover, let ν2 = (ν + µL)/2 = (µL−1 + 3µL)/4. For
k ∈ [L − 1], µk > ν > ν2 > µL and

t=1

j∈[K]\([L−1]∪{i})

(cid:110)

1{Ai(t), ˆµi(t) > µL}+1

Ai(t), ˆµi(t) ≤ µL, θ∗∗

(cid:110)

(cid:26)

Pr

θk(t) < ν, Nk(t) ≥

(cid:27)

log T
2(ν − ν2)2

(cid:111)(cid:111)

.

\i,j(t) < ν
(22)

Pr{θk(t) < ν, Nk(t) = n}

In the following, we bound the ﬁrst and the second terms
in the inner sum of the last line of (22). From Lemma 10,
the ﬁrst term of (22) is bounded as

(cid:34) T

(cid:88)

E

t=1

1 {Ai(t), ˆµi(t) > µL}

≤ 1 +

= O(1).

(cid:35)

1
d(µL, µi)

On the other hand, the second term of (22) is transformed
as

Ai(t), ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

(cid:111)

(cid:110)

1

T
(cid:88)

t=1

≤

log log T
d(µL, ν)
T
(cid:26)
(cid:88)

t=1

log log T
d(µL, ν)
T
(cid:88)

(cid:26)

≤

+

t=1

+

1

Ai(t), Ni(t) >

, ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

log log T
d(µL, ν)

1

Ni(t) >

, ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

log log T
d(µL, ν)

(cid:27)

.

Since θ∗∗
\i,j(t) is the (L − 1)-th largest posterior sample
among arms except for i and j, θ∗∗
\i,j(t) < ν indicates that,
the number of arms excluding i and j with posterior sam-
ples larger than or equal to ν is at most L − 2, and thus at
least one arm among [L − 1] has its posterior smaller than
ν. Namely,

{θ∗∗

\i,j(t) < ν} = { max

(L−1)θl(t) < ν}

l∈[K]\{i,j}

=

⊂

(cid:91)

k∈[L−1]
(cid:91)

k∈[L−1]

{θk(t) < ν, max

(L−1)θl(t) < ν}

l∈[K]\{i,j}

{θk(t) < ν, max

(L−1)θl(t) < ν}.

l∈[K]\{i,j,k}

Pr{θk(t) < ν, ˆµk(t) > ν2, Nk(t) = n}

Pr{ˆµk(t) ≤ ν2, Nk(t) = n}

T
(cid:88)

T
(cid:88)

n= log T

2(ν−ν2 )2

≤

≤

n= log T

2(ν−ν2 )2

T
(cid:88)

+

n= log T

2(ν−ν2)2

T
(cid:88)

≤

e−d(ν2,ν)n

n= log T

2(ν−ν2 )2

T
(cid:88)

+

(cid:27)

n= log T

2(ν−ν2)2

Pr{ˆµk(t) ≤ ν2, Nk(t) = n}

(by Lemma 11)

T
(cid:88)

≤

n= log T

2(ν−ν2 )2

T
(cid:88)

n= log T

2(ν−ν2 )2

e−d(ν2,ν)n +

e−d(ν2,µk)n

= O(1/T ) (by (µk − ν2) > (ν − ν2) and Pinsker’s inequality)

(by Chernoff bound)

and thus

T
(cid:88)

(cid:88)

t=1

k∈[L−1]

(cid:110)

Pr

Ni(t) >

log log T
d(µL, ν)

,

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

(cid:111)

T
(cid:88)

(cid:88)

(cid:110)

≤

Pr

Ni(t) >

t=1

k∈[L−1]

log log T
d(µL, ν)

, Nk(t) <

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

T
(cid:88)

+

(cid:88)

(cid:110)

t=1

k∈[L−1]

Pr

θk(t) < ν, Nk(t) ≥

log T
2(ν − ν2)2 ,
(cid:111)

log T
2(ν − ν2)2

(cid:111)

log T
2(ν − ν2)2 ,
(cid:111)

By using this, we have

T
(cid:88)

t=1

≤

(cid:26)

1

Ni(t) >

log log T
d(µL, ν)

, ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

T
(cid:88)

(cid:88)

(cid:110)

t=1

k∈[L−1]

1

Ni(t) >

, ˆµi(t) ≤ µL,

log log T
d(µL, ν)

(cid:27)

≤

Pr

Ni(t) >

, Nk(t) <

T
(cid:88)

(cid:88)

(cid:110)

t=1

k∈[L−1]

log log T
d(µL, ν)

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

+ O(1).

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Here, z := ν, S(t) := {max(L−1)
l∈[K]\{i,j,k} θl(t) < ν},
T (t) := {θi(t) ≤ ν}, and U(t) := {ˆµi(t) ≤ µL} sat-
isfy the conditions in Lemma 9. Under U(t), T (t) holds
with probability at least

(cid:18)

1 − exp

−d(µL, ν)

(cid:19)(cid:19)

(cid:18) log log T
d(µL, ν)

= 1 − (log T )−1

by Lemma 11. Therefore, by using Lemma 9 with Nc =
log T /(2(ν − ν2)2), we obtain

(cid:34) T

(cid:88)

E

(cid:110)

1

Ni(t) >

t=1

log log T
d(µL, ν)

, Nk(t) <

log T
2(ν − ν2)2 ,
(cid:35)

(cid:111)

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

(cid:18)

≤ O

l∈[K]\{i,j,k}
(cid:19)

1
(1 − (log T )−1)(µk − ν)2
(cid:18) (log T )−1

O

1 − (log T )−1

(cid:19)

log T
2(ν − ν2)2

+

= O(1). (23)

From (23) and the union bound over k ∈ [L−1], the second
term of (22) is O(1). In summary, term (B) is O(log log T )
in expectation.

T
(cid:88)

t=1

T
(cid:88)

≤

t=1
≤ (cid:15)2 log T
T
(cid:88)

+

t=1

By using Lemma 10 with z := ν2, the ﬁrst term in (24) is
bounded as:

(cid:34) T

(cid:88)

E

t=1
(cid:18)

= O

1{Aj(t), ˆµj(t) > ν2}

≤ 1 +

(cid:35)

1
(ν2 − µj)2

(cid:19)

(cid:18)

= O

1
(µL−1 − µL)2

1
d(ν2, µj)
(cid:19)

= O(1).

(25)

i,j(t) =
\i,j(t) ≥ ν} ⊃ Ci(t). Let Ej(t) = {Nj(t) ≥ (cid:15)2 log T }.

We now bound the second term in (24). Let C(cid:48)
{θ∗∗
We have,

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Di(t), ˆµj(t) ≤ ν2}

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Di(t), ˆµj(t) ≤ ν2, Ej(t)}.

≤ (cid:15)2 log T +

N suf
i

(T )−1
(cid:88)

T
(cid:88)

n=0

t=1

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Ni(t) = n, ˆµj(t) ≤ ν2, Ej(t)}.

In the following, we bound

T
(cid:88)

t=1

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Ni(t) = n, ˆµj(t) ≤ ν2, Ej(t)}.

i,j(t), θ∗∗

(26)
Note that, (26) is at most 1 since {Ai(t), Ni(t) = n} oc-
curs at most once. Let τ be the ﬁrst round (if exists) at
which {C(cid:48)
\i,j(t) ≤ θi(t), Ai(t), Ni(t) = n} is sat-
isﬁed. It is necessary that {θj(τ ) ≥ θ∗∗
\i,j(τ )} for (26) to be
1: this is because, (i) both θi(τ ) and θj(τ ) need to be larger
than θ∗∗
\i,j(τ ) for the simultaneous draw of arms i and j,
(ii) and if θj(τ ) < θ∗∗
\i,j(τ ) then arm i is drawn and thus
{Ni(t) = n} is never satisﬁed after t > τ . Here,

Pr{θj(τ ) ≥ θ∗∗

\i,j(τ ), θ∗∗

\i,j(τ ) ≥ ν, ˆµj(τ ) ≤ ν2}

≤ exp (−d(ν2, ν)Nj(τ )),

Evaluation of term (C):

Proof. Here, we prove inequality (15). Recall that,

(C) =

1{Ai(t), Aj(t), Ci(t), Di(t)}.

(cid:88)

T
(cid:88)

j∈[K]\([L−1]∪{i})

t=1

Let ν2 = (ν + µL)/2 = (µL−1 + 3µL)/4. Note that,
we deﬁned ν and ν2 such that µL−1 > ν > ν2 > µL,
O(µL−1 − ν) = O(ν − ν2) = O(ν2 − µL) = O(µL−1 −
µL) = O(1) as a function of T . Then,

T
(cid:88)

t=1

1{Ai(t), Aj(t), Ci(t), Di(t)}

=

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) > ν2}

+

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

≤

1{Aj(t), ˆµj(t) > ν2}

by Lemma 11. Therefore, we have

+

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}.

1{Ai(t), Aj(t), Ci(t), Ni(t) = n, ˆµj(t) ≤ ν2}

(cid:35)

(cid:34) T

(cid:88)

E

t=1

(24)

≤ exp (−d(ν2, ν)(cid:15)2 log T ) = T −(cid:15)2d(ν2,ν).

(27)

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

In summary, the second term in (24) is bounded as:

(28) is bounded as

(cid:35)

(cid:104)

E

1[Ai(t), B(t), ˆµi(t) ≤ µ(+)

i

, Ni(t) ≥ N suf

i

(cid:105)
(T )]

(cid:34) T

(cid:88)

E

t=1

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}

≤ (cid:15)2 log T + N suf

(T )T −(cid:15)2d(ν2,ν)

(cid:18)

≤

(cid:15)2 +

i
4T −(cid:15)2d(ν2,ν)
d(µi, µL)

(cid:19)

log T

(by (1 + δ)2 < 4),

(cid:104)

≤ E
(cid:104)
= E

1[θi(t) ≥ µ(−)
E(cid:2)1[θi(t) ≥ µ(−)

L , ˆµi(t) ≤ µ(+)

i

L , ˆµi(t) ≤ µ(+)

i

, Ni(t) ≥ N suf

i

(cid:105)
(T )]

, Ni(t) ≥ N suf

(T )]
(cid:12)ˆµi(t), Ni(t)(cid:3)(cid:105)
(cid:12)

i

(cid:104)
≤ E

E(cid:2)1[ˆµi(t) ≤ µ(+)

i

Pr[θi(t) ≥ µ(−)

(cid:104)

(cid:104)

E

≤ E

exp(−d(µ(+)

i

i

, Ni(t) ≥ N suf
(T )]
L |ˆµi(t), Ni(t)](cid:12)
L )N suf

(T ))

, µ(−)

i

(cid:12)ˆµi(t), Ni(t)(cid:3)(cid:105)

(cid:12)
(cid:12)
(cid:12)ˆµi(t), Ni(t)

(cid:105)(cid:105)

(by Lemma 11)

(cid:32) (cid:0)(cid:15)2 + 4T −(cid:15)2d(ν2,ν)(cid:1) log T
d(µi, µL)

(cid:33)

+ O(1)



(cid:16)



(cid:15)2 + 4T −(cid:15)2∆2

L,L−1/8(cid:17)



log T

d(µi, µL)

 + O(1),

= exp (−d(µ(+)
= T −1

i

, µ(−)

L )N suf

i

(T ))

(by the deﬁnition of N suf

(T )),

i

(30)

where we used the fact that d(ν2, ν) ≥ 2(ν − ν2)2 = 2 ×
((µL−1 − µL)/4)2 in the last transformation.

where we used the fact E[X] = E[E[X|Y ]] for any random
variables X and Y . Putting (28)–(30) together we obtain

and thus,

E[(C)]

(cid:88)

(cid:88)

≤

≤

j∈[K]\([L−1]∪{i})

j∈[K]\([L−1]∪{i})

Evaluation of term (D):

E[(D)] ≤ 1 +

+

T −1,

(31)

1
d(µ(+)
i

, µi)

T
(cid:88)

t=1

from which the inequality (16) follows.

Proof. Here, we prove inequality (16). We ﬁrst divide term
(D) into two subterms as:

A.5. Proof of Lemma 4

E[(D)] = E

1{Ai(t), B(t), Ni(t) ≥ N suf

(T )}

i

(cid:35)

It sufﬁces to prove that for any a, b > 0

(cid:26) T −a(cid:15)2
b

inf
(cid:15)2>0

(cid:27)

+ (cid:15)2

= O

(cid:18) log log T
log T

(cid:19)

.

≤ E

1{Ai(t), B(t), ˆµi(t) > µ(+)

, Ni(t) ≥ N suf

i

(T )}

+ E

1{Ai(t), B(t), ˆµi(t) ≤ µ(+)

, Ni(t) ≥ N suf

i

(T )}

.

i

i

By letting (cid:15)2 = (log log T )/(a log T ), we have

(cid:26) T −a(cid:15)2
b

inf
(cid:15)2>0

(cid:27)

+ (cid:15)2

(cid:26) e−a(cid:15)2 log T
b

(cid:27)

+ (cid:15)2

(cid:34) T

(cid:88)

t=1

(cid:34) T

(cid:88)

t=1

(cid:34) T

(cid:88)

t=1

(cid:35)

(cid:35)

(28)

(cid:35)
(T )}

= inf
(cid:15)2>0
e− log log T
b

≤

=

1
b log T

+

= O

(cid:18) log log T
log T

+

log log T
a log T

log log T
a log T
(cid:19)

and the proof is completed.

On one hand, the ﬁrst term in (28) is bounded as:

1{Ai(t), B(t), ˆµi(t) > µ(+)

i , Ni(t) ≥ N suf

i

1{Ai(t), ˆµi(t) > µ(+)

i

(cid:35)
}

(cid:34) T

(cid:88)

E

t=1

(cid:34) T

(cid:88)

≤ E

≤ 1 +

t=1

1
d(µ(+)
i

, µi)

(by Lemma 10).

(29)

On the other hand, each component of the second term of

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed
Bandit Problem with Multiple Plays

9
1
0
2
 
r
a

M
 
0
2
 
 
]
L
M

.
t
a
t
s
[
 
 
3
v
9
7
7
0
0
.
6
0
5
1
:
v
i
X
r
a

Junpei Komiyama
Junya Honda
Hiroshi Nakagawa
The University of Tokyo, Japan

JUNPEI@KOMIYAMA.INFO
HONDA@STAT.T.U-TOKYO.AC.JP
NAKAGAWA@DL.ITC.U-TOKYO.AC.JP

Abstract

We discuss a multiple-play multi-armed ban-
dit (MAB) problem in which several arms are
selected at each round. Recently, Thompson
sampling (TS), a randomized algorithm with a
Bayesian spirit, has attracted much attention for
its empirically excellent performance, and it is
revealed to have an optimal regret bound in the
standard single-play MAB problem. In this pa-
per, we propose the multiple-play Thompson
sampling (MP-TS) algorithm, an extension of TS
to the multiple-play MAB problem, and discuss
its regret analysis. We prove that MP-TS for bi-
nary rewards has the optimal regret upper bound
that matches the regret lower bound provided
by Anantharam et al. (1987). Therefore, MP-
TS is the ﬁrst computationally efﬁcient algorithm
with optimal regret. A set of computer simula-
tions was also conducted, which compared MP-
TS with state-of-the-art algorithms. We also pro-
pose a modiﬁcation of MP-TS, which is shown
to have better empirical performance.

1. Introduction

The multi-armed bandit (MAB) problem is one of the most
well-known instances of sequential decision-making prob-
lems in uncertain environments, which can model many
real-world scenarios. The problem involves conceptual en-
tities called arms. At each round, the forecaster draws one
of K arms and receives a corresponding reward. The aim
of the forecaster is to maximize the cumulative reward over
rounds, and the forecaster’s performance is usually mea-
sured by a regret, which is the gap between his or her
cumulative reward and that of an optimal drawing policy.

Throughout the rounds, the forecaster faces an “exploration
vs. exploitation” dilemma. On one hand, the forecaster
wants to exploit the information that he or she has gath-
ered up to the previous round by selecting seemingly good
arms. On the other hand, there is always a possibility that
the other arms have been underestimated, which motivates
him or her to explore seemingly bad arms in order to gather
their information. To resolve this dilemma, the forecaster
uses an algorithm to control the number of draws for each
arm.

In the stochastic MAB problem, which is the most widely
studied version of the MAB problem, it is assumed that
each arm is associated with a distinct probability distribu-
tion. While there have been many theoretical studies on the
inﬁnite setting in which future rewards are geometrically
discounted (e.g., the Gittins index (Gittins & Jones, 1974)),
recent availability of massive data has led to a ﬁnite horizon
setting in which every reward has the same importance. In
this work, we focus on the latter setting.

There has been signiﬁcant progress in this setting of the
MAB problem. In particular, the upper conﬁdence bound
(UCB) algorithm (Auer et al., 2002) has been widely used
and studied for its computational simplicity and customiz-
ability. Whereas the coefﬁcient of the leading logarithmic
term in UCB is larger than the theoretical lower bound
given by Lai & Robbins (1985), algorithms have been pro-
posed that achieve this bound, such as DMED (Honda &
Takemura, 2010), Kinf, and KL-UCB (Capp´e et al., 2013).

Moreover, Thompson sampling (TS) (Thompson, 1933)
has recently attracted attention for its excellent perfor-
mance (Scott, 2010; Chapelle & Li, 2011) and it has been
revealed to be applicable to even a wider class of problems
(Agrawal & Goyal, 2013a; Russo & Roy, 2013; Osband
et al., 2013; Koc´ak et al., 2014; Guha & Munagala, 2014).
Thompson sampling is an old heuristic that has a spirit of
Bayesian inference and selects an arm based on posterior
samples of the expectation of each arm. It has been shown
that TS has an optimal regret bound (Agrawal & Goyal,

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

2012; Kaufmann et al., 2012; Agrawal & Goyal, 2013b).

1.1. Multiple-play MAB problem

The literature mentioned above has speciﬁcally dealt with
the MAB problem in which a single arm is selected and
drawn at each round. Let us call this problem single-play
MAB (SP-MAB). While the SP-MAB problem is indis-
putably important as a canonical problem, in many prac-
tical situations multiple entities corresponding to arms are
selected at each round. We call the MAB problem in
which several arms can be selected multiple-play MAB
(MP-MAB). Examples of the situations that can be mod-
eled as an MP-MAB problem include the followings.

• Example 1 (placement of online advertisements): a
web site has several slots where advertisements can
be placed. Based on each user’s query, there is a set
of candidates of relevant advertisements from which
web sites can select to display. The effectiveness of
advertisements varies: some advertisements are more
appealing to the user than others. With the standard
model in online advertising, it is assumed that each
advertisement is associated with a click-through-rate
(CTR), which is the number of clicks per view. Since
web sites receive revenue from clicks on advertise-
ments, it is natural to maximize it, which can be con-
sidered as an instance of an MP-MAB problem in
which advertisements and clicks correspond to arms
and rewards, respectively.

• Example 2 (channel selection in cognitive radio
networks (Huang et al., 2008)): a cognitive radio
is an adaptive scheme for allocating channels, such
as wireless network spectrums. There are two kinds
of users: primary and secondary. Unlike primary
users, secondary users do not have primary access to
a channel but can take advantage of the vacancies in
primary access and opportunistically exploit instanta-
neous spectrum availability when primary users are
idle. However, the availabilities of channels are not
easily known. Usually, secondary users have access
to multiple channels. They can enhance their commu-
nication efﬁciency by adaptively estimating the avail-
ability statistics of the channels, which can be con-
sidered as an MP-MAB problem in which channels
and the permission of communication are arms and
rewards, respectively.

There have been several studies on the MP-MAB prob-
lem. Anantharam et al. (1987) derived an asymptotic lower
bound on the regret for this problem and proposed an al-
gorithm to achieve this bound. Because their algorithm
requires certain statistics that are difﬁcult to compute, ef-
ﬁciently computable MP-MAB algorithms have also been
extensively studied. Chen et al. (2013) extended a UCB-

based algorithm to a multiple-play case with combinatorial
rewards and Gopalan et al. (2014) extended TS to a wide
class of problems. Although both papers provide a loga-
rithmic regret bound, the constant factors of these regret
bounds do not match the lower bound. Therefore, it is un-
known whether the optimal regret bound for the MP-MAB
problem is achievable by using a computationally efﬁcient
algorithm.

The main difﬁculty in analyzing the MP-MAB problem
lies in the fact that the regret depends on the combinato-
rial structure of arm draws. More speciﬁcally, an algorithm
with the optimal bound on the number of draws of subopti-
mal arms does not always ensure the optimal regret bound
unlike the SP-MAB problem.

Contribution: Our contributions are as follows.

• TS-based algorithm for the MP-MAB problem and
its optimal regret bound: the ﬁrst and main contri-
bution of this paper is an extension of TS to the mul-
tiple play case, which we call MP-TS. We prove that
MP-TS for binary rewards achieves an optimal regret
bound. To the best of our knowledge, this paper is
the ﬁrst to provide a computationally efﬁcient algo-
rithm in the MP-MAB problem with the optimal regret
bound by Anantharam et al. (1987).

• Novel analysis technique: to solve the difﬁculty in
the combinatorial structure of the MP-MAB problem,
we show that the independence of posterior samples
among arms in TS is a key property for suppressing
the number of simultaneous draws of several subopti-
mal arms, and the use of this property eventually leads
to the optimal regret bound.

• Experimental comparison among MP-MAB algo-
rithms: we compare MP-TS with other algorithms,
and conﬁrm its efﬁciency. We also propose an em-
pirical improvement of MP-TS (IMP-TS) motivated
by analyses on the regret structure of the MP-MAB
problem. We conﬁrm that IMP-TS improves the per-
formance of MP-TS without increasing computational
complexity.

2. Problem Setup

there be K arms.

Each arm i ∈ [K] =
Let
{1, 2, . . . , K} is associated with a probability distribution
νi = Bernoulli(µi), µi ∈ (0, 1). At each round t =
1, 2, . . . , T , the forecaster selects a set of L < K arms
I(t), then receives the rewards of the selected arms. The
reward Xi(t) of each selected arm i is i.i.d. samples from
νi. Let Ni(t) be the number of draws of arm i before round
t (i.e., Ni(t) = (cid:80)t−1
t(cid:48)=1 1{i ∈ I(t(cid:48))}, where 1{A} = 1 if
event A holds and = 0 otherwise.), and ˆµi(t) be the em-
pirical mean of the rewards of arm i at the beginning of
round t. The forecaster is interested in maximizing the sum

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

of rewards over drawn arms. For simplicity, we assume
that all arms have distinct expected rewards (i.e., µi (cid:54)= µj
for any i (cid:54)= j). We discuss the case in which µi = µj
for some i and j in Appendix A.1, which is in Supple-
mentary Material. Without loss of generality, we assume
µ1 > µ2 > µ3 > · · · > µK. Of course, algorithms do
not exploit this ordering. We deﬁne optimal arms as top-
L arms (i.e., arms [L]), and suboptimal arms as the others
(i.e., arms [K] \ [L]). The regret, which is the expected loss
of the forecaster, is deﬁned as

Reg(T ) =

T
(cid:88)







(cid:88)

µi −

(cid:88)

µi

 .

t=1

i∈[L]

i∈I(t)

The expectation of regret E[Reg(T )] is used to measure the
performance of an algorithm.

3. Regret Bounds

In this section we introduce the known lower bounds of
the regret for the SP-MAB and MP-MAB problems and
discuss the relation between them.

3.1. Regret bound for SP-MAB problem

The SP-MAB problem, which has been thoroughly studied
in the ﬁelds of statistics and machine learning, is a special
case of the MP-MAB problem with L = 1. The optimal
regret bound in the SP-MAB problem was given by Lai &
Robbins (1985). They proved that, for any strongly consis-
tent algorithm (i.e., algorithms with subpolynomial regret
for any set of arms), there exists a lower bound

E[Ni(T + 1)] ≥

log T,

(1)

(cid:19)

(cid:18) 1 − o(1)
d(µi, µ1)

where d(p, q) = p log (p/q)+(1−p) log ((1 − p)/(1 − q))
is the KL divergence between two Bernoulli distributions
with expectation p and q. Note that when arm i is drawn,
the regret increases by ∆i,1 and the regret is written as

E[Reg(T )] =

Ni(T + 1)∆i,1,

(2)

(cid:88)

i(cid:54)=1

where ∆i,j = µj − µi. Therefore, inequality (1) directly
leads to the regret lower bound

E[Reg(T )] ≥

(cid:18) (1 − o(1))∆i,1
d(µi, µ1)

(cid:19)

(cid:88)

i(cid:54)=1

log T.

(3)

One may think that applying the techniques of the SP-MAB
problem would directly yield an optimal bound for a more
general MP-MAB problem. However, this is not the case.
In short, the difﬁculty in analyzing the regret on the MP-
MAB problem arises from the fact that the optimal bound

Figure 1. Two bandit games with the same set of arms. r(t) is
deﬁned as the increase in the regret at round t. In both games
1 and 2, we have the same number of suboptimal arm draws
(N3(2) = N4(2) = 1). However, the regret in games 1 and 2
are different.

on the number of suboptimal arm draws does not directly
lead to the optimal regret. From this point forward, we
focus on the MP-MAB problem in which L is not restricted
to one.

3.2. Extension to MP-MAB problem

The regret lower bound in the MP-MAB problem, which is
the generalization of inequality (3), was provided by Anan-
tharam et al. (1987). They ﬁrst proved that, for any strongly
consistent algorithm and suboptimal arm i, the number of
arm i draws is lower-bounded as

E[Ni(T + 1)] ≥

log T.

(4)

(cid:19)

(cid:18) 1 − o(1)
d(µi, µL)

Unlike in the SP-MAB problem, the regret in the MP-MAB
problem is not uniquely determined by the number of sub-
optimal arm draws. As illustrated in Figure 1, the regret is
dependent on the combinatorial structure of arm draws.

Recall that a regret increase at each round is the gap of ex-
pected rewards between the optimal arms and that of the
selected arms. When a suboptimal arm is selected, one op-
timal arm is excluded from I(t) instead of the suboptimal
arm. Let the selected suboptimal arm and excluded opti-
mal arm be i and j, respectively. Then, we lose expected
reward µj − µi. Namely, the loss in the expected reward at
each round is given by

(cid:88)

µj −

(cid:88)

µi =

(cid:88)

µj −

(cid:88)

µi

j∈[L]

i∈I(t)

i∈I(t)\[L]

≥

(µL − µi),

(5)

j∈[L]\I(t)
(cid:88)

i∈I(t)\[L]

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Algorithm 1 Multiple-play Thompson sampling (MP-TS)
for binary rewards

Input: # of arms K, # of selection L
for i = 1, 2, . . . , K do

Ai, Bi = 1, 1

end for
t ← 1.
for t = 1, 2, . . . , T do

for i = 1, 2, . . . , K do

θi(t) ∼ Beta(Ai, Bi)

end for
I(t) = top-L arms ranked by θi(t).
for i ∈ I(t) do

if Xi(t) = 1 then
Ai ← Ai + 1

else

Bi ← Bi + 1

end if
end for

end for

where we used the fact µj ≥ µL for any optimal arm j.
From this relation, the regret is expressed as

Reg(T ) ≥

(µL − µi)

T
(cid:88)

(cid:88)

t=1

i∈I(t)\[L]

(cid:88)

=

i∈[K]\[L]

(µL − µi)Ni(T + 1)

(6)

which, combined with (4), leads to the regret lower bound
by Anantharam et al. (1987) that any strongly consistent
algorithm satisﬁes

E[Reg(T )] ≥

(cid:88)

i∈[K]\[L]

(1 − o(1))∆i,L
d(µi, µL)

log T.

(7)

3.3. Necessary condition for an optimal algorithm

In Sections 3.1 and 3.2, we saw that the derivations of
the regret bounds are analogous between the SP-MAB and
MP-MAB problems. However, there is a difference in the
relation between the regret and Ni(T ), the number of draws
of suboptimal arms, is given as equation (2) in the SP-MAB
problem, whereas it is given as inequality (6) in the MP-
MAB problem. This means that, an algorithm achieving
the asymptotic lower bound (4) on Ni(T ) does not always
achieve the asymptotic regret bound (7).

When suboptimal arm i is selected, one of the optimal arms
is pushed out instead of arm i, and the regret increases by
the difference between the expected rewards of these two
arms. The best scenario is that, arm L, which is the optimal
arm with the smallest expected reward, is almost always

the arm pushed out instead of a suboptimal arm. For this
scenario to occur, it is necessary to ensure that at most one
suboptimal arm is drawn for almost all rounds because, if
two suboptimal arms are selected, at least one arm in [L−1]
is pushed out.

In the next section, we propose an extension of TS to the
MP-MAB problem, and explain that it has a crucial prop-
erty for suppressing this simultaneous draw of two subop-
timal arms.

Remark: Corollary 1 of Gopalan et al. (2014) shows the
achievability of the bound in the RHS of (4) on the num-
ber of draws of suboptimal arms. Whereas this does not
lead to the optimal regret bound as discussed above, they
originally derived in Theorem 1 an O(log T ) bound on the
number of each suboptimal action (that is, each combina-
tion of arms including suboptimal ones) for a more general
setting of MP-MAB. Thus, we can directly use this bound
to derive a better regret bound. However, to show the op-
timality in the sense of regret it is necessary to prove that
there are at most o(log T ) rounds such that an arm in [L−1]
is pushed out. Therefore, it still requires further discussion
to derive the optimal regret bound of TS. Note also that the
regret bound by Gopalan et al. (2014) is restricted to the
case that the prior has a ﬁnite support and the true param-
eter is in the support, and thus their analysis requires some
approximation scheme for dealing Bernoulli rewards.

4. Multiple-play Thompson Sampling

Algorithm

Algorithm 1 is our MP-TS algorithm. While TS for single-
play selects the top-1 arm based on a posterior sample θi(t),
MP-TS selects the top-L arms ranked by the posterior sam-
ple θi(t). Like Kaufmann et al. (2012) and Agrawal &
Goyal (2013b), we set the uniform prior on each arm.

In Section 3.3, we discussed that the necessary condition
to achieve the optimal regret bound is to suppress the si-
multaneous draws of two or more suboptimal arms, which
characterizes the difﬁculty of the MP-MAB problem.

Note that it is easy to extend other asymptotically opti-
mal SP-MAB algorithms, such as KL-UCB, to the MP-
MAB problem. Nevertheless, we were not able to prove
the optimality of these algorithms for the MP-MAB prob-
lem though the achievability of the bound (4) on Ni(T ) is
easily proved, and the simulation results in Section 7 also
imply their achievability of the regret bound. This is be-
cause TS has quite a plausible property to suppress simul-
taneous draws as we discuss below.

Before the exact statement in the next section, we give an
intuition for the natural extension of TS (or other asymp-
totically optimal SP-MAB algorithms) can have the opti-

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

mal regret in the MP-MAB problem. Roughly speaking, a
bandit algorithm with a logarithmic regret draws a subop-
timal arm with probability O(1/t) at the t-th round, which
amounts to O((cid:80)T
t=1 1/t) = O(log T ) regret. Thus, two
suboptimal arms are drawn at the same round with proba-
bility O(1/t2), which amounts to O((cid:80)T
t=1 1/t2) = O(1)
total simultaneous draws, provided that each suboptimal
arm is selected independently.

In TS, the score θi(t) for the choice of arms is generated
randomly at each round from the posterior independently
between each arm, which enables us to bound simultane-
ous draws as the above intuition. On the other hand, in
KL-UCB (or in other index policies), the UCB score for
the choice of arms is deterministic given the past results of
rewards, which means that the scores of suboptimal arms
may behave quite similarly in the worst case on the past
rewards.

5. Optimal Regret Bound

In this section, we state the main theoretical result (Theo-
rem 1). The analysis that leads to this theorem is discussed
in Section 6.
Theorem 1. (Regret upper bound of MP-TS) For any sufﬁ-
ciently small (cid:15)1 > 0, (cid:15)2 > 0, the regret of MP-TS is upper-
bounded as

E[Reg(T )] ≤

(cid:88)

i∈[K]\[L]

(cid:18) (1 + (cid:15)1)∆i,L log T
d(µi, µL)

(cid:19)

+ Ca((cid:15)1, µ1, µ2, . . . , µK) + Cb(T, (cid:15)2, µ1, µ2, . . . , µK),

where, Ca = Ca((cid:15)1, µ1, µ2, . . . , µK) is a constant inde-
pendent on T and is O((cid:15)−2
i=1 as
constants. The value Cb = Cb(T, (cid:15)2, µ1, µ2, . . . , µK) is
a function of T , which, by choosing proper (cid:15)2, grows at a
rate of O(log log T ) = o(log T ).

1 ) when we regard {µi}K

By letting (cid:15)1 = O((log T )−1/3) we obtain

E[Reg(T )] ≤

(cid:88)

∆i,L log T
d(µi, µL)

i∈[K]\[L]

+ O((log T )2/3) (8)

and we see that MP-TS achieves the asymptotic bound in
(7).

Expected regret and high-probability regret: Anan-
tharam et al. (1987) originally derived a regret lower bound
in a stronger form than (7) such that for any (cid:15) > 0, the
regret of a strongly consistent algorithm is lower-bounded
as





Reg(T )
log T

≥

lim
T →∞

Pr

(cid:88)

(1 − (cid:15))∆i,L
d(µi, µL)

i∈[K]\[L]



 = 1.

Combining this with (8) we can easily see that MP-TS sat-
isﬁes





Reg(T )
log T

≤

lim
T →∞

Pr

(cid:88)

(1 + (cid:15))∆i,L
d(µi, µL)

i∈[K]\[L]



 = 1,

(9)

that is, MP-TS is also asymptotically optimal in the sense
of high probability. Since an algorithm satisfying (9) is not
always optimal in the sense of expectation, our result, the
expected optimal regret bound, is also stronger in this sense
than the high-probability bound by Gopalan et al. (2014).

6. Regret Analysis
We ﬁrst deﬁne some additional notation that are useful for
our analysis in Section 6.1 then analyze the regret bound
in Section 6.2. The proofs of all the lemmas, except for
Lemma 2, are given in the Appendix.

i

i

log T

(T ) =

i
. Intuitively, N suf

L = µL − δ and µ(+)

L ∈ (µL+1, µL) and µ(+)
d(µ(+)
i

6.1. Additional notation
Let µ(−)
i = µi + δ for δ > 0 and
i ∈ [K] \ [L]. We assume δ to be sufﬁciently small such
that µ(−)
∈ (µi, µL). We also
deﬁne N suf
(T ) is the
,µ(−)
L )
sufﬁcient number of explorations to make sure that arm i is
not as good as arm L.
Events: Now, let max(m)
i∈S ai denote the m-th largest el-
ement of {ai}i∈S ∈ R|S|,
(m)ai =
We deﬁne θ∗(t) =
maxS(cid:48)⊂S:|S(cid:48)|=m mini∈S(cid:48) ai.
max(L)
i∈[K] θi(t) as the L-th largest posterior sample at round
t (i.e., the minimum posterior sample among the selected
arms), and θ∗∗
k∈[K]\{i,j} θk(t) as the (L − 1)-
th largest posterior sample at round t except for arms i and
j. Moreover, let ν = µL−1+µL
. Let us deﬁne the following
events.

\i,j(t) = max(L−1)

is, maxi∈S

that

2

Ai(t) = {i ∈ I(t)},
B(t) = {θ∗(t) ≥ µ(−)

L },

Ci(t) =

(cid:92)

{θ∗∗

\i,j(t) ≥ ν},

j∈[K]\([L−1]∪{i})

Di(t) = {Ni(t) < N suf

(T )}.

i

Event Ai(t) states that arm i is sampled at round t, and
Di(t) states that arm i has not been sampled sufﬁciently
yet. The complements of B(t) and Ci(t) are related to the
underestimation of optimal arms. Since the optimal arms
are sampled sufﬁciently, Bc(t) or Cc
i (t) should not occur
very frequently.

6.2. Proof of Theorem 1

We ﬁrst decompose the regret to the contribution of each
arm. Recall that, the regret increase by drawing suboptimal

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

arm i is determined by the optimal arm excluded in the
selection set I(t). Formally, for suboptimal arm i, let

• Term (D) corresponds to the case in which, arm i is

selected after it is sufﬁciently explored.

(cid:40)

∆i(t) =

(maxj∈[L]\I(t) µj) − µi
0

if I(t) (cid:54)= [L],
otherwise,

Proof of Lemma 2. The contribution of suboptimal arm i
to the regret is decomposed as follows. By using the fact
∆i(t) ≤ 1 and the following decomposition of an event

and

Regi(T ) =

1{i ∈ I(t)}∆i(t).

T
(cid:88)

t=1

(10)

Ai(t) ⊂ Bc(t) ∪ {Ai(t), Cc
⊂ Bc(t) ∪ {Ai(t), Cc
i (t)}
∪ {Ai(t), B(t), Dc

i (t)} ∪ {Ai(t), B(t), Ci(t)}

i (t)} ∪ {Ai(t), Ci(t), Di(t)},

From inequality (5) the following inequality is easily de-
rived

we have

Reg(T ) ≤

(cid:88)

Regi(T ).

i∈[K]\[L]

We next decompose Regi(T ) into several terms by using
events A–D. After giving bounds for these terms, we ﬁ-
nally give the total regret bound, which proves Theorem
1. Note that, in bounding the deviation of Bernoulli means
and Beta posteriors in the Appendix, our analysis borrowed
some techniques developed in the context of the SP-MAB
problem, mostly from Agrawal & Goyal (2013b), and some
from Honda & Takemura (2014).
Lemma 2. The regret by drawing suboptimal arm i > L is
decomposed as:

Regi(T ) ≤

1{Bc(t)}

+

1{Ai(t), Cc

i (t)}

Regi(T ) =

1{Ai(t)}∆i(t)

≤

1{Bc(t)} +

1{Ai(t), Cc

i (t)}

T
(cid:88)

t=1

T
(cid:88)

t=1

1{Ai(t), B(t), Dc

i (t)}

T
(cid:88)

t=1

+

+

T
(cid:88)

t=1

T
(cid:88)

t=1

1{Ai(t), Ci(t), Di(t)}∆i(t).

(11)

Recall that ∆i(t) is deﬁned as (10). At each round, when L
and all suboptimal arms, except for i, are not selected, then
I(t) = {1, 2, . . . , L − 1, i}; ∆i(t) = ∆i,L. Therefore,

T
(cid:88)

t=1
(cid:124)

(cid:123)(cid:122)
(C)

T
(cid:88)

t=1
(cid:124)

T
(cid:88)

t=1
(cid:124)

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

+

(cid:123)(cid:122)
(A)

(cid:125)

(cid:123)(cid:122)
(B)

(cid:125)

1{Ai(t), Ci(t), Di(t)}∆i(t)

+

(cid:88)

j∈[K]\([L−1]∪{i})
(cid:124)

T
(cid:88)

t=1

1{Ai(t), Ci(t), Di(t), Aj(t)}

(cid:125)

≤

1{Ai(t), Ci(t), Di(t)}∆i,L

+

1{Ai(t), B(t), Dc

i (t)}

+N suf
i

(T )∆i,L,

+

1{Ai(t), Ci(t), Di(t),

(cid:91)

Aj(t)}

j∈[K]\([L−1]∪{i})

(cid:123)(cid:122)
(D)

(cid:125)

≤

1{Ai(t), Di(t)}∆i,L

where, for example, {A, B} abbreviates {A ∩ B}.

Roughly speaking,

• Term (A) corresponds to the case in which, some of

the optimal arms are under-estimated.

• Term (B) corresponds to the case in which, arm i is
selected and some of the arms in [L − 1] are under-
estimated.

• Term (C) corresponds to the case in which, arm i ∈
[K] \ [L] and j ∈ [K] \ ([L − 1] ∪ {i}) are simulta-
neously drawn.
In particular, term (C) is unique in
the MP-MAB problem that causes additional regret
increase, and in analyzing this term we fully use the
fact that the samples of the posterior distributions on
the arms are independent of each other.

(cid:88)

T
(cid:88)

1{Ai(t), Ci(t), Di(t), Aj(t)}

j∈[K]\([L−1]∪{i})

t=1

≤ N suf
i

(T )∆i,L

(cid:88)

T
(cid:88)

j∈[K]\([L−1]∪{i})

t=1

+

1{Ai(t), Ci(t), Di(t), Aj(t)}.

(12)

Summarizing (11) and (12) completes the proof.

The following lemma bounds terms (A)–(D).
Lemma 3. (Bounds on individual terms) Let (cid:15)2 > 0 be
arbitrary. For sufﬁciently small δ and (cid:15)2, the four terms

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

are bounded in expectation as:
(cid:32)

(cid:33)

E[(A)] = O

1
(µL − µ(−)

L )2

= O

(cid:19)

,

(cid:18) 1
δ2

E[(B)] = O(log log T ),
(cid:18)

E[(C)] ≤

(cid:88)

(cid:15)2 + 4T −

(cid:15)2∆2
8

L,L−1

(cid:19)

log T

j∈[K]\([L−1]∪{i})

d(µi, µL)

and

E[(D)] ≤ 2+

1
d(µ(+)
i

, µi)

= O

(cid:19)

.

(cid:18) 1
δ2

(13)

(14)

(15)

(16)

+ O(1),

The proof of Lemma 3 is in Appendix A.4. Lemma 3 states
that terms (A), (B), and (D) are O(1/δ2). Moreover, the
following lemma bounds term (C).
Lemma 4. (Asymptotic convergence of (cid:15)2-dependent fac-
tor) By choosing an O((log log T )/ log T ) value of (cid:15)2, we
obtain E[(C)] = O(log log T ).

The proof of Lemma 4 is in Appendix A.5. Now it suf-
ﬁces to evaluate N suf
to complete the
proof. From the convexity of KL divergence there exists a
constant ci = ci(µi, µL) > 0 such that

(T ) =

d(µ(+)
i

,µ(−)
L )

log T

i

d(µ(+)
i

, µ(−)

L ) = d(µi + δ, µL − δ) ≥ (1 − ciδ)d(µi, µL)

and therefore

E[Reg(T )]≤

(cid:88)

E[Regi(T )] ≤

(cid:34) T

(cid:88)

(cid:88)

E

(cid:35)

1{Ai(t)}∆i(t)

i∈[K]\[L]

i∈[K]\[L]

t=1

(cid:88)

≤

(cid:8)E [(A) + (B) + (C) + (D)] + N suf

(T )∆i,L

i

(cid:9)

i∈[K]\[L]

(cid:88)

≤
i∈[K]\[L]

(cid:124)

∆i,L log T
(1 − ciδ)d(µi, µL)

(cid:123)(cid:122)
main term

(cid:18) 1
δ2
(cid:123)(cid:122)
Ca

(cid:19)

(cid:125)

+ O

(cid:124)

(cid:125)

+ O(log log T )
(cid:123)(cid:122)
(cid:125)
Cb

(cid:124)

.

Since (1 − ciδ)−1 ≤ 1 + 2ciδ for ciδ ≤ 1/2, we com-
plete the proof of Theorem 1 by letting (cid:15)1 < 1/2 and
δ = (cid:15)1/ maxi∈[K]\[L] ci = Θ((cid:15)1).

7. Experiment
We ran a series of computer simulations1 to clarify the em-
pirical properties MP-TS. The simulations involved the fol-
lowing three scenarios. In Scenarios 1 and 2, we used ﬁxed
arms similar to that of Garivier & Capp´e (2011), and Sce-
nario 3 is based on a click log dataset of advertisements on
a commercial search engine.
Algorithms:
the simulations involved MP-TS, Exp3.M
(Uchiya et al., 2010), CUCB (Chen et al., 2013), and

1The source code of

the simulations

is available at

https://github.com/jkomiyama/multiplaybanditlib.

arms with {µ1, . . . , µ5}

the MP-MAB problem2.

the simulations
=

MP-KL-UCB. Exp3.M is a state-of-the-art adversarial
The
bandit algorithm for
learning rate γ of Exp3.M is set
in accordance with
Corollary 1 of Uchiya et al. (2010). Note that
the
CUCB algorithm in the MP-MAB problem at each
round draws the top-L arms of the UCB indices ˆµi +
(cid:112)(3 log t)/(2Ni(t)). MP-KL-UCB is the algorithm that
selects the top-L arms in accordance with the KL-UCB in-
dex supq∈[ˆµi(t),1] {q|Ni(t)d(ˆµi(t), q) ≤ log t}.
Scenario 1 (5-armed bandits):
include 5 Bernoulli
{0.7, 0.6, 0.5, 0.4, 0.3}, and L = 2.
Scenario 2 (20-armed bandits):
the simulations in-
clude 20 Bernoulli arms with µ1 = 0.15, µ2 = 0.12,
µ3 = 0.10, µi = 0.05 for i ∈ {4, 5, . . . , 12}, µi = 0.03 for
i ∈ {13, 14, . . . , 20}, and L = 3.
Scenario 3 (many-armed bandits, online advertisement
based CTRs): we conducted another set of experiments
with arms whose expectations were based on the dataset
provided for KDD Cup3 2012 track 2. The dataset involves
a click log on soso.com (a large-scale search engine ser-
viced by Tencent), which is composed of 149 million im-
pressions (view of advertisements). We processed the data
as follows. First, we excluded users of abnormally high
click probability (i.e., users who had more than 1, 000 im-
pressions and more than 0.1 click probability) from the log.
We also excluded minor advertisements (ads) that had less
than 5, 000 impressions. There are a wide variety of ads
on a search engine (e.g., ”rental cars”, ”music”, etc.) and
randomly picking ads from a search engine should yield a
set of irrelevant ads. To address this issue, we selected pop-
ular queries that had more than 104 impressions and more
than 50 ads that appeared on the query. As a result, 80
queries were obtained. The number of ads associated with
each query ranged from 50 to 105, and the average click-
through-rate (CTR, the probability that the ad is clicked) of
an ad on each query ranged from 1.15% to 6.86%. After
that, each ad was converted into a Bernoulli arm with its
expectations corresponding to the CTR of the ad. At the
beginning of each run, one of the queries was randomly se-
lected, and the bandit simulation with the arms correspond-
ing to the query and L = 3 is then conducted. This scenario
was more difﬁcult than the ﬁrst two scenarios in the sense
that 1) a larger number of arms were involved and 2) the
reward gap among arms was very small.

The simulation results are shown in Figure 2. In all sce-
narios, the tendency is the same: our proposed MP-TS per-
forms signiﬁcantly better than the other algorithms. MP-
KL-UCB is not as good as MP-TS, but clearly better than
CUCB and Exp3.M. While it is unclear whether the slope

2Note that, Exp3.M is designed for the adversarial setting in

which the rewards of arms are not necessarily stationary.

3https://www.kddcup2012.org/

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

(a) Scenario 1

(b) Scenario 2

(c) Scenario 3

Figure 2. Regret-round plots of algorithms. The regret in Scenarios 1 and 2 are averaged over 10, 000 runs, and the regret in Scenario 3
is averaged over 1, 000 runs. “Lower Bound” is the leading Ω(log T ) term of the RHS of inequality (7). We do not show Lower Bound
in Scenario 3 because the coefﬁcient of the bound can sometimes be quite large (i.e., in some runs, 1/d(µL+1, µL) is large).

of the regret of MP-KL-UCB converges to the asymptotic
bound or not, the slope of the regret of TS quickly ap-
proaches the asymptotic lower bound.

7.1. Improvement of MP-TS based on the empirical

means

even though L − 1 arms are selected based on empirical
means as in IMP-TS. Similarly, we deﬁne an improved ver-
sion of MP-KL-UCB (IMP-KL-UCB) for selecting the ﬁrst
L − 1 arms on the basis of empirical averages. The be-
fore/after analysis of this improvement is shown in Figure
3. One sees that, (i) MP-TS still performs better than IMP-
KL-UCB, and (ii) IMP-TS reduces the regret throughout
the rounds. In particular, when the number of the rounds is
small (T ∼ 103–104), the advantage of IMP-TS is large.

8. Discussion
We extended TS to the multiple-play setting and proved its
optimality in terms of the regret. We considered the case in
which the total reward is linear to the individual rewards of
selected arms. The analysis in this paper fully uses the in-
dependent property of posterior samples and paves the way
to obtain a tight analysis on the multiple-play regret that de-
pends on the combinatorial structure of arm selection. We
now point out two promising directions for future work.

• Position-dependent factors for online advertising:
it is well-known that the CTR of an ad is dependent
on its position. Taking the position-dependent fac-
tor into consideration changes the MP-MAB problem
from the L-set selection problem to the L-sequence
selection problem in which the position of L arms
matters. For the starting point, we consider an ex-
tension of MP-TS for the cascade model (Kempe &
Mahdian, 2008; Aggarwal et al., 2008) that corrects
position-dependent bias in Appendix A.2.

• Non-Bernoulli distributions for general problems:
for the ease of argument, we exclusively consider the
binary rewards. The analysis by Korda et al. (2013)
is useful in extending our result to the case of the 1-d
exponential families of rewards. Moreover, extend-
ing our result to multi-parameter reward distributions
(Burnetas & Katehakis, 1996; Honda & Takemura,
2014) is interesting.

Figure 3. Before/after comparison of MP-TS. All settings (except
for algorithms) are the same as that of Scenario 3.

We now introduce an improved version of MP-TS (IMP-
TS). In the theoretical analysis of the MP-MAB problem,
we observed that an extra loss arises when multiple subop-
timal arms are drawn at the same round. Based on this ob-
servation, the new algorithm selects L−1 arms on the basis
of empirical averages and selects the last arm on the basis
of TS to avoid simultaneous draws of suboptimal arms. In
other words, this algorithm is further aimed to minimize
the regret by purely exploiting the knowledge in the top-
(L − 1) arms; thus, limiting the exploration to only one
arm. One might fear that this increase in exploitation could
devastate the balance between exploration and exploitation.
Although we provide no regret bound for the improved ver-
sion of the algorithm, we expect that this algorithm will
also achieve the asymptotic bound for the following reason.
When we restrict the exploration to one arm, the number of
opportunities for an arm to be explored may decrease, say,
from T to T /L. Still, T /L opportunities are sufﬁcient since
O(log(T /L)) = O(log T ). In fact, the algorithm proposed
by Anantharam et al. (1987) achieves the asymptotic bound

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Acknowledgements

We gratefully acknowledge the insightful advice from Issei
Sato and Tao Qin. We thank Yingce Xia for discussion on
the evaluation of (14). We thank Bertrand Chapleau for dis-
cussion on Bias-corrected MP-TS. We thank Zhibing Zhao
for pointing out our notation error in the arXiv version. We
thank the anonymous reviewers in ICML2015 for their use-
ful comments. This work was supported in part by JSPS
KAKENHI Grant Number 26106506.

References

Aggarwal, Gagan, Feldman, Jon, Muthukrishnan, S., and
P´al, Martin. Sponsored search auctions with markovian
users. In WINE, pp. 621–628, 2008.

Agrawal, Shipra and Goyal, Navin. Analysis of thompson
sampling for the multi-armed bandit problem. In COLT,
pp. 39.1–39.26, 2012.

Agrawal, Shipra and Goyal, Navin. Thompson sampling
for contextual bandits with linear payoffs. In ICML, pp.
127–135, 2013a.

Agrawal, Shipra and Goyal, Navin. Further optimal regret
bounds for thompson sampling. In AISTATS, pp. 99–107,
2013b.

Anantharam, V., Varaiya, P., and Walrand, J. Asymptoti-
cally efﬁcient allocation rules for the multiarmed bandit
problem with multiple plays-part i: I.i.d. rewards. Auto-
matic Control, IEEE Transactions on, 32(11):968–976,
1987.

Auer, Peter, Cesa-bianchi, Nicol´o, and Fischer, Paul.
Finite-time Analysis of the Multiarmed Bandit Problem.
Machine Learning, 47:235–256, 2002.

Burnetas, A.N. and Katehakis, M.N. Optimal adaptive poli-
cies for sequential allocation problems. Advances in Ap-
plied Mathematics, 17(2):122–142, 1996.

Capp´e, Olivier, Garivier, Aur´elien, Maillard, Odalric-
Ambrym, Munos, R´emi, and Stoltz, Gilles. Kullback-
leibler upper conﬁdence bounds for optimal sequential
allocation. Ann. Statist., 41(3):1516–1541, 06 2013.

Chapelle, Olivier and Li, Lihong. An empirical evaluation
of thompson sampling. In NIPS, pp. 2249–2257, 2011.

Garivier, Aur´elien and Capp´e, Olivier. The KL-UCB al-
gorithm for bounded stochastic bandits and beyond. In
COLT, pp. 359–376, 2011.

Gatti, Nicola, Lazaric, Alessandro, and Trov`o, Francesco.
A truthful learning mechanism for multi-slot sponsored
search auctions with externalities. In AAMAS, pp. 1325–
1326, 2012.

Gittins, J.C. and Jones, D.M. A dynamic allocation in-
dex for the sequential design of experiments. In Gani,
J. (ed.), Progress in Statistics, pp. 241–266. North-
Holland, Amsterdam, NL, 1974.

Gopalan, Aditya, Mannor, Shie, and Mansour, Yishay.
Thompson sampling for complex bandit problems.
In
ICML, 2014.

Guha, Sudipto and Munagala, Kamesh. Stochastic regret
In COLT, pp.

minimization via thompson sampling.
317–338, 2014.

Honda, Junya and Takemura, Akimichi. An Asymptot-
ically Optimal Bandit Algorithm for Bounded Support
Models. In COLT, pp. 67–79, 2010.

Honda, Junya and Takemura, Akimichi. Optimality of
thompson sampling for gaussian bandits depends on pri-
ors. In AISTATS, pp. 375–383, 2014.

Huang, Senhua, Liu, Xin, and Ding, Zhi. Opportunistic
spectrum access in cognitive radio networks. In INFO-
COM, pp. 1427–1435, 2008.

Kaufmann, Emilie, Korda, Nathaniel, and Munos, R´emi.
Thompson sampling: An asymptotically optimal ﬁnite-
time analysis. In ALT, pp. 199–213, 2012.

Kempe, David and Mahdian, Mohammad. A cascade
In WINE,

model for externalities in sponsored search.
pp. 585–596, 2008.

Koc´ak, Tom´as, Valko, Michal, Munos, R´emi, and Agrawal,
Shipra. Spectral thompson sampling. In AAAI, pp. 1911–
1917, 2014.

Korda, Nathaniel, Kaufmann, Emilie, and Munos, R´emi.
Thompson sampling for 1-dimensional exponential fam-
ily bandits. In NIPS, pp. 1448–1456, 2013.

Chen, Wei, Wang, Yajun, and Yuan, Yang. Combinato-
rial multi-armed bandit: General framework and appli-
cations. In ICML, pp. 151–159, 2013.

Lai, T. L. and Robbins, Herbert. Asymptotically efﬁcient
adaptive allocation rules. Advances in Applied Mathe-
matics, 6(1):4–22, 1985.

Craswell, Nick, Zoeter, Onno, Taylor, Michael J., and
Ramsey, Bill. An experimental comparison of click
position-bias models. In WSDM, pp. 87–94, 2008.

Osband, Ian, Russo, Daniel, and Roy, Benjamin Van.
learning via posterior

(more) efﬁcient reinforcement
sampling. In NIPS, pp. 3003–3011, 2013.

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Russo, Daniel and Roy, Benjamin Van. Eluder dimension
and the sample complexity of optimistic exploration. In
NIPS, pp. 2256–2264, 2013.

Scott, Steven L. A modern bayesian look at the multi-
armed bandit. Appl. Stoch. Model. Bus. Ind., 26(6):639–
658, November 2010. ISSN 1524-1904.

Thompson, William R. On The Likelihood That One Un-
known Probability Exceeds Another In View Of The Ev-
idence Of Two Samples. Biometrika, 25:285–294, 1933.

Uchiya, Taishi, Nakamura, Atsuyoshi, and Kudo, Mine-
ichi. Algorithms for adversarial bandit problems with
multiple plays. In ALT, pp. 375–389, 2010.

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

A. Appendix

A.1. Cases of several arms having the same expectation

Up to now, we have assumed that all arms have distinct ex-
pectations. Here, we consider cases in which some arms
have the same expectations. Without loss of generality,
we assume µ1 ≥ µ2 ≥, . . . , ≥ µK. Let us call arms
with a larger expectation than µL “strictly optimal” arms,
arms with the same expectation as µL “marginal” arms, and
arms with a smaller expectation than µL “strictly subopti-
mal” arms. Each arm is either strictly optimal, marginal, or
strictly suboptimal.

Case 1: Assume that all strictly optimal arms are distinct,
that there is only one marginal arm, and that there are sev-
eral strictly suboptimal arms with the same expectation. In
this case, the regret bound of Theorem 1 holds because our
analysis deals with each suboptimal arm separately.

Case 2: Assume that there is only one marginal arm, that
all strictly suboptimal arms are distinct, and that there are
several strictly optimal arms with the same expectation.
The regret bound also holds in this case since there is a
gap between each strictly suboptimal arm and each strictly
optimal arm.

Case 3: Assume that all strictly optimal arms and strictly
suboptimal arms are distinct and that there are several
marginal arms with the same expectation. Unfortunately,
we were unable to perform a meaningful analysis in
this case.
Intuitively, as stated by Agrawal and Goyal
(Agrawal & Goyal, 2012) for SP-MAB, adding an addi-
tional marginal arm appears to require some extra explo-
ration, which slightly increases the regret. However, the re-
gret structure is more complex than the SP-MAB because
several marginal arms can be drawn simultaneously.

In summary, our Theorem 1 holds when the marginal arm
is distinct. That is, µ1 ≥ µ2 ≥ · · · ≥ µL−1 > µL >
µL+1 ≥ · · · ≥ µK.

A.2. Cascade model and position-dependent MP-MAB

problem

In the main paper, we assumed that the rewards of arms are
independently and identically drawn from individual dis-
tributions.
In this section, we relax this assumption and
consider a wider class of the MP-MAB problem. Remem-
ber that, one of our primary applications is multiple adver-
tisement placement in the online advertising problem (c.f.,
Example 1).
In this section, we interchangeably use the
terms an advertisement (ad) and an arm. It is known that
the CTR of an ad depends on the environment where the
ad is placed, especially on the position of the ad. Among
several models that explain this dependency on the posi-
tion, the model that explains human behavior and agrees

Algorithm 2 Bias-Corrected Multiple-play Thompson
sampling (BC-MP-TS) for binary rewards

Input: # of arms K, # of positions L, discount fac-
tors {γl(i)}
for i = 1, 2, . . . , K do

Ai, Ni = 1, 2

end for
t ← 1.
for t = 1, 2 . . . , T do

for i = 1, 2, . . . , K do

Bi ← max (Ni − Ai, 1)
θi(t) ∼ Beta(Ai, Bi)

end for
Select Il(t) (l = 1, . . . , L) in accordance with Section
A.2.2.
for l ∈ 1, 2, . . . , L do
if Xi(t) = 1 then
Ai ← Ai + 1

end if
Ni ← Ni + (cid:81)l

l(cid:48)=2 γl(cid:48)(Il(cid:48)−1(t))

end for

end for

well with real data (Craswell et al., 2008) is the cascade
model (Kempe & Mahdian, 2008; Aggarwal et al., 2008),
with which it is assumed that the user scans the ads from
top to bottom. Following Gatti et al. (2012), we deﬁne
the discount factor γl(i) for l ≥ 2 as the probability that
a user observing ad i in position l − 1 will observe the
ad in the next position. Namely, the MP-MAB problem
with a discount factor is deﬁned as a MP-MAB problem
in which the arm at position l yields reward 1 with proba-
µIl(t), where Il(t) be the arm
bility
placed at the l-th position at round t. Note that, when we
set γl(i) = 1 for any position l ∈ [L] and ad i, this model is
reduced to the model we considered in the main paper. In
the MP-MAB problem in the main paper, the order of the L
arms does not matter. Whereas, under a position-dependent
discount factor smaller than 1, the order of L arms matters:
the problem is not the selection of an L-set of arms, but an
L-sequence of arms.

l(cid:48)=2 γl(cid:48)(Il(cid:48)−1(t))

(cid:16)(cid:81)l

(cid:17)

A.2.1. THOMPSON SAMPLING FOR CASCADE MODEL

In the cascade model, there is some probability that the arm
at position l > 1 is not drawn. The probability that the
arm at position l is drawn, (cid:81)l
l(cid:48)=2 γl(cid:48)(Il(cid:48)−1(t)), can be con-
sidered as the effective number of the draws at position i.
MP-TS (Algorithm 1) keeps Ai and Bi, which respectively
correspond to the number of rewards 1 and 0. The number
of draws on the arm i is Ni = Ai + Bi. When we consider
the cascade model, we need to take the effective number of
draw into consideration. We introduce Bias-corrected MP-

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

TS (BC-MP-TS, Algorithm 2). The crux of BC-MP-TS is
that, for each arm that is selected, Ni should be increased
not by 1, but by the effective number of draw for each posi-
tion. Note that, when γl(i) = 1, BC-MP-TS is essentially
the same as MP-TS.

A.2.2. OPTIMAL ARM SELECTION AND THE REGRET

In general discount factor γl(i), even if we have perfect
information over the expectation of all arms {µi}K
i=1, the
computation of the optimal sequence of L-arms at each
round t (optimal arm selection) appears to be computation-
ally intractable when K is large because we need to search
all the possible allocation of K ads over L positions. In the
case where γl(i) = γ(i), Kempe & Mahdian (2008) pro-
posed a polynomial-time approximation of the optimal arm
selection. We can obtain the arm selection strategy for BC-
MP-TS by using this approximation algorithm as an oracle
and plugging {θi(t)}L

i=1 as estimated expected rewards.

Ad-independent discount factor: when the discount fac-
tor is independent of the ad at that position (i.e., γl(i) =
γl), the optimal arm selection is easy: just select µl (i.e.,
l-th best arm) on the l-th position. We deﬁne the arm selec-
tion strategy of BC-MP-TS as placing the arm of the l-th
largest θi (i.e., Il(t) = max(l)

i∈[K] θi) on the l-th position.

Regret: naturally, the regret per round is deﬁned as the
difference between the expected reward of the optimal arm
selection and that of an algorithm. Namely,

T
(cid:88)

L
(cid:88)

(cid:32) l

(cid:89)

t=1

l=1

l(cid:48)=2

l
(cid:89)

l(cid:48)=2
(cid:124)

−

γl(cid:48)(Il(cid:48)−1(t))

×µIl(t)

(cid:123)(cid:122)
effective number of draw at position l

(cid:125)

where (Iopt(1), . . . , Iopt(L)) is the optimal arm selection.
In the case of the ad-independent discount factor, we con-
jecture that the regret lower bound should be identical to
the case of no-discount factor that we analysed in the main
paper (i.e., inequality (7)). Although we do not prove any
regret bound for this cascade model, the conjecture is sup-
ported by the fact that (i) by identifying the top-L arm
we immediately obtain the optimal arm selection, (ii) algo-
rithms should require log T /d(µi, µL) number of effective
draws to convince that suboptimal arm i > L is not as good
as arm L, and (iii) the best situation is that the simultane-
ous draw of several optimal arms rarely occurs: arm L is
pushed out instead of arm i, and the regret increase per an
effective draw is µL−µi. In the case of the general discount
factor, the problem is subtler because a slight difference in
{µi} can change the optimal arm selection.

Figure 4. Simulation with a discount factor. Lower Bound is the
leading Ω(log T ) term of the RHS of inequality (7), which we
have conjectured to be the lower bound for the cascade model
with the ad-independent discount factor in Section A.2.2. The
regret is averaged over 10, 000 runs.

A.2.3. EXPERIMENT OF CASCADE MODEL

This simulation adapts the cascade model and involves a
constant discount factor γl(i) = 0.7 for any position and
arm. There are 9 Bernoulli arms with µ1 = 0.24, µ2 =
0.21, . . . , µ9 = 0.00 and L = 3. In this case the optimal
arm selection strategy is to choose {I1(t), I2(t), I3(t)} =
{µ1, µ2, µ3} (c.f., Section A.2.2). The regret of the al-
gorithms is shown in 4. On one hand, MP-TS failed to
have a small regret due to its ignorance to the discount fac-
tors. On the other hand, the slope of BC-MP-TS quickly
approaches the conjectured Lower Bound, which is em-
pirical evidence of the ability of BC-MP-TS to correct the
position-dependent bias.

(cid:33)
,

Fact 5. (Chernoff bound for binary random variables)
Let X1, . . . , Xn be i.i.d. binary random variables. Let ˆX =
i=1 Xi and µ = E[Xi]. Then, for any (cid:15) ∈ (0, 1 − µ),
1
n

(cid:80)n

Pr( ˆX ≥ µ + (cid:15)) ≤ exp (−d(µ + (cid:15), µ)n).

and, for any (cid:15) ∈ (0, µ),

Pr( ˆX ≤ µ − (cid:15)) ≤ exp (−d(µ − (cid:15), µ)n).

Fact 6. (Beta-Binomial equality) Let F beta
α,β (y) be the cdf
of the beta distribution with integer parameters α and β.
Let F B
n,p(·) be the cdf of the binomial distribution with pa-
rameters n, p. Then,

α,β (y) = 1 − F B
F beta

α+β−1,y(α − 1),

Fact 7. (Pinsker’s inequality for binary random variables)
For p, q ∈ (0, 1), the KL divergence between two Bernoulli
distributions is bounded as:

d(p, q) ≥ 2(p − q)2.

Reg(T ) =

γl(cid:48)(Iopt(l(cid:48) − 1))µIopt(l)

A.3. Key fact and lemmas

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Lemma 8. (Lemma 2 in Agrawal & Goyal (2013b)) Let
k ∈ [K], n ≥ 0 and x < µk. Let ˆµk,n be the em-
pirical average of n samples from Bernoulli(µk). Let
pk,n(x) = 1 − F beta
ˆµk,nn+1,(1−ˆµk,n)n+1(y) be the probability
that the posterior sample from the Beta distribution with its
parameter ˆµk,nn + 1, (1 − ˆµk,n)n + 1 exceeds x. Then, its
average over runs is bounded as:

(cid:20)

E

(cid:21)

≤

1
pk,n(x)

1 + 3
∆k(x)
(cid:32)






(cid:33)

+

1
e∆k (x)2n/4−1

1 + Θ

e−∆k(x)2n/2 +

1

(n+1)∆k(x)2 e−Dk(x)n

Here note that the event

(n < 8/∆k(x))

(n ≥ 8/∆k(x)),

m ≤

1{θk(t) < z, S(t), U(t), Nk(t) = n}

1{θk(t) < z, S(t), U(t), Nk(t) < Nc}

1{θk(t) < z, S(t), U(t), Nk(t) = n}

1

m ≤

1{θk(t) < z, S(t), U(t), Nk(t) = n}

.

(cid:35)

(18)

Proof. First we have

T
(cid:88)

t=1

≤

≤

Nc(cid:88)

T
(cid:88)

n=0

t=1

Nc(cid:88)

T
(cid:88)

(cid:34)

n=0

m=1

T
(cid:88)

t=1

T
(cid:88)

t=1

implies that the event

{S(t), U(t), Nk(t) = n}

(19)

occurred for at least m rounds and {θk(t) < z} or T c(t)
occurred for the ﬁrst m rounds such that (19) occurred.
Thus, by using the mutual independence of {θk(t) < z},
S(t), and T (t), we have

(cid:34)

Pr

m ≤

T
(cid:88)

t=1

(cid:12)
(cid:12)
(cid:12)
1{θk(t) < z, S(t), U(t), Nk(t) = n}
(cid:12)
(cid:12)

(cid:35)

ˆµk,n

≤ (1 − pk,n(z)q)m (20)

where ∆k(x) = µk − x, Dk(x) = d(x, µk).

In the proof of Lemma 3 we use the following Lemmas
9, 10, and 11 several times. Lemma 9 is essentially the
combination of the existing techniques of Agrawal & Goyal
(2013b) and Honda & Takemura (2014). Lemmas 10 and
11 are also existing techniques that appear in several previ-
ous analyses in Bayesian bandits with Bernoulli arms.
Lemma 9. Let k ∈ [K], z < µk be arbitrary, S(t), T (t),
and U(t) be events such that

(i) if {θk(t) ≥ z}, S(t), and T (t) occurred then the arm

k is drawn at round t,

and therefore

(ii) θk(t), S(t) and T (t) are mutually independent given

{ˆµi(t)}K

i=1 and {Ni(t)}K

i=1.

(iii) The event U(t) is deterministic given {ˆµi(t)}K

i=1 and

{Ni(t)}K

i=1.

(iv) Given {ˆµi(t)}K

i=1 and {Ni(t)}K
holds, T (t) occurs with probability at least q > 0.

i=1 such that U(t)

t=1

Nc(cid:88)

T
(cid:88)

n=0

m=1

≤

≤

(cid:34) T

(cid:88)

E

(cid:12)
(cid:12)
(cid:12)
1{θk(t) < z, S(t), U(t), Nk(t) < Nc}
(cid:12)
(cid:12)

(cid:35)

ˆµk,n

(1 − pk,n(z)q)m (by (18) and (20))

Nc(cid:88)

n=0

1 − pk,n(z)q
pk,n(z)q

=

1
q

T −1
(cid:88)

(cid:18) 1

pk,n(z)

n=0

(cid:19)

− 1

+ Nc

1 − q
q

.

Then

(cid:34) T

(cid:88)

E

t=1

1{θk(t) < z, S(t), U(t), Nk(t) < Nc}

(cid:35)

(cid:18)

= O

(cid:19)

1
q(µk − z)2

+ Nc

1 − q
q

.

In particular, by setting T (t) and U(t) the trivial events
that always hold (q = 1), we obtain the following inequal-
ity:

(cid:34) T

(cid:88)

E

t=1

1{θk(t) < z, S(t)}

= O

(cid:35)

(cid:19)

(cid:18)

1
(µk − z)2

.

(17)

By using Lemma 8, we obtain

(cid:34)T −1
(cid:88)

(cid:18) 1

E

(cid:19)(cid:35)

− 1

pk,n(z)

≤

n=0

24
∆k(z)2
T −1
(cid:88)

(cid:32)

O
+
n=(cid:100)8/∆k(z)(cid:101)

e−∆k(z)2n/2 +

e−Dk(z)n
(n + 1)∆k(z)2 +

1
e∆k(z)2n/4 − 1

(cid:33)
.

(21)

By using the fact that Dk(z) = d(z, µk) = Ω(1/(µk −z)2)
(from the Pinsker’s inequality), it is easy to verify that the

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

RHS of (21) is O(1/(µk − z)2). By using these facts, we
ﬁnally obtain

Proof. Here, we prove inequality (13). Recall that

(cid:35)

(A) =

1{Bc(t)} =

1{θ∗(t) < µ(−)

L }.

T
(cid:88)

t=1

T
(cid:88)

t=1

(cid:34) T

(cid:88)

E

t=1

E

1
q

(cid:18)

≤

= O

1{θk(t) < z, S(t), U(t), Nk(t) < Nc}

(cid:34)T −1
(cid:88)

(cid:18) 1

pk,n(z)

n=0

(cid:19)(cid:35)

− 1

+ Nc

1 − q
q

(cid:19)

1
q(µk − z)2

+ Nc

1 − q
q

,

Since θ∗(t) is the L-th largest posterior sample among arms
at round t, θ∗(t) < µ(−)
L implies that, there exists at least
one arm in [L] with its posterior sample smaller than µ(−)
L .
Namely,

{θ∗(t) < µ(−)

L } ⊂

{θk(t) < µ(−)

L },

(cid:91)

k∈[L]

which concludes the proof of the lemma.

Lemma 10. (Deviation of empirical averages, Agrawal &
Goyal (2013b, Appendix B.1)) Let k ∈ [K] and z > µk be
arbitrary. Then,

and therefore

{θ∗(t) < µ(−)
L }
(cid:91)

(cid:34) ∞
(cid:88)

E

t=0

1{Ak(t), ˆµk(t) > z}

< 1 +

(cid:35)

1
d(z, µk)

.

Lemma 11. (Deviation of Beta posteriors) Let k ∈ [K],
x1, x2 ∈ [0, 1] be arbitrary values such that x1 > x2, and
n ≥ 1. Then,

Pr(θk(t) ≥ x1|ˆµk(t) ≤ x2, Nk(t) = n)

≤ exp (−d(x2, x1)n).

Proof. Note that, this lemma is essentially the same as
the ﬁrst display in Agrawal & Goyal (2013b, Appendix
B.2). While Agrawal & Goyal (2013b) provide a bound
for Nk(t) > n, the bound in our lemma is for Nk(t) = n.
For the sake of rigor, we write the proof here.

Pr(θj(t) ≥ x1|ˆµj(t) ≤ x2, Nj(t) = n)

(cid:18)

= Pr

θ ∼ Beta(ˆµj(t)n + 1, (1 − ˆµj(t))n + 1),

(cid:19)

θ ≥ x1

(cid:12)
(cid:12)
(cid:12)
(cid:12)
x2n+1,(1−x2)n+1(x1)

ˆµj(t) ≤ x2

= 1 − F beta
= F B

n+1,x1

(x2n)

=

=

⊂

k∈[L]
(cid:91)

k∈[L]
(cid:91)

k∈[L]

{θk(t) < µ(−)

L , θ∗(t) < µ(−)
L }

{θk(t) < µ(−)

L , max
j∈[L]

(L)θj(t) < µ(−)
L }

{θk(t) < µ(−)

L , max

(L)θj(t) < µ(−)

L }.

j∈[L]\{k}

By using the union bound, we obtain

1{θ∗(t) < µ(−)
L }
1{θk(t) < µ(−)

(cid:88)

≤

k∈[L]

L , max

j∈[L]\{k}

(L)θj(t) < µ(−)

L }.

Note that the event max(L)
L satisﬁes the
condition for the event S(t) in (17) in Lemma 9 with z :=
µ(−)
L . Therefore we obtain from Lemma 9 that

j∈[L]\{k} θj(t) < µ(−)

(cid:34) T

(cid:88)

E

t=1

(cid:35)

1{θ∗(t) < µ(−)
L }

(cid:32)

= O

1
(µk − µ(−)

L )2

(cid:33)

(cid:32)

= O

1
(µL − µ(−)

L )2

(cid:33)

,

which concludes the proof of inequality (13).

≤ F B

n,x1

(x2n) ≤ exp (−d(x2, x1)n)

(by the Beta-Binomial equality)

Evaluation of term (B):

(by the Chernoff bound).

Proof. Here, we prove inequality (14). We have,

A.4. Proof of Lemma 3

Evaluation of term (A):

(B) =

1{Ai(t), Cc

i (t)}

T
(cid:88)

t=1



1



=

T
(cid:88)

t=1

(cid:91)

{Ai(t), θ∗∗

\i,j(t) < ν}

j∈[K]\([L−1]∪{i})






Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

(cid:110)

1

Ai(t), θ∗∗

\i,j(t) < ν

(cid:111)

T
(cid:88)

=

T
(cid:88)

=

(cid:88)

(cid:88)

t=1

j∈[K]\([L−1]∪{i})

θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

(cid:111)
.

Moreover, let ν2 = (ν + µL)/2 = (µL−1 + 3µL)/4. For
k ∈ [L − 1], µk > ν > ν2 > µL and

t=1

j∈[K]\([L−1]∪{i})

(cid:110)

1{Ai(t), ˆµi(t) > µL}+1

Ai(t), ˆµi(t) ≤ µL, θ∗∗

(cid:110)

(cid:26)

Pr

θk(t) < ν, Nk(t) ≥

(cid:27)

log T
2(ν − ν2)2

(cid:111)(cid:111)

.

\i,j(t) < ν
(22)

Pr{θk(t) < ν, Nk(t) = n}

In the following, we bound the ﬁrst and the second terms
in the inner sum of the last line of (22). From Lemma 10,
the ﬁrst term of (22) is bounded as

(cid:34) T

(cid:88)

E

t=1

1 {Ai(t), ˆµi(t) > µL}

≤ 1 +

= O(1).

(cid:35)

1
d(µL, µi)

On the other hand, the second term of (22) is transformed
as

Ai(t), ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

(cid:111)

(cid:110)

1

T
(cid:88)

t=1

≤

log log T
d(µL, ν)
T
(cid:26)
(cid:88)

t=1

log log T
d(µL, ν)
T
(cid:88)

(cid:26)

≤

+

t=1

+

1

Ai(t), Ni(t) >

, ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

log log T
d(µL, ν)

1

Ni(t) >

, ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

log log T
d(µL, ν)

(cid:27)

.

Since θ∗∗
\i,j(t) is the (L − 1)-th largest posterior sample
among arms except for i and j, θ∗∗
\i,j(t) < ν indicates that,
the number of arms excluding i and j with posterior sam-
ples larger than or equal to ν is at most L − 2, and thus at
least one arm among [L − 1] has its posterior smaller than
ν. Namely,

{θ∗∗

\i,j(t) < ν} = { max

(L−1)θl(t) < ν}

l∈[K]\{i,j}

=

⊂

(cid:91)

k∈[L−1]
(cid:91)

k∈[L−1]

{θk(t) < ν, max

(L−1)θl(t) < ν}

l∈[K]\{i,j}

{θk(t) < ν, max

(L−1)θl(t) < ν}.

l∈[K]\{i,j,k}

Pr{θk(t) < ν, ˆµk(t) > ν2, Nk(t) = n}

Pr{ˆµk(t) ≤ ν2, Nk(t) = n}

T
(cid:88)

T
(cid:88)

n= log T

2(ν−ν2 )2

≤

≤

n= log T

2(ν−ν2 )2

T
(cid:88)

+

n= log T

2(ν−ν2)2

T
(cid:88)

≤

e−d(ν2,ν)n

n= log T

2(ν−ν2 )2

T
(cid:88)

+

(cid:27)

n= log T

2(ν−ν2)2

Pr{ˆµk(t) ≤ ν2, Nk(t) = n}

(by Lemma 11)

T
(cid:88)

≤

n= log T

2(ν−ν2 )2

T
(cid:88)

n= log T

2(ν−ν2 )2

e−d(ν2,ν)n +

e−d(ν2,µk)n

= O(1/T ) (by (µk − ν2) > (ν − ν2) and Pinsker’s inequality)

(by Chernoff bound)

and thus

T
(cid:88)

(cid:88)

t=1

k∈[L−1]

(cid:110)

Pr

Ni(t) >

log log T
d(µL, ν)

,

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

(cid:111)

T
(cid:88)

(cid:88)

(cid:110)

≤

Pr

Ni(t) >

t=1

k∈[L−1]

log log T
d(µL, ν)

, Nk(t) <

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

T
(cid:88)

+

(cid:88)

(cid:110)

t=1

k∈[L−1]

Pr

θk(t) < ν, Nk(t) ≥

log T
2(ν − ν2)2 ,
(cid:111)

log T
2(ν − ν2)2

(cid:111)

log T
2(ν − ν2)2 ,
(cid:111)

By using this, we have

T
(cid:88)

t=1

≤

(cid:26)

1

Ni(t) >

log log T
d(µL, ν)

, ˆµi(t) ≤ µL, θ∗∗

\i,j(t) < ν

T
(cid:88)

(cid:88)

(cid:110)

t=1

k∈[L−1]

1

Ni(t) >

, ˆµi(t) ≤ µL,

log log T
d(µL, ν)

(cid:27)

≤

Pr

Ni(t) >

, Nk(t) <

T
(cid:88)

(cid:88)

(cid:110)

t=1

k∈[L−1]

log log T
d(µL, ν)

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

l∈[K]\{i,j,k}

+ O(1).

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

Here, z := ν, S(t) := {max(L−1)
l∈[K]\{i,j,k} θl(t) < ν},
T (t) := {θi(t) ≤ ν}, and U(t) := {ˆµi(t) ≤ µL} sat-
isfy the conditions in Lemma 9. Under U(t), T (t) holds
with probability at least

(cid:18)

1 − exp

−d(µL, ν)

(cid:19)(cid:19)

(cid:18) log log T
d(µL, ν)

= 1 − (log T )−1

by Lemma 11. Therefore, by using Lemma 9 with Nc =
log T /(2(ν − ν2)2), we obtain

(cid:34) T

(cid:88)

E

(cid:110)

1

Ni(t) >

t=1

log log T
d(µL, ν)

, Nk(t) <

log T
2(ν − ν2)2 ,
(cid:35)

(cid:111)

ˆµi(t) ≤ µL, θk(t) < ν, max

(L−1)θl(t) < ν

(cid:18)

≤ O

l∈[K]\{i,j,k}
(cid:19)

1
(1 − (log T )−1)(µk − ν)2
(cid:18) (log T )−1

O

1 − (log T )−1

(cid:19)

log T
2(ν − ν2)2

+

= O(1). (23)

From (23) and the union bound over k ∈ [L−1], the second
term of (22) is O(1). In summary, term (B) is O(log log T )
in expectation.

T
(cid:88)

t=1

T
(cid:88)

≤

t=1
≤ (cid:15)2 log T
T
(cid:88)

+

t=1

By using Lemma 10 with z := ν2, the ﬁrst term in (24) is
bounded as:

(cid:34) T

(cid:88)

E

t=1
(cid:18)

= O

1{Aj(t), ˆµj(t) > ν2}

≤ 1 +

(cid:35)

1
(ν2 − µj)2

(cid:19)

(cid:18)

= O

1
(µL−1 − µL)2

1
d(ν2, µj)
(cid:19)

= O(1).

(25)

i,j(t) =
\i,j(t) ≥ ν} ⊃ Ci(t). Let Ej(t) = {Nj(t) ≥ (cid:15)2 log T }.

We now bound the second term in (24). Let C(cid:48)
{θ∗∗
We have,

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Di(t), ˆµj(t) ≤ ν2}

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Di(t), ˆµj(t) ≤ ν2, Ej(t)}.

≤ (cid:15)2 log T +

N suf
i

(T )−1
(cid:88)

T
(cid:88)

n=0

t=1

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Ni(t) = n, ˆµj(t) ≤ ν2, Ej(t)}.

In the following, we bound

T
(cid:88)

t=1

1{Ai(t), Aj(t), C(cid:48)

i,j(t), Ni(t) = n, ˆµj(t) ≤ ν2, Ej(t)}.

i,j(t), θ∗∗

(26)
Note that, (26) is at most 1 since {Ai(t), Ni(t) = n} oc-
curs at most once. Let τ be the ﬁrst round (if exists) at
which {C(cid:48)
\i,j(t) ≤ θi(t), Ai(t), Ni(t) = n} is sat-
isﬁed. It is necessary that {θj(τ ) ≥ θ∗∗
\i,j(τ )} for (26) to be
1: this is because, (i) both θi(τ ) and θj(τ ) need to be larger
than θ∗∗
\i,j(τ ) for the simultaneous draw of arms i and j,
(ii) and if θj(τ ) < θ∗∗
\i,j(τ ) then arm i is drawn and thus
{Ni(t) = n} is never satisﬁed after t > τ . Here,

Pr{θj(τ ) ≥ θ∗∗

\i,j(τ ), θ∗∗

\i,j(τ ) ≥ ν, ˆµj(τ ) ≤ ν2}

≤ exp (−d(ν2, ν)Nj(τ )),

Evaluation of term (C):

Proof. Here, we prove inequality (15). Recall that,

(C) =

1{Ai(t), Aj(t), Ci(t), Di(t)}.

(cid:88)

T
(cid:88)

j∈[K]\([L−1]∪{i})

t=1

Let ν2 = (ν + µL)/2 = (µL−1 + 3µL)/4. Note that,
we deﬁned ν and ν2 such that µL−1 > ν > ν2 > µL,
O(µL−1 − ν) = O(ν − ν2) = O(ν2 − µL) = O(µL−1 −
µL) = O(1) as a function of T . Then,

T
(cid:88)

t=1

1{Ai(t), Aj(t), Ci(t), Di(t)}

=

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) > ν2}

+

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

T
(cid:88)

t=1

≤

1{Aj(t), ˆµj(t) > ν2}

by Lemma 11. Therefore, we have

+

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}.

1{Ai(t), Aj(t), Ci(t), Ni(t) = n, ˆµj(t) ≤ ν2}

(cid:35)

(cid:34) T

(cid:88)

E

t=1

(24)

≤ exp (−d(ν2, ν)(cid:15)2 log T ) = T −(cid:15)2d(ν2,ν).

(27)

Optimal Regret Analysis of Thompson Sampling in Stochastic Multi-armed Bandit Problem with Multiple Plays

In summary, the second term in (24) is bounded as:

(28) is bounded as

(cid:35)

(cid:104)

E

1[Ai(t), B(t), ˆµi(t) ≤ µ(+)

i

, Ni(t) ≥ N suf

i

(cid:105)
(T )]

(cid:34) T

(cid:88)

E

t=1

1{Ai(t), Aj(t), Ci(t), Di(t), ˆµj(t) ≤ ν2}

≤ (cid:15)2 log T + N suf

(T )T −(cid:15)2d(ν2,ν)

(cid:18)

≤

(cid:15)2 +

i
4T −(cid:15)2d(ν2,ν)
d(µi, µL)

(cid:19)

log T

(by (1 + δ)2 < 4),

(cid:104)

≤ E
(cid:104)
= E

1[θi(t) ≥ µ(−)
E(cid:2)1[θi(t) ≥ µ(−)

L , ˆµi(t) ≤ µ(+)

i

L , ˆµi(t) ≤ µ(+)

i

, Ni(t) ≥ N suf

i

(cid:105)
(T )]

, Ni(t) ≥ N suf

(T )]
(cid:12)ˆµi(t), Ni(t)(cid:3)(cid:105)
(cid:12)

i

(cid:104)
≤ E

E(cid:2)1[ˆµi(t) ≤ µ(+)

i

Pr[θi(t) ≥ µ(−)

(cid:104)

(cid:104)

E

≤ E

exp(−d(µ(+)

i

i

, Ni(t) ≥ N suf
(T )]
L |ˆµi(t), Ni(t)](cid:12)
L )N suf

(T ))

, µ(−)

i

(cid:12)ˆµi(t), Ni(t)(cid:3)(cid:105)

(cid:12)
(cid:12)
(cid:12)ˆµi(t), Ni(t)

(cid:105)(cid:105)

(by Lemma 11)

(cid:32) (cid:0)(cid:15)2 + 4T −(cid:15)2d(ν2,ν)(cid:1) log T
d(µi, µL)

(cid:33)

+ O(1)



(cid:16)



(cid:15)2 + 4T −(cid:15)2∆2

L,L−1/8(cid:17)



log T

d(µi, µL)

 + O(1),

= exp (−d(µ(+)
= T −1

i

, µ(−)

L )N suf

i

(T ))

(by the deﬁnition of N suf

(T )),

i

(30)

where we used the fact that d(ν2, ν) ≥ 2(ν − ν2)2 = 2 ×
((µL−1 − µL)/4)2 in the last transformation.

where we used the fact E[X] = E[E[X|Y ]] for any random
variables X and Y . Putting (28)–(30) together we obtain

and thus,

E[(C)]

(cid:88)

(cid:88)

≤

≤

j∈[K]\([L−1]∪{i})

j∈[K]\([L−1]∪{i})

Evaluation of term (D):

E[(D)] ≤ 1 +

+

T −1,

(31)

1
d(µ(+)
i

, µi)

T
(cid:88)

t=1

from which the inequality (16) follows.

Proof. Here, we prove inequality (16). We ﬁrst divide term
(D) into two subterms as:

A.5. Proof of Lemma 4

E[(D)] = E

1{Ai(t), B(t), Ni(t) ≥ N suf

(T )}

i

(cid:35)

It sufﬁces to prove that for any a, b > 0

(cid:26) T −a(cid:15)2
b

inf
(cid:15)2>0

(cid:27)

+ (cid:15)2

= O

(cid:18) log log T
log T

(cid:19)

.

≤ E

1{Ai(t), B(t), ˆµi(t) > µ(+)

, Ni(t) ≥ N suf

i

(T )}

+ E

1{Ai(t), B(t), ˆµi(t) ≤ µ(+)

, Ni(t) ≥ N suf

i

(T )}

.

i

i

By letting (cid:15)2 = (log log T )/(a log T ), we have

(cid:26) T −a(cid:15)2
b

inf
(cid:15)2>0

(cid:27)

+ (cid:15)2

(cid:26) e−a(cid:15)2 log T
b

(cid:27)

+ (cid:15)2

(cid:34) T

(cid:88)

t=1

(cid:34) T

(cid:88)

t=1

(cid:34) T

(cid:88)

t=1

(cid:35)

(cid:35)

(28)

(cid:35)
(T )}

= inf
(cid:15)2>0
e− log log T
b

≤

=

1
b log T

+

= O

(cid:18) log log T
log T

+

log log T
a log T

log log T
a log T
(cid:19)

and the proof is completed.

On one hand, the ﬁrst term in (28) is bounded as:

1{Ai(t), B(t), ˆµi(t) > µ(+)

i , Ni(t) ≥ N suf

i

1{Ai(t), ˆµi(t) > µ(+)

i

(cid:35)
}

(cid:34) T

(cid:88)

E

t=1

(cid:34) T

(cid:88)

≤ E

≤ 1 +

t=1

1
d(µ(+)
i

, µi)

(by Lemma 10).

(29)

On the other hand, each component of the second term of

