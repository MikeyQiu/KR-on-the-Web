7
1
0
2
 
y
a
M
 
7
1
 
 
]

V
C
.
s
c
[
 
 
2
v
8
0
9
8
0
.
4
0
7
1
:
v
i
X
r
a

Unbiased Shape Compactness for Segmentation

Jose Dolz1, Ismail Ben Ayed1, Christian Desrosiers1

Laboratory for Imagery, Vision and Artiﬁcial Intelligence
´Ecole de Technologie Sup´erieure, Montreal, Canada

Abstract. We propose to constrain segmentation functionals with a
dimensionless, unbiased and position-independent shape compactness
prior, which we solve eﬃciently with an alternating direction method
of multipliers (ADMM). Involving a squared sum of pairwise potentials,
our prior results in a challenging high-order optimization problem, which
involves dense (fully connected) graphs. We split the problem into a se-
quence of easier sub-problems, each performed eﬃciently at each iter-
ation: (i) a sparse-matrix inversion based on Woodbury identity, (ii) a
closed-form solution of a cubic equation and (iii) a graph-cut update of
a sub-modular pairwise sub-problem with a sparse graph. We deploy our
prior in an energy minimization, in conjunction with a supervised clas-
siﬁer term based on CNNs and standard regularization constraints. We
demonstrate the usefulness of our energy in several medical applications.
In particular, we report comprehensive evaluations of our fully auto-
mated algorithm over 40 subjects, showing a competitive performance
for the challenging task of abdominal aorta segmentation in MRI.

1

Introduction

Several recent studies have shown that generic shape constraints such as con-
vexity [10,17], compactness [1,6], axial symmetry [15], tubularity [13], skeleton
consistency [12] and inter-region topology [2] can be very powerful in medical
image segmentation. Such constraints can boost substantially the performances
of state-of-the-art segmentation algorithms, including powerful supervised learn-
ing methods such as convolutional neural networks (CNN) [2]. Imposing these
constraints can be beneﬁcial in a breadth of medical applications, particularly
when training data is limited or when the target segments undergo strong noise
and poor contrasts/resolutions (see Fig. 1 for examples where target boundaries
have varied shapes and low contrast). Unfortunately, these shape constraints
are typically high-order functionals, which yield challenging optimization prob-
lems. For instance, the recent convexity term in [10] involves a large number of
non-submodular triple-cliques, and the compactness in [1] is a high-order ratio,
both requiring computationally expensive approximations and iterative schemes
to reach a local minimum.

This study focuses on constraining segmentation functionals with shape com-
pactness, a problem investigated previously in several works [1,6,14,11]. In seg-
mentation, the most common compactness functional is the ratio of boundary
length to area (or surface to volume in 3D) [14,11], which is related to the well-
known isoperimetric graph partitioning problem (also referred to as the Cheeger

problem). Unlike common length regularizers [4], this prior does not suﬀer from
strong shrinking bias (i.e., bias towards small regions). Despite its simplicity,
optimizing a discrete form of this ratio functional is an NP-hard problem [14].
However, it is possible to transform this problem into a family of parameterized
sub-modular pairwise costs, which can be explored eﬃciently with parametric
max-ﬂow optimizers [14]. Unfortunately, length-to-area ratio varies signiﬁcantly
with region size1. As pointed out (and observed experimentally) in several stud-
ies [11,14], the isoperimetric partitioning problem has a strong bias towards large
regions, which is a serious limitation in practice.

The recent segmentation study in [1] proposed an alternative compactness
measure based on a ratio of regional moment statistics, thereby ensuring size (or
scale) invariance. This algorithm showed promising performances in the case of
a vascular structure, and can handle arbitrary variations in region size. Unfor-
tunately, this compactness term is pose-dependent, requiring the user to specify
the center of mass of the target region in each 2D slice of a subject data set.
This precludes its use for fully automated segmentation, particularly in the case
of large 3D volumes. More importantly, it is strongly biased towards circular
shapes, signiﬁcantly limiting its applicability (see the examples in Fig. 1). An-
other related work is the semi-automatic segmentation algorithm in [6], whose
compactness prior also favors large regions and requires user seeds.
The contributions of this study can be summarized as follows.

– General-purpose segmentation: We propose to constrain segmentation
functionals with a dimensionless, unbiased and position-independent shape
compactness prior, which we solve eﬃciently with an alternating direction
method of multipliers (ADMM). To the best of our knowledge, the ratio of
length-squared to area has not been used before in segmentation functionals,
although it is widely accepted as a compactness measure in the area of shape
metrics [16]. This is probably due to the fact that the ensuing high-order
optimization problem is challenging. Involving a squared sum of pairwise
potentials, our problem makes the use of powerful sub-modular optimization
techniques (e.g., parametric max-ﬂow) impractical for image segmentation
problems, as it would result in dense (fully connected) graphs. We propose
an eﬃcient alternative by splitting the problem into a sequence of easier
sub-problems. At each iteration, our ADMM solution alternates three steps,
each can be performed eﬃciently: (i) a sparse-matrix inversion based on
Woodbury identity, (ii) a closed-form solution of a cubic equation and (iii) a
graph-cut update of a sub-modular pairwise sub-problem involving a sparse
graph.

– Clinical applications: We ﬁrst report a comprehensive evaluation of our
algorithm on the challenging task of abdominal aorta segmentation in 3D
MRI. Results obtained on a dataset of 40 subjects demonstrate a state-of-
the-art performance of the proposed method, with an average Dice metric of
0.81. Except for the recent semi-automatic algorithms described in [8,1], most
existing aorta segmentation techniques have focused on CTA. Unlike these

1 This is due to the fact that, in image segmentation, region size might be several

orders of magnitude larger then boundary length.

Ground truth

CNN [7]

GCs [5]

TRIC [1]

Proposed

Fig. 1: Segmentations results in several applications: aorta in MR-T1 (top),
esophagus in CT (second ), right ventricle in MRI (third row ) and aorta in CT.

techniques, our algorithm allows the development of fully automated tools,
which could be used retrospectively on large-scale MRI datasets to iden-
tify potentially fatal abnormalities like abdominal aortic aneurysms (AAA)
[9]. Our experiments further show the usefulness of our method in three
important and challenging segmentation problems: the delineation of the
esophagus in CT, the right ventricle in MR, and the aorta in CT.

2 Formulation

Let Ω denote the image domain and xi ∈ RK the input-feature vector of pixel
(or voxel) i ∈ Ω. Segmentation assigns to each i a label yi ∈ L (L is the set
of possible labels). While our formulation could be easily extended to multi-
class segmentation, we focus on a binary (two-region) statement for a clearer
presentation. We minimize the following functional with respect to a discrete
binary vector y ∈ {0, 1}|Ω|:

E(y) = Ep(y) + λ Ec(y),

(1)

where Ep encodes unary-potential priors, and Ec is our shape compactness.
As is typical in segmentation, Ep can be expressed in term of log-likelihoods:

Ep(y) = (cid:80)
i ui yi, where ui = log p(yi = 0 | xi) − log p(yi = 1 | xi). Although
any (semi-) supervised technique can be used to learn p(yi | xi), in this study,
we employed a fully-convolutional neural network (FCNN) [7].

Our dimensionless, unbiased and position-independent shape compactness
prior is based on a measure that is well accepted in the context of shape metrics
[16], the ratio of length-squared to area, which we can write in discrete form
(i.e., as a function of our segmentation variable): Ec(y) = P (y)2/A(y). The
area can be expressed as A(y) = (cid:80)
i yi, and the length is proportional to the
number of neighboring pixels with diﬀerent labels, i.e., P (y) ∝ (cid:80)
i,j wij(yi−yj)2,
where pairwise potential wij = 1 if i and j are neighbors, otherwise wij = 0.
Note that this compactness measure can be easily extended so as to attract the
solution towards strong edges in the image: wij = exp(− (cid:80)
k σk (xik − xjk)2),
with σk controlling the relative importance of feature k on the weight. With
these deﬁnitions of Ep and Ec, and re-writing length as P (y) = y(cid:62)Ly, where
L is the Laplacian matrix corresponding to weights wij, our compactness model
becomes:

arg min
y ∈ {0,1}|Ω|

E(y) = u(cid:62)y + λ

(cid:0)y(cid:62)Ly(cid:1)2
1(cid:62)y

,

(2)

where 1 is a vector with the value one for each element.

2.1 ADMM optimization

The general principle of ADMM is to decompose a hard problem into easier-
to-solve sub-problems, which are coupled together via equality constraints. In
our case, we introduce auxiliary variable z ∈ R|Ω| and s ∈ R+, and reformulate
problem (2) as

arg min
y, z, s

λ
s

u(cid:62)y +

(cid:0)y(cid:62)Ly(cid:1)(cid:0)z(cid:62)Lz(cid:1),

s.t. y = z and s = 1(cid:62)z.

(3)

Note that since we impose y = z, we can relax the binarity constraints on z.
This strategy allows an eﬃcient update of this variable.

In the next step, we move the constraints in the cost-function via a augmented

Lagrange formulation:

u(cid:62)y +

(cid:0)y(cid:62)Ly(cid:1)(cid:0)z(cid:62)Lz(cid:1) +

λ
s

µ1
2

(cid:13)
(cid:13)y − z + ν1

(cid:13)
2
2 +
(cid:13)

µ2
2

(cid:0)s − 1(cid:62)z + ν2

(cid:1)2

. (4)

arg min
y, z, s
ν 1, ν2

In this new formulation, ν1 and ν2 are dual variables corresponding to the two
constraints, and µ1, µ2 parameters controlling the trade-oﬀ between the primal
objective and constraint satisfaction. The beneﬁt of this formulation is that
solving for each variable, considering all other variables ﬁxed, can be carried out
eﬃciently and to optimality. We thus adopt an iterative optimization method,
where each variable is updated in turn until convergence.

Updating z: Let α = λ
as

s y(cid:62)Ly, the task of updating z can be expressed from (4)
µ2
2

(cid:13)z − (y + ν1)(cid:13)
(cid:13)
2
2 +
(cid:13)

(cid:0)1(cid:62)z − (s + ν2)(cid:1)2

µ1
2

(5)

.

αz(cid:62)Lz +

arg min
z ∈ R|Ω|

Minimizing this convex quadratic problem yields

z = (cid:0)αL + µ1I + µ211(cid:62)(cid:1)−1(cid:0)µ1(y + ν1) + µ2(s + ν2)1(cid:1).

(6)

Note that computing z requires solving a large and dense linear system. Let Q =
αL + µ1I, following the Woodbury identity and using the fact that Q−11 = 1
1,
µ1
we can reformulate the matrix inversion as:

(cid:0)αL + µ1I + µ211(cid:62)(cid:1)−1

= Q−1 −

+ 1(cid:62)Q−11

Q−111(cid:62)Q−1

(cid:17)−1

(cid:16) 1
µ2
1
µ1

(cid:16) µ1
µ2

= Q−1 −

+ |Ω|

(cid:17)−1

11(cid:62).

Since Q is very sparse, the resulting system can be solved eﬃciently via standard
techniques like the preconditioned conjugate gradients method.

Updating s: Let β = λ(y(cid:62)Ly)(z(cid:62)Lz), updating s amount to solving

arg min
s≥0

β
s

+

µ2
2

(cid:0)s − (1(cid:62)z − ν2)(cid:1)2

Deriving this equation w.r.t. s and setting the result to zero gives the following
cubic equation:

s3 − (cid:0)1(cid:62)z − ν2

(cid:1)s2 =

> 0.

β
µ2

It can be shown that this equation has a real valued root s > 1(cid:62)z − ν2. In
practice, 1(cid:62)z − ν2 is positive and converges toward zero, and s will be positive.

Updating y: Let γ = λ
following problem:

s z(cid:62)Lz and q = z − ν1. We update y by considering the

arg min
y ∈ {0,1}|Ω|

u(cid:62)y + λy(cid:62)Ly +

µ1
2

(cid:13)y − q(cid:13)
(cid:13)
2
(cid:13)
2

(10)

Since y is binary, we have that y2
reformulate (10) as

i = yi and (yi − yj)2 = |yi − yj|. Hence, we can

arg min
y ∈ {0,1}|Ω|

(cid:88)

i∈Ω

(cid:0)ui + µ1( 1

2 − qi)(cid:1)yi + λ

(cid:88)

wij

(cid:12)
(cid:12)yi − yj

(cid:12)
(cid:12).

(11)

i,j∈Ω2

This corresponds to a simple graph-cut problem, which can be solved eﬃciently
using the Boykov-Kolmogorov algorithm [5].

Finally, we update dual variables following the standard ADMM algorithm:
2 = ν2 + (s − 1(cid:62)z). This iterative updating process is

ν(cid:48)
1 = ν1 + (y − z) and ν(cid:48)
repeated until (cid:107)y − z(cid:107)2 is less than a small epsilon.

(7)

(8)

(9)

3 Experiments

We ﬁrst present a quantitative evaluation of our shape compactness on the task
of segmenting the abdominal aorta in a MR-T1 data set of 40 subjects. The
usefulness of the proposed method is then shown qualitatively for three addi-
tional segmentation scenarios: CT esophagus, MRI right ventricle and CT aorta
segmentation. Our method’s accuracy is measured in terms of Dice coeﬃcient,
and compared to that of graph cuts (GC) [5] and TRIC2 compactness [1]. To
measure the contribution of the pixelwise (i.e., unary potential) prior, we also
report results obtained via a simple thresholding.

While any technique can be used to obtain the unary-potentials in Eq. (2),
we considered the 3D fully-CNN (FCNN) architecture presented in [7]. This
architecture is comprised of 9 convolutional layers with non-linear activation
units, 3 fully-connected layers (converted into standard convolution operations),
and a soft-max layer. The output of this model is a map indicating the probability
of each pixel to belong to a given structure. The same unary potential was used
for all three tested approaches. For all segmentation applications, the FCNN was
trained using a k -fold validation strategy, with k = 4.

For our method’s ADMM parameters, we used µ1 ≈ 2000 and µ2=50 for all
experiments. As mentioned in [3], ADMM algorithms are not overly sensitive
to these parameters. To facilitate convergence, we increase the value of these
parameters by 1% (i.e., 1.01 multiplication factor) at each iteration. In contrast,
the compactness regularization λ was tuned for each segmentation problem: λ =
5000 for MR-T1 abdominal aorta, λ = 1000 for CT esophagus, λ = 15000 for MR
right ventricle, and λ = 3000 for CT abdominal aorta. The code has been made
publicly available at https://github.com/josedolz/UnbiasedShapeCompactness.

Fig. 2: Dice metric for 38 subjects of the 3D FCNN [7] output with graph cut[5]
regularization, with TRIC compactness [1], and with the proposed compactness.

MR-T1 abdominal aorta segmentation: As shown in the ﬁrst row of
Fig. 1, segmenting the aorta from MR-T1 images is a very challenging problem
due to the noise and lack of visible boundaries. In this example, thresholding the
FCNN probabilities yields parts of the background along with irregular contours.
Because it regularizes the segmentation, GC provides a smoother contour. How-
ever, this contour follows the probability map of FCNN and does not reﬂect the
compact shape of the target region. Increasing regularization weight in GC yields

2 Note that TRIC needs a reference point to deﬁne the shortest-path distance. This
point was deﬁned as the centroid of the CNN-based segmentation in this work.

a compact region but decreases performance signiﬁcantly due to the well-known
shrinkage bias of standard pairwise length regularization (bias to small regions);
note that regularization weight was tuned for an optimal GC performance. The
next experimental examples will further highlight shrinkage bias. Unlike GC,
TRIC ﬁnds a more compact region, due to its shape circularity prior. Nonethe-
less, this example illustrates this approach’s two main drawbacks: 1) it is biased
to near-circular regions, and 2) it is not translation invariant and ﬁnds regions
centered on the probability map’s center of mass. As seen in the ﬁgure, our pose-
independent method did not suﬀer from a circularity/shrinkage bias, yielding a
much more accurate segmentation, highly similar to the reference contours.

The bar plot of Fig. 2 gives the accuracy of tested methods obtained for each
subject3. The mean Dice and standard deviation computed across all subjects,
is reported in Table 1. These results conﬁrm that the proposed compactness
term provides a considerable improvement in accuracy. In terms of runtime, our
method takes about 80 seconds on average to segment a single subject, 60 seconds
of time spend computing the unary potentials via the FCNN. In contrast, TRIC
requires nearly 20 minutes per subject. Hence, our method is more suitable for
the fully automated segmentation of large-scale datasets.

Method

CNN [7] CNN + GC [5] TRIC [1]

Proposed

Dice
Time

0.73 (0.09)
∼ 60 sec

0.76 (0.09)
∼ 70 sec

0.71 (0.07)
∼ 20 min

0.81 (0.08)
∼ 80 sec

Table 1: Quantitative evaluations of MR-T1 abdominal aorta segmentations.

CT esophagus segmentation: Fig. 1 (second row ) shows delineations of
the esophagus in CT, also a challenging problem due to its complex shape and
non-homogeneous appearance. In this particular example, we can observe how
the well-known shrinkage bias problem of GC leads to an under-segmentation
of the esophagus. Notice that GC yielded a compact region but did not im-
prove FCNN’s performance. As in the previous case, we also observe how TRIC
over-enforces shape circularity on the segmentation. On the other hand, our
compactness term is able to preserve the target region’s shape.

MR Right Ventricle Segmentation: This qualitative result (Fig. 1, third
row ) shows how our compactness term can accommodate a more general class of
shapes that diﬀers signiﬁcantly from tubular structures. Although TRIC [1] can
also handle shapes diﬀerent than a circle, multiple reference points, which form a
skeleton, are required from the user in this case, a prohibitively time-consuming
eﬀort for 3D data. However, to keep the process fully automatic, only the centroid
of the FCNN segmentation was provided. Having only a single reference point,
and particularly in this scenario, led to failure of TRIC to achieve a satisfactory
segmentation.

CT Aorta Segmentation: The application of the proposed method to CT
aorta segmentation is illustrated in the last row of Fig 1. We see that our method
can handle multi-region scenarios, i.e. bifurcations, in contrast to other compact-

3 Two subjects were excluded from the quantitative analysis, as the FCNN failed to

generate a usable probability map.

ness terms [1]. Note that, for this example, we applied TRIC separately on each
of the two regions to avoid having a single contour centered in between these
regions. This means that we fed TRIC with additional supervision information,
unlike our method which is fully automatic. Notice that, to obtain compact and
smooth regions, GC worsened FCNN performance due to shrinkage bias.

4 Conclusion

We presented an unbiased, fully-invariant and multi-region prior for the seg-
mentation of compact shapes, based on the ratio of length-squared to area. An
eﬃcient ADMM strategy was proposed to solve the high-order energy minimiza-
tion problem resulting from this formulation. Using an FCNN to obtain unary
probabilities, the proposed method achieved high accuracy in four challenging
segmentation problems.

References

1. Ben Ayed, I., Wang, M., Miles, B., Garvin, G.J.: TRIC: Trust region for invariant
compactness and its application to abdominal aorta segmentation. In: MICCAI
(1). pp. 381–388. Springer (2014)

2. BenTaieb, A., Hamarneh, G.: Topology aware fully convolutional networks for his-

tology gland segmentation. In: MICCAI (2). pp. 460–468. Springer (2016)

3. Boyd, S., Parikh, N., Chu, E., Peleato, B., Eckstein, J.: Distributed optimization
and statistical learning via the alternating direction method of multipliers. Foun-
dations and Trends R(cid:13) in Machine Learning 3(1), 1–122 (2011)

4. Boykov, Y., Funka-Lea, G.: Graph cuts and eﬃcient nd image segmentation. In-

ternational Journal of Computer Vision 70(2), 109–131 (2006)

5. Boykov, Y., Kolmogorov, V.: An experimental comparison of min-cut/max-ﬂow al-
gorithms for energy minimization in vision. IEEE Transactions on Pattern Analysis
and Machine Intelligence 26(9), 1124–1137 (2004)

6. Das, P., Veksler, O., Zavadsky, V., Boykov, Y.: Semi-automatic segmentation with

compact shape prior. Image and Vision Computing 27(1), 206–219 (2009)

7. Dolz, J., Desrosiers, C., Ben Ayed, I.: 3D fully convolutional networks for subcor-

tical segmentation in mri: A large-scale study. arXiv:1612.03925 (2016)

8. Duquette, A.A., Jodoin, P.M., Bouchot, O., Lalande, A.: 3D segmentation of ab-
dominal aorta from CT-scan and MR images. Computerized Medical Imaging and
Graphics 36(4), 294–303 (2012)

9. E. Georgakarakos, C. V. Ioannou, Y.P.T.K., Katsamouris, A.N.: Computational
evaluation of aortic aneurysm rupture risk: What have we learned so far?”. Journal
of Endovascular Therapy 2(18), 214–225 (2011)

10. Gorelick, L., Veksler, O., Boykov, Y., Nieuwenhuis, C.: Convexity shape prior for
binary segmentation. IEEE Transactions on Pattern Analysis and Machine Intel-
ligence 2(39), 258–271 (2017)

11. Grady, L., Schwartz, E.L.: Isoperimetric graph partitioning for image segmentation.
IEEE Transactions on Pattern Analysis and Machine Intelligence 28(3), 469–475
(2006)

12. Isack, H.N., Veksler, O., Sonka, M., Boykov, Y.: Hedgehog shape priors for multi-

object segmentation. In: CVPR. pp. 2434–2442 (2016)

13. Kitamura, Y., Li, Y., Ito, W., Ishikawa, H.: Coronary lumen and plaque segmenta-
tion from cta using higher-order shape prior. In: MICCAI (1). pp. 339–347. Springer
(2014)

14. Kolmogorov, V., Boykov, Y., Rother, C.: Applications of parametric maxﬂow in

computer vision. In: ICCV. pp. 1–8 (2007)

15. Qiu, W., Yuan, J., Ukwatta, E., Sun, Y., Rajchl, M., Fenster, A.: Fast globally
optimal segmentation of 3D prostate mri with axial symmetry prior. In: MICCAI
(2). pp. 198–205. Springer (2013)

16. Santiago, R., Bribiesca, E.: State of the art of compactness and circularity mea-

sures. International Mathematical Forum 4(27), 1305–1335 (2009)

17. Veksler, O.: Star shape prior for graph-cut image segmentation. In: European Con-

ference on Computer Vision. pp. 454–467. Springer (2008)

7
1
0
2
 
y
a
M
 
7
1
 
 
]

V
C
.
s
c
[
 
 
2
v
8
0
9
8
0
.
4
0
7
1
:
v
i
X
r
a

Unbiased Shape Compactness for Segmentation

Jose Dolz1, Ismail Ben Ayed1, Christian Desrosiers1

Laboratory for Imagery, Vision and Artiﬁcial Intelligence
´Ecole de Technologie Sup´erieure, Montreal, Canada

Abstract. We propose to constrain segmentation functionals with a
dimensionless, unbiased and position-independent shape compactness
prior, which we solve eﬃciently with an alternating direction method
of multipliers (ADMM). Involving a squared sum of pairwise potentials,
our prior results in a challenging high-order optimization problem, which
involves dense (fully connected) graphs. We split the problem into a se-
quence of easier sub-problems, each performed eﬃciently at each iter-
ation: (i) a sparse-matrix inversion based on Woodbury identity, (ii) a
closed-form solution of a cubic equation and (iii) a graph-cut update of
a sub-modular pairwise sub-problem with a sparse graph. We deploy our
prior in an energy minimization, in conjunction with a supervised clas-
siﬁer term based on CNNs and standard regularization constraints. We
demonstrate the usefulness of our energy in several medical applications.
In particular, we report comprehensive evaluations of our fully auto-
mated algorithm over 40 subjects, showing a competitive performance
for the challenging task of abdominal aorta segmentation in MRI.

1

Introduction

Several recent studies have shown that generic shape constraints such as con-
vexity [10,17], compactness [1,6], axial symmetry [15], tubularity [13], skeleton
consistency [12] and inter-region topology [2] can be very powerful in medical
image segmentation. Such constraints can boost substantially the performances
of state-of-the-art segmentation algorithms, including powerful supervised learn-
ing methods such as convolutional neural networks (CNN) [2]. Imposing these
constraints can be beneﬁcial in a breadth of medical applications, particularly
when training data is limited or when the target segments undergo strong noise
and poor contrasts/resolutions (see Fig. 1 for examples where target boundaries
have varied shapes and low contrast). Unfortunately, these shape constraints
are typically high-order functionals, which yield challenging optimization prob-
lems. For instance, the recent convexity term in [10] involves a large number of
non-submodular triple-cliques, and the compactness in [1] is a high-order ratio,
both requiring computationally expensive approximations and iterative schemes
to reach a local minimum.

This study focuses on constraining segmentation functionals with shape com-
pactness, a problem investigated previously in several works [1,6,14,11]. In seg-
mentation, the most common compactness functional is the ratio of boundary
length to area (or surface to volume in 3D) [14,11], which is related to the well-
known isoperimetric graph partitioning problem (also referred to as the Cheeger

problem). Unlike common length regularizers [4], this prior does not suﬀer from
strong shrinking bias (i.e., bias towards small regions). Despite its simplicity,
optimizing a discrete form of this ratio functional is an NP-hard problem [14].
However, it is possible to transform this problem into a family of parameterized
sub-modular pairwise costs, which can be explored eﬃciently with parametric
max-ﬂow optimizers [14]. Unfortunately, length-to-area ratio varies signiﬁcantly
with region size1. As pointed out (and observed experimentally) in several stud-
ies [11,14], the isoperimetric partitioning problem has a strong bias towards large
regions, which is a serious limitation in practice.

The recent segmentation study in [1] proposed an alternative compactness
measure based on a ratio of regional moment statistics, thereby ensuring size (or
scale) invariance. This algorithm showed promising performances in the case of
a vascular structure, and can handle arbitrary variations in region size. Unfor-
tunately, this compactness term is pose-dependent, requiring the user to specify
the center of mass of the target region in each 2D slice of a subject data set.
This precludes its use for fully automated segmentation, particularly in the case
of large 3D volumes. More importantly, it is strongly biased towards circular
shapes, signiﬁcantly limiting its applicability (see the examples in Fig. 1). An-
other related work is the semi-automatic segmentation algorithm in [6], whose
compactness prior also favors large regions and requires user seeds.
The contributions of this study can be summarized as follows.

– General-purpose segmentation: We propose to constrain segmentation
functionals with a dimensionless, unbiased and position-independent shape
compactness prior, which we solve eﬃciently with an alternating direction
method of multipliers (ADMM). To the best of our knowledge, the ratio of
length-squared to area has not been used before in segmentation functionals,
although it is widely accepted as a compactness measure in the area of shape
metrics [16]. This is probably due to the fact that the ensuing high-order
optimization problem is challenging. Involving a squared sum of pairwise
potentials, our problem makes the use of powerful sub-modular optimization
techniques (e.g., parametric max-ﬂow) impractical for image segmentation
problems, as it would result in dense (fully connected) graphs. We propose
an eﬃcient alternative by splitting the problem into a sequence of easier
sub-problems. At each iteration, our ADMM solution alternates three steps,
each can be performed eﬃciently: (i) a sparse-matrix inversion based on
Woodbury identity, (ii) a closed-form solution of a cubic equation and (iii) a
graph-cut update of a sub-modular pairwise sub-problem involving a sparse
graph.

– Clinical applications: We ﬁrst report a comprehensive evaluation of our
algorithm on the challenging task of abdominal aorta segmentation in 3D
MRI. Results obtained on a dataset of 40 subjects demonstrate a state-of-
the-art performance of the proposed method, with an average Dice metric of
0.81. Except for the recent semi-automatic algorithms described in [8,1], most
existing aorta segmentation techniques have focused on CTA. Unlike these

1 This is due to the fact that, in image segmentation, region size might be several

orders of magnitude larger then boundary length.

Ground truth

CNN [7]

GCs [5]

TRIC [1]

Proposed

Fig. 1: Segmentations results in several applications: aorta in MR-T1 (top),
esophagus in CT (second ), right ventricle in MRI (third row ) and aorta in CT.

techniques, our algorithm allows the development of fully automated tools,
which could be used retrospectively on large-scale MRI datasets to iden-
tify potentially fatal abnormalities like abdominal aortic aneurysms (AAA)
[9]. Our experiments further show the usefulness of our method in three
important and challenging segmentation problems: the delineation of the
esophagus in CT, the right ventricle in MR, and the aorta in CT.

2 Formulation

Let Ω denote the image domain and xi ∈ RK the input-feature vector of pixel
(or voxel) i ∈ Ω. Segmentation assigns to each i a label yi ∈ L (L is the set
of possible labels). While our formulation could be easily extended to multi-
class segmentation, we focus on a binary (two-region) statement for a clearer
presentation. We minimize the following functional with respect to a discrete
binary vector y ∈ {0, 1}|Ω|:

E(y) = Ep(y) + λ Ec(y),

(1)

where Ep encodes unary-potential priors, and Ec is our shape compactness.
As is typical in segmentation, Ep can be expressed in term of log-likelihoods:

Ep(y) = (cid:80)
i ui yi, where ui = log p(yi = 0 | xi) − log p(yi = 1 | xi). Although
any (semi-) supervised technique can be used to learn p(yi | xi), in this study,
we employed a fully-convolutional neural network (FCNN) [7].

Our dimensionless, unbiased and position-independent shape compactness
prior is based on a measure that is well accepted in the context of shape metrics
[16], the ratio of length-squared to area, which we can write in discrete form
(i.e., as a function of our segmentation variable): Ec(y) = P (y)2/A(y). The
area can be expressed as A(y) = (cid:80)
i yi, and the length is proportional to the
number of neighboring pixels with diﬀerent labels, i.e., P (y) ∝ (cid:80)
i,j wij(yi−yj)2,
where pairwise potential wij = 1 if i and j are neighbors, otherwise wij = 0.
Note that this compactness measure can be easily extended so as to attract the
solution towards strong edges in the image: wij = exp(− (cid:80)
k σk (xik − xjk)2),
with σk controlling the relative importance of feature k on the weight. With
these deﬁnitions of Ep and Ec, and re-writing length as P (y) = y(cid:62)Ly, where
L is the Laplacian matrix corresponding to weights wij, our compactness model
becomes:

arg min
y ∈ {0,1}|Ω|

E(y) = u(cid:62)y + λ

(cid:0)y(cid:62)Ly(cid:1)2
1(cid:62)y

,

(2)

where 1 is a vector with the value one for each element.

2.1 ADMM optimization

The general principle of ADMM is to decompose a hard problem into easier-
to-solve sub-problems, which are coupled together via equality constraints. In
our case, we introduce auxiliary variable z ∈ R|Ω| and s ∈ R+, and reformulate
problem (2) as

arg min
y, z, s

λ
s

u(cid:62)y +

(cid:0)y(cid:62)Ly(cid:1)(cid:0)z(cid:62)Lz(cid:1),

s.t. y = z and s = 1(cid:62)z.

(3)

Note that since we impose y = z, we can relax the binarity constraints on z.
This strategy allows an eﬃcient update of this variable.

In the next step, we move the constraints in the cost-function via a augmented

Lagrange formulation:

u(cid:62)y +

(cid:0)y(cid:62)Ly(cid:1)(cid:0)z(cid:62)Lz(cid:1) +

λ
s

µ1
2

(cid:13)
(cid:13)y − z + ν1

(cid:13)
2
2 +
(cid:13)

µ2
2

(cid:0)s − 1(cid:62)z + ν2

(cid:1)2

. (4)

arg min
y, z, s
ν 1, ν2

In this new formulation, ν1 and ν2 are dual variables corresponding to the two
constraints, and µ1, µ2 parameters controlling the trade-oﬀ between the primal
objective and constraint satisfaction. The beneﬁt of this formulation is that
solving for each variable, considering all other variables ﬁxed, can be carried out
eﬃciently and to optimality. We thus adopt an iterative optimization method,
where each variable is updated in turn until convergence.

Updating z: Let α = λ
as

s y(cid:62)Ly, the task of updating z can be expressed from (4)
µ2
2

(cid:13)z − (y + ν1)(cid:13)
(cid:13)
2
2 +
(cid:13)

(cid:0)1(cid:62)z − (s + ν2)(cid:1)2

µ1
2

(5)

.

αz(cid:62)Lz +

arg min
z ∈ R|Ω|

Minimizing this convex quadratic problem yields

z = (cid:0)αL + µ1I + µ211(cid:62)(cid:1)−1(cid:0)µ1(y + ν1) + µ2(s + ν2)1(cid:1).

(6)

Note that computing z requires solving a large and dense linear system. Let Q =
αL + µ1I, following the Woodbury identity and using the fact that Q−11 = 1
1,
µ1
we can reformulate the matrix inversion as:

(cid:0)αL + µ1I + µ211(cid:62)(cid:1)−1

= Q−1 −

+ 1(cid:62)Q−11

Q−111(cid:62)Q−1

(cid:17)−1

(cid:16) 1
µ2
1
µ1

(cid:16) µ1
µ2

= Q−1 −

+ |Ω|

(cid:17)−1

11(cid:62).

Since Q is very sparse, the resulting system can be solved eﬃciently via standard
techniques like the preconditioned conjugate gradients method.

Updating s: Let β = λ(y(cid:62)Ly)(z(cid:62)Lz), updating s amount to solving

arg min
s≥0

β
s

+

µ2
2

(cid:0)s − (1(cid:62)z − ν2)(cid:1)2

Deriving this equation w.r.t. s and setting the result to zero gives the following
cubic equation:

s3 − (cid:0)1(cid:62)z − ν2

(cid:1)s2 =

> 0.

β
µ2

It can be shown that this equation has a real valued root s > 1(cid:62)z − ν2. In
practice, 1(cid:62)z − ν2 is positive and converges toward zero, and s will be positive.

Updating y: Let γ = λ
following problem:

s z(cid:62)Lz and q = z − ν1. We update y by considering the

arg min
y ∈ {0,1}|Ω|

u(cid:62)y + λy(cid:62)Ly +

µ1
2

(cid:13)y − q(cid:13)
(cid:13)
2
(cid:13)
2

(10)

Since y is binary, we have that y2
reformulate (10) as

i = yi and (yi − yj)2 = |yi − yj|. Hence, we can

arg min
y ∈ {0,1}|Ω|

(cid:88)

i∈Ω

(cid:0)ui + µ1( 1

2 − qi)(cid:1)yi + λ

(cid:88)

wij

(cid:12)
(cid:12)yi − yj

(cid:12)
(cid:12).

(11)

i,j∈Ω2

This corresponds to a simple graph-cut problem, which can be solved eﬃciently
using the Boykov-Kolmogorov algorithm [5].

Finally, we update dual variables following the standard ADMM algorithm:
2 = ν2 + (s − 1(cid:62)z). This iterative updating process is

ν(cid:48)
1 = ν1 + (y − z) and ν(cid:48)
repeated until (cid:107)y − z(cid:107)2 is less than a small epsilon.

(7)

(8)

(9)

3 Experiments

We ﬁrst present a quantitative evaluation of our shape compactness on the task
of segmenting the abdominal aorta in a MR-T1 data set of 40 subjects. The
usefulness of the proposed method is then shown qualitatively for three addi-
tional segmentation scenarios: CT esophagus, MRI right ventricle and CT aorta
segmentation. Our method’s accuracy is measured in terms of Dice coeﬃcient,
and compared to that of graph cuts (GC) [5] and TRIC2 compactness [1]. To
measure the contribution of the pixelwise (i.e., unary potential) prior, we also
report results obtained via a simple thresholding.

While any technique can be used to obtain the unary-potentials in Eq. (2),
we considered the 3D fully-CNN (FCNN) architecture presented in [7]. This
architecture is comprised of 9 convolutional layers with non-linear activation
units, 3 fully-connected layers (converted into standard convolution operations),
and a soft-max layer. The output of this model is a map indicating the probability
of each pixel to belong to a given structure. The same unary potential was used
for all three tested approaches. For all segmentation applications, the FCNN was
trained using a k -fold validation strategy, with k = 4.

For our method’s ADMM parameters, we used µ1 ≈ 2000 and µ2=50 for all
experiments. As mentioned in [3], ADMM algorithms are not overly sensitive
to these parameters. To facilitate convergence, we increase the value of these
parameters by 1% (i.e., 1.01 multiplication factor) at each iteration. In contrast,
the compactness regularization λ was tuned for each segmentation problem: λ =
5000 for MR-T1 abdominal aorta, λ = 1000 for CT esophagus, λ = 15000 for MR
right ventricle, and λ = 3000 for CT abdominal aorta. The code has been made
publicly available at https://github.com/josedolz/UnbiasedShapeCompactness.

Fig. 2: Dice metric for 38 subjects of the 3D FCNN [7] output with graph cut[5]
regularization, with TRIC compactness [1], and with the proposed compactness.

MR-T1 abdominal aorta segmentation: As shown in the ﬁrst row of
Fig. 1, segmenting the aorta from MR-T1 images is a very challenging problem
due to the noise and lack of visible boundaries. In this example, thresholding the
FCNN probabilities yields parts of the background along with irregular contours.
Because it regularizes the segmentation, GC provides a smoother contour. How-
ever, this contour follows the probability map of FCNN and does not reﬂect the
compact shape of the target region. Increasing regularization weight in GC yields

2 Note that TRIC needs a reference point to deﬁne the shortest-path distance. This
point was deﬁned as the centroid of the CNN-based segmentation in this work.

a compact region but decreases performance signiﬁcantly due to the well-known
shrinkage bias of standard pairwise length regularization (bias to small regions);
note that regularization weight was tuned for an optimal GC performance. The
next experimental examples will further highlight shrinkage bias. Unlike GC,
TRIC ﬁnds a more compact region, due to its shape circularity prior. Nonethe-
less, this example illustrates this approach’s two main drawbacks: 1) it is biased
to near-circular regions, and 2) it is not translation invariant and ﬁnds regions
centered on the probability map’s center of mass. As seen in the ﬁgure, our pose-
independent method did not suﬀer from a circularity/shrinkage bias, yielding a
much more accurate segmentation, highly similar to the reference contours.

The bar plot of Fig. 2 gives the accuracy of tested methods obtained for each
subject3. The mean Dice and standard deviation computed across all subjects,
is reported in Table 1. These results conﬁrm that the proposed compactness
term provides a considerable improvement in accuracy. In terms of runtime, our
method takes about 80 seconds on average to segment a single subject, 60 seconds
of time spend computing the unary potentials via the FCNN. In contrast, TRIC
requires nearly 20 minutes per subject. Hence, our method is more suitable for
the fully automated segmentation of large-scale datasets.

Method

CNN [7] CNN + GC [5] TRIC [1]

Proposed

Dice
Time

0.73 (0.09)
∼ 60 sec

0.76 (0.09)
∼ 70 sec

0.71 (0.07)
∼ 20 min

0.81 (0.08)
∼ 80 sec

Table 1: Quantitative evaluations of MR-T1 abdominal aorta segmentations.

CT esophagus segmentation: Fig. 1 (second row ) shows delineations of
the esophagus in CT, also a challenging problem due to its complex shape and
non-homogeneous appearance. In this particular example, we can observe how
the well-known shrinkage bias problem of GC leads to an under-segmentation
of the esophagus. Notice that GC yielded a compact region but did not im-
prove FCNN’s performance. As in the previous case, we also observe how TRIC
over-enforces shape circularity on the segmentation. On the other hand, our
compactness term is able to preserve the target region’s shape.

MR Right Ventricle Segmentation: This qualitative result (Fig. 1, third
row ) shows how our compactness term can accommodate a more general class of
shapes that diﬀers signiﬁcantly from tubular structures. Although TRIC [1] can
also handle shapes diﬀerent than a circle, multiple reference points, which form a
skeleton, are required from the user in this case, a prohibitively time-consuming
eﬀort for 3D data. However, to keep the process fully automatic, only the centroid
of the FCNN segmentation was provided. Having only a single reference point,
and particularly in this scenario, led to failure of TRIC to achieve a satisfactory
segmentation.

CT Aorta Segmentation: The application of the proposed method to CT
aorta segmentation is illustrated in the last row of Fig 1. We see that our method
can handle multi-region scenarios, i.e. bifurcations, in contrast to other compact-

3 Two subjects were excluded from the quantitative analysis, as the FCNN failed to

generate a usable probability map.

ness terms [1]. Note that, for this example, we applied TRIC separately on each
of the two regions to avoid having a single contour centered in between these
regions. This means that we fed TRIC with additional supervision information,
unlike our method which is fully automatic. Notice that, to obtain compact and
smooth regions, GC worsened FCNN performance due to shrinkage bias.

4 Conclusion

We presented an unbiased, fully-invariant and multi-region prior for the seg-
mentation of compact shapes, based on the ratio of length-squared to area. An
eﬃcient ADMM strategy was proposed to solve the high-order energy minimiza-
tion problem resulting from this formulation. Using an FCNN to obtain unary
probabilities, the proposed method achieved high accuracy in four challenging
segmentation problems.

References

1. Ben Ayed, I., Wang, M., Miles, B., Garvin, G.J.: TRIC: Trust region for invariant
compactness and its application to abdominal aorta segmentation. In: MICCAI
(1). pp. 381–388. Springer (2014)

2. BenTaieb, A., Hamarneh, G.: Topology aware fully convolutional networks for his-

tology gland segmentation. In: MICCAI (2). pp. 460–468. Springer (2016)

3. Boyd, S., Parikh, N., Chu, E., Peleato, B., Eckstein, J.: Distributed optimization
and statistical learning via the alternating direction method of multipliers. Foun-
dations and Trends R(cid:13) in Machine Learning 3(1), 1–122 (2011)

4. Boykov, Y., Funka-Lea, G.: Graph cuts and eﬃcient nd image segmentation. In-

ternational Journal of Computer Vision 70(2), 109–131 (2006)

5. Boykov, Y., Kolmogorov, V.: An experimental comparison of min-cut/max-ﬂow al-
gorithms for energy minimization in vision. IEEE Transactions on Pattern Analysis
and Machine Intelligence 26(9), 1124–1137 (2004)

6. Das, P., Veksler, O., Zavadsky, V., Boykov, Y.: Semi-automatic segmentation with

compact shape prior. Image and Vision Computing 27(1), 206–219 (2009)

7. Dolz, J., Desrosiers, C., Ben Ayed, I.: 3D fully convolutional networks for subcor-

tical segmentation in mri: A large-scale study. arXiv:1612.03925 (2016)

8. Duquette, A.A., Jodoin, P.M., Bouchot, O., Lalande, A.: 3D segmentation of ab-
dominal aorta from CT-scan and MR images. Computerized Medical Imaging and
Graphics 36(4), 294–303 (2012)

9. E. Georgakarakos, C. V. Ioannou, Y.P.T.K., Katsamouris, A.N.: Computational
evaluation of aortic aneurysm rupture risk: What have we learned so far?”. Journal
of Endovascular Therapy 2(18), 214–225 (2011)

10. Gorelick, L., Veksler, O., Boykov, Y., Nieuwenhuis, C.: Convexity shape prior for
binary segmentation. IEEE Transactions on Pattern Analysis and Machine Intel-
ligence 2(39), 258–271 (2017)

11. Grady, L., Schwartz, E.L.: Isoperimetric graph partitioning for image segmentation.
IEEE Transactions on Pattern Analysis and Machine Intelligence 28(3), 469–475
(2006)

12. Isack, H.N., Veksler, O., Sonka, M., Boykov, Y.: Hedgehog shape priors for multi-

object segmentation. In: CVPR. pp. 2434–2442 (2016)

13. Kitamura, Y., Li, Y., Ito, W., Ishikawa, H.: Coronary lumen and plaque segmenta-
tion from cta using higher-order shape prior. In: MICCAI (1). pp. 339–347. Springer
(2014)

14. Kolmogorov, V., Boykov, Y., Rother, C.: Applications of parametric maxﬂow in

computer vision. In: ICCV. pp. 1–8 (2007)

15. Qiu, W., Yuan, J., Ukwatta, E., Sun, Y., Rajchl, M., Fenster, A.: Fast globally
optimal segmentation of 3D prostate mri with axial symmetry prior. In: MICCAI
(2). pp. 198–205. Springer (2013)

16. Santiago, R., Bribiesca, E.: State of the art of compactness and circularity mea-

sures. International Mathematical Forum 4(27), 1305–1335 (2009)

17. Veksler, O.: Star shape prior for graph-cut image segmentation. In: European Con-

ference on Computer Vision. pp. 454–467. Springer (2008)

