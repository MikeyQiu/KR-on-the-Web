7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

7
1
0
2
 
n
a
J
 
6
 
 
]

A
C
.
h
t
a
m

[
 
 
3
v
4
5
6
4
0
.
5
0
6
1
:
v
i
X
r
a

Wavelet Scattering Regression of Quantum
Chemical Energies∗

Matthew Hirn†

St´ephane Mallat‡

Nicolas Poilvert§

January 10, 2017

Abstract

We introduce multiscale invariant dictionaries to estimate quantum
chemical energies of organic molecules, from training databases. Molec-
ular energies are invariant to isometric atomic displacements, and are
Lipschitz continuous to molecular deformations. Similarly to density func-
tional theory (DFT), the molecule is represented by an electronic density
function. A multiscale invariant dictionary is calculated with wavelet
scattering invariants.
It cascades a ﬁrst wavelet transform which sepa-
rates scales, with a second wavelet transform which computes interactions
across scales. Sparse scattering regressions give state of the art results over
two databases of organic planar molecules. On these databases, the re-
gression error is of the order of the error produced by DFT codes, but at
a fraction of the computational cost.

Key words. wavelet, scattering, multiscale, nonlinear regression, invari-
ant dictionary, molecular energy, density functional theory, convolutional
network

AMS subject classiﬁcations. 42C40, 42C15, 62J02, 62P35, 70F10,
81Q05, 41A05, 41A63

∗Submitted to Multiscale Modeling and Simulation May 16, 2016. Revised version sub-
mitted October 24, 2016. Accepted for publication in Multiscale Modeling and Simulation
January 3, 2017.
Funding: The research and manuscript preparation were supported by ERC grant Invari-
antClass 320959. During the revision of the manuscript, M.H. was partially supported by an
Alfred P. Sloan Research Fellowship, a DARPA Young Faculty Award, NSF grant number
1620216, and additionally the Institute for Pure and Applied Mathematics (IPAM) during
which time he was a resident.

†Michigan State University, Department of Computational Mathematics, Science & En-
gineering and Department of Mathematics, 428 South Shaw Lane, East Lansing, MI, 48824,
USA, mhirn@msu.edu (corresponding author)

‡ ´Ecole normale sup´erieure, D´epartement d’Informatique, 45 rue d’Ulm, 75005 Paris, France
§The Pennsylvania State University, Millennium Science Complex, University Park, PA

16801, USA and BayLabs, Inc., nicolas@baylabs.io

1

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Contents

Contents

1 Introduction

2 Density Functional Theory

3 Energy Regression

3.1 Coulomb Kernel Regression . . . . . . . . . . . . . . . . . . . . .
3.2 Sparse Regression by Orthogonal Least Squares . . . . . . . . . .

4 Permutation Invariant Electronic Densities

5 Invariant Fourier Modulus and Autocorrelations

6 Invariant Wavelet Scattering
Invariant Wavelet Modulus

. . . . . . . . . . . . . . . . . . . . .
6.1
6.2 Multiscale Scattering Invariants . . . . . . . . . . . . . . . . . . .

7 Numerical Energy Regression of Planar Molecules

7.1 Representation of Planar Molecules . . . . . . . . . . . . . . . . .
. . . . . . . . . .
7.2 Numerical Comparison Over Planar Molecules

8 Regression of Coulomb Energy Functionals

8.1 Fourier Invariant Regression . . . . . . . . . . . . . . . . . . . . .
8.2 Wavelet Invariant Regression . . . . . . . . . . . . . . . . . . . .

9 Conclusion

A Wavelet Scattering Symmetries

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.2 Proof of lemma 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.3 Proof of lemma 5 . . . . . . . . . . . . . . . . . . . . . . . . . . .

References

2

3

5

8
8
9

10

13

15
15
18

20
21
22

31
32
33

35

35

37
37
42
42

44

2

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

1

Introduction

Computing the energy of a molecule given the charges and relative positions
of its nuclei is a central topic in computational chemistry.
It has important
industrial applications such as molecular structure screening for improved or-
ganic photovoltaic materials [24] and predicting the thermodynamics and ki-
netics of industrially relevant chemical reactions [17]. Molecular energies are
low lying eigenvalues of the molecular Hamiltonian operator, for the system
of all interacting particles in the molecule. An exact numerical computation
of molecular energies is beyond the capabilities of any computer for all but a
handful of tiny molecules. Density functional theory [44] reduces the compu-
tation of ground state molecular energies by mapping the eigenvalue problem
for the many-electron wavefunction to a variational problem over the total elec-
tronic density [27]. Nevertheless, the computational complexity remains con-
siderable for large molecules. Much faster machine learning algorithms have
been pioneered by several research groups, with surprisingly good results. Such
algorithms for potential energy surface ﬁtting of one molecule or material have
been developed for more than two decades, tracing back to [45] with further
contributions in [32, 8, 7, 42, 5, 49]. More recently machine learning algorithms
have been developed to interpolate molecular energies across “chemical com-
pound space,” ﬁtting the potential energy surface across a range of molecules
with diﬀerent compositions [41, 46, 16]. In both cases molecular energies are
regressed through interpolation over a database of known molecular energies.
The precision of such algorithms depends upon the ability to reduce the dimen-
sionality of the regression problem, by focusing on relevant variables. Eﬃcient
regression procedures take advantage of existing invariants [5]. We introduce
a sparse multiscale wavelet scattering regression derived from known invariant
and stability properties of molecular energies. State of the art numerical results
are shown on databases of planar molecules.

Most computational chemistry approaches like density functional theory
make use of the Born-Oppenheimer approximation, which models the atomic
nuclei as classical particles, whereas electrons are considered as quantum par-
ticles. The state x = {rk, zk}k of a molecule is thus deﬁned by the position
rk ∈ R3 of each nuclei and its charge zk > 0. Section 2 brieﬂy reviews the
principles of density functional theory computations. A regression algorithm
uses a training set of n molecular states {xi}i≤n and their quantum energies
{f (xi)}i≤n to approximate the quantum energy f (x) of any molecule x within
a given set Ω. Such a regression ˜f (x) can be calculated as a linear expansion
over a dictionary Φ(x) = (φk(x))k of functions of the molecular state x ∈ Ω,

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wk φk(x).

(1)

The regression vector w = (wk)k is computed by minimizing the training error
(cid:80)
i≤n |f (xi) − ˜f (xi)|2, with some regularity condition imposed on its norm.

Kernel and sparse regressions are reviewed in section 3.

(cid:88)

k

3

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The main diﬃculty is to ﬁnd a dictionary Φ(x) which produces a small
average error |f (x) − ˜f (x)| over all x ∈ Ω. Since w is calculated from n training
values, ˜f belongs to an approximation space, not necessarily linear, of dimension
smaller than the number n of training samples. The choice of Φ(x) = (φk(x))k
speciﬁes the regularity of ˜f (x), which needs to match the regularity of f (x).

A quantum energy functional f (x) satisﬁes elementary invariance and conti-
nuity properties relatively to geometric transformations of x, that we summarize:

1. Permutation invariance: f (x) is invariant to permutations of atom

indices k in the state vector x = {rk, zk}k.

2. Isometric invariance: f (x) is invariant to global translations, rotations,
and symmetries of atomic positions rk, and hence to any isometry [5].

3. Deformation stability: f (x) is Lipschitz continuous to variations of
the distances |rk − rl| between atoms, and hence Lipschitz continuous to
diﬀeomorphism actions [5].

We remark that the third property, deformation stability, excludes systems in
which the potential energy surface abruptly changes. This phenomena occurs
when electronic states cross, as can happen when a system goes from the ground
state to an excited state after the absorption of a photon. However, most
molecular systems left in their natural state will exhibit wide temperature and
pressure ranges over which the deformation stability hypothesis is veriﬁed. We
also emphasize that deformation stability, as described, does not include the
nuclear charges {zk}k. These are considered discrete and we only consider the
case of neutral molecular systems.

Dictionaries invariant to isometries are usually computed from the matrix
of Euclidean atomic distances {|rk − rl|}k,l. State of the art chemical energy
regressions have been obtained with Coulomb kernels computed from these dis-
tances. However, section 3.1 shows that this representation is not invariant to
permutations of the atom indices k, which introduces instabilities.

The goal of this paper is to introduce a dictionary Φ(x) which is invariant
to permutations and isometries, and Lipschitz continuous to diﬀeomorphism
actions.
It must also generate a space which is suﬃciently large to provide
accurate sparse energy regressions. Similarly to density functional theory, sec-
tion 4 explains how to represent the molecular state x by an electronic density
function ρ[x](u) of the spatial variable u ∈ R3. This density is invariant to atom
index permutations and covariant to isometries. Invariance to isometries is then
obtained by applying an invariant operator Θ:

The main diﬃculty is to deﬁne an operator Θ which is also Lipschitz contin-
uous to diﬀeomorphisms, and whose range is suﬃciently large to regress large
training databases. A tempting solution, used by several quantum energy re-
gression algorithms [6, 5, 4, 46, 16], is to deﬁne Θ from the autocorrelation or

Φ(x) = Θρ[x].

4

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the Fourier transform modulus of ρ. Section 5 explains why it yields instabilities
to deformations, which degrades numerical regressions.

Building invariant dictionaries which are stable to diﬀeomorphism actions
requires to separate variabilities at diﬀerent scales. A large body of work has
demonstrated the eﬃciency of multiscale modeling in quantum chemical sys-
tems [38, 47]. Multiscale wavelet transforms are used in some density functional
theory softwares, to reduce computations by providing sparse representations
of atomic wavefunctions [3, 37, 21, 44, 39, 48]. Section 6.1 deﬁnes wavelet
norms which are invariant to isometries. Section 8 proves that Coulomb po-
tential energies are regressed with much fewer wavelet invariants than Fourier
invariants. Such wavelet expansions are similar to multipole decompositions
[23, 22]. Quantum molecular energies also include exchange-correlation energy
terms, responsible for the existence of chemical bonds, which are more complex
than Coulomb potentials. The numerical results of section 7 show that wavelet
invariants do not generate a suﬃciently large approximation space to precisely
regress these exchange-correlation energies.

Wavelet invariants perform a multiscale separation but do not take into
account interactions across scales. Scattering invariants have been introduced in
[31] to characterize these interactions with multiscale interference terms. They
have found applications for image [43, 11] and audio [10, 2] signal classiﬁcations.
Section 6.2 describes the resulting dictionary computed by transforming wavelet
coeﬃcient amplitudes, with a second wavelet transform. The resulting wavelet
scattering dictionary remains invariant to isometries and Lipschitz continuous
to diﬀeomorphism actions.

The accuracy of quantum energy regression with Coulomb kernels, Fourier,
wavelet and scattering dictionaries is numerically evaluated in section 7, over
databases of planar molecules. The planar symmetry reduces computations to
two dimensions. It is shown that Coulomb kernel regression is approximately
two times more accurate than Fourier and wavelet regressions. Second order
scattering coeﬃcients considerably reduce the error of wavelet regressions. It
yields sparse expansions of quantum energy functionals. On these databases, the
error is up to twice smaller than Coulomb kernel regressions and has an accuracy
comparable to DFT numerical codes at a fraction of the computational cost.

2 Density Functional Theory

Density functional theory (DFT) provides relatively fast numerical schemes to
compute the ground state energy of molecular systems. We summarize its
methodology. Following the Born-Oppenheimer approximation, DFT models
the nucleus of each atom as a classical particle, whereas electrons are consid-
ered as quantum particles. The total energy of a molecular state x = {rk, zk}k
is decomposed into:

E(x) = E(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

5

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

The second right hand side term is the Coulomb repulsion energy of all nucleus-
nucleus interactions, considered as classical point-wise particles. The ﬁrst term
E(x) is the quantum energy resulting from electronic interactions. It is com-
puted as an eigenvalue of the electronic Sch¨odinger equation:

H(x)Ψ = E(x)Ψ,

(2)

where H(x) is the Hamiltonian of the state x and Ψ(r1, ..., rN ) is a wavefunction
which depends upon the positions of the N electrons of the molecule. The
Hamiltonian is a sum of three terms:

H(x) = −

∆rj −

1
2

N
(cid:88)

j=1

N
(cid:88)

K
(cid:88)

j=1

k=1

zk
|rj − rk|

+

1
2

N
(cid:88)

i(cid:54)=j

1
|ri − rj|

.

These are respectively the electronic kinetic energy, the Coulomb electron-
nucleus attraction energy, and the Coulomb electron-electron repulsion energy.
The Schr¨odinger equation (2) has many eigenvalues corresponding to quan-
tized energies. The ground state energy corresponds to the lowest lying eigen-
value of a molecular state x, that we designate by E0(x):

f (x) = E0(x) +

1
2

K
(cid:88)

k(cid:54)=l

zkzl
|rk − rl|

.

(3)

Computing the Schr¨odinger eigenvalues requires a considerable amount of
computations because Ψ(r1, ..., rN ) is a function of 3N variables. Density func-
tional theory considers instead the total electronic density as its unknown:

(cid:90)

ρ(u) =

R3(N −1)

|Ψ(u, r2, . . . , rN )|2 dr2 · · · drN .

Since we consider the molecule to be electrically neutral, the sum of electronic
charges is equal to the sum of nuclear charges:

(cid:90)

R3

ρ(u) du = N =

(cid:88)

zk.

k

Hohenberg and Kohn [27] proved that there exists a functional Ehk(ρ) of
the electronic density, whose minimum is the ground state energy E0(x). In the
Kohn-Sham approach to density functional theory [29], the total energy of the
system is expressed as such a functional of the charge density:

Ehk(ρ) =

T (ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Kinetic energy

−

K
(cid:88)

(cid:90)

R3

zkρ(u)
|u − rk|
(cid:123)(cid:122)
External energy
(electron-nucleus)

k=1
(cid:124)

du

+

(cid:125)

1
2
(cid:124)

(cid:90)

(cid:90)

R3

R3

ρ(u)ρ(v)
|u − v|
(cid:123)(cid:122)
Hartree energy
(electron-electron)

du dv

.

+ Exc(ρ)
(cid:124) (cid:123)(cid:122) (cid:125)
Exchange
correlation
energy

(cid:125)

(4)

6

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) C2H4

(b) C6H4OS

(c) C8H9N

(d) C7H9ON

(e) C6H3NO2

(f) C5H6N2OS

Figure 1: Ground state electronic density ρ0[x] of planar molecules, in their
plane.

The kinetic energy is not explicitly written as a functional of the density. Rather
it is a functional of the Kohn-Sham orbitals, the square sum of which yields ρ.
The exchange correlation energy regroups all of the quantum eﬀects that result
from collapsing the representation of the many body Schr¨odinger equation into
a functional of the electronic density ρ. The ground state energy E0(x) is
obtained as the minimum value of Ehk(ρ) over all admissible electronic densities
ρ. Its minimum value is reached at the ground state electronic density ρ0[x]
corresponding to the ground state electronic wavefunction Ψ0 of E0(x):

ρ0[x] = arg min

Ehk(ρ)

and E0(x) = Ehk(ρ0[x]).

admissible ρ

Figure 1 shows examples of ground state electronic densities ρ0[x] computed
for several planar organic molecules. The observed ”smearing” of the electronic
density between nuclei is responsible for the presence of chemical bonds within
the molecule.

The Kohn-Sham approach shows that the high-dimensional Sch¨odinger eigen-
value problem can be replaced by a variational problem over a three dimensional
electronic density.
In practical applications, the exchange correlation energy
term is approximated, which leads to computational errors. However, density
functional theory is most often used to compute molecular energies because
it currently provides the best trade oﬀ between accuracy and computational
complexity.

7

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

3 Energy Regression

Machine learning regressions are much faster procedures, which estimate the
ground state energy f (x) of a molecular state x, by interpolating a database
of ground state energies {xi, f (xi)}i. This approach was pioneered by several
groups [8, 41, 5, 46] who obtained impressive accuracy on diﬀerent types of
molecular databases. The next section describes Coulomb kernel ridge regres-
sions, which give state of the art machine learning results on organic molecules.
In this paper, we shall use sparse regressions, which are explained in section 3.2.

3.1 Coulomb Kernel Regression

We introduce Coulomb kernel ridge regressions and discuss their invariance
properties. A kernel ridge regression is a linear regression over the dictionary
Φ, given by ˜f (x) = (cid:104)w, Φ(x)(cid:105), where w = (wk)k is computed by minimizing the
penalized error:

(cid:88)

i

| ˜f (xi) − f (xi)|2 + λ

(cid:88)

|wk|2.

k

(5)

One can verify that the minimum is achieved for a w which can be written

(cid:88)

w =

αi Φ(xi),

i

with

n
(cid:88)

i=1

˜f (x) =

αi K(x, xi) and K(x, x(cid:48)) = (cid:104)Φ(x), Φ(x(cid:48))(cid:105).

The interpolation may thus directly be calculated from the kernel values K(x, xi),
by ﬁnding the dual variables {αi}i which minimize (5).

For quantum energy regressions, x = {rk, zk}k gives the position and charge
of each atom. The kernel must enforce the invariance to isometric transforma-
tions and the Lipschitz continuity to deformations. A Coulomb kernel [41] is
calculated from the Coulomb energy potentials between all point charges (rk, zk)
and (rl, zl) of x:

ck,l(x) =






1

2 z2.4
k ,
zkzl
|rk − rl|

k = l,

, k (cid:54)= l

.

The resulting Coulomb kernel is

K(x, x(cid:48)) = exp

−

|ck,l(x) − ck,l(x(cid:48))|

 .

(6)



1
σ

(cid:88)

k,l



If the two molecules have a diﬀerent number of atoms then the Coulomb matrix
of the smallest molecule is extended with a zero padding.

Since the Coulomb kernel depends upon distances |rk − rl| it is invariant
to isometries applied to atomic positions. A small deformation modiﬁes these

8

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

distances by a multiplicative factor between 1 − (cid:15) and 1 + (cid:15), where (cid:15) measures
the deformation size. Coulomb kernel values are thus modiﬁed by multiplicative
factors which are of the same orders, and thus deﬁne a representation which is
Lipschitz continuous to deformations.

However, Coulomb kernels are not invariant to permutations on the atom
indices k [36]. This invariance can be enforced by ordering the columns and
rows of the Coulomb matrix in decreasing order of their norm. However, this
sorting may not be uniquely deﬁned for symmetric molecules having several
inter atomic distances of the same value, and it introduces instabilities. Small
perturbations of atomic positions can indeed modify the ordering, thus breaking
the deformation Lipschitz stability. This instability is reduced by calculating
several Coulomb matrices, by adding a small random noise to the norms of rows
and columns, which modiﬁes their ordering. The regressed energy of a molecule
is the average of regressed energies calculated over these diﬀerent Coulomb ma-
trices. This numerical technique reduces instabilities but does not eliminate
them. However, these Coulomb kernel regressions nevertheless provide good
approximations to ground state quantum molecular energies [41, 25].

3.2 Sparse Regression by Orthogonal Least Squares

In this paper, we introduce sparse regressions in dictionaries Φ(x) = (φk(x))k
which are adapted to the properties of quantum energy functions f (x). A lin-
ear regression is sparse in Φ(x) = (φk(x))k if there are few, say M , non-zero
regression coeﬃcients wk. The regression can then be written:

˜f (x) = (cid:104)w, Φ(x)(cid:105) =

wkm φkm (x).

M
(cid:88)

m=1

The vector w is optimized in order to minimize the regression error (cid:80)
i≤n |f (xi)−
˜f (xi)|2, while imposing that the number of non-zero wk, and hence the (cid:96)0 norm
of w, is smaller than M . Under appropriate hypotheses on Φ(x), this (cid:96)0 norm
penalization can be replaced by an (cid:96)1 norm penalization, which is convex. How-
ever, these hypotheses are violated when Φ(x) = (φk(x))k includes highly corre-
lated functions [19, 18, 13]. This will be the case for quantum energy regression
over wavelet or Fourier invariants. Sparse regression may however be computed
with non-optimal greedy algorithms such as greedy orthogonal least square for-
ward selections [14]. We describe this algorithm before concentrating on the
construction of Φ(x).

A greedy least square algorithm selects the regression vectors one at a time,
and decorrelates the dictionary relatively to the previously selected vectors. The
initial dictionary Φ is normalized so that (cid:80)
i |φk(xi)|2 = 1 for each k. Let us
k )k the decorrelated dictionary at iteration m. We ﬁrst select φm
denote by (φm
km
k relatively to φm
from among (φm
km
over the training set {xi}i:

k )k. We then decorrelate the remaining φm

(cid:101)φm+1
k

= φm

k −

φm
km

(xi) φm

k (xi)

φm
km

.

(cid:17)

(cid:16) (cid:88)

i

9

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Each decorrelated vector is then normalized to deﬁne the updated dictionary:

φm+1
k

= (cid:101)φm+1
k

(cid:16) (cid:88)

| (cid:101)φm+1
k

(xi)|2(cid:17)−1/2

.

i

The linear regression fm(x) of f (x) is a projection on the ﬁrst m selected vectors:

m
(cid:88)

fm(x) =

(cid:101)wn φn

kn

(x) with (cid:101)wn =

(cid:88)

f (xi) φn
kn

(xi).

The mth vector φm
km
is minimized. Since all projections are orthogonal,

n=1
is selected so that the training error (cid:80)

i

i |fm(xi) − f (xi)|2

(cid:88)

i

|fm(xi) − f (xi)|2 =

|f (xi)|2 −

(7)

(cid:88)

i

m
(cid:88)

n=1

| (cid:101)wn|2.

The error is thus minimized by choosing φm
km

which best correlates with f :

km = arg max

k

(cid:12)
(cid:12)
(cid:88)
(cid:12)
(cid:12)
(cid:12)

i

f (xi) φm

(cid:12)
(cid:12)
(cid:12)
k (xi)
(cid:12)
(cid:12)

.

The algorithm can be implemented with QR factorization, as described in [9], or
directly as described above. In the latter case, the cost for each step is O(nK),
where n is the number of training samples xi and K is the number of dictionary
functions φk. Since the algorithm selects M dictionary functions, the total cost
is O(nKM ).
Since φm
km

is a linear combination of the {φkn }n≤m, the ﬁnal M -term regres-

sion can also be written as a function of the φkm in the dictionary Φ:

fM (x) =

(cid:101)wm φm

km

(x) =

wm φkm (x).

(8)

M
(cid:88)

m=1

M
(cid:88)

m=1

Equation (8) is the orthogonal least square regression of f (x) over M vectors
of Φ(x). This algorithm is used to represent quantum molecular energies over
several dictionaries which are now deﬁned.

4 Permutation Invariant Electronic Densities

To compute accurate sparse regressions of f (x) we must introduce a dictionary
Φ(x) which has the same invariance and regularity properties as f (x). It must
be invariant to isometries, and Lipschitz continuous to deformations, but also
invariant to permutations of atom indices. Similarly to density functional theory,
the molecular state x is represented by an electronic density ρ[x](u) for u ∈ R3.
Invariance to isometries is then obtained by applying an invariant operator Θ:

Φ(x) = Θρ[x].

10

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This section concentrates on the calculation of ρ[x], which must be invariant
to permutations of atom indices and covariant to isometries. We cannot use the
ground state molecular density ρ0[x], because its computation is as diﬃcult as
calculating the molecular ground state energy. We replace it by a much simpler
non-interacting density, which adds the electron densities of isolated atoms.
It does not include atomic interactions responsible for molecular bonds. The
eﬀect of these interactions on energy calculations will be incorporated through
regression coeﬃcients on Φ(x).

Each atom is in a neutral state, with zk protons and zk electrons. For
example, Hydrogen and Oxygen atoms correspond respectively to zk = 1 and
zk = 8. The electronic density of such an isolated atom is a rotationally invariant
function ρ[zk](u), with (cid:82) ρ[zk](u) = zk. The resulting non-interacting density of
all atoms located at {rk}k is:

ρ[x](u) =

ρ[zk](u − rk).

(9)

K
(cid:88)

k=1

Clearly ρ[x] is invariant to permutations of the indices k, and covariant to isome-
tries. A deformation of atomic distances |rk − rl| produces a deformation of the
atomic density ρ.

A model for the nuclei is obtained with a point charge ρ[zk] = zkδ(u), where
each nucleus is treated as a classical particle. Section 8 shows that this model
captures nuclei Coulomb interactions. As a model for the electrons, ρ[zk] =
zkδ(u) corresponds to aggregating all electrons at the position of the nucleus,
which does not capture their quantum behavior. Deﬁning ρ[zk] as the exact
electronic density of an isolated neutral atom with zk protons is a more accurate
model for the electronic density.
It is computed numerically with a density
functional theory software and stored.

A reﬁnement, which better captures the chemical properties of each atom
is to separate the density of core electrons ρcor from the density ρval of valence
electrons. Indeed, chemical bonds are produced by valence electrons, whereas
core electrons remain close to the nuclei and do not interact.
In this case,
ρ[zk](u) is considered as a vector with two components (ρcor(u), ρval(u)). Sec-
tion 7 shows that this separation provides a signiﬁcant improvement of quantum
energy regressions.

Figure 2(a) shows that the ground state electronic density ρ0[x] is more
delocalized along the bonds between atoms than the non-interacting electronic
density in ﬁg. 2(c), computed for individual atoms. The core electrons of the
density in ﬁg. 2(c) are shown in ﬁg. 2(d). They are located close to the nuclei
as in the Dirac model in ﬁg. 2(b). Valence electrons in ﬁg. 2(e) are more spread
out.

11

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Ground state electronic density

(b) Dirac model

(c) Atomic density model

(d) Core electron density model

(e) Valence electron density model

Figure 2: Electronic density and associated models.
(a): Ground state electronic density of the planar molecule C8H9N, restricted
to its plane, and computed by DFT.
(b-e): Non-interacting density models, with a Dirac model in (b), an atomic
density model computed by DFT in (c), which is subdivided into core electrons
in (d) and into valence electrons in (e).

12

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

5

Invariant Fourier Modulus and Autocorrela-
tions

Invariance to isometries is obtained by applying an operator Θ to the elec-
tronic density model ρ. A Fourier transform modulus or an autocorrelation
deﬁne translation invariant representations. Integrating over all rotations yields
isometric invariant representations, which are used by several quantum energy
regression algorithms [6, 5, 4, 46, 16]. We review the properties of these rep-
resentations. They are invariant to permutations and isometries, but we show
that they are unstable to deformations. This partly explains the limited perfor-
mance of a Fourier modulus representation for quantum energy regressions, as
shown by section 7.

The Fourier transform of a density ρ(u) is written for all ω ∈ R3,

ˆρ(ω) =

ρ(u)e−iu·ω du.

(cid:90)

R3

Since the Fourier transform of ρ(u − τ ) is ˆρ(ω) e−iτ ·ω, it results that |ˆρ(ω)|
is translation invariant.
Indeed, if we deﬁne
¯ρ(u) = ρ(−u) then |ˆ¯ρ(ω)| = |ˆρ(ω)|.

It is also symmetry invariant.

A rotation of ρ yields a rotation of its Fourier transform ˆρ. A rotation
invariant representation is obtained by averaging |ˆρ(ω)| over each rotation orbit,
indexed by the sphere S2. Let us represent ω ∈ R3 in spherical coordinates
(α, η) with α = |ω| and η ∈ S2. We write ˆρ(ω) = ˆρα(η). Rotation invariance is
obtained by integrating |ˆρα(η)|2 over η ∈ S2:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

(cid:90)

S2

For a non-interacting molecular density ρ[x](u) = (cid:80)

k ρ[zk](u − rk), Fourier
2 depend upon atomic positions rk through inter-atomic dis-

invariants (cid:107)ˆρα(cid:107)2
tances |rk − rl|. Indeed,

|ˆρ(ω)|2 =

ˆρ[zk](ω) ˆρ[zl]∗(ω) e−i(rk−rl)ω.

(cid:88)

k,l

Since ρ[zk](u) is rotationally invariant, ˆρ[zk](ω) is also rotationally invariant.
Integrating |ˆρ(αη)|2 over η ∈ S2 thus only depends on rk through all |rk − rl|.
These Fourier invariants thus deﬁne a distance embedding which is invariant to
index permutations, as opposed to Coulomb matrices, but they are not stable
to deformations.

Section 8 proves, essentially, that the Coulomb energy of nuclei and elec-
tronic densities can be regressed linearly, with an error O((cid:15)), over a dictionary
of Fourier invariants of size O((cid:15)−2). The radial frequency parameter α is sam-
pled at intervals (cid:15) over a frequency range α ∈ [(cid:15), (cid:15)−1].
It yields (cid:15)−2 Fourier
invariants {(cid:107)ˆρk(cid:15)(cid:107)2
2}1≤k≤(cid:15)−2. However, quantum energy functionals also include

13

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

more complex exchange correlation terms. The resulting energy stored in so-
called chemical bonds grows rather linearly than quadratically with the number
of electrons. To approximate these terms, we include L1 norms, which are also
invariant to isometries:

(cid:107)ˆρα(cid:107)1 =

|ˆρ(αη)| dη.

(cid:90)

S2

The resulting Fourier modulus dictionary is deﬁned by:

(cid:16)

Θρ =

(cid:107)ˆρk(cid:15)(cid:107)1 , (cid:107)ˆρk(cid:15)(cid:107)2
2

(cid:17)

.

0≤k≤(cid:15)−2

(10)

If ρ is deﬁned by core and valence electron densities, then these norms are
computed separately over core and valence densities, which multiplies by two
the number of invariants.

A major drawback of Fourier invariants is their instability to deformations.
Let Dτ ρ(u) = ρ(u − τ (u)) be a deformation of a density ρ(u). The amplitude
of such a deformation is given by the matrix norm of the Jacobian ∇τ , which
is written (cid:107)∇τ (cid:107)∞. If (cid:107)∇τ (cid:107)∞ < 1 then u − τ (u) is a diﬀeomorphism. Lipschitz
continuity to deformation means that there exists C > 0 such that for all ρ ∈
L2(R3),

(cid:107)Θρ − ΘDτ ρ(cid:107)2 ≤ C (cid:107)∇τ (cid:107)∞ (cid:107)ρ(cid:107)2,

(11)
2 = (cid:82) |ρ(u)|2du. The distance thus decreases to zero when the de-
with (cid:107)ρ(cid:107)2
formation amplitude (cid:107)∇τ (cid:107)∞ goes to zero. The factor (cid:107)ρ(cid:107)2 is an amplitude
normalization.

It is well known that the Fourier transform modulus does not satisﬁes this
Lipschitz continuity property. Consider a dilation τ (u) = (cid:15)u, for which (cid:107)∇u(cid:107)∞ =
(cid:15). In this case (cid:100)Dτ ρ(ω) = (1 + (cid:15))−1 ˆρ(ω(1 + (cid:15))−1) so a frequency ω0 is “moved”
by about (cid:15) ω0, which is large if ω0 (cid:29) (cid:15)−1. For any C > 0, one can then easily
construct ˆρ concentrated around a frequency ω0 so that (cid:107)|(cid:98)ρ| − | (cid:100)Dτ ρ|(cid:107)2 does
not satisfy (11), because the right hand-side decreases linearly with (cid:15) [31]. The
rotation invariance integration does not eliminate this instability so Θ is not
Lipschitz continuous to deformations.

One may replace the Fourier modulus dictionary by an autocorrelation as in

SOAP energy regressions [6, 5, 4, 16]:

Aρ(τ ) = ρ ∗ ¯ρ(τ ) with ¯ρ(u) = ρ(−u),

but it has essentially the same properties. It is also translation invariant and
its Fourier transform is |ˆρ(ω)|2. For an electronic density, we get

Aρ[x](τ ) =

ρ[zk] ∗ ¯ρ[zl](τ − (rk − rl)).

(cid:88)

k,l

Rotation invariance is obtained by representing τ in spherical coordinates (α, η),
with α = |τ |, η ∈ S2, and integrating over η:

Aρ[x](α) =

Aρ[x](αη) dη =

ρ[zk] ∗ ¯ρ[zl](αη − (rk − rl)) dη.

(cid:90)

S2

(cid:90)

(cid:88)

k,l

S2

14

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Since each ρ[zk] is a rotationally symmetric bump, it is a sum of bumps centered
at |rk − rl|. It is thus invariant to isometries acting on x. The width of each
bump is below a constant σ which measures the maximum spread of valence
electrons of individual atoms.

Instabilities to deformations Dτ ρ(u) = ρ(u−τ (u)) can be seen with a dilation
τ (u) = (1 + (cid:15))u. This dilation moves each bump located at |rk − rl| by (cid:15)|rk −
rl|. For long distances |rk − rl| (cid:29) σ/(cid:15), the bumps produced by the deformed
density have non-overlapping support with the original bumps. It results that
(cid:107)Aρ − ADτ ρ(cid:107)2 does not decreases proportionally to (cid:107)∇u(cid:107)∞ = (cid:15), uniformly over
all densities ρ. Similarly to the Fourier modulus, autocorrelation invariants are
not Lipschitz continuous to deformations.

Deformation instabilities can be controlled by imposing that the maximum
distance |rk − rl| is bounded by a constant which is not too large. This strategy
is adopted by local autocorrelations used by Smooth Overlap of Atomic Posi-
tions (SOAP) representations [5]. However, this limits the interaction distances
between atoms, which means that one can only regress energies resulting from
short range interactions, while being stable to deformations.

6

Invariant Wavelet Scattering

Wavelet transforms avoid the deformation instabilities of Fourier transforms, by
separating diﬀerent scales. We ﬁrst introduce wavelet transform invariants while
explaining their limitations to regress complex functionals. Wavelet scattering
transforms address these issues by introducing multiscale interaction terms.

6.1

Invariant Wavelet Modulus

A wavelet transform separates the variations of a function along diﬀerent scales
and orientations.
It is computed by dilating and rotating a mother wavelet
ψ : R3 → C having a zero average. We denote by rθ ∈ O(3) an orthogonal
operator in R3, indexed by a three-dimensional angular parameter θ. Applying
it to ψ at diﬀerent scales 2j gives:

ψj,θ(u) = 2−3jψ(2−jr−1

θ u).

The wavelet transform of ρ ∈ L2(R3) computes ρ ∗ ψj,θ. The Fourier transform
of ψj,θ is:

(cid:98)ψj,θ(ω) = (cid:98)ψ(2jr−1

θ ω).

If (cid:98)ψ(ω) has its support centered in the neighborhood of a frequency ω0 then (cid:98)ψj,θ
has a support located in the neighborhood of 2−jrθω0.

Similarly to the Fourier transform, we compute invariants from the modulus
If ψ∗(u) = ψ(−u), where ψ∗(u) denotes
of wavelet coeﬃcients |ρ ∗ ψj,θ(u)|.
the complex conjugate of ψ(u), then |ρ ∗ ψj,−θ| = |ρ ∗ ψj,θ|. Suppose that
ψ(u) is invariant to two-dimensional rotations around a symmetry axis deﬁned
by η0 ∈ S2, and thus satisﬁes ψ(rθu) = ψ(u) if rθη0 = η0. All numerical

15

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

computations are performed with Morlet wavelets, which are examples of such
symmetrical wavelets:

ψ(u) = e−|u|2/2(eiη0·u − C),
where C is chosen so that (cid:82) ψ(u) du = 0. The wavelet ψj,θ only depends upon
the value of η = rθη0 ∈ S2, modulo a sign. All rotations rθ which modify a
wavelet can thus be indexed by a two-dimensional Euler angular parametrisation
θ ∈ [0, π]2 of the half sphere.

Wavelet coeﬃcients are computed up to a maximum scale 2J . Frequencies
below 2−J |η0| are captured by a low-pass ﬁlter φJ (u) = 2−3J φ(2−J u) where
φ(u) ≥ 0 is a positive rotationally symmetric function, with (cid:82) φ(u)du = 1. Its
Fourier transform ˆφ(ω) is essentially concentrated in the ball |ω| ≤ |η0|. Often
φ(u) is chosen to be a Gaussian. The resulting wavelet transform operator is
deﬁned by:

(cid:110)

W ρ =

ρ ∗ φJ , ρ ∗ ψj,θ

(cid:111)

j<J, θ∈[0,π]2

.

The Fourier transform of ψ is assumed to satisfy the following Littlewood-

Paley condition for some 0 ≤ c < 1 and all ω (cid:54)= 0:

1 − c ≤ | ˆφ(2J ω)|2 +

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ≤ 1.

(cid:90)

(cid:88)

j<J

[0,π]2

Applying the Plancherel formula proves that
(cid:90)

(cid:90)

(1 − c) (cid:107)ρ(cid:107)2

2 ≤ (cid:107)ρ ∗ φJ (cid:107)2

2 +

(cid:88)

j<J

[0,π]2

R3

|ρ ∗ ψj,θ(u)|2 du dθ ≤ (cid:107)ρ(cid:107)2
2.

It results that W is a stable and invertible operator on L2(R3).

For an electronic density ρ[x](u) = (cid:80)

k ρ[zk](u − rk),

|ρ[x] ∗ ψj,θ(u)| =

(cid:12)
(cid:12)
(cid:12)

(cid:88)

(cid:12)
(cid:12)
(cid:12).
ρ[zk] ∗ ψj,θ(u − rk)

k

A wavelet modulus coeﬃcient thus gives the amplitude at u of interferences
produced by wavelets of scale 2j “emitted” by each charge density ρ[zk] centered
at rk; see ﬁg. 3.

The wavelet transform modulus is invariant to symmetries. If ¯ρ(u) = ρ(−u)
then |ρ ∗ ψj,θ(u)| = |¯ρ ∗ ψj,θ(u)| because ψ(−u) = ψ∗(u).
It is covariant to
translations and rotations but not invariant. Translation and rotation invariant
dictionaries are obtained by integrating |ρ ∗ ψj,θ(u)|2 over the translation and
rotation variables:

(cid:90)

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ.

R3×[0,π]2

The Plancherel formula gives

(cid:107)ρ ∗ ψj,.(cid:107)2

2 =

(cid:90)

1
(2π)3

R3×[0,π]2

|ˆρ(ω)|2 | ˆψ(2jr−1

θ ω)|2 dω dθ.

16

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 3: Wavelet modulus transform |ρ ∗ ψj,θ| of the molecule in ﬁg. 2, visual-
ized over log2 scales j = 0, . . . , 8 and eight two dimensional rotations sampled
uniformly from the half circle [0, π). Rotations are indexed on the horizontal
axis, while scales get progressively larger as one moves down the vertical axis.
Wavelet invariants such as (cid:107)ρ ∗ ψj,·(cid:107)1 aggregate all of the spatial and rotational
information from each row into a single wavelet coeﬃcient.

17

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

It computes the energy of |ˆρ(ω)|2 around the sphere of radius 2−j|η0|, over an
annulus of width of the order of 2−j|η0|. This frequency integral is much more
delocalized then the Fourier integral (cid:107)ˆρα(cid:107)2 which gives the energy of |ˆρ(ω)|2
exactly on the sphere of radius α. The index −j can be interpreted as a log
radial frequency variable. These wavelet quadratic invariants have a much lower
frequency resolution than Fourier invariants at high frequencies.

Similarly to the Fourier dictionary (10), the range of radial frequencies is
deﬁned over an interval [(cid:15), (cid:15)−2] for some (cid:15) > 0. Over this interval, there are
only 3| log2 (cid:15)| scales deﬁned by 2 log2 (cid:15) ≤ j < − log2 (cid:15) = J. For appropriate
wavelets, section 8 proves Coulomb energies can be regressed with an O((cid:15)) error
from these 3| log2 (cid:15)| wavelet invariants. Such a regression is much more sparse
than a Fourier regression which requires O((cid:15)−2) terms to obtain an O((cid:15)) error.
To regress molecular energy functionals, which include exchange correlation

energy terms, like the Fourier dictionary (10) we include L1 invariants:

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

at scales 2j < 2J . At the lowest frequencies we get (cid:107)ρ ∗ φJ (cid:107)1. Since ρ ≥ 0
and φJ ≥ 0 with (cid:82) φJ (u)du = 1, it results that (cid:107)ρ ∗ φJ (cid:107)1 = (cid:107)ρ(cid:107)1 is the total
electronic charge. The resulting invariant wavelet dictionary, up to a highest
frequency (cid:15)−2 is:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2
2

(cid:111)

.

(12)

2 log2 (cid:15)≤j<J

As opposed to Fourier, wavelets yield invariants which are stable to deforma-
tions. It is proved in [31] that such wavelet invariants are Lipschitz continuous
to the action of C2 diﬀeomorphisms. Indeed, wavelets are localized in space.
Computing the wavelet transform of a deformed ρ is equivalent to computing
the wavelet transform of ρ with deformed wavelets. Since wavelets have a local-
ized support, a deformation is locally equivalent to a small dilation and rotation,
which produces a small modiﬁcation of L2 or L1 norms.

Section 7 shows that quantum energy regressions over this wavelet invariant
dictionary produces a similar error as regression over Fourier invariants (10),
but with far fewer terms. The error is not much reduced because this dictionary
does not include enough invariants to regress the complex behavior of exchange
correlation energy terms.

6.2 Multiscale Scattering Invariants

A wavelet transform is invertible but integrating its modulus along spatial and
rotation variables does not produce enough invariants. Wavelet scattering oper-
ators have been introduced in [31] to deﬁne much richer sets of invariants, with
higher order multiscale interference terms.
Integrating wavelet modulus coeﬃcients

(cid:107)ρ ∗ ψj,.(cid:107)1 =

|ρ ∗ ψj,θ(u)| du dθ,

(cid:90)

R3×[0,π]2

18

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

removes the variability of |ρ ∗ ψj,θ(u)| along u ∈ R3 and θ ∈ [0, π]2. This
variability can be captured by computing the wavelet transform of |ρ ∗ ψj,θ(u)|
along both u and θ, which deﬁnes a scattering transform on the roto-translation
group [43]. In the following, we concentrate on the variability along u and thus
only compute scattering coeﬃcients along the translation variable u ∈ R3 [31].
The variations of |ρ ∗ ψj,θ(u)| along u are represented by a second wavelet
transform, which computes convolutions with a second family of wavelets at
diﬀerent scales 2j(cid:48)
with rotations of angles θ + θ(cid:48) ∈ [0, π]2:

||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ(u)|.

Such a coeﬃcient computes the ﬁrst order interferences |ρ ∗ ψj,θ(u)| of the vari-
ations of ρ at a scale 2j along the orientation θ. These interference amplitudes
interfere again by “emitting” a new wavelet of scale 2j(cid:48)
whose angle is incre-
mented by θ(cid:48). It yields second order interferences, whose amplitudes are mea-
sured at each position u. The Fourier transform of |ρ ∗ ψj,θ(u)| has an energy
mostly concentrated at frequencies |ω| < 2−j|η0|. As a result, the amplitude of
these second order coeﬃcients is non-negligible only if 2j(cid:48)

> 2j.

Invariance to translations and rotations is obtained by integrating along

(u, θ) ∈ R3 × [0, π]2:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)| du dθ.

(cid:90)

R3×[0,π]2

A coeﬃcient (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 computes the interaction amplitudes of vari-
ations of ρ at a scale 2j along the orientation θ, located at a distance about 2j(cid:48)
within an orientation θ(cid:48) + θ. It provides a rich set of invariants, which depend
upon the multiscale geometry of the charge density ρ.

Quadratic terms are obtained by integrating the squared amplitude of second

order coeﬃcients:

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2

2 =

||ρ ∗ ψj,θ(u)| ∗ ψj(cid:48),θ(cid:48)+θ(u)|2 du dθ.

(cid:90)

R3×[0,π]2

A scattering transform further iterates this procedure by computing higher or-
der terms obtained through convolutions with third order wavelets and more.
Because it cascades wavelet transforms, it is proved in [31] that a scattering
transform remains Lipschitz continuous to diﬀeomorphism actions. In this pa-
per, we only keep second order terms for regressions.

Wavelet scales are computed over a frequency range deﬁned by 2J > 2j(cid:48)
>
2j ≥ (cid:15)2. Adding second order terms to the invariant wavelet dictionary (12)
deﬁnes a second order wavelet scattering dictionary:

(cid:110)

Θρ =

(cid:107)ρ(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)1 , (cid:107)ρ ∗ ψj,.(cid:107)2

2 ,

(cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)1 , (cid:107)|ρ ∗ ψj,.| ∗ ψj(cid:48),θ(cid:48)+.(cid:107)2
2

(cid:111)

(13)

.

2 log2 (cid:15)≤j<j(cid:48)<J, θ(cid:48)∈[0,π]2

19

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

This dictionary is invariant to permutations of atom indices, to isometries and
is Lipschitz continuous to deformations. The next section shows that it consid-
erably outperforms Fourier modulus and wavelet representations for quantum
energy regressions.

Second layer scattering coeﬃcients are a priori indexed by a four dimen-
sional parameter (j, j(cid:48), θ(cid:48)) ∈ Z × Z × [0, π]2. Appendix A proves that the two
dimensional angle parameter θ(cid:48) can be reduced to a one dimensional angle pa-
rameter. Consider the second order term ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. If η ∈ S2 is the
axis corresponding to θ and η(cid:48) ∈ S2 is the axis corresponding to θ(cid:48) + θ, then
after integrating over θ the only distinguishing parameter is the angle between
η and η(cid:48) (which is constant for all θ). Indeed, since scattering coeﬃcients (13)
are invariant to rigid motions, a single rotation applied to both η and η(cid:48) will
not change their value.

Appendix A also precisely describes the symmetries of the wavelet ψ and the
corresponding wavelet modulus transform |ρ ∗ ψj,θ| and second order scattering
transform ||ρ ∗ ψj,θ| ∗ ψj(cid:48),θ(cid:48)+θ|. The approach in the appendix is used to not
only prove the aforementioned result, but also gives insight into how one can
eﬃciently compute scattering coeﬃcients by fully taking into account the built
in symmetries.

7 Numerical Energy Regression of Planar Molecules

We compare the performance of Coulomb kernel regressions with Fourier, wavelet
and scattering regressions, on two databases of planar organic molecules which
are in their equilibrium conﬁguration. The planar symmetry allows us to reduce
computations in two dimensions, as explained in the next section.

We remark that in most applications the equilibrium structure of the molecule
is not known, but rather must be found by computing the partial derivatives of
the total energy with respect to the atomic positions {rk}k, i.e. the ionic forces.
If the dictionary functions {φk}k are smooth and the gradient ∇φk can be com-
puted for each k, then the ionic forces can be incorporated into the regression
via:

∇ ˜f (x) =

wk∇φk(x).

(cid:88)

k

The gradients {∇φk}k can be computed analytically for the scattering dictio-
nary. We omit the details here, since they are not used in these numerical
experiments. However, such computations can be used, for example, to extend
scattering regressions for the purpose of calculating equilibrium conﬁgurations
corresponding to local minima in the potential energy surface.

All numerical results can be reproduced by visiting:

https://github.com/matthew-hirn/ScatNet-QM-2D

and downloading the ScatNet-QM-2D package, which includes all software and
data.

20

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

7.1 Representation of Planar Molecules

For planar molecules x, the positions {rk}k of the atom nuclei are in a two-
dimensional plane. Since the energy is invariant to rotations, it only depends
upon the relative nuclei positions in this plane. The molecule geometry can
thus be represented in two as opposed to three dimensions. Suppose that the rk
correspond to the two-dimensional positions of the nuclei in the plane R2. The
electronic density ρ[x] = (cid:80)
k ρ[zk](u − rk) can then be restricted to R2. The
invariant dictionary Φ(x) = Θρ[x] is computed by applying an operator Θ on
ρ[x](u), for u ∈ R2 as opposed to R3. Fourier, wavelet and scattering dictionar-
ies are therefore computed in two dimensions. Although it does not change the
nature of the regression problem, it reduces computations in numerical experi-
ments.

There are several ways to restrict the isolated electronic densities ρ[zk] to
R2. We derive the two dimensional density from the three dimensional one by
condensing the charge mass on the sphere of radius α to the circle of radius α.
Note that since the isolated charge densities are radially symmetric, the value
ρ[zk](u) depends only on |u|, i.e., ρ[zk](u) = ρ[zk](α) for α = |u|. The total
charge zk can therefore be decomposed over spheres of radius α as follows:

zk =

ρ[zk](u) du =

4πα2ρ[zk](α) dα.

(14)

A radially symmetric two-dimensional electronic density, ρ2D[zk] : R2 → R, with
total charge zk, can be decomposed similarly:

(cid:90)

R3

(cid:90)

R2

(cid:90) ∞

0

(cid:90) ∞

0

zk =

ρ2D[zk](u) du =

2παρ2D[zk](α) dα.

(15)

Equating the two integrands of (14) and (15) yields:

∀ α ∈ [0, ∞),

ρ2D[zk](α) = 2αρ[zk](α).

In two dimensions, reﬂections are not generated via −I (where I is the
identity matrix) as in R3, but rather through a ﬁxed reﬂection about a line, for
example the horizontal or vertical axis. Therefore, if (cid:101)ρ is a reﬂection of ρ,

(cid:107)|(cid:101)ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p

p = (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),−θ(cid:48)+·(cid:107)p
p,

where the angles θ, θ(cid:48) now parameterize the half circle S1, taken as (−π/2, π/2].
Two dimensional reﬂections thus reﬂect the second order angle parameter θ(cid:48),
mapping it to −θ(cid:48). Invariant second order scattering coeﬃcients are obtained
by taking the average:

∀ θ(cid:48) ∈ [0, π/2], p = 1, 2,

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
p.

In numerical computations, electronic densities ρ[x] are sampled at suﬃ-
ciently small intervals (cid:15). In the following, we normalize this sampling interval

1
2

(cid:88)

ε=−1,1

21

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

to 1. Electronic densities ρ[x] are sampled over a square of 22J samples, with
2J = 29. The Fourier dictionary (10) is computed with a two-dimensional
Fourier transform. The modulus and squared Fourier transform modulus are
integrated over the unit frequency circle S1, to achieve rotation invariance. The
resulting dictionary has 2J−1 = 28 radial Fourier invariants per density channel
(as described in section 4).

The wavelet dictionary (12) is computed with a wavelet transform over J = 9
scales 2j, j = 0, . . . , 8, with L1 and L2 norms. The angular variable is also
integrated over the circle S1. The wavelet dictionary thus has 2J + 1 = 19
wavelet invariants per density channel.

The scattering dictionary (13) also includes second order invariants, which
are indexed by two scale indices 0 ≤ j < j(cid:48) < J. In two dimensions, the angle θ
is discretized over L values in (−π/2, π/2]. In numerical computations, L = 16.
Second order terms include L1 and L2 invariants. The total number of second
order scattering functions is thus (L/2 + 1)J(J − 1). The wavelet scattering
dictionary therefore has 1 + 2J + (L/2 + 1)J(J − 1) = 667 invariants per density
channel.

For the parameters listed previously and using an iMac desktop with a 4
GHz Intel Core i7 processor and 32 GB 1600 MHz DDR3 random access mem-
ory (RAM), the walltime cost of computing the L1 and L2 scattering coeﬃcients
for a single molecule is approximately 45 seconds. The wavelet ﬁlters ψj,θ are
implemented as a ﬁlter bank, which requires a one time computation whose
walltime is approximately 25 seconds. The wavelet coeﬃcients ρ ∗ ψj,θ(u) are
computed in frequency, leveraging the fact that (cid:92)ρ ∗ ψj,θ(ω) = (cid:98)ρ(ω) (cid:98)ψj,θ(ω). Us-
ing the fast Fourier transform (FFT) and inverse FFT, the cost per molecule is
O(LJ 222J ) to compute the wavelet invariants. Scattering invariants are com-
puted in a similar fashion, but with a computational cost of O(L2J 322J ) that
reﬂects the additional second order invariants. Increasing the angle parameter
L increases the accuracy of the approximate integral over the rotation group
and also increases the number of second order scattering invariants; however,
it does not in general depend on the type of molecule. The scale parameter J
grows with the size of the largest molecule. Typically in two dimensions the
relationship is J ∼ 1
2 log2 K, where K is the number of atoms, although speciﬁc
types of molecules may scale diﬀerently (for example, a string of atoms arranged
linearly will scale as J ∼ log2 K, although in this case one could replace the
square grid with a rectangular one).

7.2 Numerical Comparison Over Planar Molecules

We compare the regression performance of Fourier, wavelet and scattering dic-
tionaries over two databases of planar molecules. The molecular atomization
energies in these databases were computed using the hybrid density functional
PBE0 [1]. The errors of such hybrid DFT methods are in the range of 3 to 5
kcal/mol [40, 28] relative to experimental energies (mean absolute error). The
ﬁrst database includes 454 nearly planar molecules among the 7165 molecules

22

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Table 1: Average Error ± Standard Deviation over the ﬁve folds in kcal/mol,
with a Coulomb kernel regression and sparse regressions in Fourier, wavelet and
scattering dictionaries. For scattering dictionaries, regressions are computed for
several densities ρ[x], with a Dirac model, atomic densities calculated by DFT
and separate core/valence densities.

2D molecules from QM7

M

MAE

RMSE

M

RMSE

QM2D

MAE

Coulomb Matrix

N/A

6.7 ± 2.8

14.8 ± 12.2

N/A

2.4 ± 0.1

5.4 ± 2.5

Fourier

Dirac + Core/Valence

73 ± 27

6.7 ± 0.7

8.5 ± 0.9

244 ± 52

5.3 ± 0.2

7.2 ± 0.4

Wavelet

Dirac + Core/Valence

38 ± 13

6.9 ± 0.6

9.1 ± 0.8

46 ± 4

5.4 ± 0.1

7.1 ± 0.3

Scattering

43 ± 32

15.9 ± 1.7

23.9 ± 7.2

262 ± 81

9.2 ± 0.1

11.7 ± 0.1

Dirac

Atomic

99 ± 40

4.0 ± 0.5

5.2 ± 0.6

299 ± 56

2.7 ± 0.0

3.8 ± 0.2

Dirac + Atomic

99 ± 35

4.1 ± 0.3

5.7 ± 0.6

373 ± 76

2.3 ± 0.1

3.4 ± 0.3

Core/Valence

107 ± 41

3.2 ± 0.1

4.5 ± 0.2

468 ± 108

1.6 ± 0.1

2.6 ± 0.5

Dirac + Core/Valence

97 ± 45

3.5 ± 0.2

5.0 ± 0.6

450 ± 91

1.6 ± 0.0

2.5 ± 0.4

of the QM7 molecular database [25]. We also created a second database of 4357
strictly planar molecules, which we denote QM2D. Both databases consist of
a set of organic molecules composed of Hydrogen, Carbon, Nitrogen, Oxygen,
Sulfur and additionally Chlorine in the case of QM2D. The molecules featured in
these databases cover a large spectrum of representative organic groups typically
found in chemical compound space.

To evaluate the precision of each regression algorithm, each data set is broken
into ﬁve representative folds, and all tests are performed using ﬁve fold cross
validation as described in [25]. We reserve four folds for training and model
selection, and the ﬁfth fold for testing. We do so for each of the ﬁve possible
permutations, and report average regression errors over the ﬁve test folds with
their standard deviation. We compute both a mean absolute error (MAE) which
is the average of the absolute value error over the testing fold, and the root mean-
square error (RMSE) which is the square root of the average squared error.

For the Coulomb matrix kernel regression described in section 3.1, we use
a collection of eight Coulomb matrices per molecule, as in [25]. The width σ
of the kernel (6) and the ridge regression parameter λ in (5) are selected by
cross validation, according to the algorithm described in [25]. The algorithm
was validated by recovering the numerical precision given in [25] over the full
QM7 database which includes 7165 molecules. In these experiments, we restrict
the training database to a subset of the 454 planar molecules in QM7. Coulomb
regression errors reported in table 1 are thus larger than in [25].

Sparse M -term regressions are computed in Fourier, wavelet and scatter-
ing dictionaries Φ(x) = (φk(x))k = Θρ[x], using the orthogonal least-square

23

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 4: log2 RMSE of the root mean square errors on the QM2D database of
4357 molecules, as a function of log2 M , where M is the number of regression
terms. Coulomb is the black dashed line, Fourier is blue, wavelet is orange, and
scattering is green. The circle indicates the optimal value of M .

regression algorithm described in section 3.2:

˜f (x) =

wkm φkm(x).

M
(cid:88)

m=1

(16)

Figure 4 compares the value of the RMSE error as a function of the dimension-
ality M of the regression model, for each dictionary. In each case, the electronic
density ρ is computed with (9), for core/valence densities ρ[zk] computed by
DFT as well as the Dirac density. Results show that the RMSE error is simi-
lar for the Fourier dictionary and the wavelet dictionary, although the wavelet
dictionary needs signiﬁcantly fewer terms to achieve the same minimum.

The regression error can be decomposed into a bias error due to the inability
to precisely approximate f (x) from a linear expansion in the dictionary Φ(x),
plus a variance term due to errors when optimizing the weights wk from a limited
training set. For the Fourier and wavelet dictionaries, observe that the error
obtained on the planar molecules from the QM7 database of 454 molecules is
only about 25% larger than the error on the QM2D database of 4357 molecules.
On QM2D, it is also signiﬁcantly bigger than the error obtained by Coulomb
kernel regressions, which saw a drastic reduction in regression error when going
from the smaller to the larger database. The fact that the overall error for
Fourier and wavelet dictionaries is not signiﬁcantly reduced when increasing

24

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

the database size by a factor of 10 indicates that the bias error dominates the
variance error.
It shows that the dictionary Φ(x) must be complemented by
more invariants to deﬁne a better approximation space.

Scattering regressions improve wavelet regressions by adding second order in-
variants. When the database size increases from 454 to 4357 molecules the scat-
tering error decreases by approximately 50%, and is smaller than the Coulomb
kernel regression error. The bias term has been reduced to match the variance
term, which gets smaller when increasing the database size. With separated
valence and core electronic densities, table 1 shows that the RMSE error of
a scattering regression is 2.6 kcal/mol. Observe also that the MAE of the
core/valence scattering regression is below 2.0 kcal/mol on the larger QM2D
database, relative to the DFT energies on which the regression was trained.
The consensus is that DFT has a hard time getting below 2 – 3 kcal/mol in
MAE [28], and these errors correspond to very recent methods. Thus if the
molecular energies were experimental and the scattering regression performed
similarly, scattering regressions would be in the same range of errors as DFT on
the QM2D database, which is promising.

Table 1 additionally indicates that the standard deviation of the scattering
error is smaller than the standard deviation of the Coulomb matrix error. Fur-
thermore the largest scattering errors are signiﬁcantly smaller than the largest
Coulomb matrix errors. The ﬁve largest Coulomb matrix regression errors on
individual molecules from QM2D are 224, 185, 83, 70, and 53 (all in kcal/mol),
whereas the ﬁve largest scattering errors are 62, 47, 40, 27, and 26 kcal/mol.
These larger errors may result from Coulomb matrix instabilities, which origi-
nate from the fact that unsorted Coulomb matrices are not invariant to permu-
tations; see the end of section 3.1 for a more detailed discussion.

Increasing the model dimension M increases the estimation variance but re-
duces the bias. The optimal choice of M results from a bias-variance trade-oﬀ,
and it is estimated from the training data. Rather than estimate the optimal
value of M via four fold cross validation on the training data, we apply a bag-
ging algorithm to learn multiple models, each with their own model dimension,
which are then averaged together to reduce the variance error. Each iteration
of the bagging algorithm uniformly randomly selects β% (0 < β < 100) of the
training data to train the model using the orthogonal least square algorithm,
up to a large value M0 for the model dimension. The algorithm then selects
a model dimension M ≤ M0 which minimizes the MAE or the RMSE on the
remaining (100 − β)% of the training data. The resulting M -term regression
is then computed on the test data. The procedure is repeated X times, and
the regressions on the test data are averaged together to give the ﬁnal regressed
energies. In numerical experiments β = 90 for the 454 nearly planar molecules
from QM7 while β = 80 for the larger QM2D data set; the number of bags is
X = 10 for both data sets. Table 1 reports the mean value of M over the 10
bags, for the Fourier, wavelet and scattering dictionaries, as well as the cor-
responding mean absolute error (MAE) and root-mean-square error (RMSE),
with the standard deviation over the ﬁve folds.

For a scattering transform, the model dimension M is approximately 7.5

25

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 5: The average scattering weights El
aggregated by scale.
Lighter boxes indicate large amplitudes, darker boxes are small amplitudes. The
upper row corresponds to the weights of wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p
p, while the
lower matrix shows the weights of scattering coeﬃcients 1
ε=−1,1 (cid:107)|ρ ∗ ψj,·| ∗
2
ψj(cid:48), εθ(cid:48)+·(cid:107)p

p for j < j(cid:48).

(cid:80)

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

times the number of parameters of a molecule. Indeed, each atom is speciﬁed
by 3 variables, its two-dimensional position and its charge, so a molecule of 20
atoms has 60 free variables. The dominant scales of the wavelets selected by the
orthogonal least square regression go from a small scale, localized around the
center location of each atom, up to a large scale on the order of the diameter of
the molecule. Scales beyond the diameter of the molecule are used sparingly. It
is thus suﬃcient in the training phase to compute second order scattering inter-
action terms at the corresponding scales 2j and 2j(cid:48)
, which limits computations.
In the testing phase, only the M scattering paths used in the regression need
be computed for new conﬁgurations, thus further limiting computations.

We further analyze the distribution of scattering coeﬃcients used in the
regression by computing the expected value of the squared amplitudes of the
weights ( (cid:101)wkm)m≤M for the orthonormal scattering dictionary (φm
)m≤M (sec-
tion 3.2), over the larger QM2D database. More precisely, a scattering regression
model (8) with M = 29 nonzero weights was trained from 80% of the QM2D
database, uniformly randomly selected. The value M = 29 was selected based
on ﬁg. 4, which indicates it is approximately the optimal value of M for scatter-

km

26

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

ing regressions on the QM2D database. The mean squared amplitude of each
weight (cid:101)wkm over the sub-database {xi}i≤n is computed as:

Ex(| (cid:101)wkm φm

km

(x)|2) =

| (cid:101)wkm φm

km

(xi)|2 =

| (cid:101)wkm |2.

1
n

1
n

n
(cid:88)

i=1

The process was repeated 103 times over diﬀerent draws of the training set,
yielding a set of weights ( (cid:101)wl
k)k,l, where k indexes the scattering coeﬃcient and
If on the lth draw a scattering coeﬃcient
l = 1, . . . , 103 indexes the draw.
φk is not selected within the ﬁrst 29 iterations of the orthogonal least square
k = 0. The resulting 103
algorithm, the corresponding weight is set to zero, (cid:101)wl
root mean squared amplitudes for each k are averaged over the draws,

El

(cid:18) 1
√
n

| (cid:101)wl
k|

(cid:19)

= 10−3

103
(cid:88)

l=1

1
√
n

| (cid:101)wl
k|.

(17)

Figure 5 displays the values (17) summed according to their scale, meaning
that they were aggregated over the non-scale scattering parameters correspond-
ing to the density (Dirac, core, valence), the norm (L1, L2), and the angle θ(cid:48)
for second order coeﬃcients. From this ﬁgure we observe:

1. The dominant weights are on second layer scattering coeﬃcients, giving
further numerical validation to their importance. Amongst them, the
weights corresponding to (j, j(cid:48)) = (1, 2) have the largest value by a signiﬁ-
cant margin. Further numerical investigation shows that the ﬁrst scatter-
ing coeﬃcient selected in all 103 iterations is (cid:107)ρval(cid:107)1 (not shown in ﬁg. 5)
and it’s corresponding weight is approximately 1475 kcal/mol in ampli-
tude, which is the order of magnitude of the energy of a single molecule.
The second coeﬃcient selected, however, is always (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1,
(cid:16) 1√
with corresponding mean weight El
≈ 129 kcal/mol, which con-
stitutes approximately 90% of the energy of all second order weights cor-
responding to scales (j, j(cid:48)) = (1, 2).

n | (cid:101)wl
k|

(cid:17)

2. The majority of the energy in the second layer coeﬃcients 1
2

ε=−1,1 (cid:107)|ρ ∗
p is concentrated along the band of scales j < j(cid:48) with
ψj,·| ∗ ψj(cid:48), εθ(cid:48)+·(cid:107)p
|j − j(cid:48)| ≤ 3. It can be interpreted physically as an interaction between two
scales, for example between micro- and meso-scale interactions or meso-
and macro-scale interactions. This type of coupling property was also
observed for multifractal stochastic processes in [12]. Practically, it means
that to regress the majority of the energy, only second order scattering
coeﬃcients within the band |j − j(cid:48)| ≤ 3 need to be computed.

(cid:80)

3. Wavelet coeﬃcients (cid:107)ρ∗ψj,·(cid:107)p

p contain signiﬁcantly less energy than second
order scattering coeﬃcients. Amongst these ﬁrst order coeﬃcients, micro-
and meso-scales (j = 0, . . . , 5) are used more than large scale wavelets
(j ≥ 6).

27

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Building upon the ﬁrst remark, we observe that the ﬁrst ﬁve scattering

coeﬃcients are constant across all 103 draws of the training set. They are:

1. (cid:107)ρval(cid:107)1

2. (cid:107)|ρval ∗ ψ1,·| ∗ ψ2,0+·(cid:107)1

(cid:80)

3. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ2,·| ∗ ψ4, ε 5π

16 +·(cid:107)2

2

4. (cid:107)|ρval ∗ ψ1,·| ∗ ψ3, π

2 +·(cid:107)1

(cid:80)

5. 1
2

ε=−1,1 (cid:107)|ρval ∗ ψ0,·| ∗ ψ3, ε 3π

16 +·(cid:107)1
Observe that after the ﬁrst coeﬃcient, the next four coeﬃcients are second order
scattering coeﬃcients that all lie within the band |j − j(cid:48)| ≤ 3. Furthermore,
amongst the ﬁrst ﬁve coeﬃcients, all utilize the valence density and four out
of ﬁve are L1 norms. These ﬁve coeﬃcients serve as a microcosm for trends
observed amongst the ﬁrst 29 selected scattering coeﬃcients, some of which were
described above in reference to ﬁg. 5, while other trends are described below
and in ﬁg. 6. Given that these ﬁve coeﬃcients are universally selected global
invariants, it is an interesting open question, particularly for the second order
terms, to understand how these coeﬃcients relate to the chemical properties
of the molecules in the database. After the ﬁfth selected term, the orthogonal
least square algorithm branches out. There are four possibilities for the sixth
coeﬃcient, although all are L1 norm second order coeﬃcients. By the seventh
coeﬃcient, both L1 and L2 second order coeﬃcients are possible. An order one
wavelet coeﬃcient is selected, at the earliest, as the 11th coeﬃcient.

Average scattering weights El

were also summed according to

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

(cid:17)
n | (cid:101)wl
k|

other parameter dimensions in addition to their scale.
In Figure 6(a) they
are organized according to the order of the corresponding scattering coeﬃcient,
(cid:16) 1√
by aggregating along k the values El
which correspond to order zero
coeﬃcients of the form (cid:107)ρ(cid:107)1, order one coeﬃcients of the form (cid:107)ρ ∗ ψj,·(cid:107)p
p, and
(cid:80)
order two coeﬃcients of the form 1
p. The summed
2
magnitude of each type of coeﬃcient is plotted as a function of the model di-
mension M . As expected from the previous discussion, the plot indicates that
an order zero coeﬃcient is selected ﬁrst, which is in fact (cid:107)ρval(cid:107)1, and that the
magnitude of its corresponding weight dominates the magnitudes of all subse-
quent weights. Such a coeﬃcient captures the total valence electronic charge
of each molecule. Second order scattering terms in turn dominate ﬁrst order
wavelet terms, indicating once again their usefulness.

ε=−1,1 (cid:107)|ρ∗ψj,·|∗ψj(cid:48), εθ(cid:48)+·(cid:107)p

Figure 6(b) plots the magnitudes of L1 and L2 aggregated scattering weights.
Recall that L1 coeﬃcients scale with the number of bonds, while L2 coeﬃcients
incorporate quadratic behavior resulting from Coulomb interactions. Including
the ﬁrst weight for the coeﬃcient (cid:107)ρval(cid:107)1 shows that L1 energies dominate L2
energies. However, when this weight is removed, Figure 6(b) indicates that
the two types of coeﬃcients are more balanced, with L1 weights accounting for
approximately twice the energy as L2 weights.

28

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(a) Order zero, one, and two average scattering weights.

(b) L1 and L2 average scattering weights.

(c) Dirac, core, and valence average scattering weights.

Figure 6: Comparison of the average scattering weights El
diﬀerent categories of the coeﬃcients: the order of the coeﬃcient (zero, one, or
two), the norm of the coeﬃcient (L1 or L2), and the type of density (Dirac,
core, valence).

for three

(cid:16) 1√

(cid:17)
n | (cid:101)wl
k|

29

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Figure 7: Decay of the scattering weights’ magnitude 1√
m. The solid line is El
n | (cid:101)wl

n | (cid:101)wl
, while the upper bound of the shaded region

| as a function of

(cid:16) 1√

km

km

(cid:17)

|

(cid:16) 1√

(cid:17)

n | (cid:101)wl

and lower bound is minl
is maxl
is the quadratic polynomial that best ﬁts El

km

|

(cid:17)
|

(cid:16) 1√
(cid:16) 1√

n | (cid:101)wl
n | (cid:101)wl

km

km

. The red dashed curve
(cid:17)

on a log2 – log2 scale.

|

The precision of the regression also depends upon the electronic density mod-
els ρ[zk] used to compute the non-interacting density ρ[x] = (cid:80)
k ρ[zk](u − rk).
Table 1 shows that the error obtained with a point charge Dirac density is more
than three times as big as the error obtained with the electronic density of iso-
lated atoms, computed by DFT. The density model which separates valence and
core electronic densities further reduces the error by more than 30%. This model
multiplies by two the number of invariants of each dictionary since invariants
are computed separately for the core and valence densities. The primary factor
in the improvement is the separated valence density. Indeed, Figure 6(c) shows
that the energy of valence coeﬃcients dominates the energy of core and Dirac
density weights, even if the weight corresponding to (cid:107)ρval(cid:107)1 is removed. This
phenomena is chemically intuitive, since diﬀerences between molecules result
primarily from the interactions of valence electrons of constituent atoms. From
table 1 we also observe that the addition of the Dirac density, theoretically used
to learn the nuclei Coulomb interactions (section 8), to either the atomic den-
sity or core/valence densities yields only a small improvement in the numerical
precision. It can thus can be omitted in computations.

Finally, we study the decay of the weights’ magnitude | (cid:101)wl

| as a function
of m, which by (7) determines the rate of convergence of ˜f to f on the training

km

30

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

km

set. We extend the numerical experiment that generated ﬁgs. 5 and 6 by com-
puting the weights (cid:101)wl
up to m = 3 · 29 (the same maximum model dimension
M in ﬁg. 4). In ﬁg. 7 we plot El
(cid:17)
|

as a function of m. From the ﬁgure we observe that on the
minl
log2 – log2 scale, the weights decay similarly to the decreasing part of a convex
quadratic polynomial. This implies:

as well as maxl

n | (cid:101)wl

n | (cid:101)wl

n | (cid:101)wl

(cid:16) 1√

(cid:16) 1√

(cid:16) 1√

and

(cid:17)
|

(cid:17)
|

km

km

km

El

(cid:18) 1
√
n

(cid:19)
|

| (cid:101)wl

km

≈ 2cma log2 m+b,

a > 0, b < 0,

1 ≤ m ≤ 3 · 29.

(18)

(cid:16) 1√

(cid:17)

|

km

n | (cid:101)wl

Equation (18) shows that El
satisﬁes a variable power law C|m|−α(m),
where α(m) decreases linearly as a function of log2 m. For the polynomial
plotted in ﬁg. 7, a ≈ 0.07 and b ≈ −2.1 and the polynomial is given by
P (x) = ax2 + bx + c. Thus the power α(m) decreases from approximately
2.1 at m = 1, to 1.4 at m = 29 (the approximate best value of M from table 1
and ﬁg. 4), to 1.3 at m = 3 · 29. While the initial power law gives a fast rate
of convergence, it slows as m gets larger thereby giving diminishing returns for
˜f as the orthogonal least square algorithm progresses. Figure 4 indicates that
the diminishing improvement in the bias error of the model is overtaken by the
increasing variance error at approximately m = 29.

8 Regression of Coulomb Energy Functionals

We study the regression of Coulomb potential energies with Fourier and wavelet
invariant dictionaries. Let us ﬁrst relate Coulomb energy terms to the quantum
energy of a molecule.

The Kohn-Sham approach to density functional theory decomposes the en-
ergy as a sum of four terms in (4). The ground state energy f (x) is obtained by
adding the nuclei-nuclei Coulomb potential energy in (3), which can be rewrit-
ten:

f (x) = T (ρ0) +

U (ρn − ρ0) + Exc(ρ0),

1
2

where ρ0 is the ground state electronic density and ρn = (cid:80)
k zk δ(u − rk) is
the point charges of the nuclei. The ﬁrst term T (ρ0) is the Kinetic energy and
Exc(ρ0) is the exchange correlation energy. The Coulomb potential energy of
the electronic density and the nuclei charges are regrouped in

U (ρ) = p.v.

(cid:90)

(cid:90)

R3

R3

ρ(u) ρ(v)
|u − v|

du dv,

(19)

evaluated for the overall charge density ρ = ρn − ρ0. Whereas the ground state
electronic density ρ0 is Lipschitz with fast decay, the nuclei density ρn is a sum of
Diracs. The Coulomb integral is deﬁned as the Cauchy principal value integral
to handle the singularity of the Coulomb kernel |u|−1 for point charges. To

31

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

simplify notations, we omit the p.v. notation, but all Coulomb energy integrals
are deﬁned in that sense.

The exchange correlation energy is a complicated term which makes the
mathematical analysis of solutions particularly diﬃcult.
In the following, we
concentrate on the Coulomb energy potential U (ρ). Section 8.1 proves that
the Coulomb energy potential is linearly regressed with an error O((cid:15)1−δ) with
O((cid:15)−2) Fourier invariants calculated from ρ, for arbitrary δ > 0. Section 8.2
proves that a wavelet invariant dictionary produces a regression error O((cid:15)) with
only O(| log (cid:15)|) terms.

8.1 Fourier Invariant Regression

The Coulomb potential energy U (ρ) is invariant to isometries. We prove that
it can be linearly regressed over the quadratic Fourier invariants introduced in
section 5:

(cid:107)ˆρα(cid:107)2

2 =

|ˆρ(αη)|2 dη.

The Coulomb energy (19) can be written as a convolution

U (ρ) = p.v.

¯ρ ∗ ρ(u) |u|−1 du,

(cid:90)

S2

(cid:90)

R3

with ¯ρ(u) = ρ(−u). Since the Fourier transform of |u|−1 is 4π|ω|−2, the Parseval
formula gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω.

(20)

Let δ > 0. The following theorem gives a regression of U (ρ) using (cid:15)−2 quadratic
Fourier invariants (cid:107)ˆρα(cid:107)2
It proves that the
regression error is O((cid:15)1−δ). Like ρn − ρ0, ρ is a sum of a Lipschitz function with
fast decay and a ﬁnite number of point charges.

2 sampled on an (cid:15)–grid of [(cid:15), (cid:15)−1].

Theorem 1. If ρ is a sum of a Lipschitz function in L1(R3) with exponential
decay and a ﬁnite number of point charges, then for any 0 < (cid:15) < 1 and 0 < δ < 1,

U (ρ) =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
4π2

(cid:15)−2−1
(cid:88)

k=2

(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2


 + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(21)

Proof. Since (cid:107)ˆρα(cid:107)2

S2 |ˆρ(αη)|2 dη it results from (20) that

2 = (cid:82)
(cid:90) ∞

1
2π2

1
2π2

0
(cid:90) ∞

0

(cid:90)

1
α2

S2
α

(cid:90)

1
α2 · α2

S2

U (ρ) =

=

|ˆρ(η)|2 dη dα,

|ˆρ(αη)|2 dη dα =

1
2π2

(cid:90) ∞

0

(cid:107)ˆρα(cid:107)2

2 dα,

where S2
high frequency cut of this integral to obtain an error O((cid:15)1−δ).

α ⊂ R3 is the sphere of radius α. The following lemma gives a low and

32

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 2. Under the hypotheses of theorem 1,

and for any 0 < δ < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω = O((cid:15))(cid:107)ρ(cid:107)2
1,

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω = O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

It results from this lemma that

U (ρ) =

(cid:90) (cid:15)−1

1
2π2

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα + O((cid:15)1−δ)(cid:107)ρ(cid:107)2
1.

(22)

This second lemma provides a Riemann sum approximation of this integral using
the trapezoid rule.

Lemma 3. Under the hypotheses of theorem 1,

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 + 2

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(23)

Inserting (23) in (22) proves (21). The proofs of lemmas 2 and 3 are given

in appendices B.1 and B.2, respectively.

Since δ can be made arbitrarily small, theorem 1 proves, for all practical
purposes, that Fourier regressions can approximate U (ρ) to accuracy O((cid:15)) uti-
lizing O((cid:15)−2) invariants. Lemma 3 can be improved by utilizing higher order
Newton-Cotes numerical integration schemes [26], in which case one can show
that for an arbitrary δ(cid:48) > 0 independent of δ, there exists O((cid:15)−(1+δ(cid:48))) quadratic
Fourier invariants that regress U (ρ) to accuracy O((cid:15)1−δ); some additional re-
marks along these lines are given in appendix B.2. Furthermore, the assump-
tions on ρ are physically valid. Indeed, it is reasonable to assume ρ0 is Lipschitz,
see for example [20], and it is known [35] that the electronic density ρ0(u) decays
exponentially fast as |u| → ∞.

8.2 Wavelet Invariant Regression

A Coulomb potential energy is computed with the singular convolution kernel
|u|−1. The Fourier spectrum 4π|ω|−2 is singular at ω = 0 and has a slow decay.
Such homogeneous singular operators are better represented with wavelet trans-
forms [15, 33, 34, 30]. The following theorem proves that Coulomb potentials
have a much more sparse regression over quadratic wavelet invariants,

(cid:90)

(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ρ ∗ ψj,θ(u)|2 du dθ,

R3×[0,π]2

than over Fourier invariants.

33

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Theorem 4. Suppose ψ has compactly supported Fourier transform and satisﬁes
for ω (cid:54)= 0,

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2.

(24)

If ρ is the sum of a Lipschitz function in L1(R3) and a ﬁnite number of point
charges, then:

U (ρ) = 4π

22j (cid:107)ρ ∗ ψj,·(cid:107)2

2 + O((cid:15))(cid:107)ρ(cid:107)2
1,

as (cid:15) → 0.

(25)

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

− log2 (cid:15)
(cid:88)

j=2 log2 (cid:15)

Proof. Since

inserting (24) gives

U (ρ) =

(cid:90)

4π
(2π)3

R3

|ˆρ(ω)|2
|ω|2 dω,

U (ρ) =

(cid:90)

22j

4π
(2π)3

(cid:88)

j∈Z

(cid:90)

[0,π]2

R3

| (cid:98)ψj,θ(ω)|2|ˆρ(ω)|2 dω dθ.

Applying the Plancherel formula proves that

U (ρ) = 4π

22j(cid:107)ρ ∗ ψj,.(cid:107)2
2 .

(cid:88)

j∈Z

(26)

(27)

(28)

The following lemma proves that the inﬁnite sum over j can be truncated with
an O((cid:15)) error; it’s proof is in appendix B.3.

Lemma 5. Under the hypotheses of theorem 4,

and

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1,

22j(cid:107)ρ ∗ ψj,.(cid:107)2

2 = O((cid:15))(cid:107)ρ(cid:107)2
1.

Inserting (27) and (28) in (26) proves (25).

This theorem proves that Coulomb potential energy can be regressed to
O((cid:15)) error with 3| log2 (cid:15)| = O(| log (cid:15)|) wavelet invariants, as opposed to O((cid:15)−2)
Fourier invariants. Similarly to multipole approximations of Coulomb potentials
[23, 22], the wavelet transform regroups Coulomb interactions at distances of
the order of 2j, which gives an eﬃcient regression formula.

The wavelet condition (24) is satisﬁed if (cid:98)ψ(ω) = |ω|−1 (cid:98)ψ0(ω) where (cid:98)ψ0(ω)

satisﬁes the exact Littlewood-Paley condition for all ω (cid:54)= 0:

(cid:90)

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ0(2jr−1

θ ω)|2 dθ = 1 .

34

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

In the last two sections, we computed U (ρ) by supposing that ρ is known.
Given the molecular state x = {zk, rk}k, the pointwise nuclear charge ρn(u) =
(cid:80)
k zkδ(u − rk) is known, but the ground state electronic density ρ0(u) is un-
known. The non-interacting electronic densities ρ[x] are crude approximations
of ρ0. One may however approximate ρ0 through deformations of ρ[x]. Since
wavelet transforms are Lipschitz continuous to deformations, adjusting the lin-
ear regression coeﬃcients in (25) can partly take into account the electronic
density errors. Such adjustments are more unstable with Fourier invariant re-
gressions, because of the Fourier instabilities to deformations at high frequencies.

9 Conclusion

We introduced a multiscale dictionary of invariants to compute sparse regres-
sions of quantum molecular energies. We proved that Coulomb potential ener-
gies are regressed with few wavelet transform invariants, but these invariants
do not have enough ﬂexibility to accurately regress quantum molecular ener-
gies. Wavelet invariants are complemented by multiscale scattering invariants
providing higher order interaction terms, which improve energy regressions.

Numerical regression errors over two databases of planar molecules are of the
order of DFT errors, but further numerical experiments over larger databases
of three dimensional molecules are needed to evaluate the range of validity of
these quantum energy regressions. A priori there is no mathematical diﬃculty
in working with three dimensional molecules, and indeed all of the mathematical
analysis is carried out over R3. Numerically, ongoing work includes the develop-
ment of computational and memory eﬃcient three dimensional wavelet ﬁlters,
done in part by leveraging the symmetries described in appendix A. Already
though these numerical results over planar molecules are opening mathemat-
ical questions to relate more precisely second order scattering coeﬃcients to
the properties of kinetic energy terms and exchange correlation energy terms of
density functional theory.

Let us ﬁnally emphasize that scattering energy regressions rely on general
invariance and stability properties, which are common to large classes of in-
teracting many body problems. Multiscale scattering regressions may thus also
apply to other many body problems, which exhibit complex multiscale behavior,
such as in astronomy, atmospheric science, and ﬂuid mechanics.

A Wavelet Scattering Symmetries

We prove that second layer scattering terms (cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),θ(cid:48)+·(cid:107)p
p, for p = 1, 2,
j, j(cid:48) ∈ Z, and θ(cid:48) ∈ [0, π]2, in fact only depend on a one dimensional angle pa-
rameter as opposed to the two dimensional θ(cid:48).
In doing so, we give a more
detailed explanation of the wavelet and scattering symmetries described in sec-
tions 6.1 and 6.2, and show how one might practically implement the scattering
transform to take these symmetries into account.

35

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

(29)

(30)

(31)

To do so, we index rotations of the wavelet ψ by unit vectors η ∈ S2 as
opposed to the Euler angle θ. Recall ψ is assumed to have two symmetry prop-
erties: (i) ψ∗(u) = ψ(−u), and (ii) ψ is symmetric about an axis η0, meaning
ψ(ru) = ψ(u) for any r ∈ O(3) that ﬁxes η0, i.e., rη0 = η0. Deﬁne:

ψj,r(u) = 2−3jψ(2−jr−1u),

j ∈ Z, r ∈ O(3),

and recall that O(3) = SO(3) × {I, −I}. Since we exclusively consider the
wavelet modulus transform, and since property (i) implies |ρ ∗ ψj,r| = |ρ ∗ ψj,−r|,
we can restrict ψj,r to r ∈ SO(3). Furthermore, let rη ∈ SO(3) denote a rotation
that moves η0 to η:

The wavelet ψj,rη is symmetric about η, and furthermore

rηη0 = η.

ψj,rη = ψj,˜rη ,

for any two rotations rη, (cid:101)rη ∈ SO(3) deﬁned by (29). Therefore we can index
the rotated wavelet by η ∈ S2, and set:

ψj,η(u) = 2−3jψ(2−jr−1

η u),

j ∈ Z, η ∈ S2.

Second layer scattering terms are represented as follows. The second wavelet

modulus transform is computed as:

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)| =

ρ(v)2−3jψ(2−jr−1

η (· − v)) dv

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
∗ ψj(cid:48),rηγ(u)
(cid:12)
(cid:12)

,

where j(cid:48) ∈ Z and γ ∈ S2. Similar to the Euler angle presentation, the orien-
tation of the second wavelet is decomposed as an increment of the ﬁrst wavelet
orientation. In this case, the axis η0 is ﬁrst moved to γ, and then γ is moved to a
new axis by the same rotation that moves η0 to η. Isometry invariant scattering
coeﬃcients are derived by integrating over η and u:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(cid:107)p

p =

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(u)|p dη du.

(cid:90)

(cid:90)

R3

S2

In the vector presentation, second layer scattering coeﬃcients are a priori
indexed by j, j(cid:48), and γ ∈ S2. We now show that they only depend on the
one dimensional angle between η and rηγ, as opposed to the two dimensional
γ. First note that this angle is indeed ﬁxed and is equal to arccos(η0 · γ), since
η · rηγ = r−1
η η · γ = η0 · γ. Now let δ ∈ S2 be a second vector such that
η0 · δ = η0 · γ, which implies that there exists a rη0 ∈ SO(3) such that rη0δ = γ.
Therefore:

rγη0 = rrη0 δη0 = rη0 δ = rη0rδη0,

for any rγ, rδ ∈ SO(3). In particular, we can take rγ = rη0rδ. This yields:

rηγ = rηrγη0 = rηrη0rδη0 = rηrη0 δ.

36

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

But rηrη0 η0 = η, which implies (cid:101)rη = rηrη0. Therefore rηγ = (cid:101)rηδ, which com-
pletes the proof by (30).

The rotation rη in (31) can be any rotation satisfying (29). In practice one

can use the following construction. Let

where × denotes the usual cross product. Deﬁne the skew symmetric cross
product matrix of ν as:

ν = η0 × η,

[ν]× =





0
ν3
−ν2

−ν3
0
ν1

ν2
−ν1
0



 ,

where ν = (ν1, ν2, ν3). One can then take rη to be:

rη =

I,





I + 2[ν]2
×,

I + [ν]× +

η = η0,

η = −η0,

1 − η0 · η
(cid:107)ν(cid:107)2

[ν]2

×, otherwise.

If ones takes η0 = (1, 0, 0), then by the above proof, second layer terms are only
distinguished by the value η0 · γ = γ1, where γ = (γ1, γ2, γ3). Therefore one can
parameterize the second layer with (j, j(cid:48), t) ∈ Z × Z × [0, 1], utilizing coeﬃcients:

(cid:107)|ρ ∗ ψj,·| ∗ ψj(cid:48),r·γ(t)(cid:107)p

(cid:90)

(cid:90)

||ρ ∗ ψj,η| ∗ ψj(cid:48),rηγ(t)(u)|p dη du,

p =
where γ(t) = (1 − t, (cid:112)t(2 − t), 0), t ∈ [0, 1].

S2

R3

B Coulomb Regression Lemmas from Section 8

B.1 Proof of lemma 2

Recall lemma 2 from section 8.1.

Lemma 6 (Restatement of lemma 2). Let ρ be the sum of a Lipschitz function
in L1(R3) and a ﬁnite number of point charges. Then:

1. There exists a constant C such that for any (cid:15) > 0,

2. For each 0 < β < 1, there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

37

(32)

(33)

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Proof of (32). Since ρ ∈ L1(R3), we have ˆρ ∈ L∞(R3) with (cid:107)ˆρ(cid:107)∞ ≤ (cid:107)ρ(cid:107)1.
Using this fact with a change to spherical coordinates yields:

(cid:90)

|ω|<(cid:15)

|ˆρ(ω)|2
|ω|2 dω ≤ (cid:107)ˆρ(cid:107)2

∞

(cid:90)

|ω|−2 dω,

|ω|<(cid:15)

(cid:90) 2π

(cid:90) π

(cid:90) (cid:15)

≤ (cid:107)ρ(cid:107)2
1

0
0
≤ C · (cid:107)ρ(cid:107)2
1 · (cid:15).

0

α−2 · α2 · sin ϑ dα dϑ dϕ,

(cid:90)

(cid:90)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

The proof of (33) is more delicate and will be broken into two cases. Recall
that ρ = ρn − ρ0 where ρ0 ∈ L1(R3) is Lipchitz, and ρn is the sum of a ﬁnite
number of point charges. Thus:

|ˆρ(ω)|2
|ω|2 dω =

(cid:90)

ω>(cid:15)−1

|ω|>(cid:15)−1

|ˆρn(ω)|2 + |ˆρ0(ω)|2 − ˆρn(ω)ˆρ∗

0(ω) − ˆρ∗

n(ω)ˆρ0(ω)

dω.

|ω|2

Additionally using H¨older’s inequality,

0(ω)

ˆρn(ω)ˆρ∗
|ω|2

dω

≤

(cid:32)(cid:90)

(cid:33) 1

2 (cid:32)(cid:90)

|ˆρn(ω)|2
|ω|2

dω

(cid:33) 1

2

dω

.

|ˆρ0(ω)|2
|ω|2

|ω|>(cid:15)−1

|ω|>(cid:15)−1

|ω|>(cid:15)−1

Thus we have separated the proof of (33) into two sub-cases, one for Lipschitz
functions and one for sums of point charges. We begin with the former.

Lemma 7. If ρ ∈ L1(R3) is Lipschitz, there exists a constant C ≥ 1 such that
for any 0 < (cid:15) < 1,

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

ω>(cid:15)−1

Proof of lemma 7. Since ρ is Lipschitz, there exists C (cid:48) ≥ 1 such that

|ˆρ(ω)| ≤

√

C (cid:48)(cid:107)ρ(cid:107)1
1 + |ω|

.

(34)

Therefore:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C (cid:48)(cid:107)ρ(cid:107)2

1

(cid:90)

(1 + |ω|)−2 · |ω|−2 dω,

|ω|>(cid:15)−1
(cid:90) π

(cid:90) 2π

(cid:90) ∞

0

(cid:15)−1

= C (cid:48)(cid:107)ρ(cid:107)2
1

≤ C · (cid:107)ρ(cid:107)2

0
1 · (cid:15).

(1 + α)−2 · α−2 · α2 · sin ϑ dα dϑ dϕ,

For point charges we have:

38

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 8. If ρ is the sum of a ﬁnite number of point charges and 0 < β < 1,
there exists a constant C such that for any 0 < (cid:15) < 1,

(cid:90)

ω>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

For the proof of lemma 8 we deﬁne a function φ : R3 → R with prescribed
decay in space and smoothness in frequency in order to approximate the point
charges. The function φ is deﬁned through its Fourier transform. First deﬁne
the following bump function:

b(ω) =

(cid:40)

(cid:16)

− 1

1−|2ω|2

(cid:17)

,

exp
0,

for |ω| < 1/2,
for |ω| ≥ 1/2.

Then take:

(cid:98)φ(ω) = C · b ∗ b(ω),

where C is chosen so that (cid:98)φ(0) = 1. By construction, (cid:98)φ(0) = 1, 0 ≤ (cid:98)φ ≤ 1,
supp (cid:98)φ ⊂ {|ω| < 1}, and (cid:98)φ ∈ C∞(R3). In space, one has φ ≥ 0, (cid:82) φ = 1, and for
each n ∈ N, there exists a constant Cn > 0 such that

φ(u) ≤

Cn
1 + |u|n .

Deﬁne the s-dilation of φ as:

φs(u) = s−3φ(s−1u),

s > 0,

and note that:

(cid:90)

R3

φs(u) du = 1,

0 ≤ (cid:98)φs ≤ 1,

and supp (cid:98)φs ⊂ {|ω| ≤ s−1}.

Proof of lemma 8. Since ρ is the sum of point charges we write it as:

ρ(u) =

zkδ(u − rk).

(cid:88)

k

Let V (u) = |u|−1 so that (cid:98)V (ω) = 4π|ω|−2. Using (cid:98)φ(cid:15) and the Parseval formula
we bound the quantity of interest:

(cid:90)

|ω|>(cid:15)−1

|ˆρ(ω)|2
|ω|2 dω ≤

(cid:90)

(1 − (cid:98)φ(cid:15)(ω)) dω,

|ˆρ(ω)|2 (cid:98)V (ω) dω −

|ˆρ(ω)|2 (cid:98)V (ω) (cid:98)φ(cid:15)(ω) dω

,

(cid:90)

R3

(cid:19)

(cid:17)

(cid:33)
.

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

(35)

|ˆρ(ω)|2
|ω|2

(cid:18)(cid:90)

R3

1
4π

=

=

R3
(cid:32)

(cid:88)

k(cid:54)=l

(2π)3
4π

(cid:16)

39

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

Lemma 9 below proves that for each 0 < β < 1 there exists a constant C

such that:

∀ k (cid:54)= l and ∀ (cid:15) > 0,

|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)| ≤ C · (cid:15)β.

(36)

Plugging (36) into (35) proves the result, since:

(cid:32)

(2π)3
4π

(cid:88)

k(cid:54)=l

(cid:16)

zkzl

V (rk − rl) − V ∗ φ(cid:15)(rk − rl)

≤

(cid:33)

(cid:17)

zkzl|V (rk − rl) − V ∗ φ(cid:15)(rk − rl)|,

(cid:88)

k(cid:54)=l

≤

(2π)3
4π
≤ C(cid:15)β (cid:88)

zkzl,

k(cid:54)=l
≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)β.

Lemma 9. For each 0 < β < 1 and δ > 0, there exists a constant C such that
for any (cid:15) > 0,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ C · (cid:15)β,

V (u) = |u|−1.

Proof. Fix β and δ, and let n be an arbitrary positive integer that we will select
later. Using φ(cid:15) ≥ 0 and (cid:82) φ(cid:15) = 1, we compute:
(cid:12)
(cid:12)
(cid:12)
(cid:12)

φ(cid:15)(v)(V (u) − V (u − v)) dv

|V (u) − V ∗ φ(cid:15)(u)| =

(cid:12)
(cid:12)
(cid:12)
(cid:12)

R3

(cid:90)

,

≤

(cid:90)

(cid:124)

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv

+

φ(cid:15)(v)|V (u) − V (u − v)| dv

,

(cid:123)(cid:122)
I

(cid:123)(cid:122)
II

(cid:125)

(cid:90)

|v|>γ

(cid:125)

(cid:124)

where γ > 0 is a free parameter that we will set as γ = (cid:15)β at the end of the
proof.

To bound term I, we compute the modulus of continuity of V on |u| ≥ δ:

∀ |u|, |v| ≥ δ,

|V (u) − V (v)| =

||v| − |u||
|u||v|

≤ δ−2|u − v|.

Thus:

(cid:90)

I =

|v|<γ

φ(cid:15)(v)|V (u) − V (u − v)| dv ≤ δ−2 · γ ·

φ(cid:15)(v) dv ≤ δ−2 · γ.

(cid:90)

|v|<γ

Term II is more delicate and will require several steps. We begin with the

40

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

following upper bound:

(cid:90)

(cid:90)

(cid:124)

|v|>γ

|u−v|>γ

II =

φ(cid:15)(v)|V (u) − V (u − v)| dv,

≤

φ(cid:15)(u − v)V (u) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.A

|u−v|>γ

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B

(cid:125)

(cid:90)

The ﬁrst term II.A is bounded by the following calculation:

(cid:90)

II.A =

|u−v|>γ

φ(cid:15)(u − v)V (u) dv ≤ δ−1

φ(cid:15)(v) dv,

(cid:90)

|v|>γ

(cid:90)

≤ Cn · δ−1 · (cid:15)n−3 ·

|v|>γ
≤ C(n, δ) · (cid:15)n−3 · γ3−n,

|v|−n dv,

if n > 3.

Term II.B is split as:

II.B =

φ(cid:15)(u − v)V (v) dv,

(cid:90)

(cid:90)

(cid:124)

|u−v|>γ

|u−v|>γ
|v|<1

=

φ(cid:15)(u − v)V (v) dv

+

φ(cid:15)(u − v)V (v) dv

.

(cid:123)(cid:122)
II.B.i

(cid:125)

(cid:124)

(cid:123)(cid:122)
II.B.ii

(cid:125)

(cid:90)

|u−v|>γ
|v|>1

We bound II.B.i using H¨older’s inequality followed by an argument similar to
the one used for II.A:
(cid:90)

II.B.i =

φ(cid:15)(u − v)V (v) dv,

|u−v|>γ
|v|<1

(cid:32)(cid:90)

≤

φ(cid:15)(u − v)2 dv

(cid:33) 1

2 (cid:32)(cid:90)

(cid:33) 1

2

V (v)2 dv

,

|u−v|>γ

|v|<1

≤ C(n) · (cid:15)n−3 · γ3/2−n.

Term II.B.ii is bounded with the same argument as II.A:

φ(cid:15)(u − v)V (v) dv ≤

φ(cid:15)(v) dv ≤ C(n) · (cid:15)n−3 · γ3−n.

(cid:90)

|v|>γ

(cid:90)

II.B.ii =

|u−v|>γ
|v|>1

In summary,

∀ |u| ≥ δ,

|V (u) − V ∗ φ(cid:15)(u)| ≤ I + II.A + II.B.i + II.B.ii,

≤ C(n, δ) · (γ + (cid:15)n−3 · γ3−n + (cid:15)n−3 · γ3/2−n).

(37)

Recall that γ and n are free parameters. Setting γ = (cid:15)β and n = (6−β)/2(1−β)
completes the proof.

41

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

B.2 Proof of lemma 3

Recall lemma 3 from section 8.1.

Lemma 10 (Restatement of lemma 3). If ρ ∈ L1(R3) decays exponentially fast
as |u| → ∞, then:

(cid:90) (cid:15)−1

(cid:15)

(cid:107)ˆρα(cid:107)2

2 dα =


(cid:107)ˆρ(cid:15)(cid:107)2

2 +

(cid:15)
2

(cid:15)−2−1
(cid:88)

k=2



(cid:107)ˆρk(cid:15)(cid:107)2

2 + (cid:107)ˆρ(cid:15)−1(cid:107)2
2

 + O((cid:15)).

(38)

Proof. The proof is an application of the trapezoid rule from numerical integra-
tion. Recall that it approximates the integral (cid:82) b

a g(α) dα as:

(cid:90) b

a

(cid:32)

b − a
2m

m
(cid:88)

k=2

g(α) dα =

g(a) +

2g(αk) + g(b)

−

(39)

(cid:33)

(b − a)3
12m2 g(2)(ξ)
,
(cid:125)
(cid:123)(cid:122)
error term

(cid:124)

where αk = a + (k − 1)(b − a)/m and ξ ∈ [a, b]. Take a = (cid:15), b = (cid:15)−1, and
2. Since ρ has exponential decay, ˆρ ∈ C∞(R3) with bounded
g(α) = (cid:107)ˆρα(cid:107)2
derivatives of all orders. Therefore the error term can be bounded as:

|error term| ≤ C

((cid:15)−1 − (cid:15))3
m2

= C

(cid:15)3((cid:15)−2 − 1)3
m2

.

Thus if m = (cid:15)−2 − 1, the resulting error term is O((cid:15)) and (38) follows from
(39).

Since ˆρ has bounded derivatives of all orders, lemma 3 can be reﬁned to show
the Coulomb energy U (ρ) can be regressed to accuracy O((cid:15)) with O((cid:15)−1− 2
n+1 )
Fourier coeﬃcients, for any integer n ≥ 0. The parameter n corresponds to the
order of the Newton-Cotes numerical integration scheme [26], where for example
n = 0 and n = 1 correspond to the rectangle and trapezoid rules, respectively.
We omit the details.

B.3 Proof of lemma 5

Lemma 5 is proven as a corollary to lemma 2.

Lemma 11 (Restatement of lemma 5). Suppose that ψ satisﬁes:

(cid:90)

22j

(cid:88)

j∈Z

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ = |ω|−2, ω (cid:54)= 0,

(40)

and

(cid:90)

supp

[0,π]2

| (cid:98)ψ(2jr−1

θ ω)|2 dθ ⊂ {c12−j < |ω| < c22−j+1},

(41)

42

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

where 0 < c1 ≤ c2 < ∞ are universal constants. If ρ is the sum of a Lipschitz
function in L1(R3) and a ﬁnite sum of point charges, then there exists a constant
C such that for any 0 < (cid:15) < 1,

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

(cid:90)

R3

(cid:90)

R3

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15).

2 log2 (cid:15)
(cid:88)

j=−∞

and

+∞
(cid:88)

j=− log2 (cid:15)

Utilizing (41),

and

and

and

Proof. Following the proof of theorem 4,

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

| (cid:98)ψj,θ(ω)|2 dθ dω,

(42)

|ˆρ(ω)|2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

j=−∞

[0,π]2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 =

|ˆρ(ω)|2

| (cid:98)ψj,θ(ω)|2 dθ dω.

(43)

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

2 log2 (cid:15)
(cid:88)

(cid:90)

22j

supp

j=−∞

[0,π]2

supp

+∞
(cid:88)

(cid:90)

22j

j=− log2 (cid:15)

[0,π]2

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| > c1(cid:15)−2},

(44)

| (cid:98)ψj,θ(ω)|2 dθ ⊂ {|ω| < 2c2(cid:15)}.

(45)

Combing (40) with (44) and (45), and plugging into (42) and (43) respectively,
yields:

2 log2 (cid:15)
(cid:88)

j=−∞

+∞
(cid:88)

j=− log2 (cid:15)

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|>c1(cid:15)−2

22j(cid:107)ρ ∗ ψj,·(cid:107)2

2 ≤

(cid:90)

|ˆρ(ω)|2
|ω|2 dω ≤ C · (cid:107)ρ(cid:107)2

1 · (cid:15),

|ω|<2c2(cid:15)

(46)

(47)

where the bound (46) follows from lemma 2, equation (33) with β = 1/2, and
the bound (47) follows from lemma 2, equation (32).

43

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

References

[1] Carlo Adamo and Vincenzo Barone. Toward reliable density functional
methods without adjustable parameters: The PBE0 model. The Journal
of Chemical Physics, 110:6158–6170, 1999. 22

[2] Joakim And´en and St´ephane Mallat. Deep scattering spectrum.

IEEE

Transactions on Signal Processing, 62(16):4114–4128, August 2014. 5

[3] T. A. Arias. Multiresolution analysis of electronic structure: semicardinal
and wavelet bases. Reviews of Modern Physics, 71(1):267–311, January
1999. 5

[4] Albert P. Bart´ok and G´abor Cs´anyi. Gaussian approximation potentials: A
brief tutorial introduction. International Journal of Quantum Chemistry,
115:1051–1057, 2015. 4, 13, 14

[5] Albert P. Bart´ok, Risi Kondor, and G´abor Cs´anyi. On representing chem-
ical environments. Physical Review B, 87(18):184115(16), May 2013. 3, 4,
8, 13, 14, 15

[6] Albert P. Bart´okk, Mike C. Payne, Risi Kondor, and G´abor Cs´anyi. Gaus-
sian approximation potentials: The accuracy of quantum mechanics, with-
out the electrons. Physical Review Letters, 104(13):136403(4), 2010. 4, 13,
14

[7] J¨org Behler. Atom-centered symmetry functions for constructing high-
dimensional neural network potentials. The Journal of Chemical Physics,
134(7):074106, 2011. 3

[8] J¨org Behler and Michele Parrinello. Generalized neural-network representa-
tion of high-dimensional potential-energy surfaces. Physical Review Letters,
98(14):146401(4), 2007. 3, 8

[9] Thomas Blumensath and Mike E. Davies. On the diﬀerence between
least squares. Online at

orthogonal matching pursuit and orthogonal
http://eprints.soton.ac.uk/142469/1/BDOMPvsOLS07.pdf, 2007. 10

[10] Joan Bruna and St´ephane Mallat. Audio texture synthesis with scattering

moments. arXiv:1311.0407, 2013. 5

[11] Joan Bruna and St´ephane Mallat.

Invariant scattering convolution net-
works. IEEE Transactions on Pattern Analysis and Machine Intelligence,
35(8):1872–1886, August 2013. 5

[12] Joan Bruna, St´ephane Mallat, Emmanuel Bacry, and Jean-Francois Muzy.
Intermittent process analysis with scattering moments. Annals of Statistics,
43(1):323 – 351, 2015. 27

44

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[13] Emmanuel Cand´es and Justin Romberg. Sparsity and incoherence in com-

pressive sampling. Inverse Problems, 23:969–985, 2007. 9

[14] S. Chen, C. F. N. Cowan, and P. M. Grant. Orthogonal least squares
learning algorithm for radial basis function networks. IEEE Transactions
on Neural Networks, 2(2):302–309, March 1991. 9

[15] Ingrid Daubechies. Ten Lectures on Wavelets. Society for Industrial and

Applied Mathematics, Philadelphia, PA, USA, 1992. 33

[16] Sandip De, Albert P. Bartok, Gabor Csanyi, and Michele Ceriotti. Com-
paring molecules and solids across structural and alchemical space. Physical
Chemistry Chemical Physics, 18(20):13754–13769, 2016. 3, 4, 13, 14

[17] Peter Deglmann, Ansgar Sch¨afer, and Christian Lennartz. Application of
quantum calculations in the chemical industry - an overview. International
Journal of Quantum Chemistry, 115(3):107–136, 2014. 3

[18] David L. Donoho and Michael Elad. Optimally sparse representation in gen-
eral (non-orthogonal) dictionaries via (cid:96)1 minimization. Proceedings of the
National Academy of Sciences of the United States of America, 100:2197–
2202, 2003. 9

[19] David L. Donoho and Xiaoming Huo.

Uncertainty principles and
ideal atomic decomposition. IEEE Transactions on Information Theory,
47:2845–2862, 2001. 9

[20] Søren Fournais, Thomas Østergaard Sørensen, Maria Hoﬀmann-Ostenhof,
and Thomas Hoﬀmann-Ostenhof. Non-isotropic cusp conditions and reg-
ularity of the electron density of molecules at the nuclei. Annales Henri
Poincar´e, 8(4):731–748, 2007. 33

[21] Luigi Genovese, Alexey Neelov, Stefan Goedecker, Thierry Deutsch,
Seyed Alireza Ghasemi, Alexander Willand, Damien Caliste, Oded Zilber-
berg, Mark Rayson, Anders Bergman, and Reinhold Schneider. Daubechies
wavelets as a basis set for density functional pseudopotential calculations.
The Journal of Chemical Physics, 129(1):014109, 2008. 5

[22] Leslie Greengard. The Rapid Evaluation of Potential Fields in Particle

Systems. MIT Press, Cambridge, 1988. 5, 34

[23] Leslie Greengard and Vladimir Rokhlin. A fast algorithm for particle sim-
ulations. Journal of Computational Physics, 73:325–348, 1987. 5, 34

[24] Johannes Hachmann, Roberto Olivares-Amaya, Sule Atahan-Evrenk, Car-
los Amador-Bedolla, Roel S. S´anchez-Carrera, Aryeh Gold-Parker, Leslie
Vogt, Anna M. Brockway, and Al´an Aspuru-Guzik. The Harvard clean
energy project: Large-scale computational screening and design of organic
photovoltaics on the world community grid. The Journal of Physical Chem-
istry Letters, 2(17):2241–2251, 2011. 3

45

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[25] Katja Hansen, Gr´egoire Montavon, Franziska Biegler, Siamac Fazli,
Matthias Rupp, Matthias Scheﬄer, O. Anatole von Lilienfeld, Alexan-
dre Tkatchenko, and Klaus-Robert M¨uller. Assessment and validation of
machine learning methods for predicting molecular atomization energies.
Journal of Chemical Theory and Computation, 9(8):3404–3419, 2013. 9, 23

[26] Joe D. Hoﬀman. Numerical Methods for Engineers and Scientists. Marcel

Dekker, 2nd edition, 2001. 33, 42

[27] Pierre Hohenberg and Walter Kohn. Inhomogeneous electron gas. Physical

Review, 136(3B):B864–B871, November 1964. 3, 6

[28] Kerwin Hui and Jeng-Da Chai. SCAN-based hybrid and double-hybrid
density functionals from models without ﬁtted parameters. The Journal of
Chemical Physics, 144(4), 2016. 044114. 22, 25

[29] W. Kohn and L. J. Sham. Self-consistent equations including exchange and

correlation eﬀects. Phys. Rev., 140:A1133–A1138, Nov 1965. 6

[30] St´ephane Mallat. A Wavelet Tour of Signal Processing, Third Edition: The

Sparse Way. Academic Press, 3rd edition, 2008. 33

[31] St´ephane Mallat. Group invariant scattering. Communications on Pure

and Applied Mathematics, 65(10):1331–1398, October 2012. 5, 14, 18, 19

[32] Sergei Manzhos, Xiaogang Wang, Richard Dawes, and Tucker Carrington.
A nested molecule-independent neural network approach for high-quality
potential ﬁts. The Journal of Physical Chemistry A, 110(16):5295–5304,
2006. 3

[33] Yves Meyer. Wavelets and Operators, volume 1. Cambridge University

Press, 1993. 33

[34] Yves Meyer and Ronald Coifman. Wavelets: Calder´on-Zygmund and Mul-

tilinear Operators. Cambridge University Press, 2000. 33

[35] Marilyn M. Morrell, Robert G. Parr, and Mel Levy. Calculation of ion-
ization potentials from density matrices and natural functions, and the
long-range behavior of natural orbitals and electron density. Journal of
Chemical Physics, 62(2):549–554, 1975. 33

[36] Jonathan E. Moussa. Comment on ”fast and accurate modeling of molecu-
lar atomization energies with machine learning”. Physical Review Letters,
109(5):059801, August 2012. 9

[37] Szilvia Nagy. Wavelet Based Density Operators, Electron Density and En-
ergy Functionals. PhD thesis, Budapest University of Technology and Eco-
nomics, 2005. 5

46

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[38] Bhaarathi Natarajan, Luigi Genovese, Mark E. Casida, Thierry Deutsch,
Olga N. Burchak, Christian Philouze, and Maxim Y. Balakirev. Wavelet-
based linear-response time-dependent density-functional theory. Chemical
Physics, 402:29–40, 2012. 5

[39] J. C. Pei, G. I. Fann, R. J. Harrison, W. Nazarewicz, Yue Shi, and S. Thorn-
ton. Adaptive multi-resolution 3D Hartree-Fock-Bogoliubov solver for nu-
clear structure. Physical Review C, 90(2):024317(8), 2014. 5

[40] Raghunathan Ramakrishnan, Pavlo O. Dral, Matthias Rupp, and O. Ana-
tole von Lilienfeld. Quantum chemistry structures and properties of 134
kilo molecules. Scientiﬁc Data, 1:140022 EP –, 08 2014. 22

[41] Matthias Rupp, Alexandre Tkatchenko, Klaus-Robert M¨uller, and O. Ana-
tole von Lilienfeld. Fast and accurate modeling of molecular atomization
energies with machine learning. Physical Review Letters, 108(5):058301,
January 2012. 3, 8, 9

[42] Ali Sadeghi, S. Alireza Ghasemi, Bastian Schaefer, Stephan Mohr,
Markus A. Lill, and Stefan Goedecker. Metrics for measuring distances
in conﬁguration spaces. The Journal of Chemical Physics, 139(18):184118,
2013. 3

[43] Laurent Sifre and St´ephane Mallat. Rotation, scaling and deformation
invariant scattering for texture discrimination. In The IEEE Conference
on Computer Vision and Pattern Recognition (CVPR), June 2013. 5, 19

[44] Viktor N. Staroverov. Density-functional approximations for exchange and
correlation.
In N. Sukumar, editor, A Matter of Density: Exploring the
Electron Density Concept in Chemical, Biological, and Materials Sciences,
pages 125–156. John Wiley & Sons, Hoboken, NJ, 2013. 3, 5

[45] Bobby G. Sumpter and Donald W. Noid. Neural networks and graph theory
as computational tools for predicting polymer properties. Macromolecular
Theory and Simulations, 3(2):363–378, 1994. 3

[46] O. Anatole von Lilienfeld, Raghunathan Ramakrishnan, Matthias Rupp,
and Aaron Knoll. Fourier series of atomic radial distribution functions:
A molecular ﬁngerprint for machine learning models of quantum chemical
properties. International Journal of Quantum Chemistry, 115:1084–1093,
2015. 3, 4, 8, 13

[47] Ross C. Walker, Andreas W. G¨otz, Luigi Genovese, Brice Videau, Damien
Caliste, Jean-Fran¸cois M´ehaut, Stefan Goedecker, and Thierry Deutsch.
Electronic Structure Calculations on Graphics Processing Units: From
Quantum Chemistry to Condensed Matter Physics, chapter 6: Wavelet-
Based Density Functional Theory on Massively Parallel Hybrid Architec-
tures. Wiley Periodicals, Inc., 2016. 5

47

Scattering Regression of Quantum Energies

Hirn, Mallat, Poilvert

[48] Takeshi Yanai, George I Fann, Gregory Beylkin, and Robert J Harrison.
Multiresolution quantum chemistry in multiwavelet bases: excited states
from time-dependent Hartree-Fock and density functional theory via lin-
ear response. Physical Chemistry Chemical Physics, 17(47):31405–31416,
February 2015. 5

[49] Li Zhu, Maximilian Amsler, Tobias Fuhrer, Bastian Schaefer, So-
mayeh Faraji, Samare Rostami, S. Alireza Ghasemi, Ali Sadeghi, Migle
Grauzinyte, Chris Wolverton, and Stefan Goedecker. A ﬁngerprint based
metric for measuring similarities of crystalline structures. The Journal of
Chemical Physics, 144(3):034203, 2016. 3

48

